<div class="container">

<table style="width: 100%;"><tr>
<td>E</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Test Which Expectations are Met</h2>

<h3>Description</h3>

<p>Performs a unit test and summarises the results.
</p>


<h3>Usage</h3>

<pre><code class="language-R">E(
  expr,
  ...,
  value_comparer = getOption("realtest_value_comparer", identical),
  sides_comparer = getOption("realtest_sides_comparer", sides_similar),
  postprocessor = getOption("realtest_postprocessor", failstop)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>expr</code></td>
<td>
<p>an expression to be recorded (via <code>R</code>) and
and compared with the prototypes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>a sequence of 1 or more (possibly named) prototypes constructed
via <code>R</code> or <code>P</code> (objects which are not
of class <code>realtest_descriptor</code> will be passed to <code>P</code>);
arguments whose names start with a dot (like <code>.label=value</code>)
can be used to introduce metadata (e.g., additional details
in natural language)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>value_comparer</code></td>
<td>
<p>a two-argument function used (unless overridden
by the prototype) to compare the values with each other,
e.g., <code>identical</code>
or <code>all.equal</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sides_comparer</code></td>
<td>
<p>a two-argument function used (unless overridden
by the prototype) to compare the side effects (essentially: two lists)
with each other, e.g., <code>sides_similar</code>
or <code>ignore_differences</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>postprocessor</code></td>
<td>
<p>a function to call on the generated
<code>realtest_result</code>, e.g., <code>failstop</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Each expression in the R language has a range of possible effects.
The direct effect corresponds to the value generated by evaluating
the expression. Side effects may include errors, warnings, text printed
out on the console, etc., see <code>P</code> and <code>R</code>.
</p>
<p>Arguments passed via <code>...</code> whose names do not start with
a dot should be objects of class <code>realtest_descriptor</code>
(otherwise they are passed to <code>P</code>). They define the
prototypes against which the object generated by <code>expr</code>
will be tested.
</p>
<p><code>value_comparer</code> and <code>sides_comparer</code> are 2-ary functions
that return <code>TRUE</code> if two objects/side effect lists are equivalent
and a character string summarising the differences (or any other kind
or object) otherwise.
</p>
<p>A test case is considered met, whenever
<code>value_comparer(prototype[["value"]], object[["value"]])</code> and
<code>sides_comparer(prototype[["sides"]], object[["sides"]])</code>
are both <code>TRUE</code> for some <code>prototype</code>.
The comparers may be overridden on a per-prototype basis, though.
If <code>prototype[["value_comparer"]]</code> or
<code>prototype[["sides_comparer"]]</code> are defined, these are used
instead.
</p>


<h3>Value</h3>

<p>The function creates an object of class <code>realtest_result</code>,
which is a named list with at least the following components:
</p>

<ul>
<li> <p><code>object</code> – an object of class <code>realtest_descriptor</code>,
ultimately <code>R(expr)</code>,
</p>
</li>
<li> <p><code>prototypes</code> – a (possibly named) list of objects of class
<code>realtest_descriptor</code> that were passed via <code>...</code>,
</p>
</li>
<li> <p><code>matches</code> – a (possibly empty) numeric vector of the indexes
of the prototypes matching the object (can be named),
</p>
</li>
<li> <p><code>.dotted.names</code> – copied as-is
from the arguments of the same name.
</p>
</li>
</ul>
<p>This object is then passed to the <code>postprocessor</code> which itself becomes
responsible for generating the output value to
be returned by the current function (and, e.g., throwing an error
if the test fails).
</p>


<h3>Author(s)</h3>

<p><a href="https://www.gagolewski.com/">Marek Gagolewski</a>
</p>


<h3>See Also</h3>

<p>The official online manual of <span class="pkg">realtest</span> at <a href="https://realtest.gagolewski.com/">https://realtest.gagolewski.com/</a>
</p>
<p>Related functions:
<code>P</code>, <code>R</code>, <code>test_dir</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># the default result postprocessor throws an error on a failed test:
E(E(sqrt(4), P(7)), P(error=TRUE, stdout=TRUE))
E(sqrt(4), 2.0)  # the same as E(sqrt(4), P(2.0))
E(sin(pi), 0.0, value_comparer=all.equal)  # almost-equal
E(
  sample(c("head", "tail"), 1),
  .description="this call has two possible outcomes",
  "head",  # first prototype
  "tail"   # second prototype
)
E(sqrt(-1), P(NaN, warning=TRUE))  # a warning is expected
E(sqrt(-1), NaN, sides_comparer=ignore_differences) # do not test side effects
E(sqrt(-1), P(NaN, warning=NA))  # ignore warnings
E(
  paste0(1:2, 1:3),                  # expression to test - concatenation
  .description="partial recycling",  # info - what behaviour are we testing?
  best=P(                            # what we yearn for (ideally)
    c("11", "22", "13"),
    warning=TRUE
  ),
  pass=c("11", "22", "13"),          # this is the behaviour we have now
  bad=P(error=TRUE)                  # avoid regression
)
e &lt;- E(sin(pi), best=0.0, pass=P(0.0, value_comparer=all.equal),
  .comment="well, this is not a symbolic language after all...")
print(e)

</code></pre>


</div>