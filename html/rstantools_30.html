<div class="container">

<table style="width: 100%;"><tr>
<td>use_rstan</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Add Stan infrastructure to an existing package</h2>

<h3>Description</h3>

<p>Add Stan infrastructure to an existing <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> package. To create a <em>new</em> package
containing Stan programs use <code>rstan_create_package()</code> instead.
</p>


<h3>Usage</h3>

<pre><code class="language-R">use_rstan(pkgdir = ".", license = TRUE, auto_config = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pkgdir</code></td>
<td>
<p>Path to package root folder.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>license</code></td>
<td>
<p>Logical or character; whether or not to paste the contents of
a <code>license.stan</code> file at the top of all Stan code, or path to such a
file.  If <code>TRUE</code> (the default) adds the <code style="white-space: pre;">⁠GPL (&gt;= 3)⁠</code> license (see
<strong>Details</strong>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>auto_config</code></td>
<td>
<p>Whether to automatically configure Stan functionality
whenever the package gets installed (see <strong>Details</strong>). Defaults to <code>TRUE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Prepares a package to compile and use Stan code by performing the
following steps:
</p>

<ol>
<li>
<p> Create <code>inst/stan</code> folder where all <code>.stan</code> files defining
Stan models should be stored.
</p>
</li>
<li>
<p> Create <code>inst/stan/include</code> where optional <code>license.stan</code> file is stored.
</p>
</li>
<li>
<p> Create <code>inst/include/stan_meta_header.hpp</code> to include optional header
files used by Stan code.
</p>
</li>
<li>
<p> Create <code>src</code> folder (if it doesn't exist) to contain the Stan C++ code.
</p>
</li>
<li>
<p> Create <code>R</code> folder (if it doesn't exist) to contain wrapper code to expose
Stan C++ classes to <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span>.
</p>
</li>
<li>
<p> Update <code>DESCRIPTION</code> file to contain all needed dependencies to compile
Stan C++ code.
</p>
</li>
<li>
<p> If <code>NAMESPACE</code> file is generic (i.e., created by <code>rstan_create_package()</code>),
append <code>import(Rcpp, methods)</code>, <code>importFrom(rstan, sampling)</code>,
<code>importFrom(rstantools, rstan_config)</code>, <code>importFrom(RcppParallel, RcppParallelLibs)</code>,
and <code>useDynLib</code> directives.  If <code>NAMESPACE</code> is not generic, display message
telling user what to add to <code>NAMESPACE</code> for themselves.
</p>
</li>
</ol>
<p>When <code>auto_config = TRUE</code>, a <code>configure[.win]</code> file is added to the
package, calling <code>rstan_config()</code> whenever the package is installed.
Consequently, the package must list <span class="pkg">rstantools</span> in the <code>DESCRIPTION</code>
Imports field for this mechanism to work.  Setting <code>auto_config = FALSE</code>
removes the package's dependency on <span class="pkg">rstantools</span>, but the package then
must be manually configured by running <code>rstan_config()</code> whenever
<code>stanmodel</code> files in <code>inst/stan</code> are added, removed, or modified.
</p>


<h3>Value</h3>

<p>Invisibly, <code>TRUE</code> or <code>FALSE</code> indicating whether or not any files or
folders where created or modified.
</p>


<h3>Using the pre-compiled Stan programs in your package</h3>

<p>The
<code>stanmodel</code> objects corresponding to the Stan programs included with your
package are stored in a list called <code>stanmodels</code>. To run one of the Stan
programs from within an R function in your package just pass the
appropriate element of the <code>stanmodels</code> list to one of the <span class="pkg">rstan</span>
functions for model fitting (e.g., <code>sampling()</code>). For example, for a Stan
program <code>"foo.stan"</code> you would use <code>rstan::sampling(stanmodels$foo, ...)</code>.
</p>


</div>