<div class="container">

<table style="width: 100%;"><tr>
<td>TSHT</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Two-Stage Hard Thresholding</h2>

<h3>Description</h3>

<p>Perform Two-Stage Hard Thresholding method, which provides the robust inference of the treatment effect in the presence of invalid instrumental variables.
</p>


<h3>Usage</h3>

<pre><code class="language-R">TSHT(
  Y,
  D,
  Z,
  X,
  intercept = TRUE,
  method = c("OLS", "DeLasso", "Fast.DeLasso"),
  voting = c("MaxClique", "MP", "Conservative"),
  robust = TRUE,
  alpha = 0.05,
  tuning.1st = NULL,
  tuning.2nd = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>The outcome observation, a vector of length <code class="reqn">n</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>D</code></td>
<td>
<p>The treatment observation, a vector of length <code class="reqn">n</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z</code></td>
<td>
<p>The instrument observation of dimension <code class="reqn">n \times p_z</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>The covariates observation of dimension <code class="reqn">n \times p_x</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>
<p>Whether the intercept is included. (default = <code>TRUE</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>The method used to estimate the reduced form parameters. <code>"OLS"</code> stands for ordinary least squares, <code>"DeLasso"</code> stands for the debiased Lasso estimator, and <code>"Fast.DeLasso"</code> stands for the debiased Lasso estimator with fast algorithm. (default = <code>"OLS"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>voting</code></td>
<td>
<p>The voting option used to estimate valid IVs. <code>'MP'</code> stands for majority and plurality voting, <code>'MaxClique'</code> stands for finding maximal clique in the IV voting matrix, and <code>'Conservative'</code> stands for conservative voting procedure. Conservative voting is used to get an initial estimator of valid IVs in the Searching-Sampling method. (default= <code>'MaxClique'</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>robust</code></td>
<td>
<p>If <code>TRUE</code>, the method is robust to heteroskedastic errors. If <code>FALSE</code>, the method assumes homoskedastic errors. (default = <code>TRUE</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>The significance level for the confidence interval. (default = <code>0.05</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tuning.1st</code></td>
<td>
<p>The tuning parameter used in the 1st stage to select relevant instruments. If <code>NULL</code>, it will be generated data-dependently, see Details. (default=<code>NULL</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tuning.2nd</code></td>
<td>
<p>The tuning parameter used in the 2nd stage to select valid instruments. If <code>NULL</code>, it will be generated data-dependently, see Details. (default=<code>NULL</code>)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>When <code>robust = TRUE</code>, the <code>method</code> will be input as <code>’OLS’</code>.
When <code>voting = MaxClique</code> and there are multiple maximum cliques, <code>betaHat</code>,<code>beta.sdHat</code>,<code>ci</code>, and <code>VHat</code> will be list objects
where each element of list corresponds to each maximum clique.
As for tuning parameter in the 1st stage and 2nd stage, if do not specify, for method "OLS" we adopt <code class="reqn">\sqrt{\log n}</code> for both tuning parameters, and for other methods
we adopt <code class="reqn">\max{(\sqrt{2.01 \log p_z}, \sqrt{\log n})}</code> for both tuning parameters.
</p>


<h3>Value</h3>

<p><code>TSHT</code> returns an object of class "TSHT", which is a list containing the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>betaHat</code></td>
<td>
<p>The estimate of treatment effect.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta.sdHat</code></td>
<td>
<p>The estimated standard error of <code>betaHat</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci</code></td>
<td>
<p>The 1-alpha confidence interval for <code>beta</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SHat</code></td>
<td>
<p>The set of selected relevant IVs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>VHat</code></td>
<td>
<p>The set of selected relevant and valid IVs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>voting.mat</code></td>
<td>
<p>The voting matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check</code></td>
<td>
<p>The indicator that the majority rule is satisfied.</p>
</td>
</tr>
</table>
<h3>References</h3>


<p>Guo, Z., Kang, H., Tony Cai, T. and Small, D.S. (2018), Confidence intervals for causal effects with invalid instruments by using two-stage hard thresholding with voting, <em>J. R. Stat. Soc. B</em>, 80: 793-815. <br></p>


<h3>Examples</h3>

<pre><code class="language-R">data("lineardata")
Y &lt;- lineardata[,"Y"]
D &lt;- lineardata[,"D"]
Z &lt;- as.matrix(lineardata[,c("Z.1","Z.2","Z.3","Z.4","Z.5","Z.6","Z.7","Z.8")])
X &lt;- as.matrix(lineardata[,c("age","sex")])
TSHT.model &lt;- TSHT(Y=Y,D=D,Z=Z,X=X)
summary(TSHT.model)

</code></pre>


</div>