<div class="container">

<table style="width: 100%;"><tr>
<td>late.regu.cv</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Model-assisted inference for local average treatment effects (LATEs) with instrumental variables based on cross validation</h2>

<h3>Description</h3>

<p>This function implements model-assisted inference for LATEs with instrumental variables, using regularized calibrated estimation based on cross validation.
</p>


<h3>Usage</h3>

<pre><code class="language-R">late.regu.cv(fold, nrho = NULL, rho.seq = NULL, y, tr, iv, fx, gx, hx,
  arm = 2, d1 = NULL, d2 = NULL, ploss = "cal", yloss = "gaus",
  off = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fold</code></td>
<td>
<p>A vector of length 3 giving the fold numbers for cross validation in instrument propensity score estimation, treatment and outcome regressions respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrho</code></td>
<td>
<p>A vector of length 3 giving the numbers of tuning parameters searched in cross validation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho.seq</code></td>
<td>
<p>A list of three vectors giving the tuning parameters in instrument propensity score estimation (first vector), treatment (second vector) and outcome (third vector) regressions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>An <code class="reqn">n</code> x <code class="reqn">1</code> vector of observed outcomes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tr</code></td>
<td>
<p>An <code class="reqn">n</code> x <code class="reqn">1</code> vector of treatment indicators (=1 if treated or 0 if untreated).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iv</code></td>
<td>
<p>An <code class="reqn">n</code> x <code class="reqn">1</code> vector of instruments (0 or 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fx</code></td>
<td>
<p>An <code class="reqn">n</code> x <code class="reqn">p</code> matix of covariates, used in the instrument propensity score model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gx</code></td>
<td>
<p>An <code class="reqn">n</code> x <code class="reqn">q_1</code> matix of covariates, used in the treatment regression models. In theory, <code>gx</code> should be a subvector of <code>gx</code>, hence <code class="reqn">p\leq q_1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hx</code></td>
<td>
<p>An <code class="reqn">n</code> x <code class="reqn">q_2</code> matix of covariates, used in the outcome regression models. In theory, <code>hx</code> should be a subvector of <code>hx</code>, hence <code class="reqn">p\leq q_2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>arm</code></td>
<td>
<p>An integer 0, 1 or 2 indicating whether <code class="reqn">\theta_0</code>, <code class="reqn">\theta_1</code> or both are computed; see <strong>Details</strong> for <code>late.aipw</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d1</code></td>
<td>
<p>Degree of truncated polynomials of fitted values from treatment regression to be included as regressors in the outcome regression (NULL: no adjustment, 0: piecewise constant, 1: piecewise linear etc.).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d2</code></td>
<td>
<p>Number of knots of fitted values from treatment regression to be included as regressors in the outcome regression, with knots specified as the <code class="reqn">i</code>/(<code>d2</code>+1)-quantiles for <code class="reqn">i</code>=1,...,<code>d2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ploss</code></td>
<td>
<p>A loss function used in instrument propensity score estimation (either "ml" for likelihood estimation or "cal" for calibrated estimation).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yloss</code></td>
<td>
<p>A loss function used in outcome regression (either "gaus" for continuous outcomes or "ml" for binary outcomes).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>off</code></td>
<td>
<p>A <code class="reqn">2</code> x <code class="reqn">1</code> vector of offset values (e.g., the true values in simulations) used to calculate the z-statistics from augmented IPW estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to <code>glm.regu.cv</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For <code>ploss</code>="cal", regularized calibrated estimation of the instrument propensity score (IPS) and regularized weighted likelihood estimation of the treatment and outcome regression models are performed. The method leads to model-assisted inference for LATE, in which condidence intervals are valid
with high-dimensional data if the IPS model is correctly specified, but the treatment and outcome regression models may be misspecified (Sun and Tan 2020). For <code>ploss</code>="ml", regularized maximum likelihood estimation is used (Chernozhukov et al. 2018). In this case, standard errors are only shown to be valid if the IPS, treatment and outcome models are all correctly specified.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ips</code></td>
<td>
<p>A list containing the results from fitting the instrument propensity score models by <code>glm.regu.cv</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mfp</code></td>
<td>
<p>An <code class="reqn">n</code> x <code class="reqn">2</code> matrix of fitted instrument propensity scores for <code>iv</code>=0 (first column) and <code>iv</code>=1 (second column).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tps</code></td>
<td>
<p>A list containing the results from fitting the treatment regression models by <code>glm.regu.cv</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mft</code></td>
<td>
<p>An <code class="reqn">n</code> x <code class="reqn">2</code> matrix of fitted treatment regression models for <code>iv</code>=0 (first column) and <code>iv</code>=1 (second column).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>or</code></td>
<td>
<p>A list containing the results from fitting the outcome regression models by <code>glm.regu.cv</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mfo</code></td>
<td>
<p>An <code class="reqn">n</code> x <code class="reqn">4</code> matrix of fitted outcome regression models for for <code>iv</code>=0, <code>tr</code>=0 (first column), <code>iv</code>=0, <code>tr</code>=1 (second column), <code>iv</code>=1, <code>tr</code>=0 (third column) and  <code>iv</code>=1, <code>tr</code>=1 (fourth column). Two columns are set to <code>NA</code> if <code>arm</code>=0 or 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est</code></td>
<td>
<p>A list containing the results from augmented IPW estimation by <code>late.aipw</code>.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Chernozhukov, V., Chetverikov, D., Demirer, M., Duflo, E., Hansen, C., Newey, W. and Robins, J.M. (2018) Double/debiased machine learning for treatment and structural parameters, <em>The Econometrics Journal</em>, 21, C1â€“C68.
</p>
<p>Sun, B. and Tan, Z. (2020) High-dimensional model-assisted inference for local average treatment effects with instrumental variables, arXiv:2009.09286.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
data(simu.iv.data)
n &lt;- dim(simu.iv.data)[1]
p &lt;- dim(simu.iv.data)[2]-3

y &lt;- simu.iv.data[,1]
tr &lt;- simu.iv.data[,2]
iv &lt;- simu.iv.data[,3]
x &lt;- simu.iv.data[,3+1:p]
x &lt;- scale(x)

late.cv.rcal &lt;- late.regu.cv(fold=5*c(1,1,1), nrho=(1+10)*c(1,1,1), rho.seq=NULL, 
                 y, tr, iv, fx=x, gx=x, hx=x, arm=2, d1=1, d2=3, ploss="cal", yloss="gaus")

matrix(unlist(late.cv.rcal$est), ncol=2, byrow=TRUE, 
dimnames=list(c("ipw", "or", "est", "var", "ze", 
 "late.est", "late.var", "late.ze"), c("theta1", "theta0")))


</code></pre>


</div>