<div class="container">

<table style="width: 100%;"><tr>
<td>optimizeNewData</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Perform factorization for new data</h2>

<h3>Description</h3>

<p>Uses an efficient strategy for updating that takes advantage of
the information in the existing factorization. Assumes that variable features
are presented in the new datasets. Two modes are supported (controlled by
<code>merge</code>):
</p>

<ul>
<li>
<p>Append new data to existing datasets specified by <code>useDatasets</code>.
Here the existing <code class="reqn">V</code> matrices for the target datasets will directly be
used as initialization, and new <code class="reqn">H</code> matrices for the merged matrices will
be initialized accordingly.
</p>
</li>
<li>
<p>Set new data as new datasets. Initial <code class="reqn">V</code> matrices for them will
be copied from datasets specified by <code>useDatasets</code>, and new <code class="reqn">H</code>
matrices will be initialized accordingly.
</p>
</li>
</ul>
<h3>Usage</h3>

<pre><code class="language-R">optimizeNewData(
  object,
  dataNew,
  useDatasets,
  merge = TRUE,
  lambda = NULL,
  nIteration = 30,
  seed = 1,
  verbose = getOption("ligerVerbose"),
  new.data = dataNew,
  which.datasets = useDatasets,
  add.to.existing = merge,
  max.iters = nIteration,
  thresh = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>A liger object. Should have integrative
factorization performed e.g. (<code>runINMF</code>) in advance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dataNew</code></td>
<td>
<p>Named list of <b>raw count</b> matrices, genes by cells.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useDatasets</code></td>
<td>
<p>Selection of datasets to append new data to if
<code>merge = TRUE</code>, or the datasets to inherit <code class="reqn">V</code> matrices from and
initialize the optimization when <code>merge = FALSE</code>. Should match the
length and order of <code>dataNew</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>merge</code></td>
<td>
<p>Logical, whether to add the new data to existing
datasets or treat as totally new datasets (i.e. calculate new <code class="reqn">V</code>
matrices). Default <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>Numeric regularization parameter. By default <code>NULL</code>, this
will use the lambda value used in the latest factorization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nIteration</code></td>
<td>
<p>Number of block coordinate descent iterations to perform.
Default <code>30</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>Random seed to allow reproducible results. Default <code>1</code>. Used
by <code>runINMF</code> factorization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical. Whether to show information of the progress. Default
<code>getOption("ligerVerbose")</code> which is <code>TRUE</code> if users have not set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new.data, which.datasets, add.to.existing, max.iters</code></td>
<td>
<p>These arguments are
now replaced by others and will be removed in the future. Please see usage
for replacement.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thresh</code></td>
<td>
<p><b>Deprecated</b>. New implementation of iNMF does not require
a threshold for convergence detection. Setting a large enough
<code>nIteration</code> will bring it to convergence.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>object</code> with <code>W</code> slot updated with the new <code class="reqn">W</code>
matrix, and the <code>H</code> and <code>V</code> slots of each
ligerDataset object in the <code>datasets</code> slot updated with
the new dataset specific <code class="reqn">H</code> and <code class="reqn">V</code> matrix, respectively.
</p>


<h3>See Also</h3>

<p><code>runINMF</code>, <code>optimizeNewK</code>,
<code>optimizeNewLambda</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">pbmc &lt;- normalize(pbmc)
pbmc &lt;- selectGenes(pbmc)
pbmc &lt;- scaleNotCenter(pbmc)
# Only running a few iterations for fast examples
if (requireNamespace("RcppPlanc", quietly = TRUE)) {
    pbmc &lt;- runINMF(pbmc, k = 20, nIteration = 2)
    # Create fake new data by increasing all non-zero count in "ctrl" by 1,
    # and make unique cell identifiers
    ctrl2 &lt;- rawData(dataset(pbmc, "ctrl"))
    ctrl2@x &lt;- ctrl2@x + 1
    colnames(ctrl2) &lt;- paste0(colnames(ctrl2), 2)
    pbmcNew &lt;- optimizeNewData(pbmc, dataNew = list(ctrl2 = ctrl2),
                               useDatasets = "ctrl", nIteration = 2)
}
</code></pre>


</div>