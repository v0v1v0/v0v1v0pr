<div class="container">

<table style="width: 100%;"><tr>
<td>getDistFromSource</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Moving window approach to get distance from source</h2>

<h3>Description</h3>

<p>This function is deprecated please use <code>terra::distance()</code>. Note that you need
to set <code>target = 0</code> to get distances from cells that are zero to cells that
are non-zero.
</p>


<h3>Usage</h3>

<pre><code class="language-R">getDistFromSource(src, maxDist, kwidth = 3, method = "terra", override = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>src</code></td>
<td>
<p><code>SpatRaster</code> or RasterLayer, where all values &gt; 0 are treated as
source locations. NA values are treated as 0s.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxDist</code></td>
<td>
<p>Numeric, maximum distance that should be calculated in units of
the CRS.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kwidth</code></td>
<td>
<p>Integer, for the "pfocal" and "terra" methods the width of the
moving window. For the "pfocal2" method the aggregation factor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Character, the method to use, currently only "terra" supported
with the CRAN version, while "pfocal" or "pfocal2" are available with the
development version. See below for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>override</code></td>
<td>
<p>Logical, if TRUE will use the old deprecated function.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function provides three different methods for calculating the distance of
all points on a landscape from "source" locations. This is a computationally
intensive process so the function arguments can be used to balance the
tradeoffs between speed and accuracy. Note the pfocal versions are only
available in the development version of the package.
</p>
<p>The "terra" and "pfocal" methods use an iterative moving window approach and
assign each cell a distance based on the number of times the moving window is
repeated before it is included. This means that the moving window function is
run many times but for a small window relative to the size of the raster. The
<code>maxDist</code> argument determines the maximum distance calculated and affects the
number of iterations of the moving window that are needed. <code>kwidth</code> is the
radius of the moving window in number of cells, with larger values reducing
the number of iterations needed but also reducing the granularity of the
distances produced. The resulting distances will be in increments of <code>kwidth</code>
</p>

<ul><li>
<p> the resolution of the raster. The total number of iterations is <code>maxDist</code>/
<code>kwidth</code> * resolution. The only difference in these methods is the underlying
package used to do the moving window. The <code>terra</code> package has methods for
handling large rasters by writing them to disk, while the <code>pfocal</code> package
requires that the raster can be held in memory as a matrix.
</p>
</li></ul>
<p>The third method "pfocal2" uses a global moving window to calculate the
distance to the source. This means that the moving window only needs to be
applied once but the window size can be very large. In this case <code>maxDist</code>
determines the total size of the window. <code>kwidth</code> can be used to reduce the
number of cells included in the moving window by aggregating the source raster
by a factor of <code>kwidth</code>. This will increase the speed of computation but will
produce results with artefacts of the larger grid and which may be less
accurate since the output raster is disaggregated using bilinear
interpolation.
</p>


<h3>Value</h3>

<p>A SpatRaster
</p>


<h3>Examples</h3>

<pre><code class="language-R">
CLUSexample &lt;-  prepExData(CLUSexample)
# Deprecated
# getDistFromSource(CLUSexample$roads, 5, 2)

# Use terra::distance instead
terra::distance(CLUSexample$roads, target = 0)


 library(sf)
 library(terra)

#make example roads from scratch
rds &lt;- data.frame(x = 1:1000/100, y = cos(1:1000/100)) %&gt;%
  st_as_sf(coords = c("x", "y")) %&gt;%
  st_union() %&gt;%
  st_cast("LINESTRING")

rds_rast &lt;- rasterize(vect(rds),
                      rast(nrows = 50, ncols = 50,
                           xmin = 0, xmax = 10,
                           ymin = -5, ymax = 5),
                      touches = TRUE)

terra::distance(rds_rast)

# or straight from the line
terra::distance(rds_rast, terra::vect(rds %&gt;% st_set_crs(st_crs(rds_rast))))

</code></pre>


</div>