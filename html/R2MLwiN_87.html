<div class="container">

<table style="width: 100%;"><tr>
<td>write.IGLS</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Writes MLwiN macros to fit models using the iterative generalized least
squares (IGLS) algorithm.</h2>

<h3>Description</h3>

<p>write.IGLS is an internal function which creates an MLwiN macro file to
fit a multilevel model using IGLS.
</p>


<h3>Usage</h3>

<pre><code class="language-R">write.IGLS(
  indata,
  dtafile,
  oldsyntax = FALSE,
  resp,
  levID,
  expl,
  rp,
  D = "Normal",
  nonlinear = c(0, 1),
  categ = NULL,
  notation = NULL,
  nonfp = NA,
  clre = NULL,
  Meth = 1,
  extra = FALSE,
  reset,
  rcon = NULL,
  fcon = NULL,
  maxiter = 20,
  convtol = 2,
  mem.init = "default",
  optimat = FALSE,
  weighting = NULL,
  fpsandwich = FALSE,
  rpsandwich = FALSE,
  macrofile,
  IGLSfile,
  resifile,
  resi.store = FALSE,
  resioptions,
  debugmode = FALSE,
  startval = NULL,
  namemap = sapply(colnames(indata), as.character),
  saveworksheet = NULL,
  rng.version = 10
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>indata</code></td>
<td>
<p>A data.frame object containing the data to be modelled.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dtafile</code></td>
<td>
<p>The name of the temporary file used to send the data to MLwiN, which
is in Stata format (i.e. with extension .dta).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>oldsyntax</code></td>
<td>
<p>Specified as <code>FALSE</code> if new syntax has been used in
<code>Formula</code> object, else specified as <code>TRUE</code> (to enable
back-compatibility).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resp</code></td>
<td>
<p>A character string (vector) of the response variable name(s).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>levID</code></td>
<td>
<p>A character string (vector) of the specified level ID name(s). The
ID(s) should be sorted in the descending order of levels (e.g.
<code>levID = c('level2', 'level1')</code> where <code>'level2'</code> is the higher
level).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expl</code></td>
<td>
<p>A character string (vector) of explanatory (predictor)
variable name(s).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rp</code></td>
<td>
<p>A character string (vector) of random part of random variable name(s).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>D</code></td>
<td>
<p>A character string/vector specifying the type of distribution to be modelled, which
can include <code>'Normal'</code> (the default), <code>'Binomial'</code>, <code>'Poisson'</code>,
<code>'Negbinom'</code>, <code>'Unordered Multinomial'</code>, <code>'Ordered Multinomial'</code>,
<code>'Multivariate Normal'</code>, or <code>'Mixed'</code>. In the case of the latter, 
<code>'Mixed'</code> precedes the response types which also need to be listed in 
<code>D</code>, e.g. <code>c('Mixed', 'Normal', 'Binomial')</code>; these need to be
be listed in the same order to which they are referred to in the
<code>Formula</code> object (see <code>runMLwiN</code>, <code>Formula.translate</code>,
<code>Formula.translate.compat</code>. <code>'Mixed'</code> combinations can consist of
<code>'Normal'</code> and <code>'Binomial'</code> or <code>'Normal'</code> and <code>'Poisson'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nonlinear</code></td>
<td>
<p>A character vector specifying linearisation method for discrete
response models (see Chapter 9 of Rasbash et al 2012, and Goldstein 2011).
<code>N = 0</code> specifies marginal quasi-likelihood
linearization (MQL), whilst <code>N = 1</code> specifies penalised quasi-
likelihood linearization (PQL); <code>M = 1</code> specifies first order
approximation, whilst <code>M = 2</code> specifies second order approximation.
<code>nonlinear = c(N = 0, M = 1)</code> by default. First order marginal
quasi-likelihood (MQL1) only option for single-level discrete response
models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>categ</code></td>
<td>
<p>Specifies categorical variable(s) as a matrix. Each column
corresponds to a categorical variable; the first row specifies the name(s)
of variable(s); the second row specifies the name(s) of reference group(s),
<code>NA</code>(s) if no reference group; the third row states the number of
categories for each variable. Supports back-compatibility with <span class="pkg">R2MLwiN</span>
versions &lt;0.8-0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>notation</code></td>
<td>
<p>Specifies the model subscript notation to be used in the
MLwiN equations window. <code>'class'</code> means no multiple subscripts, whereas
<code>'level'</code> has multiple subscripts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nonfp</code></td>
<td>
<p>Removes the fixed part of random variable(s). <code>NA</code> if no
variable to be removed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clre</code></td>
<td>
<p>A matrix used to define which elements of the random effects matrix
to remove (i.e. hold constant at zero). Removes
from the random part at level &lt;first row&gt; the covariance matrix element(s)
defined by the pair(s) of rows &lt;second row&gt; &lt;third row&gt;. Each column
corresponds to a removed entry of the covariance matrix. See e.g. <code>demo(UserGuide07)</code>
for an example.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Meth</code></td>
<td>
<p>Specifies which maximum likelihood estimation method to be used.
If <code>Meth = 0</code> estimation method is set to RIGLS. If <code>Meth = 1</code>
estimation method is set to IGLS (the default setting).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extra</code></td>
<td>
<p>If <code>TRUE</code>, extra binomial, extra negative binomial,
extra Poisson or extra multinomial distributions assumed, else <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reset</code></td>
<td>
<p>A vector of <code>length(levID)</code> specifying the action to be
taken, at each level, if a variance parameter is estimated at a particular
iteration to be negative during estimation. Values specified in
ascending order of level hierarchy: if <code>0</code> a negative variance
estimate is reset to zero and so are any associated covariances; if <code>1</code>
a negative variance estimate is reset to zero but not the associated
covariances; if <code>2</code> no resetting takes place. E.g. <code>reset = c(0, 1)</code>
to assign value <code>0</code> to level 1 and value <code>1</code> to level 2 of
two-level model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rcon</code></td>
<td>
<p>Matrix specifying constraints on the random parameters as
specified in <code>random.ui</code> and <code>random.ci</code> in the <code>constraints</code>
option within <code>estoptions</code> (see <code>runMLwiN</code>). <code>random.ci</code>
is appended to the bottom row of <code>random.ui</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fcon</code></td>
<td>
<p>Matrix specifying constraints on the fixed coefficients as
specified in <code>fixed.ui</code> and <code>fixed.ci</code> in the <code>constraints</code>
option within <code>estoptions</code> (see <code>runMLwiN</code>). <code>fixed.ci</code>
is appended to the bottom row of <code>fixed.ui</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxiter</code></td>
<td>
<p>Numeric value specifying the maximum number of iterations, from
the start, before estimation halts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>convtol</code></td>
<td>
<p>Numeric value specifying the convergence criterion, as
specified in the <code>tol</code> option within <code>estoptions</code> (see
<code>runMLwiN</code>). If value of <code>convtol</code> is m, estimation will be
deemed to have converged when the relative change in the estimate for all
parameters from one iteration to the next is less than 10(-m). Defaults to
value of <code>2</code> for m if not otherwise specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mem.init</code></td>
<td>
<p>If calling write.IGLS directly, if wish to use defaults, value needs to be
specified as <code>'default'</code>, else specify a vector of length 5 corresponding
to the following order: number of levels; worksheet size in thousands of cells;
the number of columns; the number of explanatory variables; the number of group
labels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optimat</code></td>
<td>
<p>This option instructs MLwiN to limit the maximum matrix size
that can be allocated by the (R)IGLS algorithm. Specify <code>optimat = TRUE</code>
if MLwiN gives the following error message 'Overflow allocating smatrix'.
This error message arises if one more higher-level units is extremely large
(contains more than 800 lower-level units). In this situation <span class="pkg">R2MLwiN</span>'s
default behaviour is to instruct MLwiN to allocate a larger matrix size to
the (R)IGLS algorithm than is currently possible. Specifying
<code>optimat = TRUE</code> caps the maximum matrix size at 800 lower-level units,
circumventing the MLwiN error message, and allowing most MLwiN
functionality.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weighting</code></td>
<td>
<p>A list of two items, one of which is a list called <code>weightvar</code>
the length of which corresponds
to the number of levels in the model, in descending order from highest level first.
The other is an option <code>standardised</code> which is <code>TRUE</code> or <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fpsandwich</code></td>
<td>
<p>Specifies standard error type for fixed parameters. If
<code>fpsandwich = TRUE</code>, robust or ‘sandwich’ standard errors based on raw
residuals are used, if <code>fpsandwich = FALSE</code> (default) then standard,
uncorrected, IGLS or RIGLS computation used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rpsandwich</code></td>
<td>
<p>Specifies standard error type for random parameters. If
<code>rpsandwich = TRUE</code>, robust or ‘sandwich’ standard errors based on raw
residuals are used, if <code>rpsandwich = FALSE</code> (default) then standard,
uncorrected, IGLS or RIGLS ‘plug in’ estimates used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>macrofile</code></td>
<td>
<p>A file name where the MLwiN macro file will be saved. The
default location is in the temporary folder.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>IGLSfile</code></td>
<td>
<p>A file name where the parameter estimates will be saved. The
default location is in the temporary folder.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resifile</code></td>
<td>
<p>A file name where the residuals will be saved. The default
location is in the temporary folder.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resi.store</code></td>
<td>
<p>A logical value to indicate if the residuals are to be
stored (<code>TRUE</code>) or not (<code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resioptions</code></td>
<td>
<p>A string vector to specify the various residual options.
The <code>'variances'</code> option calculates the posterior variances instead of
the posterior standard errors; the <code>'standardised'</code>, <code>'leverage'</code>,
<code>'influence'</code> and <code>'deletion'</code> options calculate standardised,
leverage, influence and deletion residuals respectively; the
<code>'sampling'</code> option calculates the sampling variance covariance matrix
for the residuals; the <code>'norecode'</code> option prevents residuals with
values exceedingly close or equal to zero from being recoded to missing; the
reflate option returns unshrunken residuals. Note that the default option is
<code>resioptions = c('variance')</code>; <code>'variance'</code> cannot be used together
with the other options to calculate standardised, leverage, influence and
deletion residuals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>debugmode</code></td>
<td>
<p>A logical value determining whether MLwiN is run in the
background or not. The default value is <code>FALSE</code>: i.e. MLwiN is run in
the background. If <code>TRUE</code> the MLwiN GUI is opened, and then pauses after the model
has been set-up, allowing user to check starting values; pressing 'Resume macro'
will then fit the model. Once fit, pressing 'Resume macro' once more will save
the outputs to the <code>workdir</code> ready to be read by <span class="pkg">R2MLwiN</span>. Users can
instead opt to 'Abort macro' in which case the outputs are not saved to the
<code>workdir</code>. This option currently
works for 32 bit version of MLwiN only (automatically switches unless
<code>MLwiNPath</code> or <code>options(MLwiNPath)</code>
has been set directly to the executable).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>startval</code></td>
<td>
<p>A list of numeric vectors specifying the starting values.
<code>FP.b</code> corresponds to the estimates for the fixed
part; <code>FP.v</code> specifies the variance/covariance estimates for the fixed
part; <code>RP.b</code> specifies the variance estimates for the random part;
<code>RP.v</code> corresponds to the variance/covariance matrix of the variance
estimates for the random part.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>namemap</code></td>
<td>
<p>A mapping of column names to DTA friendly shorter names</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveworksheet</code></td>
<td>
<p>A file name used to store the MLwiN worksheet after the
model has been estimated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rng.version</code></td>
<td>
<p>An integer indicating which random number generator should
be used by MLwiN.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Outputs a modified version of namemap containing newly generated
short names.
</p>


<h3>Author(s)</h3>

<p>Zhang, Z., Charlton, C.M.J., Parker, R.M.A., Leckie, G., and Browne,
W.J. (2016) Centre for Multilevel Modelling, University of Bristol.
</p>


<h3>References</h3>

<p>Goldstein, H. (2011) Multilevel Statistical Models. 4th Edition. London: John Wiley and Sons.
</p>
<p>Rasbash, J., Steele, F., Browne, W.J. and Goldstein, H. (2012)
A User's Guide to MLwiN Version 2.26. Centre for Multilevel Modelling,
University of Bristol.
</p>


<h3>See Also</h3>

<p><code>write.MCMC</code>
</p>


</div>