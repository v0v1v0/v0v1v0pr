<div class="container">

<table style="width: 100%;"><tr>
<td>redcap_read_oneshot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Read/Export records from a REDCap project</h2>

<h3>Description</h3>

<p>This function uses REDCap's API to select and return data.
</p>


<h3>Usage</h3>

<pre><code class="language-R">redcap_read_oneshot(
  redcap_uri,
  token,
  records = NULL,
  fields = NULL,
  forms = NULL,
  events = NULL,
  raw_or_label = "raw",
  raw_or_label_headers = "raw",
  export_checkbox_label = FALSE,
  export_survey_fields = FALSE,
  export_data_access_groups = FALSE,
  filter_logic = "",
  datetime_range_begin = as.POSIXct(NA),
  datetime_range_end = as.POSIXct(NA),
  blank_for_gray_form_status = FALSE,
  col_types = NULL,
  na = c("", "NA"),
  guess_type = TRUE,
  guess_max = 1000,
  http_response_encoding = "UTF-8",
  locale = readr::default_locale(),
  verbose = TRUE,
  config_options = NULL,
  handle_httr = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>redcap_uri</code></td>
<td>
<p>The
<a href="https://en.wikipedia.org/wiki/Uniform_Resource_Identifier">uri</a>/url
of the REDCap server
typically formatted as "https://server.org/apps/redcap/api/".
Required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>token</code></td>
<td>
<p>The user-specific string that serves as the password for a
project.  Required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>records</code></td>
<td>
<p>An array, where each element corresponds to the ID of a
desired record.  Optional.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fields</code></td>
<td>
<p>An array, where each element corresponds to a desired project
field.  Optional.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>forms</code></td>
<td>
<p>An array, where each element corresponds to a desired project
form.  Optional.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>events</code></td>
<td>
<p>An array, where each element corresponds to a desired project
event.  Optional.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raw_or_label</code></td>
<td>
<p>A string (either <code>'raw'</code> or <code>'label'</code>) that specifies
whether to export the raw coded values or the labels for the options of
multiple choice fields.  Default is <code>'raw'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raw_or_label_headers</code></td>
<td>
<p>A string (either <code>'raw'</code> or <code>'label'</code> that
specifies for the CSV headers whether to export the variable/field names
(raw) or the field labels (label).  Default is <code>'raw'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>export_checkbox_label</code></td>
<td>
<p>specifies the format of checkbox field values
specifically when exporting the data as labels.  If <code>raw_or_label</code> is
<code>'label'</code> and <code>export_checkbox_label</code> is TRUE, the values will be the text
displayed to the users.  Otherwise, the values will be 0/1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>export_survey_fields</code></td>
<td>
<p>A boolean that specifies whether to export the
survey identifier field (e.g., 'redcap_survey_identifier') or survey
timestamp fields (e.g., instrument+'_timestamp').
The timestamp outputs reflect the survey's <em>completion</em> time
(according to the time and timezone of the REDCap server.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>export_data_access_groups</code></td>
<td>
<p>A boolean value that specifies whether or
not to export the <code>redcap_data_access_group</code> field when data access groups
are utilized in the project. Default is <code>FALSE</code>. See the details below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filter_logic</code></td>
<td>
<p>String of logic text (e.g., <code style="white-space: pre;">⁠[gender] = 'male'⁠</code>) for
filtering the data to be returned by this API method, in which the API will
only return the records (or record-events, if a longitudinal project) where
the logic evaluates as TRUE.   An blank/empty string returns all records.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datetime_range_begin</code></td>
<td>
<p>To return only records that have been created or
modified <em>after</em> a given datetime, provide a
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/as.POSIXlt.html">POSIXct</a>
value.
If not specified, REDCap will assume no begin time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datetime_range_end</code></td>
<td>
<p>To return only records that have been created or
modified <em>before</em> a given datetime, provide a
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/as.POSIXlt.html">POSIXct</a>
value.
If not specified, REDCap will assume no end time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blank_for_gray_form_status</code></td>
<td>
<p>A boolean value that specifies whether
or not to export blank values for instrument complete status fields that have
a gray status icon. All instrument complete status fields having a gray icon
can be exported either as a blank value or as "0" (Incomplete). Blank values
are recommended in a data export if the data will be re-imported into a
REDCap project. Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col_types</code></td>
<td>
<p>A <code>readr::cols()</code> object passed internally to
<code>readr::read_csv()</code>.  Optional.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na</code></td>
<td>
<p>A character vector passed internally to <code>readr::read_csv()</code>.
Defaults to <code>c("", "NA")</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>guess_type</code></td>
<td>
<p>A boolean value indicating if all columns should be
returned as character.  If true, <code>readr::read_csv()</code> guesses the intended
data type for each column.  Ignored if <code>col_types</code> is not null.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>guess_max</code></td>
<td>
<p>A positive base::numeric value
passed to <code>readr::read_csv()</code> that
specifies the maximum number of records to use for guessing column types.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>http_response_encoding</code></td>
<td>
<p>The encoding value passed to
<code>httr::content()</code>.  Defaults to 'UTF-8'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>locale</code></td>
<td>
<p>a <code>readr::locale()</code> object to specify preferences like
number, date, and time formats.  This object is passed to
<code>readr::read_csv()</code>.  Defaults to <code>readr::default_locale()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>A boolean value indicating if <code>message</code>s should be printed
to the R console during the operation.  The verbose output might contain
sensitive information (<em>e.g.</em> PHI), so turn this off if the output might
be visible somewhere public. Optional.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>config_options</code></td>
<td>
<p>A list of options passed to <code>httr::POST()</code>.
See details at <code>httr::httr_options()</code>. Optional.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>handle_httr</code></td>
<td>
<p>The value passed to the <code>handle</code> parameter of
<code>httr::POST()</code>.
This is useful for only unconventional authentication approaches.  It
should be <code>NULL</code> for most institutions.  Optional.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If you do not pass an <code>export_data_access_groups</code> value, it will default
to <code>FALSE</code>. The following is from the API help page for version 10.5.1:
<em>This flag is only viable if the user whose token is being used to make the
API request is <strong>not</strong> in a data access group. If the user is in a group,
then this flag will revert to its default value</em>.
</p>
<p>The REDCap project may contain "pseudofields", depending on its structure.
Pseudofields are exported for certain project structures, but are not
defined by users and do not appear in the codebook.
If a recognized pseudofield is passed to the <code>fields</code> api parameter,
it is suppressed by <code>redcap_read()</code> and <code>redcap_read_oneshot()</code>
so the server doesn't throw an error.
Requesting a pseudofield is discouraged, so a message is returned to the user.
</p>
<p>Pseudofields include:
</p>

<ul>
<li> <p><code>redcap_event_name</code>: for longitudinal projects or multi-arm projects.
</p>
</li>
<li> <p><code>redcap_repeat_instrument</code>:  for projects with repeating instruments.
</p>
</li>
<li> <p><code>redcap_repeat_instance</code>:   for projects with repeating instruments.
</p>
</li>
<li> <p><code>redcap_data_access_group</code>: for projects with DAGs when the
<code>export_data_access_groups</code> api parameter is TRUE.
</p>
</li>
<li> <p><code>redcap_survey_identifier</code>:  for projects with surveys when the
<code>export_survey_fields</code> api parameter is TRUE.
</p>
</li>
<li> <p><em>instrument_name</em><code style="white-space: pre;">⁠_timestamp⁠</code>: for projects with surveys.
For example, an instrument called "demographics" will have a pseudofield
named <code>demographics_timestamp</code>.
REDCapR does not suppress requests for timestamps, so the server will
throw an error like
</p>
<div class="sourceCode"><pre>ERROR: The following values in the parameter fields are not valid: 'demographics_timestamp'
</pre></div>
</li>
</ul>
<h3>Value</h3>

<p>Currently, a list is returned with the following elements:
</p>

<ul>
<li> <p><code>data</code>: A <code>tibble::tibble()</code> of the desired records and columns.
</p>
</li>
<li> <p><code>success</code>: A boolean value indicating if the operation was apparently
successful.
</p>
</li>
<li> <p><code>status_code</code>: The
<a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">http status code</a>
of the operation.
</p>
</li>
<li> <p><code>outcome_message</code>: A human readable string indicating the operation's
outcome.
</p>
</li>
<li> <p><code>records_collapsed</code>: The desired records IDs, collapsed into a single
string, separated by commas.
</p>
</li>
<li> <p><code>fields_collapsed</code>: The desired field names, collapsed into a single
string, separated by commas.
</p>
</li>
<li> <p><code>filter_logic</code>: The filter statement passed as an argument.
</p>
</li>
<li> <p><code>elapsed_seconds</code>: The duration of the function.
</p>
</li>
<li> <p><code>raw_text</code>: If an operation is NOT successful, the text returned by
REDCap.  If an operation is successful, the <code>raw_text</code> is returned as an
empty string to save RAM.
</p>
</li>
</ul>
<p>If no records are retrieved (such as no records meet the filter criteria),
a zero-row tibble is returned.
Currently the empty tibble has zero columns, but that may change in the future.
</p>


<h3>Author(s)</h3>

<p>Will Beasley
</p>


<h3>References</h3>

<p>The official documentation can be found on the 'API Help Page'
and 'API Examples' pages on the REDCap wiki (<em>i.e.</em>,
https://community.projectredcap.org/articles/456/api-documentation.html and
https://community.projectredcap.org/articles/462/api-examples.html).
If you do not have an account for the wiki, please ask your campus REDCap
administrator to send you the static material.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
uri      &lt;- "https://bbmc.ouhsc.edu/redcap/api/"
token    &lt;- "9A81268476645C4E5F03428B8AC3AA7B"

# Return all records and all variables.
ds &lt;- REDCapR::redcap_read_oneshot(redcap_uri=uri, token=token)$data

# Return only records with IDs of 1 and 3
desired_records_v1 &lt;- c(1, 3)
ds_some_rows_v1 &lt;- REDCapR::redcap_read_oneshot(
  redcap_uri = uri,
  token      = token,
  records    = desired_records_v1
)$data

# Return only the fields record_id, name_first, and age
desired_fields_v1 &lt;- c("record_id", "name_first", "age")
ds_some_fields_v1 &lt;- REDCapR::redcap_read_oneshot(
  redcap_uri = uri,
  token      = token,
  fields     = desired_fields_v1
)$data

# Specify the column types.
col_types &lt;- readr::cols(
  record_id  = readr::col_integer(),
  race___1   = readr::col_logical(),
  race___2   = readr::col_logical(),
  race___3   = readr::col_logical(),
  race___4   = readr::col_logical(),
  race___5   = readr::col_logical(),
  race___6   = readr::col_logical()
)
ds_col_types &lt;- REDCapR::redcap_read_oneshot(
  redcap_uri = uri,
  token      = token,
  col_types  = col_types
)$data

## End(Not run)
</code></pre>


</div>