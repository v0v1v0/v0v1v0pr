<div class="container">

<table style="width: 100%;"><tr>
<td>RCTREP</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Replicate treatment effect estimates obtained from a randomized control trial using observational data</h2>

<h3>Description</h3>

<p>The function <code>RCTREP</code> is used to validate the estimates of treatment effects obtained from observational data by comparing to estimates from a target randomized control trial. The function currently implements the following types of estimators of treatment effects: G_computation, inverse propensity score weighting (IPW), and augmented propensity score weighting. The function implements the following three types of weighting estimators to compare the resulting estimates of treatment effects from RWD to the target RCT: exact matching weights, inverse selection probability weighting, and sub-classification. Since we regard the sample in the RCT as the target population, weights for each individual in observational data is <code class="reqn">p/(1-p)</code> so that the weighted population of observational data is representative to the target population.
</p>


<h3>Usage</h3>

<pre><code class="language-R">RCTREP(
  TEstimator = "G_computation",
  SEstimator = "Exact",
  source.data = source.data,
  target.data = target.data,
  source.name = "RWD",
  target.name = "RCT",
  vars_name,
  selection_predictors,
  outcome_method = "glm",
  treatment_method = "glm",
  weighting_method = "glm",
  outcome_formula = NULL,
  treatment_formula = NULL,
  selection_formula = NULL,
  stratification = NULL,
  stratification_joint = FALSE,
  strata_cut_source = NULL,
  strata_cut_target = NULL,
  two_models = FALSE,
  data.public = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>TEstimator</code></td>
<td>
<p>A character specifying an estimator for conditional average treatment effects. The allowed estimators for <code>TEstimator</code> are: <code>"G_computation"</code>, <code>"IPW"</code>, and <code>"DR"</code>. The corresponding object will be created by the wrapper function <code>TEstimator_wrapper()</code>. The default is <code>"G_computation"</code>, which, along with <code>outcome_method="glm"</code> models the potential outcomes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SEstimator</code></td>
<td>
<p>A character specifying an estimator for weight. The allowed estimators are: <code>"Exact"</code>, <code>"Subclass"</code>, <code>"ISW"</code>. The default is <code>"Exact"</code>, which, implements the exact matching on variables in <code>selection_predictors</code> to balance the population covariates between <code>source.data</code> and <code>target.data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>source.data</code></td>
<td>
<p>A data frame containing variables named in <code>vars_name</code> and possible other variables. <code>source.obj</code> is instantiated using <code>source.data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target.data</code></td>
<td>
<p>A data frame containing variables named in <code>vars_name</code> and possible other variables. <code>target.obj</code> is instantiated using <code>target.data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>source.name</code></td>
<td>
<p>A character indicating the name of <code>source.obj</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target.name</code></td>
<td>
<p>A character indicating the name of <code>target.obj</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vars_name</code></td>
<td>
<p>A list containing four vectors <code>outcome_predictors</code>, <code>treatment_name</code>, and <code>outcome_name</code>. <code>outcome_predictors</code> is a character vector containing the adjustment variables, which, along with <code>TEstimator</code> and the corresponding <code>outcome_method</code> or <code>treatment_method</code> to correct for confounding; <code>outcome_name</code> is a character vector of length one containing the variable name of outcome; <code>treatment_name</code> is a character vector of length one containing the variable name of treatment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>selection_predictors</code></td>
<td>
<p>a character vector specifying variable names. The weights are estimated based on the variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outcome_method, treatment_method, weighting_method</code></td>
<td>
<p>A character specifying model for outcome, treatment, and weight to use. Possible values are found using <code>names(getModelInfo())</code>. See <a href="http://topepo.github.io/caret/train-models-by-tag.html">http://topepo.github.io/caret/train-models-by-tag.html</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outcome_formula, treatment_formula, selection_formula</code></td>
<td>
<p>An optional object of class <code>formula</code> describing the outcome model specification, treatment model specification, and selection model specification.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stratification</code></td>
<td>
<p>An optional character vector containing variables to select subgroups. <code>source.obj</code> will compute both weighted and unweighted average treatment effects of the subgroups, <code>targe.obj</code> will calculate the average treatment effects of the subgroups.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stratification_joint</code></td>
<td>
<p>An optional logical indicating if the subgroups are selected based on levels of combined variables in <code>stratification</code> or levels of individual variable in <code>stratification</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strata_cut_source</code></td>
<td>
<p>An optional list containing lists. Each component is a list with tag named by a variable in <code>source.data</code> to discretize, containing <code>break</code> which is a vector specifying the interval of range of the variable to divide, <code>lable</code> which is a character vector specifying how to code value in the variable according to which interval they fall. The leftmost interval corresponds to level one, the next leftmost to level two and so on. This parameter is useful in the case we concern the integrated treatment effect conditioning on variables with multiple levels (for instance, continuous variable or ordinal variable with multiple levels). Note that we first model based on these continuous variables, then we discretize these variables according to <code>strata_cut</code>. The variables in <code>data</code> of <code>TEstimator</code> object are discretized, and the weight is calculated based on the discretized variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strata_cut_target</code></td>
<td>
<p>An optional list containing lists. Each component is a list with tag named by a variable in <code>target.data</code> to discretize.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>two_models</code></td>
<td>
<p>An optional logical indicating whether potential outcomes should be modeled separately when <code>TEstimator="DR"</code>. Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data.public</code></td>
<td>
<p>An optional logical indicating whether the <code>data</code> in the output objects are public. Default is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>An optional argument passed to <code>fit()</code> of each estimator object for model training and tuning. See <a href="https://topepo.github.io/caret/model-training-and-tuning.html">https://topepo.github.io/caret/model-training-and-tuning.html</a> for details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>An R6 object is constructed by a wrapper function <code>TEstimator_wrapper</code> and <code>SEstimator_wrapper</code> with user's input of data and estimators for treatment effect and weight. <code>TEstimator_wrapper()</code> returns initialized objects <code>source.obj</code> and <code>target.obj</code>. <code>SEstimator_wrapper()</code> weights the estimates of <code>source.obj</code> via the class method <code>RCTrep()</code>. The weights are computed using data in the source object <code>source.obj</code>, target object <code>target.obj</code>, and estimator of weights <code>SEstimator</code>.
</p>


<h3>Value</h3>

<p>A list of length three with three R6 class objects, <code>source.obj</code>, <code>target.obj</code> and <code>source.rep.obj</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
output &lt;- RCTREP(TEstimator = "G_computation", SEstimator = "Exact",
                 outcome_method = "BART",
                 source.data = RCTrep::source.data[sample(dim(RCTrep::source.data)[1],500),],
                 target.data = RCTrep::target.data[sample(dim(RCTrep::target.data)[1],500),],
                 vars_name = list(outcome_predictors =
                                    c("x1","x2","x3","x4","x5","x6"),
                                 treatment_name = c('z'),
                                 outcome_name = c('y')),
                 selection_predictors = c("x2","x6"),
                 stratification = c("x1","x3","x4","x5"),
                 stratification_joint = TRUE)
output$target.obj
output$source.obj
output$source.rep.obj

</code></pre>


</div>