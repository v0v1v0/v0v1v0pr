<div class="container">

<table style="width: 100%;"><tr>
<td>rs_var</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Robust variance matrix for repeat-sales indexes</h2>

<h3>Description</h3>

<p>Convenience function to compute a cluster-robust variance matrix for a
linear regression, with or without instruments, where clustering occurs
along one dimension. Useful for calculating a variance matrix when a
regression is calculated manually.
</p>


<h3>Usage</h3>

<pre><code class="language-R">rs_var(u, Z, X = Z, ids = seq_len(nrow(X)), df = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>
<p>An <code class="reqn">n \times 1</code> vector of residuals from a linear
regression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z</code></td>
<td>
<p>An <code class="reqn">n \times k</code> matrix of instruments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>An <code class="reqn">n \times k</code> matrix of covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ids</code></td>
<td>
<p>A factor of length <code class="reqn">n</code>, or something that can be coerced into
one, that groups observations in <code>u</code>. By default each observation
belongs to its own group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>An optional degrees of freedom correction. Default is Stata's
small sample degrees of freedom correction.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function calculates the standard robust variance matrix for a linear
regression, as in Manski (1988, section 8.1.2) or White (2001, Theorem 6.3);
that is, <code class="reqn">(Z'X)^{-1} V (X'Z)^{-1}</code>. It is useful
when a regression is calculated by hand. This generalizes the variance
matrix proposed by Shiller (1991, section II) when a property sells more
than twice.
</p>
<p>This function gives the same result as <code>vcovHC(x, type = 'sss', cluster = 'group')</code> from the <span class="pkg">plm</span> package.
</p>


<h3>Value</h3>

<p>A <code class="reqn">k \times k</code> covariance matrix.
</p>


<h3>References</h3>

<p>Manski, C. (1988). <em>Analog Estimation Methods in Econometrics</em>.
Chapman and Hall.
</p>
<p>Shiller, R. J. (1991). Arithmetic repeat sales price estimators.
<em>Journal of Housing Economics</em>, 1(1):110-126.
</p>
<p>White, H. (2001). <em>Asymptotic Theory for Econometricians</em> (revised
edition). Emerald Publishing.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Makes some groups in mtcars
mtcars$clust &lt;- letters[1:4]

# Matrices for regression
x &lt;- model.matrix(~ cyl + disp, mtcars)
y &lt;- matrix(mtcars$mpg)

# Regression coefficients
b &lt;- solve(crossprod(x), crossprod(x, y))

# Residuals
r &lt;- y - x %*% b

# Robust variance matrix
vcov &lt;- rs_var(r, x, ids = mtcars$clust)

## Not run: 
# Same as plm
library(plm)
mdl &lt;- plm(mpg ~ cyl + disp, mtcars, model = "pooling", index = "clust")
vcov2 &lt;- vcovHC(mdl, type = "sss", cluster = "group")
vcov - vcov2

## End(Not run)

</code></pre>


</div>