<div class="container">

<table style="width: 100%;"><tr>
<td>RNAmf_three_level</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fitting the model with three fidelity levels</h2>

<h3>Description</h3>

<p>The function fits RNA models with designs of three fidelity levels.
The estimation method is based on MLE.
Possible kernel choices are squared exponential, Matern kernel with smoothness parameter 1.5 and 2.5.
The function returns fitted model by <code>RNAmf_two_level</code>, fitted model at level 3, whether constant mean or not, and kernel choice.
</p>


<h3>Usage</h3>

<pre><code class="language-R">RNAmf_three_level(X1, y1, X2, y2, X3, y3, kernel = "sqex", constant = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X1</code></td>
<td>
<p>vector or matrix of input locations for the low fidelity level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y1</code></td>
<td>
<p>vector of response values for the low fidelity level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X2</code></td>
<td>
<p>vector or matrix of input locations for the medium fidelity level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y2</code></td>
<td>
<p>vector of response values for the medium fidelity level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X3</code></td>
<td>
<p>vector or matrix of input locations for the high fidelity level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y3</code></td>
<td>
<p>vector of response values for the high fidelity level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kernel</code></td>
<td>
<p>character specifying kernel type to be used, to be chosen between <code>"sqex"</code>(squared exponential), <code>"matern1.5"</code>, or <code>"matern2.5"</code>. Default is <code>"sqex"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>constant</code></td>
<td>
<p>logical indicating for constant mean of GP (<code>constant=TRUE</code>) or zero mean (<code>constant=FALSE</code>). Default is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>for compatibility with <code>optim</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Consider the model
<code class="reqn">\begin{cases}
&amp; f_1(\bm{x}) = W_1(\bm{x}),\\
&amp; f_l(\bm{x}) = W_l(\bm{x}, f_{l-1}(\bm{x})) \quad\text{for}\quad l=2,3,
\end{cases}</code>
where <code class="reqn">f_l</code> is the simulation code at fidelity level <code class="reqn">l</code>, and
<code class="reqn">W_l(\bm{x}) \sim GP(\alpha_l, \tau_l^2 K_l(\bm{x}, \bm{x}'))</code> is GP model.
Hyperparameters <code class="reqn">(\alpha_l, \tau_l^2, \bm{\theta_l})</code> are estimated by
maximizing the log-likelihood via an optimization algorithm "L-BFGS-B".
For <code>constant=FALSE</code>, <code class="reqn">\alpha_l=0</code>.
</p>
<p>Covariance kernel is defined as:
<code class="reqn">K_l(\bm{x}, \bm{x}')=\prod^d_{j=1}\phi(x_j,x'_j;\theta_{lj})</code> with
<code class="reqn">\phi(x, x';\theta) = \exp \left( -\frac{ \left( x - x' \right)^2}{\theta}  \right)</code>
for squared exponential kernel; <code>kernel="sqex"</code>,
<code class="reqn">\phi(x,x';\theta) =\left( 1+\frac{\sqrt{3}|x- x'|}{\theta} \right) \exp \left( -\frac{\sqrt{3}|x- x'|}{\theta} \right)</code>
for Matern kernel with the smoothness parameter of 1.5; <code>kernel="matern1.5"</code> and
<code class="reqn">\phi(x, x';\theta) = \left( 1+\frac{\sqrt{5}|x-x'|}{\theta} +\frac{5(x-x')^2}{3\theta^2} \right) \exp \left( -\frac{\sqrt{5}|x-x'|}{\theta} \right)</code>
for Matern kernel with the smoothness parameter of 2.5; <code>kernel="matern2.5"</code>.
</p>
<p>For details, see Heo and Sung (2024, &lt;<a href="https://doi.org/10.1080/00401706.2024.2376173">doi:10.1080/00401706.2024.2376173</a>&gt;).
</p>


<h3>Value</h3>


<ul>
<li> <p><code>fit.RNAmf_two_level</code>: a class <code>RNAmf</code> object fitted by <code>RNAmf_two_level</code>. It contains a list of <code class="reqn">\begin{cases} &amp; \text{\code{fit1} for } (X_1, y_1),\\ &amp; \text{\code{fit2} for } ((X_2, f_1(X_2)), y_2), \end{cases}</code>. See <code>RNAmf_two_level</code>.
</p>
</li>
<li> <p><code>fit3</code>: list of fitted model for <code class="reqn">((X_2, f_2(X_3, f_1(X_3))), y_3)</code>.
</p>
</li>
<li> <p><code>constant</code>: copy of <code>constant</code>.
</p>
</li>
<li> <p><code>kernel</code>: copy of <code>kernel</code>.
</p>
</li>
<li> <p><code>level</code>: a level of the fidelity. It returns 3.
</p>
</li>
<li> <p><code>time</code>: a scalar of the time for the computation.
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>predict.RNAmf</code> for prediction.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
### three levels example ###
library(lhs)

### Branin function ###
branin &lt;- function(xx, l){
  x1 &lt;- xx[1]
  x2 &lt;- xx[2]
  if(l == 1){
    10*sqrt((-1.275*(1.2*x1+0.4)^2/pi^2+5*(1.2*x1+0.4)/pi+(1.2*x2+0.4)-6)^2 +
    (10-5/(4*pi))*cos((1.2*x1+0.4))+ 10) + 2*(1.2*x1+1.9) - 3*(3*(1.2*x2+2.4)-1) - 1 - 3*x2 + 1
  }else if(l == 2){
    10*sqrt((-1.275*(x1+2)^2/pi^2+5*(x1+2)/pi+(x2+2)-6)^2 +
    (10-5/(4*pi))*cos((x1+2))+ 10) + 2*(x1-0.5) - 3*(3*x2-1) - 1
  }else if(l == 3){
    (-1.275*x1^2/pi^2+5*x1/pi+x2-6)^2 + (10-5/(4*pi))*cos(x1)+ 10
  }
}

output.branin &lt;- function(x, l){
  factor_range &lt;- list("x1" = c(-5, 10), "x2" = c(0, 15))

  for(i in 1:length(factor_range)) x[i] &lt;- factor_range[[i]][1] + x[i] * diff(factor_range[[i]])
  branin(x[1:2], l)
}

### training data ###
n1 &lt;- 20; n2 &lt;- 15; n3 &lt;- 10

### fix seed to reproduce the result ###
set.seed(1)

### generate initial nested design ###
X &lt;- NestedX(c(n1, n2, n3), 2)
X1 &lt;- X[[1]]
X2 &lt;- X[[2]]
X3 &lt;- X[[3]]

### n1, n2 and n3 might be changed from NestedX ###
### assign n1, n2 and n3 again ###
n1 &lt;- nrow(X1)
n2 &lt;- nrow(X2)
n3 &lt;- nrow(X3)

y1 &lt;- apply(X1,1,output.branin, l=1)
y2 &lt;- apply(X2,1,output.branin, l=2)
y3 &lt;- apply(X3,1,output.branin, l=3)

### fit an RNAmf ###
fit.RNAmf &lt;- RNAmf_three_level(X1, y1, X2, y2, X3, y3, kernel = "sqex")



</code></pre>


</div>