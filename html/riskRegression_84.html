<div class="container">

<table style="width: 100%;"><tr>
<td>iidCox</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Extract iid decomposition from a Cox model</h2>

<h3>Description</h3>

<p>Compute the influence function for each observation used to estimate the model
</p>


<h3>Usage</h3>

<pre><code class="language-R">iidCox(
  object,
  newdata,
  baseline.iid,
  tau.hazard,
  tau.max,
  store.iid,
  keep.times,
  return.object
)

## S3 method for class 'coxph'
iidCox(
  object,
  newdata = NULL,
  baseline.iid = TRUE,
  tau.hazard = NULL,
  tau.max = NULL,
  store.iid = "full",
  keep.times = TRUE,
  return.object = TRUE
)

## S3 method for class 'cph'
iidCox(
  object,
  newdata = NULL,
  baseline.iid = TRUE,
  tau.hazard = NULL,
  tau.max = NULL,
  store.iid = "full",
  keep.times = TRUE,
  return.object = TRUE
)

## S3 method for class 'phreg'
iidCox(
  object,
  newdata = NULL,
  baseline.iid = TRUE,
  tau.hazard = NULL,
  tau.max = NULL,
  store.iid = "full",
  keep.times = TRUE,
  return.object = TRUE
)

## S3 method for class 'CauseSpecificCox'
iidCox(
  object,
  newdata = NULL,
  baseline.iid = TRUE,
  tau.hazard = NULL,
  tau.max = NULL,
  store.iid = "full",
  keep.times = TRUE,
  return.object = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>object The fitted Cox regression model object either
obtained with <code>coxph</code> (survival package) or <code>cph</code>
(rms package).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p>[data.frame] Optional new data at which to do iid decomposition</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>baseline.iid</code></td>
<td>
<p>[logical] Should the influence function for the baseline hazard be computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau.hazard</code></td>
<td>
<p>[numeric vector] the vector of times at which the i.i.d decomposition of the baseline hazard will be computed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau.max</code></td>
<td>
<p>[numeric] latest time at which the i.i.d decomposition of the baseline hazard will be computed. Alternative to <code>tau.hazard</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>store.iid</code></td>
<td>
<p>[character] the method used to compute the influence function and the standard error.
Can be <code>"full"</code> or <code>"minimal"</code>. See the details section.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep.times</code></td>
<td>
<p>[logical] If <code>TRUE</code> add the evaluation times to the output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.object</code></td>
<td>
<p>[logical] If <code>TRUE</code> return the object where the iid decomposition has been added.
Otherwise return a list (see the return section)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function implements the first three formula (no number,10,11) of the subsection
"Empirical estimates" in Ozenne et al. (2017).
If there is no event in a strata, the influence function for the baseline hazard is set to 0. 
</p>
<p><b>Argument store.iid</b>:
If <code>n</code> denotes the sample size, <code>J</code> the number of jump times, and <code>p</code> the number of coefficients:
</p>

<ul>
<li> <p><code>store.iid="full"</code> exports the influence function for the coefficients and the baseline hazard at each event time.
</p>
</li>
<li> <p><code>store.iid="minimal"</code> exports the influence function for the coefficients. For the
baseline hazard it only computes the quantities necessary to compute the influence function in order to save memory. </p>
</li>
</ul>
<p>More details can be found in appendix B of Ozenne et al. (2017).
</p>


<h3>Value</h3>

<p>For Cox models, it returns the object with an additional iid slot (i.e. <code>object$iid</code>).
It is a list containing:
</p>

<ul>
<li>
<p> IFbeta: Influence function for the regression coefficient.
</p>
</li>
<li>
<p> IFhazard: Time differential of the influence function of the hazard.
</p>
</li>
<li>
<p> IFcumhazard: Influence function of the cumulative hazard.
</p>
</li>
<li>
<p> calcIFhazard: Elements used to compute the influence function at a given time.
</p>
</li>
<li>
<p> time: Times at which the influence function has been evaluated.
</p>
</li>
<li>
<p> etime1.min: Time of first event (i.e. jump) in each strata.
</p>
</li>
<li>
<p> etime.max: Last observation time (i.e. jump or censoring) in each strata.
</p>
</li>
<li>
<p> indexObs: Index of the observation in the original dataset.</p>
</li>
</ul>
<p>For Cause-Specific Cox models,
it returns the object with an additional iid slot for each model (e.g. <code>object$models[[1]]iid</code>).
</p>


<h3>References</h3>

<p>Brice Ozenne, Anne Lyngholm Sorensen, Thomas Scheike, Christian Torp-Pedersen and Thomas Alexander Gerds.
riskRegression: Predicting the Risk of an Event using Cox Regression Models.
The R Journal (2017) 9:2, pages 440-460.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(survival)
library(data.table)
library(prodlim)
set.seed(10)
d &lt;- sampleData(100, outcome = "survival")[,.(eventtime,event,X1,X6)]
setkey(d, eventtime)

m.cox &lt;- coxph(Surv(eventtime, event) ~ X1+X6, data = d, y = TRUE, x = TRUE)
system.time(IF.cox &lt;- iidCox(m.cox))

IF.cox.all &lt;- iidCox(m.cox, tau.hazard = sort(unique(c(7,d$eventtime))))
IF.cox.beta &lt;- iidCox(m.cox, baseline.iid = FALSE)

</code></pre>


</div>