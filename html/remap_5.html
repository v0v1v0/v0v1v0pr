<div class="container">

<table style="width: 100%;"><tr>
<td>remap</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Build separate models for mapping multiple regions.</h2>

<h3>Description</h3>

<p>Separate models are built for each given region and combined into one S3
object that can be used to predict on new data using generic function
predict().
</p>


<h3>Usage</h3>

<pre><code class="language-R">remap(
  data,
  regions,
  region_id,
  model_function,
  buffer,
  min_n = 1,
  distances,
  cores = 1,
  progress = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>An sf data frame with point geometry.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>regions</code></td>
<td>
<p>An sf dataframe with polygon or multipolygon geometry.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>region_id</code></td>
<td>
<p>Optional name of column in 'regions' that contains the id
that each region belongs to (no quotes). If null, it will be assumed that
each row of 'regions' is its own region.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model_function</code></td>
<td>
<p>A function that can take a subset of 'data' and
output a model that can be used to predict new values when passed to generic
function predict().</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>buffer</code></td>
<td>
<p>The length of the buffer zone around each region in km where
observations are included in the data used to build models for each region.
(Can be a named vector with different values for each unique 'region_id' in
'region'.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_n</code></td>
<td>
<p>The minimum number of observations to use when building a model.
If there are not enough observations in the region and buffer, then the
closest min_n observations are used. <code>min_n</code> must be at least 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distances</code></td>
<td>
<p>An optional matrix of distances between 'data' and 'regions'
generated by <code>redist()</code> function (calculated internally if not
provided). Note that unless you know that you have min_n within a certain
distance, no max_dist parameter should be used in <code>redist()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cores</code></td>
<td>
<p>Number of cores for parallel computing. 'cores' above
default of 1 will require more memory.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progress</code></td>
<td>
<p>If true, a text progress bar is printed to the console.
(Progress bar only appears if 'cores' = 1.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Extra arguments to pass to 'model_function' function.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If a model fails for a region, a warning is given but the modeling
process will continue.
</p>
<p>A description of the methodology can be found in Wagstaff and Bean (2023)
"remap: Regionalized Models with Spatially Smooth Predictions"
&lt;doi:10.32614/RJ-2023-004&gt;.
</p>


<h3>Value</h3>

<p>A <em>remap</em> S3 object containing:
</p>

<dl>
<dt><em>models</em></dt>
<dd>
<p>A list of models containing a model output by
'model_function' for each region.</p>
</dd>
<dt><em>regions</em></dt>
<dd>
<p>'regions' object passed to the function (used for
prediction). The first column is 'region_id' or the row number of 'regions'
if 'region_id is missing. The second column is the region geometry.</p>
</dd>
<dt><em>call</em></dt>
<dd>
<p>Shows the parameters that were passed to the function.</p>
</dd>
</dl>
<h3>See Also</h3>

<p><code>predict.remap</code> - used for predicting on new data.
<code>redist</code> - used for pre-computing distances.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(remap)
data(utsnow)
data(utws)

# We will keep these examples simple by only modeling non-zero values of
# snow water equivalent (WESD)

utsnz &lt;- utsnow[utsnow$WESD &gt; 0, ]

# Build a remap model with lm that has formula WESD ~ ELEVATION
# The buffer to collect data around each region is 30km
# The minimum number of observations per region is 10
remap_model &lt;- remap(data = utsnz,
                     regions = utws,
                     region_id = HUC2,
                     model_function = lm,
                     formula = log(WESD) ~ ELEVATION,
                     buffer = 20,
                     min_n = 10,
                     progress = TRUE)

# Resubstitution predictions
remap_preds &lt;- exp(predict(remap_model, utsnz, smooth = 10))
head(remap_preds)

</code></pre>


</div>