<div class="container">

<table style="width: 100%;"><tr>
<td>ci</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Add confidence interval and relative frequency variables</h2>

<h3>Description</h3>

<p>Using <code>prop.test()</code>, <code>ci</code> adds three columns to a data frame:
</p>

<ol>
<li>
<p> relative frequency (<code>f</code>)
</p>
</li>
<li>
<p> lower bound of a confidence interval (<code>ci.low</code>)
</p>
</li>
<li>
<p> upper bound of a confidence interval
</p>
</li>
</ol>
<p>Convenience function for converting frequency tables to instances per
million.
</p>
<p>Convenience function for converting frequency tables of alternative variants
(generated with <code>as.alternatives=TRUE</code>) to percent.
</p>
<p>Converts a vector of query or vc strings to typically appropriate legend labels
by clipping off prefixes and suffixes that are common to all query strings.
</p>
<p>Experimental convenience function for plotting typical frequency by year graphs with confidence intervals using ggplot2.
<strong>Warning:</strong> This function may be moved to a new package.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ci(df, x = totalResults, N = total, conf.level = 0.95)

ipm(df)

percent(df)

queryStringToLabel(data, pubDateOnly = FALSE, excludePubDate = FALSE)

geom_freq_by_year_ci(mapping = aes(ymin = conf.low, ymax = conf.high), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>table returned from <code>frequencyQuery()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>column with the observed absolute frequency.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>column with the total frequencies</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>confidence level of the returned confidence interval. Must
be a single number between 0 and 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>string or vector of query or vc definition strings</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pubDateOnly</code></td>
<td>
<p>discard all but the publication date</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excludePubDate</code></td>
<td>
<p>discard publication date constraints</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mapping</code></td>
<td>
<p>Set of aesthetic mappings created by aes() or aes_(). If specified and inherit.aes = TRUE (the default), it is combined with the default mapping at the top level of the plot. You must supply mapping if there is no plot mapping.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments passed to geom_ribbon, geom_line, and geom_click_point.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Given a table with columns <code>f</code>, <code>conf.low</code>, and <code>conf.high</code>, <code>ipm</code> ads a <code style="white-space: pre;">⁠column ipm⁠</code>
und multiplies conf.low and <code>conf.high</code> with 10^6.
</p>


<h3>Value</h3>

<p>original table with additional column <code>ipm</code> and converted columns <code>conf.low</code> and <code>conf.high</code>
</p>
<p>original table with converted columns <code>f</code>, <code>conf.low</code> and <code>conf.high</code>
</p>
<p>string or vector of strings with clipped off common prefixes and suffixes
</p>


<h3>See Also</h3>

<p><code>ci</code> is already included in <code>frequencyQuery()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 

library(ggplot2)
kco &lt;- new("KorAPConnection", verbose=TRUE)
expand_grid(year=2015:2018, alternatives=c("Hate Speech", "Hatespeech")) %&gt;%
  bind_cols(corpusQuery(kco, .$alternatives, sprintf("pubDate in %d", .$year))) %&gt;%
  mutate(total=corpusStats(kco, vc=vc)$tokens) %&gt;%
  ci() %&gt;%
  ggplot(aes(x=year, y=f, fill=query, color=query, ymin=conf.low, ymax=conf.high)) +
    geom_point() + geom_line() + geom_ribbon(alpha=.3)

## End(Not run)
## Not run: 

new("KorAPConnection") %&gt;% frequencyQuery("Test", paste0("pubDate in ", 2000:2002)) %&gt;% ipm()

## End(Not run)
## Not run: 

new("KorAPConnection") %&gt;%
    frequencyQuery(c("Tollpatsch", "Tolpatsch"),
    vc=paste0("pubDate in ", 2000:2002),
    as.alternatives = TRUE) %&gt;%
  percent()

## End(Not run)
queryStringToLabel(paste("textType = /Zeit.*/ &amp; pubDate in", c(2010:2019)))
queryStringToLabel(c("[marmot/m=mood:subj]", "[marmot/m=mood:ind]"))
queryStringToLabel(c("wegen dem [tt/p=NN]", "wegen des [tt/p=NN]"))

## Not run: 
library(ggplot2)
kco &lt;- new("KorAPConnection", verbose=TRUE)

expand_grid(condition = c("textDomain = /Wirtschaft.*/", "textDomain != /Wirtschaft.*/"),
            year = (2005:2011)) %&gt;%
  cbind(frequencyQuery(kco, "[tt/l=Heuschrecke]",
                            paste0(.$condition," &amp; pubDate in ", .$year)))  %&gt;%
  ipm() %&gt;%
  ggplot(aes(year, ipm, fill = condition, color = condition)) +
  geom_freq_by_year_ci()

## End(Not run)
</code></pre>


</div>