<div class="container">

<table style="width: 100%;"><tr>
<td>hnsw_search</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Search an hnswlib nearest neighbor index</h2>

<h3>Description</h3>

<p>Search an hnswlib nearest neighbor index
</p>


<h3>Usage</h3>

<pre><code class="language-R">hnsw_search(
  X,
  ann,
  k,
  ef = 10,
  verbose = FALSE,
  progress = "bar",
  n_threads = 0,
  grain_size = 1,
  byrow = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>A numeric matrix of data to search for neighbors. If <code>byrow = TRUE</code>
(the default) then each row of <code>X</code> is an item to be searched. Otherwise,
each item should be stored in the columns of <code>X</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ann</code></td>
<td>
<p>an instance of a <code>HnswL2</code>, <code>HnswCosine</code> or <code>HnswIp</code>
class.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>Number of neighbors to return. This can't be larger than the number
of items that were added to the index <code>ann</code>. To check the size of the
index, call <code>ann$size()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ef</code></td>
<td>
<p>Size of the dynamic list used during search. Higher values lead
to improved recall at the expense of longer search time. Can take values
between <code>k</code> and the size of the dataset. Typical values are
<code>100 - 2000</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>If <code>TRUE</code>, log messages to the console.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progress</code></td>
<td>
<p>defunct and has no effect.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_threads</code></td>
<td>
<p>Maximum number of threads to use. The exact number is
determined by <code>grain_size</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grain_size</code></td>
<td>
<p>Minimum amount of work to do (items in <code>X</code> to search)
per thread. If the number of items in <code>X</code> isn't sufficient, then fewer
than <code>n_threads</code> will be used. This is useful in cases where the
overhead of context switching with too many threads outweighs the gains due
to parallelism.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>byrow</code></td>
<td>
<p>if <code>TRUE</code> (the default), this indicates that the items to be
searched in <code>X</code> are stored in each row of <code>X</code>. Otherwise, the items are
stored in the columns of <code>X</code>. Storing items in each column reduces the
overhead of copying data to a form that can be searched by the <code>hnsw</code>
library. Note that if <code>byrow = FALSE</code>, any matrices returned from this
function will also store the items by column.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a list containing:
</p>

<ul>
<li> <p><code>idx</code> a matrix containing the nearest neighbor indices.
</p>
</li>
<li> <p><code>dist</code> a matrix containing the nearest neighbor distances.
</p>
</li>
</ul>
<p>The dimensions of the matrices respect the storage (row or column-based) of
<code>X</code> as indicated by the <code>byrow</code> parameter. If <code>byrow = TRUE</code> (the default)
each row of <code>idx</code> and <code>dist</code> contain the neighbor information for the item
passed in the equivalent row of <code>X</code>, i.e. the dimensions are <code style="white-space: pre;">⁠n x k⁠</code> where
<code>n</code> is the number of items in <code>X</code>. If <code>byrow = FALSE</code>, then each column of
<code>idx</code> and <code>dist</code> contain the neighbor  information for the item passed in
the equivalent column of <code>X</code>, i.e. the dimensions are <code style="white-space: pre;">⁠k x n⁠</code>.
</p>
<p>Every item in the dataset is considered to be a neighbor of itself, so the
first neighbor of item <code>i</code> should always be <code>i</code> itself. If that isn't the
case, then any of <code>M</code> or <code>ef</code> may need increasing.
</p>


<h3>Examples</h3>

<pre><code class="language-R">irism &lt;- as.matrix(iris[, -5])
ann &lt;- hnsw_build(irism)
iris_nn &lt;- hnsw_search(irism, ann, k = 5)
</code></pre>


</div>