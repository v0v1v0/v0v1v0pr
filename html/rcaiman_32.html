<div class="container">

<table style="width: 100%;"><tr>
<td>fix_reconstructed_sky</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fix reconstructed sky</h2>

<h3>Description</h3>

<p>Automatically edit a raster image of sky digital numbers (DNs) reconstructed
with functions such as <code>fit_coneshaped_model()</code> and
<code>fit_trend_surface()</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fix_reconstructed_sky(sky, z, r, bin)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sky</code></td>
<td>
<p>SpatRaster. Sky DNs predicted with functions such as
<code>fit_coneshaped_model()</code> and <code>fit_trend_surface()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>SpatRaster built with <code>zenith_image()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>SpatRaster. The source of the sky DNs used to build
<code>sky</code> (the data source).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bin</code></td>
<td>
<p>SpatRaster. The binarization of <code>r</code> used to
select the sky DNs for building the <code>sky</code> argument.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The predicted sky DNs are usually erroneous near the horizon because either
they are a misleading extrapolation or are based on corrupted data (non-pure
sky DNs).
</p>
<p>The proposed automatic edition consists of:
</p>

<ul>
<li>
<p> flattening the values below
the minimum value from the data source defined by <code>r</code> and
<code>bin</code>and
</p>
</li>
<li>
<p> forcing the values toward the horizon to become gradually
the median value from the data source.
</p>
</li>
</ul>
<p>The latter is achieved by calculating
the weighted average of the median value and the predicted sky DNs, using the
ratio of <code>z</code> to <code>90</code> to determine the weights.
</p>


<h3>Value</h3>

<p>An object of class SpatRaster. The argument <code>sky</code>
with dimensions unchanged but values edited.
</p>


<h3>See Also</h3>

<p>Other Sky Reconstruction Functions: 
<code>cie_sky_model_raster()</code>,
<code>fit_cie_sky_model()</code>,
<code>fit_coneshaped_model()</code>,
<code>fit_trend_surface()</code>,
<code>interpolate_sky_points()</code>,
<code>ootb_sky_reconstruction()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
caim &lt;- read_caim()
r &lt;- caim$Blue
caim &lt;- normalize(caim, 0, 20847, TRUE)
z &lt;- zenith_image(ncol(caim), lens())
a &lt;- azimuth_image(z)
bin &lt;- find_sky_pixels(r, z, a)
sky &lt;- fit_trend_surface(r, z, a, bin)$image
sky &lt;- fix_reconstructed_sky(sky, z, r, bin)
plot(sky)

## End(Not run)
</code></pre>


</div>