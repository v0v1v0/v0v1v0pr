<div class="container">

<table style="width: 100%;"><tr>
<td>rate.map</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Mapping rate and direction of phenotypic change on 3D surfaces.</h2>

<h3>Description</h3>

<p>Given vectors of RW (or PC) scores, the function selects the
RW(PC) axes linked to highest (and lowest) evolutionary rate values and
reconstructs the morphology weighted on them. In this way, <code>rate.map</code>
shows where and how the phenotype changed the most between any pair of
taxa.
</p>


<h3>Usage</h3>

<pre><code class="language-R">rate.map(x, RR, PCscores, pcs, mshape, out.rem = TRUE,
  shape.diff=FALSE, show.names=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>the species/nodes to be compared; it can be a single species, or a
vector containing two species or a species and any of its parental nodes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RR</code></td>
<td>
<p>an object generated by using the <code>RRphylo</code> function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PCscores</code></td>
<td>
<p>PC scores.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pcs</code></td>
<td>
<p>RW (or PC) vectors (eigenvectors of the covariance matrix) of all
the samples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mshape</code></td>
<td>
<p>the Consensus configuration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>out.rem</code></td>
<td>
<p>logical: if <code>TRUE</code> mesh triangles with outlying area
difference are removed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shape.diff</code></td>
<td>
<p>logical: if <code>TRUE</code>, the mesh area differences are
displayed in an additional 3d plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show.names</code></td>
<td>
<p>logical: if <code>TRUE</code>, the names of the species are
displayed in the 3d plot.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>After selecting the PC axes, <code>rate.map</code> automatically builds a
3D mesh on the mean shape calculated from the Relative Warp Analysis (RWA)
or Principal Component Analysis (PCA) (<cite>Schlager 2017</cite>) by applying
the function <code>vcgBallPivoting</code> (<span class="pkg">Rvcg</span>). Then, it
compares the area differences between corresponding triangles of the 3D
surfaces reconstructed for the species and surface of the mrca. Finally,
<code>rate.map</code> returns a 3D plot showing such comparisons displayed on
shape of the mrca used as the reference.The colour gradient goes from blue
to red, where blue areas represent expansion of the mesh, while the red
areas represent contractions of the mesh triangles. In the calculation of
the differences of areas we supply the possibility to find and remove
outliers from the vectors of areas calculated on the reference and target
surfaces. We suggest considering this possibility if the mesh may contain
degenerate facets. Additionally, <code>rate.map</code> allows to investigate the
pure morphological comparison of shapes by excluding the evolutionary rate
component by setting the argument <code>show.diff  = TRUE</code>. In this case, a
second 3D plot will be displayed highlighting area differences in terms of
expansion (green) and contraction (yellow).
</p>


<h3>Value</h3>

<p>The function returns a list including:
</p>
<ul>
<li>
<p><strong>$selected</strong> a list of PCs axes selected for higher
evolutionary rates for each species. </p>
</li>
<li>
<p><strong>$surfaces</strong> a list of
reconstructed coloured surfaces of the given species and of the most recent
common ancestor.</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Marina Melchionna, Antonio Profico, Silvia Castiglione, Gabriele
Sansalone, Pasquale Raia
</p>


<h3>References</h3>

<p>Schlager, S. (2017). <em>Morpho and Rvcg-Shape Analysis in R:
R-Packages for geometric morphometrics, shape analysis and surface
manipulations.</em> In: Statistical shape and deformation analysis. Academic
Press.
Castiglione, S., Melchionna, M., Profico, A., Sansalone, G.,
Modafferi, M., Mondanaro, A., Wroe, S., Piras, P., &amp; Raia, P. (2021). Human
face-off: a new method for mapping evolutionary rates on three-dimensional
digital models. Palaeontology. doi:10.1111/pala.12582
</p>


<h3>See Also</h3>

<p><a href="../doc/RRphylo.html"><code>RRphylo</code> vignette</a> ;
<code>relWarps</code> ; <code>procSym</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">  ## Not run: 
  data(DataSimians)
  DataSimians$pca-&gt;pca
  DataSimians$tree-&gt;tree
  dato&lt;-pca$PCscores
  cc&lt;- 2/parallel::detectCores()

  RRphylo(tree,dato,clus=cc)-&gt;RR

  Rmap&lt;-rate.map(x=c("Pan_troglodytes","Gorilla_gorilla"),RR=RR, PCscores=dato,
                 pcs=pca$PCs, mshape=pca$mshape, shape.diff = TRUE)

  
## End(Not run)
</code></pre>


</div>