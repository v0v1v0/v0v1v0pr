<div class="container">

<table style="width: 100%;"><tr>
<td>gapFilling</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimating new values in original missing values data series of daily precipitation</h2>

<h3>Description</h3>

<p>This function uses the neighboring observations to estimate new precipitation values in those days and locations where no records exist.
</p>


<h3>Usage</h3>

<pre><code class="language-R">gapFilling(
  prec,
  sts,
  dates,
  stmethod = NULL,
  thres = NA,
  neibs = 10,
  coords,
  crs,
  coords_as_preds = TRUE,
  window,
  ncpu = 2
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>prec</code></td>
<td>
<p>matrix containing the original (cleaned) precipitation data. Each column represents one station. The names of columns must coincide with the names of the stations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sts</code></td>
<td>
<p>data.frame. A column "ID" (unique ID of stations) is required. The rest of the columns (all of them) will act as predictors of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dates</code></td>
<td>
<p>vector of class "Date" with all days of observations (yyyy-mm-dd).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stmethod</code></td>
<td>
<p>standardization method. 'quant' or 'ratio', see details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thres</code></td>
<td>
<p>numeric. Maximum radius (in km) where neighboring stations will be searched. NA value uses the whole spatial domain.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>neibs</code></td>
<td>
<p>integer. Number of nearest neighbors to use.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coords</code></td>
<td>
<p>vector of two character elements. Names of the fields in "sts" containing longitude and latitude.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>crs</code></td>
<td>
<p>character. Coordinates system in EPSG format (e.g.: "EPSG:4326").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coords_as_preds</code></td>
<td>
<p>logical. If TRUE (default), "coords" are also taken as predictors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>window</code></td>
<td>
<p>odd integer. Length of data considered for standardization</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncpu</code></td>
<td>
<p>number of processor cores used to parallel computing.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>After the gap filling, "stmethod" allows for an standardization of the predictions based on the observations.
It only works for daily data. For other timescales (monthly, annual) use "stmethod=NULL".
The "window" parameter is a daily-moving centered window from which data is collected for each year
(i.e. a 15-day window on 16th January will take all predictions from 1st to 30th January of all years to standardize them
with their corresponding observations. Only standardized prediction of 16th January is returned. Process is repeated for all days).
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
set.seed(123)
prec &lt;- round(matrix(rnorm(30*50, mean = 1.2, sd = 6), 30, 50), 1)
prec[prec&lt;0] &lt;- 0
prec &lt;- apply(prec, 2, FUN = function(x){x[sample(length(x),5)] &lt;- NA; x})
colnames(prec) &lt;- paste0('sts_',1:50)
sts &lt;- data.frame(ID = paste0('sts_',1:50), lon = rnorm(50,0,1), 
                  lat = rnorm(50,40,1), dcoast = rnorm(50,200,50))
filled &lt;- gapFilling(prec, sts, 
                    dates = seq.Date(as.Date('2023-04-01'),
                    as.Date('2023-04-30'),by='day'), 
                    stmethod = "ratio", thres = NA, coords = c('lon','lat'),
                    coords_as_preds = TRUE, crs = 'EPSG:4326', neibs = 10, 
                    window = 11, ncpu = 2)
str(filled)
summary(filled)

## End(Not run)

</code></pre>


</div>