<div class="container">

<table style="width: 100%;"><tr>
<td>rstan_create_package</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create a new <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> package with compiled Stan programs</h2>

<h3>Description</h3>

<p><img src="../help/figures/stanlogo.png" width="25" alt="https://mc-stan.org/about/logo/">
The <code>rstan_create_package()</code> function helps get you started developing a
new <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> package that interfaces with Stan via the <span class="pkg">rstan</span> package. First
the basic package structure is set up via <code>usethis::create_package()</code>.
Then several adjustments are made so the package can include Stan programs
that can be built into binary versions (i.e., pre-compiled Stan C++ code).
</p>
<p>The <strong>Details</strong> section below describes the process and the
<strong>See Also</strong> section provides links to recommendations for developers
and a step-by-step walk-through.
</p>
<p>As of version <code style="white-space: pre;">⁠2.0.0⁠</code> of <span class="pkg">rstantools</span> the
<code>rstan_package_skeleton()</code> function is defunct and only
<code>rstan_create_package()</code> is supported.
</p>


<h3>Usage</h3>

<pre><code class="language-R">rstan_create_package(
  path,
  fields = NULL,
  rstudio = TRUE,
  open = TRUE,
  stan_files = character(),
  roxygen = TRUE,
  travis = FALSE,
  license = TRUE,
  auto_config = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p>The path to the new package to be created (terminating in the
package name).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fields, rstudio, open</code></td>
<td>
<p>Same as <code>usethis::create_package()</code>. See
the documentation for that function, especially the note in the
<strong>Description</strong> section about the side effect of changing the active
project.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stan_files</code></td>
<td>
<p>A character vector with paths to <code>.stan</code> files to include
in the package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>roxygen</code></td>
<td>
<p>Should <span class="pkg">roxygen2</span> be used for documentation?  Defaults to
<code>TRUE</code>. If so, a file <code>R/{pkgname}-package.R</code> is added to the package with
roxygen tags for the required import lines. See the <strong>Note</strong> section below
for advice specific to the latest versions of <span class="pkg">roxygen2</span>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>travis</code></td>
<td>
<p>Should a <code>.travis.yml</code> file be added to the package directory?
This argument is now deprecated. We recommend using GitHub Actions to set
up automated testings for your package. See
https://github.com/r-lib/actions for useful templates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>license</code></td>
<td>
<p>Logical or character; whether or not to paste the contents of
a <code>license.stan</code> file at the top of all Stan code, or path to such a
file.  If <code>TRUE</code> (the default) adds the <code style="white-space: pre;">⁠GPL (&gt;= 3)⁠</code> license (see
<strong>Details</strong>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>auto_config</code></td>
<td>
<p>Whether to automatically configure Stan functionality
whenever the package gets installed (see <strong>Details</strong>). Defaults to <code>TRUE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function first creates a regular <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> package using
<code>usethis::create_package()</code>, then adds the infrastructure required to compile
and export <code>stanmodel</code> objects. In the package root directory, the user's
Stan source code is located in:
</p>
<pre>
inst/
  |_stan/
  |   |_include/
  |
  |_include/
</pre>
<p>All <code>.stan</code> files containing instructions to build a <code>stanmodel</code>
object must be placed in <code>inst/stan</code>.  Other <code>.stan</code> files go in
any <code style="white-space: pre;">⁠stan/⁠</code> subdirectory, to be invoked by Stan's <code style="white-space: pre;">⁠#include⁠</code>
mechanism, e.g.,
</p>
<pre>
#include "include/mylib.stan"
#include "data/preprocess.stan"
</pre>
<p>See <span class="pkg">rstanarm</span> for many examples.
</p>
<p>The folder <code>inst/include</code> is for all user C++ files associated with the
Stan programs.  In this folder, the only file to directly interact with the
Stan C++ library is <code>stan_meta_header.hpp</code>; all other <code style="white-space: pre;">⁠#include⁠</code>
directives must be channeled through here.
</p>
<p>The final step of the package creation is to invoke
<code>rstan_config()</code>, which creates the following files for
interfacing with Stan objects from <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span>:
</p>

<ul>
<li> <p><code>src</code> contains the <code style="white-space: pre;">⁠stan_ModelName{.cc/.hpp}⁠</code> pairs
associated with all <code>ModelName.stan</code> files in <code>inst/stan</code> which
define <code>stanmodel</code> objects.
</p>
</li>
<li> <p><code>src/Makevars[.win]</code> which link to the <code>StanHeaders</code> and
Boost (<code>BH</code>) libraries.
</p>
</li>
<li> <p><code>R/stanmodels.R</code> loads the C++ modules containing the
<code>stanmodel</code> class definitions, and assigns an <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> instance of each
<code>stanmodel</code> object to a <code>stanmodels</code> list (with names
corresponding to the names of the Stan files).
</p>
</li>
</ul>
<p>When <code>auto_config = TRUE</code>, a <code>configure[.win]</code> file is added to the
package, calling <code>rstan_config()</code> whenever the package is installed.
Consequently, the package must list <span class="pkg">rstantools</span> in the <code>DESCRIPTION</code>
Imports field for this mechanism to work.  Setting <code>auto_config = FALSE</code>
removes the package's dependency on <span class="pkg">rstantools</span>, but the package then
must be manually configured by running <code>rstan_config()</code> whenever
<code>stanmodel</code> files in <code>inst/stan</code> are added, removed, or modified.
</p>
<p>In order to enable Stan functionality, <span class="pkg">rstantools</span>
copies some files to your package.  Since these files are licensed as GPL= 3, the same license applies to your package should you choose todistribute it.  Even if you don't use <span class="pkg">rstantools</span> to createyour package, it is likely that you will be linking to <span class="pkg">Rcpp</span> toexport the Stan C++ stanmodel objects to <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span>.  Since<span class="pkg">Rcpp</span> is released under GPL &gt;= 2, the same license would applyto your package upon distribution.
</p>
<p>Authors willing to license their Stan programs of general interest
under the GPL are invited to contribute their <code>.stan</code> files and
supporting <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> code to the <span class="pkg">rstanarm</span> package.
</p>


<h3>Using the pre-compiled Stan programs in your package</h3>

<p>The
<code>stanmodel</code> objects corresponding to the Stan programs included with your
package are stored in a list called <code>stanmodels</code>. To run one of the Stan
programs from within an R function in your package just pass the
appropriate element of the <code>stanmodels</code> list to one of the <span class="pkg">rstan</span>
functions for model fitting (e.g., <code>sampling()</code>). For example, for a Stan
program <code>"foo.stan"</code> you would use <code>rstan::sampling(stanmodels$foo, ...)</code>.
</p>


<h3>Note</h3>

<p>For <span class="pkg">devtools</span> users, because of changes in the latest versions of
<span class="pkg">roxygen2</span> it may be necessary to run <code>pkgbuild::compile_dll()</code>
once before <code>devtools::document()</code> will work.
</p>


<h3>See Also</h3>


<ul>
<li> <p><code>use_rstan()</code> for adding Stan functionality to an existing
<span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> package and <code>rstan_config()</code> for updating an existing package
when its Stan files are changed.
</p>
</li>
<li>
<p> The <span class="pkg">rstanarm</span> package <a href="https://github.com/stan-dev/rstanarm">repository</a>
on GitHub.
</p>
</li>
</ul>
<ul><li>
<p> Guidelines and recommendations for developers of <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> packages
interfacing with Stan and a demonstration getting a simple package working
can be found in the vignettes included with <span class="pkg">rstantools</span> and at
<a href="https://mc-stan.org/rstantools/articles/">mc-stan.org/rstantools/articles</a>.
</p>
</li></ul>
<ul><li>
<p> After reading the guidelines for developers, if you have trouble setting up
your package let us know on the the <a href="https://discourse.mc-stan.org">Stan Forums</a>
or at the <span class="pkg">rstantools</span> GitHub <a href="https://github.com/stan-dev/rstantools/issues">issue tracker</a>.
</p>
</li></ul>
</div>