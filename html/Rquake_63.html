<div class="container">

<table style="width: 100%;"><tr>
<td>Vlocate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Hypocenter Determination
</h2>

<h3>Description</h3>

<p>Hypocenter Determination
with error checking and adjustments.
</p>


<h3>Usage</h3>

<pre><code class="language-R">Vlocate(Ldat,EQ,vel, 
                  distwt = 10,
                  lambdareg =100,
                  REG = TRUE,
                  WTS = TRUE,
                  STOPPING = TRUE,
                  tolx = 0.1,
                  toly = 0.1,
                  tolz = 0.5,
                  RESMAX = c(.4,.5),
                  maxITER = c(7, 5, 7, 4),
                  PLOT=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Ldat</code></td>
<td>
<p>list, must inlude: lat, lon ,err, sec, cor (see details)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>EQ</code></td>
<td>
<p>list, must inlude: lat,lon,z, t
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vel</code></td>
<td>
<p>list, 1D velocity structure
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distwt</code></td>
<td>
<p>distance weighting factor
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambdareg</code></td>
<td>
<p>regularization parameter for damping
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>REG</code></td>
<td>
<p> logical, TRUE=use regularization
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>WTS</code></td>
<td>
<p>logical, TRUE==use weighting
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>STOPPING</code></td>
<td>
<p>logical, TRUE=use stopping criteria
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolx</code></td>
<td>
<p>numeric, tolerance in km in x direction
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>toly</code></td>
<td>
<p>numeric, tolerance in km in y  direction
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolz</code></td>
<td>
<p>numeric, tolerance in km in z  direction
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RESMAX</code></td>
<td>
<p>vector, residual max for P and S, default=c(4,5)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxITER</code></td>
<td>
<p>vector, Maximum number of iterations
for each section of the location routine, default=c(7,5,7,4)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PLOT</code></td>
<td>
<p>logical, plot results during iterations
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This is a wrapper for XYlocate, only here the lat-lon
of the stations is passed and the code does the
projection internally.
</p>
<p>There are 3 main loops, each controled by differing input params: first event is located only in XY
keeping the depth fixed (7 iterations).  Then an initial free solution
is estimated using
robust elimination of residual based on RESMAX (5 iterations).
Finally a set of 7 iterations is applied providing the final
estimate, along with error bars, elliposids, etc.
</p>
<p>In the event no good solution is derived, the regularization parameter
is doubled and a loop with 4 iterations is applied, and the result
returned.
</p>


<h3>Value</h3>

<p>list:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>EQ</code></td>
<td>
<p>Hypocenter lcoation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ERR</code></td>
<td>
<p>Error Analysis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>its</code></td>
<td>
<p>number of iteration</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ksolutions</code></td>
<td>
<p>list of matrices, each with intermediate x,y,z,t locations</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>The schedule may be adjusted by
duplicating this function and changing the
maxit parameters.
</p>


<h3>Author(s)</h3>

<p>Jonathan M. Lees&lt;jonathan.lees@unc.edu&gt;
</p>


<h3>References</h3>

<p>Lee and Stewart
</p>


<h3>See Also</h3>

<p>XYlocate, Klocate, DoRLocate
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library(RSEIS)
data(GH, package='RSEIS')

g1 = GH$pickfile

data(VELMOD1D, package='RSEIS')
vel= VELMOD1D

 w1 = which(!is.na(g1$STAS$lat))
         sec = g1$STAS$sec[w1]

         N = length(sec)
         Ldat =    list(
           name = g1$STAS$name[w1],
           sec = g1$STAS$sec[w1],
           phase = g1$STAS$phase[w1],
           lat=g1$STAS$lat[w1],
           lon = g1$STAS$lon[w1],
           z = g1$STAS$z[w1],
           err= g1$STAS$err[w1],
           yr = rep(g1$LOC$yr , times=N),
           jd = rep(g1$LOC$jd, times=N),
           mo = rep(g1$LOC$mo, times=N),
           dom = rep(g1$LOC$dom, times=N),
           hr =rep( g1$LOC$hr, times=N),
           mi = rep(g1$LOC$mi, times=N) )


wstart = which.min(Ldat$sec)
        EQ = list(lat=Ldat$lat[wstart], lon=Ldat$lon[wstart], z=6, t=Ldat$sec[wstart] )
      

  AQ = Vlocate(Ldat,EQ,vel, 
      distwt = 10,
      lambdareg =100 ,
      REG = TRUE,
      WTS = TRUE,
      STOPPING = TRUE,
      tolx =   0.01,
      toly = 0.01 ,
      tolz = 0.05, maxITER = c(7,5,7,4) , RESMAX = c(0.1, 0.1),  PLOT=FALSE)



</code></pre>


</div>