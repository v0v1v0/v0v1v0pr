<div class="container">

<table style="width: 100%;"><tr>
<td>setwelch</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Set up Matrix of fft for Welch method</h2>

<h3>Description</h3>

<p>Prepares a matrix for estimation of power spectrum via Welch's method.
Also, is can be used for spectrogram.
</p>


<h3>Usage</h3>

<pre><code class="language-R">setwelch(X, win = min(80, floor(length(X)/10)),
inc = min(24, floor(length(X)/30)), coef = 64, wintaper=0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>Time series vector</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>win</code></td>
<td>
<p>window length</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inc</code></td>
<td>
<p>increment</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coef</code></td>
<td>
<p>coefficient for fft</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wintaper</code></td>
<td>
<p>percent taper window taper</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>List:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>values</code></td>
<td>
<p>Matrix of fft's staggered along the trace</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>windowsize</code></td>
<td>
<p>window length used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>increment</code></td>
<td>
<p>increment used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wintaper</code></td>
<td>
<p>percent taper window taper</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>originally written by Andreas Weingessel, modified Jonathan M. Lees&lt;jonathan.lees@unc.edu&gt;</p>


<h3>References</h3>

<p>Welch, P.D. (1967) The use of Fast Fourier Transform for the estimation of power spectra:
a method based on time averaging over short, modified periodograms IEEE Trans. Audio
Electroacoustics 15, 70-73. 
</p>


<h3>See Also</h3>

<p>stft</p>


<h3>Examples</h3>

<pre><code class="language-R">
  
dt &lt;- 0.001

 t &lt;- seq(0, 6, by=dt)
x &lt;- 6*sin(2*pi*50*t) + 10* sin(2*pi*120*t)
 y &lt;- x + rnorm(length(x), mean=0, sd=10)

plot(t,y, type='l')

title('sin(2*pi*50*t) + sin(2*pi*120*t)+ rnorm')

Y &lt;- fft(y)

Pyy &lt;- Y * Conj(Y)

N &lt;- length(y)

n &lt;- length(Pyy)/2

Syy &lt;- (Mod(Pyy[1:n])^2)/N

fn &lt;- 1/(2*dt)


f &lt;- (0:(length(Syy)-1))*fn/length(Syy)

plot(f, Syy, type='l', log='y' , xlim=c(0, 150));
abline(v=c(50, 120),col='blue', lty=2)


plot(f, Syy, type='l', log='y' , xlim=c(0, 150));
abline(v=c(50, 120),col='blue', lty=2)


win &lt;- 1024

inc &lt;- min(24, floor(length(y)/30))
coef &lt;- 2048


 w &lt;- setwelch(y, win=win, inc=inc, coef=coef, wintaper=0.2)

    KK &lt;- apply(w$values, 2, FUN="mean")


fw &lt;- seq(from=0, to=0.5, length=coef)/(dt)

plot(fw, KK^2, log='', type='l' , xlim=c(0, 150)) ;
abline(v=c(50, 120), col='blue', lty=2)


Wyy &lt;- (KK^2)/w$windowsize
plot(f, Syy, type='l', log='y' , xlim=c(0, 150))
lines(fw,Wyy , col='red')


DBSYY &lt;- 20*log10(Syy/max(Syy))
DBKK &lt;- 20*log10(Wyy/max(Wyy))


plot(f, DBSYY, type='l' , xlim=c(0, 150), ylab="Db", xlab="Hz")

lines(fw, DBKK, col='red')
title("Compare simple periodogam with Welch's Method")



</code></pre>


</div>