<div class="container">

<table style="width: 100%;"><tr>
<td>NCA_fetch_state</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fetch ruminate State</h2>

<h3>Description</h3>

<p>Merges default app options with the changes made in the UI
</p>


<h3>Usage</h3>

<pre><code class="language-R">NCA_fetch_state(
  id,
  input,
  session,
  FM_yaml_file,
  MOD_yaml_file,
  id_ASM,
  id_UD,
  id_DW,
  react_state
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>Shiny module ID</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input</code></td>
<td>
<p>Shiny input variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>session</code></td>
<td>
<p>Shiny session variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>FM_yaml_file</code></td>
<td>
<p>App configuration file with FM as main section.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MOD_yaml_file</code></td>
<td>
<p>Module configuration file with MC as main section.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id_ASM</code></td>
<td>
<p>ID string for the app state management module used to save and load app states</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id_UD</code></td>
<td>
<p>ID string for the upload data module used to save and load app states</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id_DW</code></td>
<td>
<p>ID string for the data wrangling module used to save and load app states</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>react_state</code></td>
<td>
<p>Variable passed to server to allow reaction outside of module (<code>NULL</code>)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>list containing the current state of the app including default
values from the yaml file as well as any changes made by the user. The list
has the following structure:
</p>

<ul>
<li>
<p>yaml: Full contents of the supplied yaml file.
</p>
</li>
<li>
<p>MC: Module components of the yaml file.
</p>
</li>
<li>
<p>NCA:
</p>

<ul>
<li>
<p>ana_cntr:       Analysis counter.
</p>
</li>
<li>
<p>anas:                    List of analyses: Each analysis has the following  structure:
</p>

<ul>
<li>
<p>ana_dsview:       Dataset view/ID (name from DSV) selected as a data source for this analysis.
</p>
</li>
<li>
<p>ana_scenario:     Analysis scenario selected in the UI
</p>
</li>
<li>
<p>checksum:         checksum of the analysis (used to detect changes in the analysis).
</p>
</li>
<li>
<p>code:             Code to generate analysis from start to finish or error messages if code generation/analysis failed.
</p>
</li>
<li>
<p>code_components:  List containing the different components from code
</p>
</li>
<li>
<p>col_conc:         Column from ana_dsview containing the concentration data.
</p>
</li>
<li>
<p>col_dose:         Column from ana_dsview containing the dose amount.
</p>
</li>
<li>
<p>col_dur:          Column from ana_dsview containing the infusion duration or N/A if unused.
</p>
</li>
<li>
<p>col_group:        Columns from ana_dsview containing other grouping variables.
</p>
</li>
<li>
<p>col_id:           Column from ana_dsview containing the subject IDs.
</p>
</li>
<li>
<p>col_ntime:        Column from ana_dsview containing the nominal time values
</p>
</li>
<li>
<p>col_route:        Column from ana_dsview containing the dosing route.
</p>
</li>
<li>
<p>col_time:         Column from ana_dsview containing the time values.
</p>
</li>
<li>
<p>id:               Character id (<code>ana_idx</code>).
</p>
</li>
<li>
<p>idx:              Numeric id (<code>1</code>).
</p>
</li>
<li>
<p>include_units:    Boolean variable indicating in units should included in the analysis.
</p>
</li>
<li>
<p>interval_range:   Vector with the first element representing he beginning of the interval
and the second element containing the end of the interval.
</p>
</li>
<li>
<p>intervals:        List of the intervals to include.
</p>
</li>
<li>
<p>isgood:           Current status of the analysis.
</p>
</li>
<li>
<p>key:              Analysis key acts as a title/caption (user editable)
</p>
</li>
<li>
<p>msgs:             Messages generated when checking configuration and analysis options.
</p>
</li>
<li>
<p>nca_config:       List of NCA configuration options for this analysis.
</p>
</li>
<li>
<p>nca_object_name:  Prefix for NCA objects associated with this analyis.
</p>
</li>
<li>
<p>nca_parameters:   NCA parameters selected for calculation in the UI.
</p>
</li>
<li>
<p>notes:            Analysis notes  (user editable)
</p>
</li>
<li>
<p>objs:             List of names and values for objects created with generated code.
</p>
</li>
<li>
<p>sampling:         Sampling method either "sparse" or "serial"
</p>
</li>
<li>
<p>units_amt:        Amount units.
</p>
</li>
<li>
<p>units_conc:       Concentration units.
</p>
</li>
<li>
<p>units_dose:       Dosing units.
</p>
</li>
<li>
<p>units_time:       Time units.
</p>
</li>
</ul>
</li>
<li>
<p>current_ana:           Currently selected analysis (list name element from anas).
</p>
</li>
<li>
<p>DSV:                   Available data source views (see <code>FM_fetch_ds</code>)
</p>
</li>
<li>
<p>checksum:              This is an MD5 sum of the module (checksum of the analysis checksums).
</p>
</li>
<li>
<p>nca_config:            List of PKNCA configuration options for this analysis.
</p>
</li>
<li>
<p>nca_parameters:        List with two elements
</p>

<ul>
<li>
<p>choices:          List consisting of "Common Parameters" and
"Other" (used for grouping in the UI).
Each of these is a list of text parameter
names with a value of the PKNCA parameter
name.
</p>
</li>
<li>
<p>summary:          Summary table with the following columns:
</p>

<ul>
<li>
<p>parameter:      PKNCA Paramter name.
</p>
</li>
<li>
<p>text:           Name used in text output.
</p>
</li>
<li>
<p>md:             Name used markdown output.
</p>
</li>
<li>
<p>latex:          Name used in latex output.
</p>
</li>
<li>
<p>description:    Verbose textual description of the parameter.
</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ui:                    Current value of form elements in the UI.
</p>
</li>
<li>
<p>ui_ana_map:            Map between UI element names and analysis in the object you get from <code>NCA_fetch_current_ana</code>
</p>
</li>
<li>
<p>ui_ids:                Vector of UI elements for the module.
</p>
</li>
<li>
<p>ui_hold:               List of hold elements to disable updates before a full ui referesh is complete.
</p>
</li>
</ul>
</li>
<li>
<p>MOD_TYPE: Character data containing the type of module <code>"NCA"</code>
</p>
</li>
<li>
<p>id: Character data containing the module id module in the session variable.
</p>
</li>
<li>
<p>FM_yaml_file: App configuration file with FM as main section.
</p>
</li>
<li>
<p>MOD_yaml_file:  Module configuration file with MC as main section.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">library(ruminate)
# Module IDs                                                                   
id     = "NCA"                                                                 
id_UD  = "UD"                                                                  
id_DW  = "DW"                                                                  
id_ASM = "ASM"                                                                 
# We need session and input variables to be define                             
 sess_res = NCA_test_mksession(session=list(),                                 
      id     = id,                                                             
      id_UD  = id_UD,                                                          
      id_DW  = id_DW,                                                          
      id_ASM = id_ASM,
      full_session=FALSE)
                                                                               
# Extracting the session and input variables                                   
session      = sess_res$session                                                
input        = sess_res$input                                                  
react_state  = list()                                                          
                                                                               
# We also need configuration files                                             
FM_yaml_file  = system.file(package = "formods",  "templates", "formods.yaml") 
MOD_yaml_file = system.file(package = "ruminate", "templates", "NCA.yaml")     
                                                                               
# Getting the current module state                                             
state = NCA_fetch_state(id             = id,                                   
                       input           = input,                                
                       session         = session,                              
                       FM_yaml_file    = FM_yaml_file,                         
                       MOD_yaml_file   = MOD_yaml_file,                        
                       id_ASM          = id_ASM,                               
                       id_UD           = id_UD,                                
                       id_DW           = id_DW,                                
                       react_state     = react_state)                          
                                                                               
# Pulls out the active analysis                                                
current_ana = NCA_fetch_current_ana(state)

# This will get the dataset associated with this analysis
ds = NCA_fetch_ana_ds(state, current_ana)

# After making changes you can update those in the state
state = NCA_set_current_ana(state, current_ana)

# You can use this to check the current analysis
current_ana = NCA_process_current_ana(state)

# This will pull out the code for the module
fc_res = NCA_fetch_code(state)

# This will use patterns defined for the site to detect
# columns. In this example we are detecting the id column:
id_col = NCA_find_col(
  patterns = state[["MC"]][["detect_col"]][["id"]],
  dscols   = names(ds$DS))

# This creates a new analysis
state = NCA_new_ana(state)
</code></pre>


</div>