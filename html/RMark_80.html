<div class="container">

<table style="width: 100%;"><tr>
<td>extract.indices</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Various utility functions</h2>

<h3>Description</h3>

<p>Miscellaneous set of functions that can be used with results from the
package.
</p>


<h3>Usage</h3>

<pre><code class="language-R">extract.indices(model,parameter,df)
 
        nat.surv(model,df)

         pop.est(ns,ps,design,p.vcv)

         compute.Sn(x,df,criterion)

         logitCI(x,se)

         search.output.files(x,string)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>a mark model object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parameter</code></td>
<td>
<p>character string for a type of parameter for that model
(eg, "Phi","p")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>dataframe containing the columns group, row, column which specify
the group number, the row number and column number of the PIM</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ns</code></td>
<td>
<p>vector of counts of animals captured</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ps</code></td>
<td>
<p>vector of capture probability estimates which match counts</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>design</code></td>
<td>
<p>design matrix that specifies how counts will be aggregate</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.vcv</code></td>
<td>
<p>variance-covariance matrix for capture probability estimates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>marklist of models for compute.Sn and a vector of real estimates for logitCI</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se</code></td>
<td>
<p>vector of std errors for real estimates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>criterion</code></td>
<td>
<p>vector of model selection criterion values (eg AICc)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>string</code></td>
<td>
<p>string to be found in output files contained in models in x</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Function <code>extract.indices</code> extracts the parameter indices from the
parameter index matrices (PIMS) for a particular type of <code>parameter</code>
that match a set of group numbers and rows and columns that are defined in
the dataframe <code>df</code>. It returns a vector of indices which can be used to
specify the set of real parameters to be extracted by
<code>covariate.predictions</code> using the index column in <code>data</code> or
the <code>indices</code> argument. If df is NULL, it returns a dataframe with all of
the indices with model.index being the unique index across all parameters and the
par.index which is an index to the row in the design data. If parameter is NULL then
the the dataframe is given for all of the parameters.
</p>
<p>Function <code>nat.surv</code> produces estimates of natural survival (Sn) from
total survival (S) and recovery rate (r) from a joint live-dead model in
which all harvest recoveries are reported. In that case, Taylor et al 2005
suggest the following estimator of natural survival Sn=S + (1-S)*r.  The
arguments for the function are a mark <code>model</code> object and a dataframe
<code>df</code> that defines the set of groups and times (row,col) for the natural
survival computations. It returns a list with elements: 1) <code>Sn</code> - a
vector of estimates for natural survival; one for each entry in <code>df</code>
and 2) <code>vcv</code> - a variance-covariance matrix for the estimates of
natural survival.
</p>
<p>Function <code>pop.est</code> produces estimates of abundance using a vector of
counts of animals captured (<code>ns</code>) and estimates of capture
probabilities (<code>ps</code>).  The estimates can be aggregated or averaged
using the <code>design</code> matrix argument.  If individual estimates are
needed, use an nxn identity matrix for design where n is the length of
<code>ns</code>. To get a total of all the estimates use a nx1 column matrix of
1s.  Any other <code>design</code> matrix can be specified to subset, aggregate
and/or average the estimates.  The argument <code>p.vcv</code> is needed to
compute the variance-covariance matrix for the abundance estimates using the
formula described in Taylor et al. (2002).  The function returns a list with
elements: 1) <code>Nhat</code> - a vector of abundance estimates and 2) <code>vcv</code>
- variance-covariance matrix for the abundance estimates.
</p>
<p>Function <code>Compute.Sn</code> creates list structure for natural survival using
<code>nat.surv</code> to be used for model averaging natural survival estimates
(e.g., <code>model.average(compute.Sn(x,df,criterion))</code>). It returns a list
with elements estimates, vcv, weight: 1) estimates - matrix of estimates of
natural survival, 2)vcv - list of var-cov matrix for the estimates, and 3)
weight - vector of model weights.
</p>
<p>Function <code>search.output.files</code>searches for occurrence of a specific
string in output files associated with models in a marklist x. It returns a
vector of model numbers in the marklist which have an output file containing
the string.
</p>


<h3>Author(s)</h3>

<p>Jeff Laake
</p>


<h3>References</h3>

<p>TAYLOR, M. K., J. LAAKE, H. D. CLUFF, M. RAMSAY and F. MESSIER.
2002. Managing the risk from hunting for the Viscount Melville Sound polar
bear population. Ursus 13: 185-202.
</p>
<p>TAYLOR, M. K., J. LAAKE, P. D. MCLOUGHLIN, E. W. BORN, H. D. CLUFF, S. H.
FERGUSON, A. ROSING-ASVID, R. SCHWEINSBURG and F.  MESSIER. 2005. Demography
and viability of a hunted population of polar bears. Arctic 58: 203-214.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# This example is excluded from testing to reduce package check time
# Example of computing N-hat for occasions 2 to 7 for the p=~time model
data(dipper)
md=mark(dipper,model.parameters=list(p=list(formula=~time),
       Phi=list(formula=~1)),delete=TRUE)
# Create a matrix from the capture history strings 
xmat=matrix(as.numeric(unlist(strsplit(dipper$ch,""))),
      ncol=nchar(dipper$ch[1]),byrow=TRUE)
# sum number of captures in each column but don't use the first 
# column because p[1] can't be estimated
ns=colSums(xmat)[-1]
# extract the indices and then get covariate predictions for p(2),...,p(7)
# which are row-colums 1-6 in PIM for p 
p.indices=extract.indices(md,"p",df=data.frame(group=rep(1,6),
   row=1:6,col=1:6))
p.list=covariate.predictions(md,data=data.frame(index=p.indices))
# call pop.est using diagonal design matrix to get 
# separate estimate for each occasion
pop.est(ns,p.list$estimates$estimate,
  design=diag(1,ncol=6,nrow=6),p.list$vcv)

</code></pre>


</div>