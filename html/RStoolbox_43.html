<div class="container">

<table style="width: 100%;"><tr>
<td>superClass</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Supervised Classification</h2>

<h3>Description</h3>

<p>Supervised classification both for classification and regression mode based on vector training data (points or polygons).
</p>


<h3>Usage</h3>

<pre><code class="language-R">superClass(
  img,
  trainData,
  valData = NULL,
  responseCol = NULL,
  nSamples = 1000,
  nSamplesV = 1000,
  polygonBasedCV = FALSE,
  trainPartition = NULL,
  model = "rf",
  tuneLength = 3,
  kfold = 5,
  minDist = 2,
  mode = "classification",
  predict = TRUE,
  predType = "raw",
  filename = NULL,
  verbose,
  overwrite = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>img</code></td>
<td>
<p>SpatRaster. Typically remote sensing imagery, which is to be classified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trainData</code></td>
<td>
<p>sf or sp spatial vector data containing the training locations (POINTs,or POLYGONs).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>valData</code></td>
<td>
<p>Ssf or sp spatial vector data containing the validation locations (POINTs,or POLYGONs) (optional).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>responseCol</code></td>
<td>
<p>Character or integer giving the column in <code>trainData</code>, which contains the response variable. Can be omitted, when <code>trainData</code> has only one column.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nSamples</code></td>
<td>
<p>Integer. Number of samples per land cover class. If <code>NULL</code> all pixels covered by training polygons are used (memory intensive!). Ignored if trainData consists of POINTs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nSamplesV</code></td>
<td>
<p>Integer. Number of validation samples per land cover class. If <code>NULL</code> all pixels covered by validation polygons are used (memory intensive!). Ignored if valData consists of POINTs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>polygonBasedCV</code></td>
<td>
<p>Logical. If <code>TRUE</code> model tuning during cross-validation is conducted on a per-polygon basis. Use this to deal with overfitting issues. Does not affect training data supplied as SpatialPointsDataFrames.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trainPartition</code></td>
<td>
<p>Numeric. Partition (polygon based) of <code>trainData</code> that goes into the training data set between zero and one. Ignored if <code>valData</code> is provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>Character. Which model to use. See train for options. Defaults to randomForest ('rf'). In addition to the standard caret models, a maximum likelihood classification is available via <code>model = 'mlc'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tuneLength</code></td>
<td>
<p>Integer. Number of levels for each tuning parameter (see train for details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kfold</code></td>
<td>
<p>Integer. Number of cross-validation resamples during model tuning.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minDist</code></td>
<td>
<p>Numeric. Minumum distance between training and validation data,
e.g. <code>minDist=1</code> clips validation polygons to ensure a minimal distance of one pixel (pixel size according to <code>img</code>) to the next training polygon. 
Requires all data to carry valid projection information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mode</code></td>
<td>
<p>Character. Model type: 'regression' or 'classification'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predict</code></td>
<td>
<p>Logical. Produce a map (TRUE, default) or only fit and validate the model (FALSE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predType</code></td>
<td>
<p>Character. Type of the final output raster. Either "raw" for class predictions or "prob" for class probabilities. Class probabilities are not available for all classification models (predict.train).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filename</code></td>
<td>
<p>Path to output file (optional). If <code>NULL</code>, standard raster handling will apply, i.e. storage either in memory or in the raster temp directory.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical. prints progress and statistics during execution</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overwrite</code></td>
<td>
<p>logical. Overwrite spatial prediction raster if it already exists.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments to be passed to <code>train</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>SuperClass performs the following steps:
</p>

<ol>
<li>
<p> Ensure non-overlap between training and validation data. This is neccesary to avoid biased performance estimates.
A minimum distance (<code>minDist</code>) in pixels can be provided to enforce a given distance between training and validation data.
</p>
</li>
<li>
<p> Sample training coordinates. If <code>trainData</code> (and <code>valData</code> if present) are polygons <code>superClass</code> will calculate the area per polygon and sample
<code>nSamples</code> locations per class within these polygons. The number of samples per individual polygon scales with the polygon area, i.e. the bigger the polygon, the more samples.
</p>
</li>
<li>
<p> Split training/validation      
If <code>valData</code> was provided (reccomended) the samples from these polygons will be held-out and not used for model fitting but only for validation. 
If <code>trainPartition</code> is provided the trainingPolygons will be divided into training polygons and validation polygons.
</p>
</li>
<li>
<p> Extract raster data
The predictor values on the sample pixels are extracted from <code>img</code>
</p>
</li>
<li>
<p> Fit the model. Using caret::train on the sampled training data the <code>model</code> will be fit, 
including parameter tuning (<code>tuneLength</code>) in <code>kfold</code> cross-validation. <code>polygonBasedCV=TRUE</code> will define cross-validation folds based on polygons (reccomended)
otherwise it will be performed on a per-pixel basis.
</p>
</li>
<li>
<p> Predict the classes of all pixels in <code>img</code> based on the final model.
</p>
</li>
<li>
<p> Validate the model with the independent validation data.
</p>
</li>
</ol>
<h3>Value</h3>

<p>A superClass object (effectively a list) containing:
</p>

<ol>
<li>
<p> $model: the fitted model
</p>
</li>
<li>
<p> $modelFit: model fit statistics
</p>
</li>
<li>
<p> $training: indexes of samples used for training
</p>
</li>
<li>
<p> $validation: list of
</p>

<ol>
<li>
<p> $performance: performance estimates based on independent validation (confusion matrix etc.)
</p>
</li>
<li>
<p> $validationSamples: actual pixel coordinates plus reference and predicted values used for validation
</p>
</li>
<li>
<p> $validationGeometry: validation polygpns (clipped with mindist to training geometries)
</p>
</li>
</ol>
</li>
<li>
<p> $map: the predicted raster
</p>
</li>
<li>
<p> $classMapping: a data.frame containing an integer &lt;-&gt; label mapping
</p>
</li>
</ol>
<h3>See Also</h3>

<p><code>train</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(RStoolbox)
library(caret)
library(randomForest)
library(e1071)
library(terra)
train &lt;- readRDS(system.file("external/trainingPoints_rlogo.rds", package="RStoolbox"))

## Plot training data
olpar &lt;- par(no.readonly = TRUE) # back-up par
par(mfrow=c(1,2))
colors &lt;- c("yellow", "green", "deeppink")
plotRGB(rlogo)
plot(train, add = TRUE, col =  colors[train$class], pch = 19)

## Fit classifier (splitting training into 70\% training data, 30\% validation data)
SC       &lt;- superClass(rlogo, trainData = train, responseCol = "class",
model = "rf", tuneLength = 1, trainPartition = 0.7)
SC

## Plots
plot(SC$map, col = colors, legend = FALSE, axes = FALSE, box = FALSE)
legend(1,1, legend = levels(train$class), fill = colors , title = "Classes", 
horiz = TRUE,  bty = "n")
par(olpar) # reset par
</code></pre>


</div>