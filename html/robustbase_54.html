<div class="container">

<table style="width: 100%;"><tr>
<td>covMcd</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Robust Location and Scatter Estimation via MCD</h2>

<h3>Description</h3>

<p>Compute the Minimum Covariance Determinant (MCD) estimator,
a robust multivariate location and scale estimate with a high
breakdown point, via the ‘Fast MCD’ or ‘Deterministic
MCD’ (“DetMcd”) algorithm.
</p>


<h3>Usage</h3>

<pre><code class="language-R">covMcd(x, cor = FALSE, raw.only = FALSE,
       alpha =, nsamp =, nmini =, kmini =,
       scalefn =, maxcsteps =,
       initHsets = NULL, save.hsets = FALSE, names = TRUE, 
       seed =, tolSolve =, trace =,
       use.correction =, wgtFUN =, control = rrcov.control())
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a matrix or data frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cor</code></td>
<td>
<p>should the returned result include a correlation matrix?
Default is <code>cor = FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raw.only</code></td>
<td>
<p>should only the “raw” estimate be returned,
i.e., no (re)weighting step be performed; default is false.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>numeric parameter controlling the size of the subsets
over which the determinant is minimized; roughly <code>alpha*n</code>,
(see ‘Details’ below)
observations are used for computing the determinant.  Allowed values
are between 0.5 and 1 and the default is 0.5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsamp</code></td>
<td>
<p>number of subsets used for initial estimates or <code>"best"</code>,
<code>"exact"</code>, or <code>"deterministic"</code>.  Default is <code>nsamp = 500</code>.
For <code>nsamp = "best"</code> exhaustive enumeration is done, as long as
the number of trials does not exceed 100'000 (<code>= nLarge</code>).
For <code>"exact"</code>, exhaustive enumeration will be attempted however
many samples are needed.  In this case a warning message may be
displayed saying that the computation can take a very long time.
</p>
<p>For <code>"deterministic"</code>, the <em>deterministic</em> MCD is computed; as
proposed by Hubert et al. (2012) it starts from the <code class="reqn">h</code> most
central observations of <em>six</em> (deterministic) estimators.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nmini, kmini</code></td>
<td>
<p>for <code class="reqn">n \ge 2 \times n_0</code>,
<code class="reqn">n_0 := \code{nmini}</code>, the algorithm splits the data into
maximally <code>kmini</code> (by default 5) subsets, of size
approximately, but at least <code>nmini</code>.  When <code>nmini*kmini &lt; n</code>,
the initial search uses only a <em>subsample</em> of size <code>nmini*kmini</code>.

The original algorithm had <code>nmini = 300</code> and <code>kmini = 5</code>
hard coded.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scalefn</code></td>
<td>
<p>for the deterministic MCD: <code>function</code> to
compute a robust scale estimate or character string specifying a
rule determining such a function.  The default, currently
<code>"hrv2012"</code>, uses the recommendation of Hubert, Rousseeuw and
Verdonck (2012) who recommend <code>Qn</code>
for <code class="reqn">n &lt; 1000</code> and <code>scaleTau2</code> for larger n.  Alternatively,
<code>scalefn = "v2014"</code>, uses that rule with cutoff <code class="reqn">n = 5000</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxcsteps</code></td>
<td>
<p>maximal number of concentration steps in the
deterministic MCD; should not be reached.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initHsets</code></td>
<td>
<p>NULL or a <code class="reqn">K x h</code> integer matrix of initial
subsets of observations of size <code class="reqn">h</code> (specified by the indices in
<code>1:n</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save.hsets</code></td>
<td>
<p>(for deterministic MCD) logical indicating if the
initial subsets should be returned as <code>initHsets</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>names</code></td>
<td>
<p>logical; if true (as by default), several parts of the
result have a <code>names</code> or <code>dimnames</code>
respectively, derived from data matrix <code>x</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>initial seed for random generator, like
<code>.Random.seed</code>, see <code>rrcov.control</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolSolve</code></td>
<td>
<p>numeric tolerance to be used for inversion
(<code>solve</code>) of the covariance matrix in <code>mahalanobis</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trace</code></td>
<td>
<p>logical (or integer) indicating if intermediate results
should be printed; defaults to <code>FALSE</code>; values <code class="reqn">\ge 2</code>
also produce print from the internal (Fortran) code.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use.correction</code></td>
<td>
<p> whether to use finite sample correction
factors; defaults to <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wgtFUN</code></td>
<td>
<p>a character string or <code>function</code>, specifying
how the weights for the reweighting step should be computed.  Up to
April 2013, the only option has been the original proposal in (1999),
now specified by <code>wgtFUN = "01.original"</code> (or via
<code>control</code>).  Since <span class="pkg">robustbase</span> version 0.92-3, Dec.2014,
other predefined string options are available, though experimental,
see the experimental <code>.wgtFUN.covMcd</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>a list with estimation options - this includes those
above provided in the function specification, see
<code>rrcov.control</code> for the defaults.  If <code>control</code> is
supplied, the parameters from it will be used.  If parameters are
passed also in the invocation statement, they will override the
corresponding elements of the control object.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The minimum covariance determinant estimator of location and scatter
implemented in <code>covMcd()</code> is similar to <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> function
<code>cov.mcd()</code> in <a href="https://CRAN.R-project.org/package=MASS"><span class="pkg">MASS</span></a>.  The MCD method looks for
the <code class="reqn">h (&gt; n/2)</code> (<code class="reqn">h = h(\alpha,n,p) =</code>
<code>h.alpha.n(alpha,n,p)</code>) observations (out of <code class="reqn">n</code>)
whose classical covariance matrix has the lowest possible determinant.
</p>
<p>The raw MCD estimate of location is then the average of these <code class="reqn">h</code> points,
whereas the raw MCD estimate of scatter is their covariance matrix,
multiplied by a consistency factor (<code>.MCDcons(p, h/n)</code>) and (if
<code>use.correction</code> is true) a finite sample correction factor
(<code>.MCDcnp2(p, n, alpha)</code>), to make it consistent at the
normal model and unbiased at small samples.  Both rescaling factors
(consistency and finite sample) are returned in the length-2 vector
<code>raw.cnp2</code>.
</p>
<p>The implementation of <code>covMcd</code> uses the Fast MCD algorithm of
Rousseeuw and Van Driessen (1999) to approximate the minimum
covariance determinant estimator.
</p>
<p>Based on these raw MCD estimates, (unless argument <code>raw.only</code> is
true), a reweighting step is performed, i.e., <code>V &lt;- cov.wt(x,w)</code>,
where <code>w</code> are weights determined by “outlyingness” with
respect to the scaled raw MCD.  Again, a consistency factor and
(if <code>use.correction</code> is true) a finite sample correction factor
(<code>.MCDcnp2.rew(p, n, alpha)</code>) are applied.
The reweighted covariance is typically considerably more efficient
than the raw one, see Pison et al. (2002).
</p>
<p>The two rescaling factors for the reweighted estimates are returned in
<code>cnp2</code>.  Details for the computation of the finite sample
correction factors can be found in Pison et al. (2002).
</p>


<h3>Value</h3>

<p>An object of class <code>"mcd"</code> which is basically a
<code>list</code> with components
</p>
<table>
<tr style="vertical-align: top;">
<td><code>center</code></td>
<td>
<p>the final estimate of location.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov</code></td>
<td>
<p>the final estimate of scatter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cor</code></td>
<td>
<p>the (final) estimate of the correlation matrix (only if
<code>cor = TRUE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>crit</code></td>
<td>
<p>the value of the criterion, i.e., the logarithm of the
determinant.  Previous to Nov.2014, it contained the determinant
itself which can under- or overflow relatively easily.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>best</code></td>
<td>
<p>the best subset found and used for computing the raw
estimates, with <code>length(best) == quan =
      h.alpha.n(alpha,n,p)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mah</code></td>
<td>
<p>mahalanobis distances of the observations using the final
estimate of the location and scatter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcd.wt</code></td>
<td>
<p>weights of the observations using the final estimate of
the location and scatter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cnp2</code></td>
<td>
<p>a vector of length two containing the consistency
correction factor and the finite sample correction factor of
the final estimate of the covariance matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raw.center</code></td>
<td>
<p>the raw (not reweighted) estimate of location.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raw.cov</code></td>
<td>
<p>the raw (not reweighted) estimate of scatter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raw.mah</code></td>
<td>
<p>mahalanobis distances of the observations based on the
raw estimate of the location and scatter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raw.weights</code></td>
<td>
<p>weights of the observations based on the raw
estimate of the location and scatter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raw.cnp2</code></td>
<td>
<p>a vector of length two containing the consistency
correction factor and the finite sample correction factor of
the raw estimate of the covariance matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>the input data as numeric matrix, without <code>NA</code>s.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.obs</code></td>
<td>
<p>total number of observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>the size of the subsets over which the determinant is
minimized (the default is <code class="reqn">(n+p+1)/2</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quan</code></td>
<td>
<p>the number of observations, <code class="reqn">h</code>, on which the MCD is
based.  If <code>quan</code> equals <code>n.obs</code>, the MCD is the classical
covariance matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>character string naming the method (Minimum Covariance
Determinant), starting with <code>"Deterministic"</code> when
<code>nsamp="deterministic"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iBest</code></td>
<td>
<p>(for the deterministic MCD) contains indices from 1:6
denoting which of the (six) initial subsets lead to the best set found.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.csteps</code></td>
<td>
<p>(for the deterministic MCD) for each of the initial
subsets, the number of C-steps executed till convergence.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the call used (see <code>match.call</code>).</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Valentin Todorov <a href="mailto:valentin.todorov@chello.at">valentin.todorov@chello.at</a>, based on
work written for S-plus by Peter Rousseeuw and Katrien van Driessen
from University of Antwerp.
</p>
<p>Visibility of (formerly internal) tuning parameters, notably
<code>wgtFUN()</code>: Martin Maechler
</p>


<h3>References</h3>

<p>Rousseeuw, P. J. and Leroy, A. M. (1987)
<em>Robust Regression and Outlier Detection.</em> Wiley.
</p>
<p>Rousseeuw, P. J. and van Driessen, K. (1999)
A fast algorithm for the minimum covariance determinant estimator.
<em>Technometrics</em> <b>41</b>, 212–223.
</p>
<p>Pison, G., Van Aelst, S., and Willems, G. (2002)
Small Sample Corrections for LTS and MCD,
<em>Metrika</em> <b>55</b>, 111–123.
</p>
<p>Hubert, M., Rousseeuw, P. J. and Verdonck, T. (2012)
A deterministic algorithm for robust location and scatter.
Journal of Computational and Graphical Statistics <b>21</b>, 618–637.
</p>


<h3>See Also</h3>

<p><code>cov.mcd</code> from package <a href="https://CRAN.R-project.org/package=MASS"><span class="pkg">MASS</span></a>;
<code>covOGK</code> as cheaper alternative for larger dimensions.
</p>
<p><code>BACON</code> and <code>covNNC</code>,
from package <a href="https://CRAN.R-project.org/package=robustX"><span class="pkg">robustX</span></a>;
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(hbk)
hbk.x &lt;- data.matrix(hbk[, 1:3])
set.seed(17)
(cH &lt;- covMcd(hbk.x))
cH0 &lt;- covMcd(hbk.x, nsamp = "deterministic")
with(cH0, stopifnot(quan == 39,
     iBest == c(1:4,6), # 5 out of 6 gave the same
     identical(raw.weights, mcd.wt),
     identical(which(mcd.wt == 0), 1:14), all.equal(crit, -1.045500594135)))

## the following three statements are equivalent
c1 &lt;- covMcd(hbk.x, alpha = 0.75)
c2 &lt;- covMcd(hbk.x, control = rrcov.control(alpha = 0.75))
## direct specification overrides control one:
c3 &lt;- covMcd(hbk.x, alpha = 0.75,
             control = rrcov.control(alpha=0.95))
c1

## Martin's smooth reweighting:

## List of experimental pre-specified wgtFUN() creators:
## Cutoffs may depend on  (n, p, control$beta) :
str(.wgtFUN.covMcd)

cMM &lt;- covMcd(hbk.x, wgtFUN = "sm1.adaptive")

ina &lt;- which(names(cH) == "call")
all.equal(cMM[-ina], cH[-ina]) # *some* differences, not huge (same 'best'):
stopifnot(all.equal(cMM[-ina], cH[-ina], tol = 0.2))
</code></pre>


</div>