<div class="container">

<table style="width: 100%;"><tr>
<td>redcap_metadata_coltypes</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Suggests a col_type for each field in a REDCap project</h2>

<h3>Description</h3>

<p>This function inspects a REDCap project to
determine a <code>readr::cols()</code> object that is compatible with the
the project's current definition.  It can be copied and pasted into the
R code so future calls to the server will produce a <code>tibble::tibble()</code>
with an equivalent set of data types.
</p>


<h3>Usage</h3>

<pre><code class="language-R">redcap_metadata_coltypes(
  redcap_uri,
  token,
  print_col_types_to_console = TRUE,
  http_response_encoding = "UTF-8",
  locale = readr::default_locale(),
  verbose = FALSE,
  config_options = NULL,
  handle_httr = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>redcap_uri</code></td>
<td>
<p>The
<a href="https://en.wikipedia.org/wiki/Uniform_Resource_Identifier">uri</a>/url
of the REDCap server
typically formatted as "https://server.org/apps/redcap/api/".
Required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>token</code></td>
<td>
<p>The user-specific string that serves as the password for a
project.  Required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print_col_types_to_console</code></td>
<td>
<p>Should the <code>readr::cols()</code> object
be printed to the console?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>http_response_encoding</code></td>
<td>
<p>The encoding value passed to
<code>httr::content()</code>.  Defaults to 'UTF-8'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>locale</code></td>
<td>
<p>a <code>readr::locale()</code> object to specify preferences like
number, date, and time formats.  This object is passed to
<code>readr::read_csv()</code>.  Defaults to <code>readr::default_locale()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>A boolean value indicating if <code>message</code>s should be printed
to the R console during the operation.  The verbose output might contain
sensitive information (<em>e.g.</em> PHI), so turn this off if the output might
be visible somewhere public. Optional.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>config_options</code></td>
<td>
<p>A list of options passed to <code>httr::POST()</code>.
See details at <code>httr::httr_options()</code>. Optional.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>handle_httr</code></td>
<td>
<p>The value passed to the <code>handle</code> parameter of
<code>httr::POST()</code>.
This is useful for only unconventional authentication approaches.  It
should be <code>NULL</code> for most institutions.  Optional.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>redcap_metadata_coltypes()</code> returns a <code>readr::cols()</code> object in two ways.
First, a literal object is returned that can be passed to
<code>redcap_read()</code> or <code>redcap_read_oneshot()</code>.
</p>
<p>Second, the function acts as a code generator.
It prints text to the console so that it can be copied
and pasted into an R file.  This is useful to (a) document what
fields and data types are expected, and (b) adjust those fields and
data types if the defaults can be customized for your needs.
For instance, you may choose to exclude some variables or tweak a
data type (<em>e.g.</em>, changing a patient's height from an integer to
a double).
</p>
<p>When printing to the console, each data type decision is accompanied
by an explanation on the far right.  See the output from the
examples below.  Please file an
<a href="https://github.com/OuhscBbmc/REDCapR/issues">issue</a> if you think
something is too restrictive or can be improved.
</p>
<p>The overall heuristic is assign a data type down a waterfall of decisions:
</p>

<ol>
<li>
<p> Is the field built into REDCap? This includes
an autonumber <code>record_id</code>,
<code>redcap_event_name</code>, <code>redcap_repeat_instrument</code>, <code>redcap_repeat_instance</code>,
and an instrument's completion status.
</p>
</li>
<li>
<p> What is the field's type?  For example, sliders should be an
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/integer.html">integer</a>,
while check marks should be
logical(https://stat.ethz.ch/R-manual/R-devel/library/base/html/logical.html.
</p>
</li>
<li>
<p> If the field type is "text", what is the validation type?
For instance, a postal code should be a
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/character.html">character</a>
(even though it looks like a number),
a "mdy" should be cast to a
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/date.html">date</a>,
and a "number_2dp" should be cast to a
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/double.html">floating point</a>
</p>
</li>
<li>
<p> If the field type or validation type is not recognized,
the field will be cast to
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/character.html">character</a>.
This will happen when REDCap develops &amp; releases a new type.
If you see something like, "# validation doesn't have an associated col_type.
Tell us in a new REDCapR issue", please make sure REDCapR is running the newest
<a href="https://ouhscbbmc.github.io/REDCapR/index.html#installation-and-documentation">GitHub release</a>
and file a new <a href="https://github.com/OuhscBbmc/REDCapR/issues">issue</a> if it's still not
recognized.
</p>
</li>
</ol>
<p>For details of the current implementation,
the decision logic starts about half-way down in the
<a href="https://github.com/OuhscBbmc/REDCapR/blob/HEAD/R/redcap-metadata-coltypes.R">function's source code</a>
</p>
<p>*<em>Validation does NOT Guarantee Conformity</em>
</p>
<p>If you're coming to REDCap from a database world, this will be unexpected.
A validation type does NOT guarantee that all retrieved values will conform to
complementary the data type.
The validation setting affects only the values entered
<em>after</em> the validation was set.
</p>
<p>For example, if values like "abcd" where entered in a field for a few months, then
the project manager selected the "integer" validation option, all those
"abcd" values remain untouched.
</p>
<p>This is one reason <code>redcap_metadata_coltypes()</code> prints it suggestions to the console.
It allows the developer to adjust the specifications to match the values
returned by the API.  The the "abcd" scenario, consider (a) changing the type
from <code>col_integer</code> to <code>col_character</code>, (b) excluding the trash values,
then (c) in a <code>dplyr::mutate()</code> statement,
use <code>readr::parse_integer()</code> to cast it to the desired type.
</p>


<h3>Value</h3>

<p>A <code>readr::cols()</code> object is returned, which can be
passed to <code>redcap_read()</code> or <code>redcap_read_oneshot()</code>.
</p>
<p>Additionally objected is printed to the console, see the Details below.
</p>


<h3>Author(s)</h3>

<p>Will Beasley, Philip Chase
</p>


<h3>References</h3>

<p>The official documentation can be found on the 'API Help Page'
and 'API Examples' pages on the REDCap wiki (<em>i.e.</em>,
https://community.projectredcap.org/articles/456/api-documentation.html and
https://community.projectredcap.org/articles/462/api-examples.html).
If you do not have an account for the wiki, please ask your campus REDCap
administrator to send you the static material.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
uri      &lt;- "https://bbmc.ouhsc.edu/redcap/api/"

# A simple project
token      &lt;- "9A81268476645C4E5F03428B8AC3AA7B" # 153
col_types  &lt;- redcap_metadata_coltypes(uri, token)
redcap_read_oneshot(uri, token, col_types = col_types)$data

# A longitudinal project
token      &lt;- "0434F0E9CF53ED0587847AB6E51DE762" # 212
col_types  &lt;- redcap_metadata_coltypes(uri, token)
redcap_read_oneshot(uri, token, col_types = col_types)$data

# A repeating instruments project
token      &lt;- "56F43A10D01D6578A46393394D76D88F" # 2603
col_types  &lt;- redcap_metadata_coltypes(uri, token)
redcap_read_oneshot(uri, token, col_types = col_types)$data

# A project with every field type and validation type.
#   Notice it throws a warning that some fields use a comma for a decimal,
#   while other fields use a period/dot as a decimal
token      &lt;- "8F5313CAA266789F560D79EFCEE2E2F1" # 2634 - Validation Types
col_types  &lt;- redcap_metadata_coltypes(uri, token)
redcap_read_oneshot(uri, token, col_types = col_types)$data

## End(Not run)
</code></pre>


</div>