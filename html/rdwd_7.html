<div class="container">

<table style="width: 100%;"><tr>
<td>dataDWD</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Download data from the DWD CDC FTP Server</h2>

<h3>Description</h3>

<p>Get climate data from the German Weather Service (DWD) FTP-server.
The desired dataset is downloaded into <code>dir</code>.
If <code>read=TRUE</code>, it is also read and processed.<br><code>dataDWD</code> handles vectors of URLs,
displays progress bars (if the package <code>pbapply</code> is available)
and by default does not re-download data already in <code>dir</code>
(but see argument <code>force</code> to update files).<br>
To solve "errors in download.file: cannot open URL", see
<a href="https://bookdown.org/brry/rdwd/fileindex.html">https://bookdown.org/brry/rdwd/fileindex.html</a>.<br></p>


<h3>Usage</h3>

<pre><code class="language-R">dataDWD(
  url,
  base = dwdbase,
  joinbf = FALSE,
  dir = locdir(),
  force = FALSE,
  overwrite = !isFALSE(force),
  read = TRUE,
  dbin = TRUE,
  method = getOption("download.file.method"),
  dfargs = NULL,
  sleep = 0,
  progbar = !quiet,
  browse = FALSE,
  ntrunc = 2,
  file = NULL,
  quiet = rdwdquiet(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>url</code></td>
<td>
<p>Char (vector): complete file URL(s) (including base and filename.zip)
as returned by <code>selectDWD()</code>. Can be a vector with several FTP URLs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>base</code></td>
<td>
<p>Single char: base URL that will be removed from output file names.
DEFAULT: <code>dwdbase</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>joinbf</code></td>
<td>
<p>Logical: paste <code>base</code> and <code style="white-space: pre;">⁠file url⁠</code> together?
Needed mostly for data at <code>gridbase</code>.
DEFAULT: FALSE (selectDWD returns complete URLs already)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dir</code></td>
<td>
<p>Char: Writeable directory name where to save the downloaded file.
Created if not existent. DEFAULT: <code>locdir()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>force</code></td>
<td>
<p>Logical (vector): always download, even if the file already exists in <code>dir</code>?
Use NA to force re-downloading files older than 24 hours.
Use a numerical value to force after that amount of hours.
Use something like <code>c(Inf, 24)</code> or <code>force=c(24*365, 6)</code>, for per="hr".
Note: if <code>force</code> is not FALSE, the <code>overwrite</code> default is TRUE.
DEFAULT: FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overwrite</code></td>
<td>
<p>Logical (vector): if force=TRUE, overwrite the existing file
rather than append "_1"/"_2" etc to the filename?
DEFAULT: <code>!isFALSE(force)</code>, i.e. true when <code>force</code> is specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>read</code></td>
<td>
<p>Logical: read the file(s) with <code>readDWD()</code>? If FALSE,
only download is performed and the filename(s) returned. DEFAULT: TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dbin</code></td>
<td>
<p>Logical: Download binary file, i.e. add <code>mode="wb"</code> to the
<code>download.file()</code> call?
See <a href="https://bookdown.org/brry/rdwd/raster-data.html#binary-file-errors">Website</a>
for details.
DEFAULT: TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>download.file <code>method</code>. Introduced in version 1.5.25 (2022-05-12)
as triggered by <a href="https://github.com/brry/rdwd/issues/34">https://github.com/brry/rdwd/issues/34</a>.
DEFAULT: <code>getOption("download.file.method")</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dfargs</code></td>
<td>
<p>Named list of additional arguments passed to <code>download.file()</code>
Note that mode="wb" is already passed if <code>dbin=TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sleep</code></td>
<td>
<p>Number. If not 0, a random number of seconds between 0 and
<code>sleep</code> is passed to <code>Sys.sleep()</code> after each download
to avoid getting kicked off the FTP-Server,
see note in <code>indexFTP()</code>. DEFAULT: 0</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progbar</code></td>
<td>
<p>Logical: present a progress bar with estimated remaining time?
If missing and length(file)==1, progbar is internally set to FALSE.
Only works if the R package <code>pbapply</code> is available. DEFAULT: TRUE (!quiet)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>browse</code></td>
<td>
<p>Logical: open repository via <code>browseURL()</code> and
return URL folder path? If TRUE, no data is downloaded.
If file has several values, only unique folders will be opened.
DEFAULT: FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ntrunc</code></td>
<td>
<p>Single integer: number of filenames printed in messages
before they get truncated with message "(and xx more)". DEFAULT: 2</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>Deprecated since rdwd version 1.3.34, 2020-07-28.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>Logical: suppress message about directory / filenames?
DEFAULT: FALSE through <code>rdwdquiet()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments passed to <code>readDWD()</code>,
like <code>fread</code>, <code>varnames</code>, <code>hr</code>, etc.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Presuming downloading and processing were successful:
if <code>read=TRUE</code>, the desired dataset
(as returned by <code>readDWD()</code>),
otherwise the filename as saved on disc
(may have "_n" appended in name, see <code>newFilename()</code>).<br>
If length(file)&gt;1, the output is a list of outputs / vector of filenames.<br>
The output is always invisible.
</p>


<h3>Author(s)</h3>

<p>Berry Boessenkool, <a href="mailto:berry-b@gmx.de">berry-b@gmx.de</a>, Jun-Oct 2016
</p>


<h3>See Also</h3>

<p><code>selectDWD()</code>. <code>readDWD()</code>, <code>download.file()</code>.<br><a href="https://bookdown.org/brry/rdwd">https://bookdown.org/brry/rdwd</a><br>
Helpful for plotting: <code>berryFunctions::monthAxis()</code>,
see also <code>berryFunctions::climateGraph()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run:  ## requires internet connection
# find FTP files for a given station name and file path:
link &lt;- selectDWD("Fuerstenzell", res="hourly", var="wind", per="recent")
# download file:
fname &lt;- dataDWD(link, dir=locdir(), read=FALSE) ; fname
# dir="DWDdata" is the default directory to store files
# unless force=TRUE, already obtained files will not be downloaded again

# read and plot file:
wind &lt;- readDWD(fname, varnames=TRUE) ; head(wind)
metafiles &lt;- readMeta(fname)          ; str(metafiles, max.level=1)
column_names &lt;- readVars(fname)       ; head(column_names)

plot(wind$MESS_DATUM, wind$F, main="DWD hourly wind Fuerstenzell", col="blue",
     xaxt="n", las=1, type="l", xlab="Date", ylab="Hourly Wind speed  [m/s]")
berryFunctions::monthAxis(1)


# current and historical files, keep historical in the overlap time period:
link &lt;- selectDWD("Potsdam", res="daily", var="kl", per="hr"); link
potsdam &lt;- dataDWD(link, dir=locdir(), hr=4)
plot(TMK~MESS_DATUM, data=tail(potsdam,1500), type="l")


# With many files (&gt;&gt;50), use sleep to avoid getting kicked off the FTP server
#links &lt;- selectDWD(res="daily", var="solar")
#sol &lt;- dataDWD(links, sleep=20) # random waiting time after download (0 to 20 secs)

# Real life examples can be found in the use cases section of the vignette:
# browseURL("https://bookdown.org/brry/rdwd")

## End(Not run)

</code></pre>


</div>