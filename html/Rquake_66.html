<div class="container">

<table style="width: 100%;"><tr>
<td>XYlocate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Locate Earthquake with UTM projection
</h2>

<h3>Description</h3>

<p>Non-linear hypocenter location with UTM
geographical projection.  Used for locating earthquakes in
local or regional settings.
</p>


<h3>Usage</h3>

<pre><code class="language-R">XYlocate(Ldat, EQ, vel, maxITER = 10, distwt = 10,
lambdareg = 100, FIXZ
= FALSE, REG = TRUE, WTS = TRUE, STOPPING = TRUE,
RESMAX = c(.4,.5), tolx = 0.005, toly = 0.005,
 tolz = 0.01, PLOT = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Ldat</code></td>
<td>
<p>list, must inlude: x,y,err, sec, cor (see details)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>EQ</code></td>
<td>
<p>list, must inlude: x,y,z, t
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vel</code></td>
<td>
<p>list, 1D velocity structure
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxITER</code></td>
<td>
<p>Maximum number of iterations
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distwt</code></td>
<td>
<p>distance weighting factor
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambdareg</code></td>
<td>
<p>regularization parameter for damping
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>FIXZ</code></td>
<td>
<p>logical, TRUE = fix depth, i.e. only calculate x,y,t
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>REG</code></td>
<td>
<p> logical, TRUE=use regularization
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>WTS</code></td>
<td>
<p>logical, TRUE==use weighting
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>STOPPING</code></td>
<td>
<p>logical, TRUE=use stopping criteria
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RESMAX</code></td>
<td>
<p>vector, residual max for P and S, default=c(4,5)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolx</code></td>
<td>
<p>numeric, tolerance in km in x direction
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>toly</code></td>
<td>
<p>numeric, tolerance in km in y  direction
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolz</code></td>
<td>
<p>numeric, tolerance in km in z  direction
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PLOT</code></td>
<td>
<p>logical, plot results during iterations
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Input pick list must have at x,y,z, sec, cor, err elements
for each station.  If no station correction is available it is set to
zero.  If no uncertainty (err) is available, it is set to 0.05 sec.
Each station must have a finite x-y coordinate and arrival time in
seconds. Events are located relative to the minute.
</p>
<p>Routine uses the svd in a sequence of linear inversions
to estimate the nonlinear location.
</p>


<h3>Value</h3>

<p>List:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>EQ</code></td>
<td>
<p>list, Earthquake hypocenter and time</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>its</code></td>
<td>
<p>number of iterations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rms</code></td>
<td>
<p>rms residual</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wrms</code></td>
<td>
<p>wheighted rms residual</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>used</code></td>
<td>
<p>vector, index of used equations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>guesses</code></td>
<td>
<p>list of x,y,z,t intermediate locations when converging </p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>This routine should be called by a wrapper (Vlocate) that applies the
algorithm several times and changes parameters based on
the quality.
</p>
<p>If RESMAX is used and the robust approach yields
fewer than 4 equations, the best (smallest) four residuals will be
used to determiine the event location.
</p>


<h3>Author(s)</h3>

<p>Jonathan M. Lees&lt;jonathan.lees@unc.edu&gt;
</p>


<h3>See Also</h3>

<p>Vlocate
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library(RSEIS)
data(GH, package='RSEIS')

g1 = GH$pickfile
data(VELMOD1D, package='RSEIS')

vel= VELMOD1D

 w1 = which(!is.na(g1$STAS$lat))
         sec = g1$STAS$sec[w1]

         N = length(sec)
         Ldat =    list(
           name = g1$STAS$name[w1],
           sec = g1$STAS$sec[w1],
           phase = g1$STAS$phase[w1],
           lat=g1$STAS$lat[w1],
           lon = g1$STAS$lon[w1],
           z = g1$STAS$z[w1],
           err= g1$STAS$err[w1],
           yr = rep(g1$LOC$yr , times=N),
           jd = rep(g1$LOC$jd, times=N),
           mo = rep(g1$LOC$mo, times=N),
           dom = rep(g1$LOC$dom, times=N),
           hr =rep( g1$LOC$hr, times=N),
           mi = rep(g1$LOC$mi, times=N) )

 MLAT = median(Ldat$lat)
    MLON = median(Ldat$lon)
    
    proj = GEOmap::setPROJ(type=2, LAT0=MLAT, LON0=MLON)

####   get station X-Y values in km
    XY = GEOmap::GLOB.XY(Ldat$lat, Ldat$lon, proj)
###   add to Ldat list
    Ldat$x = XY$x
    Ldat$y = XY$y
       wstart = which.min(Ldat$sec)



EQ = list(x=XY$x[wstart], y=XY$y[wstart], z=6, t=Ldat$sec[wstart] )

      
 maxITER = 7
###print(EQ)
    AQ = XYlocate(Ldat,EQ,vel, 
      maxITER = maxITER,
      distwt = 1,
      lambdareg =10 ,
      FIXZ = FALSE,
      REG = TRUE,
      WTS = TRUE,
      STOPPING = TRUE,
      RESMAX = c(0.1,0.1),
      tolx =   0.001,
      toly = 0.001 ,
      tolz = 0.5, PLOT=FALSE)

########  update the new location

AXY = GEOmap::XY.GLOB(AQ$EQ$x, AQ$EQ$y, proj)
AQ$EQ$lat = AXY$lat
AQ$EQ$lon = AXY$lon
if(AQ$EQ$lon&gt;180) { AQ$EQ$lon = AQ$EQ$lon-360 }


plot(c(Ldat$x, AQ$EQ$x) , c(Ldat$y,AQ$EQ$y), type='n' , xlab="km",
ylab="km" )

points(Ldat$x, Ldat$y, pch=6)

points(AQ$EQ$x, AQ$EQ$y, pch=8, col='red')

points(EQ$x, EQ$y, pch=4, col='blue')


legend("topright", pch=c(8,4, 6), col=c("red", "blue", "black"),
 legend=c("Final location", "Initial guess", "Station"))


print(AQ)

#####  try a different case with an extremely wrong start
EQ$x = 10
EQ$y = 2

</code></pre>


</div>