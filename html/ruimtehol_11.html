<div class="container">

<table style="width: 100%;"><tr>
<td>predict.textspace</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Predict using a Starspace model</h2>

<h3>Description</h3>

<p>The prediction functionality allows you to retrieve the following types of elements from a Starspace model:
</p>

<ul>
<li> <p><code>generic</code>: get general Starspace predictions in detail
</p>
</li>
<li> <p><code>labels</code>: get similarity of your text to all the labels of the Starspace model
</p>
</li>
<li> <p><code>embedding</code>: document embeddings of your text (shorthand for <code>starspace_embedding</code>)
</p>
</li>
<li> <p><code>knn</code>: k-nearest neighbouring (most similar) elements of the model dictionary compared to your input text (shorthand for <code>starspace_knn</code>)
</p>
</li>
</ul>
<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'textspace'
predict(
  object,
  newdata,
  type = c("generic", "labels", "knn", "embedding"),
  k = 5L,
  sep = " ",
  basedoc,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>an object of class <code>textspace</code> as returned by <code>starspace</code> or <code>starspace_load_model</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p>a data frame with columns <code>doc_id</code> and <code>text</code> or a character vector with text where the names of the character vector represent an identifier of that text</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>character string: either 'generic', 'labels', 'embedding', 'knn'. Defaults to 'generic'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>integer with the number of predictions to make. Defaults to 5. Only used in case <code>type</code> is set to <code>'generic'</code> or <code>'knn'</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sep</code></td>
<td>
<p>character string used to split <code>newdata</code> using boost::split. Only used in case <code>type</code> is set to <code>'generic'</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>basedoc</code></td>
<td>
<p>optional, either a character vector of possible elements to predict or 
the path to a file in labelDoc format, containing basedocs which are set of possible things to predict, if different than 
the ones from the training data. Only used in case <code>type</code> is set to <code>'generic'</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>not used</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The following is returned, depending on the argument <code>type</code>:
</p>

<ul>
<li>
<p> In case type is set to <code>'generic'</code>: a list, one for each row or element in <code>newdata</code>. 
Each list element is a list with elements 
</p>

<ul>
<li>
<p> doc_id: the identifier of the text
</p>
</li>
<li>
<p> text: the character string with the text
</p>
</li>
<li>
<p> prediction: data.frame with columns label, label_starspace and similarity 
indicating the predicted label and the similarity of the text to the label
</p>
</li>
<li>
<p> terms: a list with elements basedoc_index and basedoc_terms indicating the position in basedoc and the terms 
which are part of the dictionary which are used to find the similarity
</p>
</li>
</ul>
</li>
<li>
<p> In case type is set to <code>'labels'</code>: a data.frame is returned namely:<br>
The data.frame <code>newdata</code> where several columns are added, one for each label in the Starspace model. 
These columns contain the similarities of the text to the label. 
Similarities are computed with <code>embedding_similarity</code> indicating embedding similarities 
of the text compared to the labels using either cosine or dot product as was used during model training.
</p>
</li>
<li>
<p> In case type is set to <code>'embedding'</code>: <br>
A matrix of document embeddings, one embedding for each text in <code>newdata</code> as returned by <code>starspace_embedding</code>. 
The rownames of this matrix are set to the document identifiers of <code>newdata</code>.
</p>
</li>
<li>
<p> In case type is set to <code>'knn'</code>: a list of data.frames, one for each row or element in <code>newdata</code> <br>
Each of these data frames contains the columns doc_id, label, similarity and rank indicating the
k-nearest neighbouring (most similar) elements of the model dictionary compared to your input text as returned by <code>starspace_knn</code>
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">data(dekamer, package = "ruimtehol")
dekamer$text &lt;- strsplit(dekamer$question, "\\W")
dekamer$text &lt;- lapply(dekamer$text, FUN = function(x) x[x != ""])
dekamer$text &lt;- sapply(dekamer$text, 
                       FUN = function(x) paste(x, collapse = " "))

idx &lt;- sample(nrow(dekamer), size = round(nrow(dekamer) * 0.9))
traindata &lt;- dekamer[idx, ]
testdata &lt;- dekamer[-idx, ]
set.seed(123456789)
model &lt;- embed_tagspace(x = traindata$text, 
                        y = traindata$question_theme_main, 
                        early_stopping = 0.8,
                        dim = 10, minCount = 5)
scores &lt;- predict(model, testdata)                        
scores &lt;- predict(model, testdata, type = "labels")
str(scores)
emb &lt;- predict(model, testdata[, c("doc_id", "text")], type = "embedding")
knn &lt;- predict(model, testdata[1:5, c("doc_id", "text")], type = "knn", k=3)


## Not run: 
library(udpipe)
data(dekamer, package = "ruimtehol")
dekamer &lt;- subset(dekamer, question_theme_main == "DEFENSIEBELEID")
x &lt;- udpipe(dekamer$question, "dutch", tagger = "none", parser = "none", trace = 100)
x &lt;- x[, c("doc_id", "sentence_id", "sentence", "token")]
set.seed(123456789)
model &lt;- embed_sentencespace(x, dim = 15, epoch = 5, minCount = 5)
scores &lt;- predict(model, "Wat zijn de cijfers qua doorstroming van 2016?", 
                  basedoc = unique(x$sentence), k = 3) 
str(scores)

#' ## clean up for cran
file.remove(list.files(pattern = ".udpipe$"))

## End(Not run)
</code></pre>


</div>