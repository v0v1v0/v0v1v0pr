<div class="container">

<table style="width: 100%;"><tr>
<td>abundEstim</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimate abundance from distance-sampling data</h2>

<h3>Description</h3>

<p>Estimate abundance (or density) given an estimated detection
function and supplemental information on observed group sizes, transect
lengths, area surveyed, etc.  Also computes confidence intervals on
abundance (or density) using a the bias corrected bootstrap method.
</p>


<h3>Usage</h3>

<pre><code class="language-R">abundEstim(
  dfunc,
  detectionData,
  siteData,
  area = NULL,
  singleSided = FALSE,
  ci = 0.95,
  R = 500,
  lengthColumn = "length",
  plot.bs = FALSE,
  showProgress = TRUE,
  control = RdistanceControls()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dfunc</code></td>
<td>
<p>An estimated 'dfunc' object produced by <code>dfuncEstim</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>detectionData</code></td>
<td>
<p>A data frame containing detection distances 
(either perpendicular for line-transect or radial for point-transect
designs), with one row per detected object or group.   
This data frame must contain at least the following 
information: 
</p>

<ul>
<li>
<p> Detection Distances: A single column containing 
detection distances must be specified on the left-hand 
side of <code>formula</code>.  As of Rdistance version 3.0.0, 
the detection distances must have measurement units attached. 
Attach measurements units to distances using <code>library(units);units()&lt;-</code>.
For example, <code>library(units)</code> followed by <code>units(df$dist) &lt;- "m"</code> or 
<code>units(df$dist) &lt;- "ft"</code> will work. Alternatively, 
<code>df$dist &lt;- units::set_units(df$dist, "m")</code> also works.
</p>
</li>
<li>
<p> Site IDs: The ID of the transect or point 
(i.e., the 'site') where each object or group was detected.
The site ID  column(s) (see arguments <code>transectID</code> and
<code>pointID</code>) must 
specify the site (transect or point) so that this 
data frame can be merged with <code>siteData</code>.    
</p>
</li>
<li>
<p> In a later release, <code>Rdistance</code> will allow detection-level 
covariates.  When that happens, detection-level 
covariates will appear in this data frame. 
</p>
</li>
</ul>
<p>See example data set <code>sparrowDetectionData</code>.
See also <b>Input data frames</b> below 
for information on when <code>detectionData</code> and 
<code>siteData</code> are required inputs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>siteData</code></td>
<td>
<p>A data.frame containing site (transect or point)
IDs and any 
<em>site level</em> covariates to include in the detection function. 
Every unique surveyed site (transect or point) is represented on
one row of this data set, whether or not targets were sighted 
at the site.  See arguments <code>transectID</code> and 
<code>pointID</code> for an explanation of the way in which distance and site 
data frames are merged.  See 
section <b>Relationship between data frames (transect and point ID's)</b>
for additional details.
</p>
<p>See <b>Data frame requirements</b> for situations in which 
<code>detectionData</code> only, <code>detectionData</code> and <code>siteData</code>, or 
neither are required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>area</code></td>
<td>
<p>A scalar containing the total area of 
inference. Commonly, this is study area size.  
If <code>area</code> is NULL (the default), 
<code>area</code> will be set to 1 square unit of the output units and this
produces abundance estimates equal density estimates. 
If <code>area</code> is not NULL, it must have measurement units 
assigned by the <code>units</code> package. 
The units on <code>area</code> must be convertible
to squared output units. Units 
on <code>area</code> must be two-dimensional. 
For example, if output units are "foo", 
units on area must be convertible to "foo^2" by the <code>units</code>
package. 
Units of "km^2", "cm^2", "ha", "m^2", "acre", "mi^2", and many
others are acceptable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>singleSided</code></td>
<td>
<p>Logical scaler. If only one side of the transect was 
observed, set <code>singleSided</code> = TRUE. If both sides of line-transects were 
observed, <code>singleSided</code> = FALSE. Some surveys
observe only one side of transect lines for a variety of logistical reasons. 
For example, some aerial line-transect surveys place observers on only one
side of the aircraft. This parameter effects only line-transects.  When 
<code>singleSided</code> = TRUE, surveyed area is halved and the density 
estimator's denominator (see <b>Details</b>)
is <code class="reqn">(ESW)(L)</code>, not <code class="reqn">2(ESW)(L)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci</code></td>
<td>
<p>A scalar indicating the confidence level of confidence intervals. 
Confidence intervals are computed using a bias corrected bootstrap
method. If <code>ci = NULL</code>, confidence intervals are not computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>
<p>The number of bootstrap iterations to conduct when <code>ci</code> is not
NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lengthColumn</code></td>
<td>
<p>Character string specifying the (single) column in 
<code>siteData</code> that contains transect lengths. This is ignored if 
<code>pointSurvey</code> = TRUE. This column must have measurement units.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.bs</code></td>
<td>
<p>A logical scalar indicating whether to plot individual
bootstrap iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>showProgress</code></td>
<td>
<p>A logical indicating whether to show a text-based
progress bar during bootstrapping. Default is <code>TRUE</code>. 
It is handy to shut off the 
progress bar if running this within another function. Otherwise, 
it is handy to see progress of the bootstrap iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>A list containing optimization control parameters such 
as the maximum number of iterations, tolerance, the optimizer to use, 
etc.  See the 
<code>RdistanceControls</code> function for explanation of each value,
the defaults, and the requirements for this list. 
See examples below for how to change controls.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The abundance estimate for line-transect surveys (if no covariates
are included in the detection function and both sides of the transect 
were observed) is 
</p>
<p style="text-align: center;"><code class="reqn">N =\frac{n(A)}{2(ESW)(L)}</code>
</p>
 
<p>where <em>n</em> is total number of sighted individuals 
(i.e., <code>sum(dfunc$detections$groupSizes)</code>), <em>L</em> is the total length of 
surveyed transect (i.e., <code>sum(siteData[,lengthColumn])</code>),
and <em>ESW</em> is effective strip width
computed from the estimated distance function (i.e., <code>ESW(dfunc)</code>).
If only one side of transects were observed, the "2" in the denominator 
is not present (or, replaced with a "1"). 
</p>
<p>The abundance estimate for point transect surveys (if no covariates are
included) is 
</p>
<p style="text-align: center;"><code class="reqn">N =\frac{n(A)}{\pi(ESR^2)(P)}</code>
</p>
 
<p>where <em>n</em> is total number of sighted individuals,
<em>P</em> is the total number of surveyed points, 
and <em>ESR</em> is effective search radius 
computed from the estimated distance function (i.e., <code>ESR(dfunc)</code>).
</p>
<p>Setting <code>plot.bs=FALSE</code> and <code>showProgress=FALSE</code> 
suppresses all intermediate output.
</p>


<h3>Value</h3>

<p>An 'abundance estimate' object, which is a list of
class <code>c("abund", "dfunc")</code>, containing all the components of a "dfunc"
object (see <code>dfuncEstim</code>), plus the following: 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>density</code></td>
<td>
<p>Estimated density on the sampled area with units. The <em>effectively</em>
sampled area is 2*L*ESW (not 2*L*w.hi). Density has squared units of the 
requested output units.  Convert density to other units with  
<code>units::set_units(x$density, "&lt;units&gt;").</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.hat</code></td>
<td>
<p>Estimated abundance on the study area (if <code>area</code> &gt;
1) or estimated density on the study area (if <code>area</code> = 1), without units.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>The number of detections (not individuals, unless all group sizes = 1) 
on non-NA length transects
used to compute density and abundance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.seen</code></td>
<td>
<p>The total number of individuals seen on transects with non-NA
length. Sum of group sizes used 
to estimate density and abundance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>area</code></td>
<td>
<p>Total area of inference in squared output units.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>surveyedUnits</code></td>
<td>
<p>The total length of sampled transect with units. This is the sum 
of the <code>lengthColumn</code> column of <code>siteData</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avg.group.size</code></td>
<td>
<p>Average group size on transects with non-NA length transects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rng.group.size</code></td>
<td>
<p>Minimum and maximum groupsizes observed on non-NA length transects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>effDistance</code></td>
<td>
<p>A vector containing effective sample distance.  If covariates
are not included, length of this vector is 1 because effective sampling distance 
is constant over detections. If covariates are included, this vector has length
equal to the number of detections (i.e., <code>x$n</code>).  This vector was produced 
by a call to <code>effectiveDistance()</code> with <code>newdata</code> set to NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.hat.ci</code></td>
<td>
<p>A vector containing the lower and upper limits of the 
bias corrected bootstrap confidence interval for
abundance. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>density.ci</code></td>
<td>
<p>A vector containing the lower and upper limits of the 
bias corrected bootstrap confidence interval for
density, with units.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>effDistance.ci</code></td>
<td>
<p>A vector containing the lower and upper limits of the 
bias corrected bootstrap confidence interval for <em>average</em>
effective sampling distance.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>A data frame containing bootstrap values of coefficients, 
density, and effective distances.  Number of rows is always 
<code>R</code>, the requested number of bootstrap 
iterations.  If a particular iteration did not converge, the
corresponding row in <code>B</code> is <code>NA</code> (hence, use 'na.rm = TRUE' 
when computing summaries). Columns 1 through <code>length(coef(dfunc))</code>
contain bootstrap realizations of the distance function's coefficients. 
The second to last column contains bootstrap values of
density (with units).  The last column of B contains bootstrap 
values of effective sampling distance or radius (with units). If the 
distance function contains covariates,
the effective sampling distance column is the average 
effective distance over detections 
used during the associated bootstrap iteration. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nItersConverged</code></td>
<td>
<p>The number of bootstrap iterations that converged.  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>The (scalar) confidence level of the
confidence interval for <code>n.hat</code>.</p>
</td>
</tr>
</table>
<h3>Bootstrap Confidence Intervals</h3>

<p>The bootstrap confidence interval for abundance 
assumes that the fundamental units of
replication (lines or points, hereafter "sites") are independent.
The bias corrected bootstrap
method used here resamples the units of replication (sites), 
refits the distance function, and estimates abundance using 
the resampled counts and re-estimated distance function. 
The original data frames, <code>detectionData</code> and <code>siteData</code>, 
are needed here for bootstrapping because they contain the transect 
and detection information.
If a double-observer data
frame is included in <code>dfunc</code>, rows of the double-observer data frame
are re-sampled each bootstrap iteration. 
</p>
<p>This routine does not 
re-select the distance model fitted to resampled data.  The 
model in the input object is re-fitted every iteration.  
</p>
<p>By default, <code>R</code> = 500 iterations are performed, after which the bias
corrected confidence intervals are computed (Manly, 1997, section 3.4).
</p>
<p>During bootstrap iterations, the distance function can fail 
to converge on the resampled data.   An iteration can fail 
to converge for a two reasons:
(1) no detections on the iteration, and (2) bad configuration 
of distances on the iteration which pushes parameters to their 
bounds. When an iteration fails to produce a valid 
distance function, <code>Rdistance</code> 
simply skips the intration, effectively ignoring these 
non-convergent iterations. 
If the proportion of non-convergent iterations is small 
(less than 20
on abundance is 
probably valid.  If the proportion of non-convergent iterations 
is not small (exceeds 20
The print method (<code>print.abund</code>) is the routine that  issues this 
warning. The warning can be 
turned off by setting <code>maxBSFailPropForWarning</code> in the 
print method to 1.0, or by modifying the code in <code>RdistanceControls()</code>
to re-set the default threshold and storing the modified 
function in your <code>.GlobalEnv</code>.  Additional iterations may be needed 
to achieve an adequate number. Check number of convergent iterations by 
counting non-NA rows in output data frame 'B'.
</p>


<h3>Missing Transect Lengths</h3>

<p><b>Line transects</b>: The transect length column of <code>siteData</code> can contain missing values. 
NA length transects are equivalent
to 0 [m] transects and do not count toward total surveyed units.  NA length
transects are handy if some off-transect distance observations should be included
when estimating the distance function, but not when estimating abundance. 
To do this, include the "extra" distance observations in the detection data frame, with valid
site IDs, but set the length of those site IDs to NA in the site data frame. 
Group sizes associated with NA length transects are dropped and not counted toward density
or abundance. Among other things, this allows estimation of abundance on one 
study area using off-transect distance observations from another.  
</p>
<p><b>Point transects</b>: Point transects do not have length. The "length" of point transects
is the number of points on the transect. <code>Rdistance</code> treats individual points as independent 
and bootstrap resampmles them to estimate variance. To include distance obervations
from some points but not the number of targets seen, include a separate "length" column 
in the site data frame with NA for the "extra" points. Like NA length line transects, 
NA "length" point transects are dropped from the count of points and group sizes on these 
transects are dropped from the counts of targets.  This allows users to estimate their distance 
function on one set of observations while inflating counts from another set of observations.  
A transect "length" column is not required for point transects. Values in the <code>lengthColumn</code>
do not matter except for NA (e.g., a column of 1's mixed with NA's is acceptable).
</p>


<h3>References</h3>

<p>Manly, B.F.J. (1997) <em>Randomization, bootstrap, and 
Monte-Carlo methods in biology</em>, London: Chapman and Hall.
</p>
<p>Buckland, S.T., D.R. Anderson, K.P. Burnham, J.L. Laake, D.L. Borchers,
and L. Thomas. (2001) <em>Introduction to distance sampling: estimating
abundance of biological populations</em>. Oxford University Press, Oxford, UK.
</p>


<h3>See Also</h3>

<p><code>dfuncEstim</code>, <code>autoDistSamp</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Load example sparrow data (line transect survey type)
data(sparrowDetectionData)
data(sparrowSiteData)

# Fit half-normal detection function
dfunc &lt;- dfuncEstim(formula=dist ~ groupsize(groupsize)
                    , detectionData=sparrowDetectionData
                    , likelihood="halfnorm"
                    , w.hi=units::set_units(100, "m")
                    )

# Estimate abundance given a detection function
# No variance on density or abundance estimated here 
# due to time constraints.  Set ci=0.95 (or another value)
# to estimate bootstrap variances on ESW, density, and abundance.

fit &lt;- abundEstim(dfunc
                , detectionData = sparrowDetectionData
                , siteData = sparrowSiteData
                , area = units::set_units(4105, "km^2")
                , ci = NULL
                )
         
</code></pre>


</div>