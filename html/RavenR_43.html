<div class="container">

<table style="width: 100%;"><tr>
<td>rvn_met_interpolate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Interpolate meteorological data using IDW</h2>

<h3>Description</h3>

<p>Interpolates/infills missing meteorological data by
using an inverse-distance weighting scheme to infill using data from nearby
meteorological stations; issues where maximum temperature is less than minimum
temperature can also be resolved.
</p>


<h3>Usage</h3>

<pre><code class="language-R">rvn_met_interpolate(
  weather_data = NULL,
  cc = c("max_temp", "min_temp", "total_precip"),
  key_stn_ids = NULL,
  ppexp = 2,
  fix_interp_temp = TRUE,
  fix_base_temp = FALSE,
  min_dist = 100
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>weather_data</code></td>
<td>
<p>data frame of input meteorological data from multiple stations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cc</code></td>
<td>
<p>columns from weather_data to infill missing values in</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>key_stn_ids</code></td>
<td>
<p>station IDs in which to perform the interpolation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ppexp</code></td>
<td>
<p>exponent to use in inverse distance weighting calculation (default 2)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fix_interp_temp</code></td>
<td>
<p>function will swap interpolated min and max temp if appropriate</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fix_base_temp</code></td>
<td>
<p>function will swap any min and max temp if appropriate</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_dist</code></td>
<td>
<p>minimum distance used in IDW to avoid issues with stations of different IDs but exact same coordinates (default 100m)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function takes a meteorological data set with multiple station data in one data frame and
interpolates the missing values for key stations, for the specified meteorological variables to interpolate.
</p>
<p>The format of the weather_data input is consistent with that from the <code>weathercan::weather_dl</code>
function, which is the recommended tool to gather this input (see the examples).
</p>
<p>This function does not guarantee to infill all missing values, since this depends on the availability of data
at other locations when it lacks at a given station, although a warning is issued if
missing values remain following the interpolation. If this is encountered, it may be prudent to consider
including additional stations in the available data for interpolation and/or applying alternative
interpolation schemes in conjunction with <code>rvn_met_interpolate</code>.
</p>
<p>This function does not (currently) perform checks for the quality of the supplied or infilled data,
such as checking for maximum temperature less than minimum temperature, unreasonable precipitation values, etc.
</p>
<p>The key_stn_ids indicates which stations should have their missing values interpolated. It is likely that
the user will require more data to perform a proper interpolation than the user cares to have gauge
records at, i.e. some stations are only provided for the purposes of infilling missing data at other stations.
Since the interpolation of all stations provided can become computationally expensive, the user can
specify which stations they want to interpolate data for with the key_stn_ids parameter. Station IDs that
are not within the key_stn_ids (if not NULL) will still be used, but not themselves infilled.
</p>
<p>fix_interp_temp is a boolean for the function to swap any max_temp and min_temp fields where the maximum
temperature is less than the minimum temperature, a common fix in messy environmental data. This function
will only apply if the columns <code>max_temp</code> and <code>min_temp</code> are present, and will only apply to the
interpolated fields. By default this is enabled, and automatic fixes to interpolated data will be done;
supplied data where the max temp is less than min temp will not be fixed unless fix_base_temp is enabled.
</p>
<p>The distance calculation, estimating the distance between stations, is performed using the
<code>rvn_dist_lonlat</code> function, which is based on the <code>geosphere</code> package. The min_dist is
included to provide a minimum distance used in IDW, and avoid issues with stations of different names and IDs but
the same coordinates. This can occur when stations upgrade or are reinstated at a later time in the same location,
which would otherwise result in a div/0 error in the IDW calculation.
</p>


<h3>Value</h3>

<table><tr style="vertical-align: top;">
<td><code>new_wd</code></td>
<td>
<p>infilled meteorological data set</p>
</td>
</tr></table>
<h3>See Also</h3>

<p><code>rvn_rvt_write_met</code> for writing meteorological data sets to rvt format.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Not run: 
## NOT RUN (downloads data + long runtime)

# example to create infilled data sets

library(weathercan)
stn &lt;- weathercan::stations_search(name="Glen allan", interval = "day")
dl_stn &lt;- stn
all_stns &lt;- weathercan::stations_search(coords=c(stn$lat, stn$lon), dist=40,
          interval="day", starts_latest = 2002,
          ends_earliest = 2010)

# download data with weathercan::weather_dl()
weather_data &lt;- weather_dl(station_ids = all_stns$station_id,
                            start = "2002-10-01",
                            end = "2005-10-01",
                            interval="day")

# define first three as key stations of interest for infilling
dl_stn &lt;- all_stns[1:3,]

# confirm missing data in key columns
key_cols &lt;- c("min_temp","max_temp","total_precip")
length(which(is.na(weather_data[,key_cols])))

# perform interpolation for key stns (3) using all stations downloaded (5)
new_wd &lt;- rvn_met_interpolate(weather_data = weather_data,
                               key_stn_ids = dl_stn$station_id,
                               cc = key_cols)

# no warning - confirm no missing values in key columns
length(which(is.na(new_wd[,key_cols])))

## End(Not run)

</code></pre>


</div>