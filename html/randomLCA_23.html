<div class="container">

<table style="width: 100%;"><tr>
<td>randomLCA</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fits a Latent Class Model including a Random Effect</h2>

<h3>Description</h3>

<p>Fit latent class models, which may include a random effect.
</p>


<h3>Usage</h3>

<pre><code class="language-R">randomLCA(patterns, freq = NULL, nclass = 2, calcSE = TRUE, notrials = 20, 
  random = FALSE, byclass = FALSE, quadpoints = 21, constload = TRUE,
  blocksize = dim(patterns)[2], level2 = FALSE, probit = FALSE,
  level2size = blocksize, qniterations = 5, penalty = 0.01, EMtol = 1.0e-5,
  verbose = FALSE, seed = as.integer(runif(1, 0, .Machine$integer.max)),
  cores =  max(detectCores() %/% 2, 1))</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>patterns</code></td>
<td>
<p>Data frame or matrix of 0 and 1 defining the outcome patterns. May also include missing values, with randomLCA using maximum likelihood to fit the models using all available data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>freq</code></td>
<td>
<p>Frequency for each outcome pattern, if missing this is calculated from the patterns, and the patterns are summarised to remove duplicate values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nclass</code></td>
<td>
<p>Number of classes to be fitted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calcSE</code></td>
<td>
<p>Calculate standard errors for parameters. Useful for bootstrapping.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>notrials</code></td>
<td>
<p>For a standard latent class model, the number of random starting values used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random</code></td>
<td>
<p>Include random effect?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>byclass</code></td>
<td>
<p>Vary random effect loading(s) by class?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadpoints</code></td>
<td>
<p>Number of quadrature points for adaptive quadrature</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>constload</code></td>
<td>
<p>Outcome loadings are constant for random effects model?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blocksize</code></td>
<td>
<p>Where a random effects (single level) model is broken into blocks, that is the loadings are repeated, this defines the size of the blocks</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probit</code></td>
<td>
<p>Probit model for random effect?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level2</code></td>
<td>
<p>Fit 2 level random effects model (further details to follow)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level2size</code></td>
<td>
<p>Size of level 2 blocks if fitting 2 level models</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>qniterations</code></td>
<td>
<p>Number of Quasi-Newton iterations within each EM/adaptive cycle. Decrease if there is a failure to converge</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>penalty</code></td>
<td>
<p>penalty applied to likelihood for outcome probabilities. Shrinks outcome probabilities in slightly and can prevent extreme values. Setting penalty to 0 will produce an unpenalized fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>EMtol</code></td>
<td>
<p>convergence tolerance for EM algorithm for fixed effect latent class</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Prints fit progress if true</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>Initial random seed for generating starting values. This can be set to guarantee that the fit is the same each time, including the order of the classes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cores</code></td>
<td>
<p>Number of cores to be used for parallel evaluation of starting values</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The structure of the patterns is assumed to be a number of blocks of different outcomes each of level2size, allowing outcomes to be repeated. Each outcome is assumed to have it's own loading.
An example is the width of the patterns is n and the level2size is n, resulting in n outcomes and therefore n loadings. Alternatively if the level2size is 1, then there are n repeats of the same outcome (but with different probabilities) with the same loading. In practice they may not be the same type of outcome, but usually will be.
</p>
<p>The algorithm used is EM for the standard latent class and adaptive (in the sense of moving the location of the quadrature points) Gauss-Hermite quadrature for the random effects models. The number of quadrature points defaults to 21.
</p>


<h3>Value</h3>

<p>randomLCA object
This contains
</p>
<table>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p>Fit object from optim</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nclass</code></td>
<td>
<p>Number of classes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>classp</code></td>
<td>
<p>Class probabilities</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outcomep</code></td>
<td>
<p>Outcome probability</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambdacoef</code></td>
<td>
<p>Loadings</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se</code></td>
<td>
<p>Standard errors corresponding to results returned by optim</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>np</code></td>
<td>
<p>Number of parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nobs</code></td>
<td>
<p>Number of observations in total</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logLik</code></td>
<td>
<p>log likelihood for fitted model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>penlogLik</code></td>
<td>
<p>Penalised log likelihood for fitted model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>observed</code></td>
<td>
<p>Observed numbers corresponding to each pattern</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitted</code></td>
<td>
<p>Fitted number corresponding to each pattern</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deviance</code></td>
<td>
<p>Deviance</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>classprob</code></td>
<td>
<p>Posterior class probability for each pattern</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bics</code></td>
<td>
<p>BIC obtained for each trial when fitting initial latent class models</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>call to randomLCA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random</code></td>
<td>
<p>random parameter to randomLCA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>constload</code></td>
<td>
<p>constload parameter to randomLCA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level2</code></td>
<td>
<p>level2 parameter to randomLCA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level2size</code></td>
<td>
<p>level2size parameter to randomLCA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>byclass</code></td>
<td>
<p>byclass parameter to randomLCA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probit</code></td>
<td>
<p>probit parameter to randomLCA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadpoints</code></td>
<td>
<p>quadpoints parameter to randomLCA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blocksize</code></td>
<td>
<p>blocksize parameter to randomLCA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>freq</code></td>
<td>
<p>frequency of each pattern</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>qniterations</code></td>
<td>
<p>qniterations parameter to randomLCA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>penalty</code></td>
<td>
<p>penalty parameter to randomLCA</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>In the returned object there a fields for patterns and frequencies. If frequencies are not supplied then the patterns and frequencies are constructed. If frequencies are supplied then zero rows are removed. When frequencies are supplied it is assumed that the data has been simplified. The returned fitted, posterior class probabilities etc, all correspond to the simplified patterns, not to the original data.
</p>


<h3>Author(s)</h3>

<p>Ken Beath</p>


<h3>References</h3>

<p>Beath KJ (2017). randomLCA: An R Package for Latent Class with Random Effects Analysis. Journal of Statistical Software, 81(13), pp. 1-25. <a href="https://doi.org/10.18637/jss.v081.i13">doi:10.18637/jss.v081.i13</a></p>


<h3>Examples</h3>

<pre><code class="language-R">
# standard latent class with 2 classes
dentistry.lca2 &lt;- randomLCA(dentistry[, 1:5], freq = dentistry$freq, nclass = 2, cores = 1)
# random effects model with constant random effect loading
dentistry.lca2random &lt;- randomLCA(dentistry[, 1:5], freq = dentistry$freq, 
	nclass = 2, random = TRUE, constload = TRUE, probit = TRUE, cores = 1)
# allow loading to vary by dentist
# this is the 2LCR model from Qu et al (1996)
dentistry.lca2random1 &lt;- randomLCA(dentistry[, 1:5], freq = dentistry$freq, 
	nclass = 2, random = TRUE, constload = FALSE, probit = TRUE, cores = 1)

</code></pre>


</div>