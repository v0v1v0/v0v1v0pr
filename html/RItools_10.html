<div class="container">

<table style="width: 100%;"><tr>
<td>DesignWeights</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create stratum weights to be associated with a DesignOptions</h2>

<h3>Description</h3>

<p>Apply weighting function to a DesignOptions by stratum, returning results in a format
suitable to be associated with an existing design and used in further calcs.
</p>


<h3>Usage</h3>

<pre><code class="language-R">DesignWeights(design, stratum.weights = harmonic_times_mean_weight)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>design</code></td>
<td>
<p>DesignOptions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stratum.weights</code></td>
<td>
<p>Stratum weights function. Will be fed a count data.frame with Tx.grp (indicating the treatment group), stratum.code, all other covariates and unit.weights.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function expects its DesignOptions argument to represent aggregated data,
i.e. clusters not elements within clusters.  Its <code>stratum.weights</code> argument
is a function that is applied to a data frame representing clusters,
with variables <code>Tx.grp</code>, <code>stratum.code</code>, covariates as named in the
<code>design</code> argument (a DesignOptions object), and <code>unit.weights</code> (either as
culled or inferred from originating <code>balanceTest</code> call or as aggregated up
from those unit weights).  Returns a
weighting factor to be associated with each stratum, this factor determining the stratum
weight by being multiplied by mean of unit weights over clusters in that stratum.
</p>
<p>Specifically, the function's value is a data frame of two variables,
<code>sweights</code>  and <code>wtratio</code>, with rows representing strata.
The <code>sweights</code> vector represents internally
calculated or user-provided <code>stratum.weights</code>, one for each
stratum, scaled so that their sum is 1; in Hansen &amp; Bowers (2008), these
weights are denoted <code class="reqn">w_{b}</code>. <code>wtratio</code> is the ratio of
<code>sweights</code> to the product of half the harmonic
mean of <code class="reqn">n_{tb}</code> and <code class="reqn">n_{cb}</code>, the number of treatment and control
clusters in stratum <code class="reqn">b</code>, with the mean of the weights associated with
each of these clusters.  In the notation of Hansen &amp; Bowers
(2008), this is <code class="reqn">w_{b}/(h_b \bar{m}_b)</code>. Despite the name
‘<code>wtratio</code>’, this ratio's denominator is not a weight
in the sense of summing to 1 across strata.  The ratio is expected
downstream in <code>HB08</code> (in internal calculations
involving ‘<code>wtr</code>’).
</p>


<h3>Value</h3>

<p>data frame w/ rows for strata, cols <code>sweights</code> and <code>wtratio</code>.
</p>


</div>