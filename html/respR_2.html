<div class="container">

<table style="width: 100%;"><tr>
<td>adjust_rate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Adjust rates to account for background respiration or oxygen flux.</h2>

<h3>Description</h3>

<p>The <code>adjust_rate</code> function adjusts oxygen uptake or production rates (for
example, as determined in <code>calc_rate()</code> or <code>auto_rate()</code>) for background
oxygen use by microbial organisms, or for other removal or input of oxygen
during a respirometry experiment. The function accepts numeric values, as
well as regular <code>respR</code> objects, and data frames. See <code>calc_rate.bg()</code> for
determining background rates, which is the recommended way of passing
background rates to <code>adjust_rate</code>. Rates determined in <code>calc_rate</code> are also
accepted as background rates.
</p>


<h3>Usage</h3>

<pre><code class="language-R">adjust_rate(
  x,
  by,
  method = NULL,
  by2 = NULL,
  time_x = NULL,
  time_by = NULL,
  time_by2 = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>numeric. A single numeric value, numeric vector, or object of class
<code>calc_rate</code>, <code>calc_rate.int</code>, <code>auto_rate</code>, or <code>auto_rate.int</code>. This
contains the experimental rate value(s) to be adjusted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by</code></td>
<td>
<p>numeric. A single numeric value, numeric vector, or object of class
<code>calc_rate.bg</code> or <code>calc_rate</code>. This is the background rate(s) used to
perform the adjustment to <code>x</code>. Can also be a <code>data.frame</code> or <code>inspect</code>
object for <code>"concurrent"</code>, <code>"linear"</code> or <code>"exponential"</code> adjustments. See
Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>string. Method of background adjustment. Defaults to <code>"mean"</code>.
Other inputs are: <code>"value"</code>, <code>"paired"</code>, <code>"concurrent"</code>, <code>"linear"</code>,
<code>"exponential"</code>. See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by2</code></td>
<td>
<p>numeric. Either a single numeric value, a <code>calc_rate.bg</code> or
<code>calc_rate</code> object, a <code>data.frame</code>, or <code>inspect</code> object. This is the source
of the second background adjustment rate, and used only for dynamic
adjustments (<code>"linear"</code> or <code>"exponential"</code>). See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_x</code></td>
<td>
<p>numeric. The timestamp(s) for the rate(s) in <code>x</code>, if it was
entered as a numeric (otherwise it is extracted from the <code>x</code> input object).
Generally this is the midpoint of the time range over which each <code>x</code> rate
was calculated. Used only in dynamic adjustments (<code>"linear"</code> or
<code>"exponential"</code>). See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_by</code></td>
<td>
<p>numeric. The timestamp of the background correction rate in
<code>by</code>, if it was entered as a numeric (otherwise it is extracted from the
<code>by</code> input object). Generally the midpoint of the time range over which it
was calculated. Used only in dynamic adjustments (<code>"linear"</code> or
<code>"exponential"</code>). See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_by2</code></td>
<td>
<p>numeric. The timestamp of the background correction rate in
<code>by2</code>, if it was entered as a numeric (otherwise it is extracted from the
<code>by2</code> input object). Generally the midpoint of the time range over which it
was calculated. Used only in dynamic adjustments (<code>"linear"</code> or
<code>"exponential"</code>). See Details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>adjust_rate</code> allows the rate, or multiple rates, in <code>x</code> to be adjusted in a
number of ways, as detailed below. Note that for those methods which accept
them, <code>by</code> and <code>by2</code> inputs of class <code>calc_rate</code>, <code>calc_rate.bg</code>,
<code>data.frame</code> or <code>inspect</code> can contain multiple columns of background oxygen
data, as long as they share the same numeric time data in column 1. In this
case, the mean of all rates calculated for all oxygen columns is used to
perform adjustments (see <code>inspect()</code> and <code>calc_rate.bg()</code> to coerce data
to this form). The exception to this is the <code>"paired"</code> method, where each
rate in <code>by</code> (i.e. rate in each oxygen column) is paired with the rate at the
same position in <code>x</code> and used to adjust it.
</p>
<p><em><strong>Note:</strong></em> take special care with the <em>sign</em> of the rate used for
adjustments. In <code>respR</code> oxygen uptake rates are negative, as they represent a
negative slope of oxygen against time. Background rates will normally also be
a negative value, while any input of oxygen would be positive. See Examples.
</p>
<p><em><strong>Methods</strong></em>
</p>
<p>There are six methods of adjustment, briefly summarised here, with more
detail below:
</p>
<p><code>"value"</code> - All experimental rates in <code>x</code> are adjusted by a single background
rate value in <code>by</code>.
</p>
<p><code>"mean"</code> - This is the default method. All experimental rates in <code>x</code> are
adjusted by the mean of all background rate values in <code>by</code>.
</p>
<p><code>"paired"</code> - Experimental rates in <code>x</code> are adjusted by the background rate
value at the same position in <code>by</code>. Therefore requires <code>x</code> and <code>by</code> to have
the same number of rates.
</p>
<p><code>"concurrent"</code> - Experimental rates in <code>x</code> are adjusted by a background rate
calculated over the same time window in the data in <code>by</code>. Therefore requires
<code>x</code> and <code>by</code> to share the same time data and length (broadly speaking).
</p>
<p><code>"linear"</code> - The time values for experimental rates in <code>x</code> are used to
calculate an adjustment value based on a background rate that changes
<em>linearly</em> with respect to time over the course of an experiment. Requires
two background recordings or values (<code>by</code>, <code>by2</code>), and that all data share
the same time data or scale.
</p>
<p><code>"exponential"</code> - The time values for experimental rates in <code>x</code> are used to
calculate an adjustment value based on a background rate that changes
<em>exponentially</em> with respect to time over the course of an experiment.
Requires two background recordings or values (<code>by</code>, <code>by2</code>), and that all data
share the same time data or scale.
</p>
<p><em><strong>More Detail</strong></em>
</p>
<p><code>"value"</code> - For experiments in which the rate from a single background
experiment (or any single background value) is being used to adjust one or
more specimen rates. Each rate in <code>x</code> is adjusted by the subtracting the
single value in <code>by</code>. <code>x</code> can be a numeric value, numeric vector,
<code>calc_rate</code>, <code>calc_rate.int</code>, <code>auto_rate</code>, or <code>auto_rate.int</code> object. <code>by</code>
can be a single numeric value, a <code>calc_rate.bg</code> object containing a single
<code style="white-space: pre;">⁠$rate.bg⁠</code> (i.e. calculated from a 2-column data frame of time~oxygen), or a
<code>calc_rate</code> object containing a single <code style="white-space: pre;">⁠$rate⁠</code>. All other inputs should be
<code>NULL</code>.
</p>
<p><code>"mean"</code> - For experiments in which the mean rate from multiple background
experiments is being used to adjust one or more specimen rates. Each rate in
<code>x</code> is adjusted by subtracting the <em>mean</em> of all background rates in <code>by</code>.
<code>x</code> can be a numeric value, numeric vector, <code>calc_rate</code>, <code>calc_rate.int</code>,
<code>auto_rate</code>, or <code>auto_rate.int</code> object. <code>by</code> can be a numeric value, numeric
vector, <code>calc_rate.bg</code> object containing multiple <code style="white-space: pre;">⁠$rate.bg⁠</code>, or a
<code>calc_rate</code> object containing multiple <code style="white-space: pre;">⁠$rate⁠</code>. All other inputs should be
<code>NULL</code>. If <code>by</code> is a single value, this will obviously have the same output
as the <code>"value"</code> method.
</p>
<p><code>"paired"</code> - For experiments where multiple specimen experiments are being
adjusted by multiple different background rates. This is a vectorised
adjustment operation: rates in <code>x</code> are adjusted by the background rates at
the same position in <code>by</code>. That is, the first <code>x</code> adjusted by the first <code>by</code>,
second <code>x</code> by second <code>by</code>, etc. <code>x</code> can be a numeric value, numeric vector,
<code>calc_rate</code>, <code>calc_rate.int</code>, <code>auto_rate</code>, or <code>auto_rate.int</code> object. <code>by</code>
can be a numeric vector <em>of the same length</em>, a <code>calc_rate.bg</code> or <code>calc_rate</code>
object where the <code style="white-space: pre;">⁠$rate.bg⁠</code> or <code style="white-space: pre;">⁠$rate⁠</code> element is the <em>same length</em> as the
rates in <code>x</code> to be adjusted. All other inputs should be <code>NULL</code>.
</p>
<p><code>"concurrent"</code> - For experiments in which one or more concurrent "blanks" or
background experiments are run alongside specimen experiments. Rates in <code>x</code>
are adjusted by a background rate calculated over the same time window in the
data in <code>by</code>. That is, the start and end time of each <code>x</code> rate is used to fit
a linear regression and calculate a background rate in the <code style="white-space: pre;">⁠$dataframe⁠</code> in
<code>by</code>. <code>x</code> must be an <code>calc_rate</code>, <code>calc_rate.int</code>, <code>auto_rate</code>, or
<code>auto_rate.int</code> object. <code>by</code> must be a <code>data.frame</code>, <code>inspect</code>,
<code>calc_rate.bg</code>, or <code>calc_rate</code> object containing time~oxygen data. If there
are multiple columns of background oxygen the mean rate across the same time
window in all columns is used. In <code>calc_rate.bg</code> and <code>calc_rate</code> objects the
<code style="white-space: pre;">⁠$rate.bg⁠</code> or <code style="white-space: pre;">⁠$rate⁠</code> element is not used, only the <code style="white-space: pre;">⁠$dataframe⁠</code>. The <code>x</code> and
<code>by</code> data must share (broadly) the <em>same time data or scale in the same
units</em>. If the <code>x</code> and <code>by</code> data differ in length by more than 5% or some
time values are not shared between the two datasets, a warning is given, but
the adjustment is nevertheless performed using the available data, by using
the closest matching time window in the background data.
</p>
<p><code>"linear"</code> - This is a dynamic adjustment, intended for experiments in which
the background oxygen rate <em>changes</em> over the course of the experiment
<em>linearly</em> with respect to time. This is typical of long duration
respirometry experiments in high temperatures, where a "blank" is conducted
at the start of the experiment before the specimen is put in, and again at
the end after it is taken out. It requires therefore two background
recordings sharing the same numeric <em>time data</em> or <em>time scale</em>, in the same
units as the experiment to be adjusted. These can also be entered as two rate
<em>values</em> with associated <em>timestamps</em>, which again must share the same time
scale and units as the rate to be adjusted. This method can also be used in
experiments in which a concurrent blank experiment is conducted alongside
specimen experiments (as described in the <code>concurrent</code> method above), but in
which the background data is deemed too noisy to fit reliable regressions
over the short timescales specimen rates are determined. In this case, <em>any</em>
two reliable segments of the background data of any duration can be used to
determine how the background rate changes over the course of the experiment,
and then this used to adjust specimen rates using the appropriate rate
timestamps. The <em>time~background rate</em> linear relationship is calculated
using the midpoint of the time range of the <code>by</code> and <code>by2</code> rate regressions
(or values plus timestamps). The adjustments to <code>x</code> rates are calculated by
taking the midpoint of the time range over which it was determined and
applying it to the <code>by~by2</code> linear relationship. The <code>x</code> input can be a
numeric value, numeric vector, or a <code>calc_rate</code>, <code>calc_rate.int</code>,
<code>auto_rate</code>, or <code>auto_rate.int</code> object containing single or multiple rates.
The <code>by</code> input is the first background recording or rate value, and <code>by2</code> the
second background recording or rate value.
</p>
<p>While it is typical, the <code>x</code> rates do not necessarily need to be at
intermediate timepoints to the <code>by/by2</code> times. these are used only to
establish a <em>time~background rate</em> linear relationship, which can be
extrapolated before or after the time values used to calculate it. The <code>by</code>
and <code>by2</code> inputs can be a <code>data.frame</code>, <code>inspect</code> or <code>calc_rate.bg</code> object
containing background time~oxygen data. Alternatively, the rate <code>x</code>, and
background rates <code>by</code> and <code>by2</code> can be entered as values, in which case the
associated timepoints at which these were determined (generally the midpoint
of the time range over which the linear regression was fit) must be entered
as <code>time_x</code>, <code>time_by</code>, and <code>time_by2</code> (these timepoints are otherwise
automatically extracted from the input objects). Multiple <code>x</code> rates with
multiple <code>time_x</code> timepoints can be entered and adjusted, but only one linear
background rate relationship applied, that is <code>by</code>, <code>by2</code>, <code>time_by</code>, and
<code>time_by2</code> must be single numeric values in the correct units.
</p>
<p><code>"exponential"</code> - This is a dynamic adjustment, intended for experiments in
which the background oxygen rate <em>changes</em> over the course of the experiment
<em>exponentially</em> with respect to time. This is typical of long duration
respirometry experiments in high temperatures, where a "blank" is conducted
at the start of the experiment before the specimen is put in, and again at
the end after it is taken out, and the background rate is found to increase
exponentially. This is identical to the <code>"linear"</code> method (see above for
requirements), except the adjustment is calculated as an exponential
relationship of the form - <code>lm(log(c(by, by2)) ~ c(time_by, time_by2))</code>.
</p>


<h4>S3 Generic Functions</h4>

<p>Saved output objects can be used in the generic S3 functions <code>print()</code>,
<code>summary()</code>, and <code>mean()</code>.
</p>

<ul>
<li> <p><code>print()</code>: prints a single result, by default the first adjusted rate.
Others can be printed by passing the <code>pos</code> input. e.g. <code>print(x, pos = 2)</code>
</p>
</li>
<li> <p><code>summary()</code>: prints summary table of all results and metadata, or those
specified by the <code>pos</code> input. e.g. <code>summary(x, pos = 1:5)</code>. The summary can
be exported as a separate dataframe by passing <code>export = TRUE</code>.
</p>
</li>
<li> <p><code>mean()</code>: calculates the mean of all adjusted rates, or those specified by
the <code>pos</code> input. e.g. <code>mean(x, pos = 1:5)</code> The mean can be exported as a
separate value by passing <code>export = TRUE</code>.
</p>
</li>
</ul>
<h4>More</h4>

<p>For additional help, documentation, vignettes, and more visit the <code>respR</code>
website at <a href="https://januarharianto.github.io/respR/">https://januarharianto.github.io/respR/</a>
</p>



<h3>Value</h3>

<p>Output is a list object of class <code>adjust_rate</code> containing all inputs,
input rates, adjustment values, adjustment method and model (if relevant),
and the primary output of interest <code style="white-space: pre;">⁠$rate.adjusted⁠</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Note that oxygen uptake rates are negative in respR since they represent a
# decrease in dissolved oxygen and negative slope. Typically both
# specimen rate and background rate values are negative.

# Simple background adjustment to a single rate
# This is (-7.44) - (-0.04) = -7.40
adjust_rate(x = -7.44, by = -0.04, method = "value")

# Oxygen input adjustment
# This is (-7.44) - (0.1) = -7.54
adjust_rate(x = -7.44, by = 0.1, method = "value")

# Mean background respiration correction to a single rate.
adjust_rate(x = -7.44, by = c(-0.04, -0.05, -0.06),
            method = "mean")

# Mean background respiration correction to multiple rates.
out &lt;- adjust_rate(x = c(-7.44, -7.20, -7.67),
                   by = c(-0.04, -0.05, -0.06),
                   method = "mean")
summary(out)

# Paired background respiration correction to multiple rates.
out &lt;- adjust_rate(x = c(-7.44, -7.20, -7.67),
                   by = c(-0.04, -0.05, -0.06),
                   method = "paired")
summary(out)

# Dynamic linear adjustment
# With a linear relationship between the 'by' and 'by2' rates,
# at the midpoint time value the adjustment to 'x' should be -0.5
adjust_rate(x = -10,
            time_x = 500,
            by = 0, by2 = -1,
            time_by = 0, time_by2 = 1000,
            method = "linear")

# Same operation to multiple rates
out &lt;- adjust_rate(x = c(-10, -11, -12),
                   time_x = c(500, 600, 700),
                   by = 0, by2 = -1,
                   time_by = 0, time_by2 = 1000,
                   method = "linear")
summary(out)

# A complete workflow using objects instead of values.

# Extract a single replicate from the middle of the zebrafish data
# and calculate rates
zeb_rate &lt;- subset_data(zeb_intermittent.rd,
                        from = 38300,
                        to = 38720,
                        by = "time") %&gt;%
  inspect() %&gt;%
  auto_rate()

# Calculate background rate at start of experiment
bg_start &lt;- subset_data(zeb_intermittent.rd, 1, 4999, "time") %&gt;%
  inspect() %&gt;%
  calc_rate.bg() %&gt;%
  print()

# Calculate background rate at end of experiment
bg_end &lt;- subset_data(zeb_intermittent.rd, 75140, 79251, "time") %&gt;%
  inspect() %&gt;%
  calc_rate.bg() %&gt;%
  print()

# Perform a dynamic linear adjustment
adjust_rate(zeb_rate, by = bg_start, by2 = bg_end,
            method = "linear") %&gt;%
  summary()

# Note the adjustment values applied are somewhere between the
# start and end background rate values

</code></pre>


</div>