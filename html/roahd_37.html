<div class="container">

<table style="width: 100%;"><tr>
<td>fbplot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Functional boxplot of univariate and multivariate functional data</h2>

<h3>Description</h3>

<p>This function can be used to perform the functional boxplot of univariate or
multivariate functional data.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fbplot(
  Data,
  Depths = "MBD",
  Fvalue = 1.5,
  adjust = FALSE,
  display = TRUE,
  xlab = NULL,
  ylab = NULL,
  main = NULL,
  ...
)

## S3 method for class 'fData'
fbplot(
  Data,
  Depths = "MBD",
  Fvalue = 1.5,
  adjust = FALSE,
  display = TRUE,
  xlab = NULL,
  ylab = NULL,
  main = NULL,
  ...
)

## S3 method for class 'mfData'
fbplot(
  Data,
  Depths = list(def = "MBD", weights = "uniform"),
  Fvalue = 1.5,
  adjust = FALSE,
  display = TRUE,
  xlab = NULL,
  ylab = NULL,
  main = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Data</code></td>
<td>
<p>the univariate or multivariate functional dataset whose
functional boxplot must be determined, in form of <code>fData</code> or
<code>mfData</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Depths</code></td>
<td>
<p>either a vector containing the depths for each element of the
dataset, or:
</p>

<ul>
<li> <p><em>univariate case</em>: a string containing the name of the method you
want to use to compute it. The default is <code>'MBD'</code>.
</p>
</li>
<li> <p><em>multivariate case</em>: a list with elements <code>def</code>, containing the
name of the depth notion to be used to compute depths (<code>BD</code> or
<code>MBD</code>), and <code>weights</code>, containing the value of parameter
<code>weights</code> to be passed to the depth function. Default is
<code>list(def = 'MBD', weights = 'uniform')</code>.
</p>
</li>
</ul>
<p>In both cases the name of the functions to compute depths must be available
in the caller's environment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Fvalue</code></td>
<td>
<p>the value of the inflation factor <code class="reqn">F</code>, default is <code>F =
1.5</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adjust</code></td>
<td>
<p>either <code>FALSE</code> if you would like the default value for the
inflation factor, <code class="reqn">F = 1.5</code>, to be used, or (for now <b>only in the
univariate functional case</b>) a list specifying the parameters required by
the adjustment:
</p>

<ul>
<li> <p><code>N_trials</code>: the number of repetitions of the adjustment procedure
based on the simulation of a gaussian population of functional data, each
one producing an adjusted value of <code class="reqn">F</code>, which will lead to the averaged
adjusted value <code class="reqn">\bar{F}</code>. Default is 20.
</p>
</li>
<li> <p><code>trial_size</code>: the number of elements in the gaussian population of
functional data that will be simulated at each repetition of the adjustment
procedure. Default is 8 * <code>Data$N</code>.
</p>
</li>
<li> <p><code>TPR</code>: the True Positive Rate of outliers, i.e. the proportion of
observations in a dataset without amplitude outliers that have to be
considered outliers. Default is <code>2 * pnorm(4 * qnorm(0.25))</code>.
</p>
</li>
<li> <p><code>F_min</code>: the minimum value of <code class="reqn">F</code>, defining the left boundary
for the optimization problem aimed at finding, for a given dataset of
simulated gaussian data associated to <code>Data</code>, the optimal value of
<code class="reqn">F</code>. Default is 0.5.
</p>
</li>
<li> <p><code>F_max</code>: the maximum value of <code class="reqn">F</code>, defining the right boundary
for the optimization problem aimed at finding, for a given dataset of
simulated gaussian data associated to <code>Data</code>, the optimal value of
<code class="reqn">F</code>. Default is 5.
</p>
</li>
<li> <p><code>tol</code>: the tolerance to be used in the optimization problem aimed at
finding, for a given dataset of simulated gaussian data associated to
<code>Data</code>, the optimal value of <code class="reqn">F</code>. Default is <code>1e-3</code>.
</p>
</li>
<li> <p><code>maxiter</code>: the maximum number of iterations to solve the
optimization problem aimed at finding, for a given dataset of simulated
gaussian data associated to <code>Data</code>, the optimal value of <code class="reqn">F</code>.
Default is <code>100</code>.
</p>
</li>
<li> <p><code>VERBOSE</code>: a parameter controlling the verbosity of the adjustment
process.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>display</code></td>
<td>
<p>either a logical value indicating whether you want the
functional boxplot to be displayed, or the number of the graphical device
where you want the functional boxplot to be displayed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>the label to use on the x axis when displaying the functional
boxplot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>the label (or list of labels for the multivariate functional
case) to use on the y axis when displaying the functional boxplot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main</code></td>
<td>
<p>the main title (or list of titles for the multivariate functional
case) to be used when displaying the functional boxplot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional graphical parameters to be used in plotting functions.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Even when used in graphical way to plot the functional boxplot, the
function returns a list of three elements:
</p>

<ul>
<li> <p><code>Depths</code>: contains the depths of each element of the functional
dataset.
</p>
</li>
<li> <p><code>Fvalue</code>: is the value of F used to obtain the outliers.
</p>
</li>
<li> <p><code>ID_out</code>: contains the vector of indices of dataset elements flagged
as outliers (if any).
</p>
</li>
</ul>
<h3>Adjustment</h3>

<p>In the <b>univariate functional case</b>, when the adjustment option is
selected, the value of <code class="reqn">F</code> is optimized for the univariate functional
dataset provided with <code>Data</code>.
</p>
<p>In practice, a number <code>adjust$N_trials</code> of times a synthetic population
(of size <code>adjust$tiral_size</code> with the same covariance (robustly
estimated from data) and centerline as <code>fData</code> is simulated without
outliers and each time an optimized value <code class="reqn">F_i</code> is computed so that a
given proportion (<code>adjust$TPR</code>) of observations is flagged as outliers.
The final value of <code>F</code> for the functional boxplot is determined as an
average of <code class="reqn">F_1, F_2, \dots, F_{N_{trials}}</code>. At each time step the
optimization problem is solved using <code>stats::uniroot</code> (Brent's method).
</p>


<h3>References</h3>


<ol>
<li>
<p> Sun, Y., &amp; Genton, M. G. (2012). Functional boxplots. Journal of
Computational and Graphical Statistics.
</p>
</li>
<li>
<p> Sun, Y., &amp; Genton, M. G. (2012). Adjusted functional boxplots for
spatio-temporal data visualization and outlier detection. Environmetrics,
23(1), 54-64.
</p>
</li>
</ol>
<h3>See Also</h3>

<p><code>fData</code>, <code>MBD</code>, <code>BD</code>,
<code>mfData</code>, <code>multiMBD</code>, <code>multiBD</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# UNIVARIATE FUNCTIONAL BOXPLOT - NO ADJUSTMENT

set.seed(1)

N = 2 * 100 + 1
P = 2e2

grid = seq( 0, 1, length.out = P )

D = 10 * matrix( sin( 2 * pi * grid ), nrow = N, ncol = P, byrow = TRUE )

D = D + rexp(N, rate = 0.05)


# c( 0, 1 : (( N - 1 )/2), -( ( ( N - 1 ) / 2 ) : 1 ) )^4


fD = fData( grid, D )

dev.new()
oldpar &lt;- par(mfrow = c(1, 1))
par(mfrow = c(1, 3))

plot( fD, lwd = 2, main = 'Functional dataset',
      xlab = 'time', ylab = 'values' )

fbplot( fD, main = 'Functional boxplot', xlab = 'time', ylab = 'values', Fvalue = 1.5 )

boxplot(fD$values[,1], ylim = range(fD$values), main = 'Boxplot of functional dataset at t_0 ' )

par(oldpar)

# UNIVARIATE FUNCTIONAL BOXPLOT - WITH ADJUSTMENT


set.seed( 161803 )

P = 2e2
grid = seq( 0, 1, length.out = P )

N = 1e2

# Generating a univariate synthetic gaussian dataset
Data = generate_gauss_fdata( N, centerline = sin( 2 * pi * grid ),
                             Cov = exp_cov_function( grid,
                                                     alpha = 0.3,
                                                     beta  = 0.4 ) )
fD = fData( grid, Data )

dev.new()

fbplot( fD, adjust = list( N_trials = 10,
                           trial_size = 5 * N,
                           VERBOSE = TRUE ),
                     xlab = 'time', ylab = 'Values',
                     main = 'My adjusted functional boxplot' )


# MULTIVARIATE FUNCTIONAL BOXPLOT - NO ADJUSTMENT

set.seed( 1618033 )

P = 1e2
N = 1e2
L = 2

grid = seq( 0, 1, length.out = 1e2 )

C1 = exp_cov_function( grid, alpha = 0.3, beta = 0.4 )
C2 = exp_cov_function( grid, alpha = 0.3, beta = 0.4 )

# Generating a bivariate functional dataset of gaussian data with partially
# correlated components
Data = generate_gauss_mfdata( N, L,
                              centerline = matrix( sin( 2 * pi * grid ),
                                                   nrow = 2, ncol = P,
                                                   byrow = TRUE ),
                              correlations = rep( 0.5, 1 ),
                              listCov = list( C1, C2 ) )

mfD = mfData( grid, Data )

dev.new()
fbplot( mfD, Fvalue = 2.5, xlab = 'time', ylab = list( 'Values 1',
                                                       'Values 2' ),
        main = list( 'First component', 'Second component' ) )



</code></pre>


</div>