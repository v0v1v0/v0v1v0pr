<div class="container">

<table style="width: 100%;"><tr>
<td>aem</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create an analytic element model</h2>

<h3>Description</h3>

<p><code>aem()</code> creates an analytic element model to which elements can be added
</p>
<p><code>solve.aem()</code> solves the system of equations as constructed by the elements in the <code>aem</code> model
</p>
<p><code>plot.element()</code> plots the location of an analytic element with point or line geometry.
</p>
<p><code>plot.aem()</code> plots the locations of all analytic elements with a point or line geometry
in an <code>aem</code> object by calling <code>plot.element()</code> on them, or adds them to an existing plot.
</p>


<h3>Usage</h3>

<pre><code class="language-R">aem(
  k,
  top,
  base,
  n,
  ...,
  type = c("variable", "confined"),
  verbose = FALSE,
  maxiter = 10
)

## S3 method for class 'aem'
solve(a, b, maxiter = 10, verbose = FALSE, ...)

## S3 method for class 'element'
plot(
  x,
  y = NULL,
  add = FALSE,
  pch = 16,
  cex = 0.75,
  use.widths = TRUE,
  col = "black",
  xlim,
  ylim,
  ...
)

## S3 method for class 'aem'
plot(x, y = NULL, add = FALSE, xlim, ylim, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>numeric, hydraulic conductivity of the aquifer.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>top</code></td>
<td>
<p>numeric, top elevation of the aquifer.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>base</code></td>
<td>
<p>numeric, bottom elevation of the aquifer.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>numeric, effective porosity of the aquifer as a fraction of total unit volume. Used for determining flow velocities with <code>velocity()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>for <code>aem()</code>, objects of class <code>element</code>, or a single (named) list with <code>element</code> objects. Otherwise, ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>character specifying the type of flow in the aquifer, either <code>variable</code> (default) or <code>confined</code>. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical indicating if information during the solving process should be printed. Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxiter</code></td>
<td>
<p>integer specifying the maximum allowed iterations for a non-linear solution. Defaults to 10. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a</code></td>
<td>
<p><code>aem</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b</code></td>
<td>
<p>ignored</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p><code>aem</code> object, or analytic element of class <code>element</code> to plot. If not a point or line geometry, nothing is plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>ignored</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add</code></td>
<td>
<p>logical, should the plot be added to the existing plot? Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pch</code></td>
<td>
<p>numeric point symbol value, defaults to <code>16</code>. For a reference point, a value of <code>4</code> is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex</code></td>
<td>
<p>numeric symbol size value, defaults to <code>0.75</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use.widths</code></td>
<td>
<p>logical, if line elements with non-zero width are plotted, should they be plotted as polygons including
the width (<code>TRUE</code>; default) or as infinitesimally thin lines (<code>FALSE</code>)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p>color of element. Defaults to <code>'black'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlim</code></td>
<td>
<p>numeric, plot limits along the x-axis. Required if <code>add = FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>numeric, plot limits along the y-axis. Required if <code>add = FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The default <code>type = 'variable'</code> allows for unconfined/confined flow, i.e. flow with variable saturated thickness. If <code>type = 'confined'</code>,
the saturated thickness is always constant and equal to the aquifer thickness. This results in a linear model when head-specified elements with
a resistance are used, whereas <code>type = 'variable'</code> would create a non-linear model in that case.
</p>
<p><code>solve.aem()</code> is called on the <code>aem</code> object before it is returned by <code>aem()</code>, which solves the system of equations.
</p>


<h4>Solving</h4>

<p><code>solve.aem()</code> sets up the system of equations, and calls <code>solve()</code> to
solve. If head-specified elements are supplied, an element of class <code>constant</code> as
created by <code>constant()</code> (also called the reference point), should be supplied as well.
Constructing an <code>aem</code> object by a call to <code>aem()</code> automatically calls <code>solve.aem()</code>.
</p>
<p>If the system of equations is non-linear, i.e. when the flow system is unconfined (variable
saturated thickness) and elements with hydraulic resistance are specified, a Picard iteration is entered.
During each Picard iteration step (outer iteration), the previously solved model parameters are used to set up and
solve a linear system of equations. The model parameters are then updated and the next outer iteration step is
entered, until <code>maxiter</code> iterations are reached. For an linear model, <code>maxiter</code> is ignored.
</p>



<h4>Plotting</h4>

<p>If the analytic element has a point geometry and has a collocation point
(e.g. <code>headwell()</code>), that point is also plotted with <code>pch = 1</code>.
</p>

<p>A reference point (as created by <code>constant()</code>) is never plotted when plotting the model
as it is not a hydraulic feature. Area-sinks (as created by <code>areasink()</code> or <code>headareasink()</code>)
are also never plotted as they would clutter the plot. These elements can be plotted by
calling <code>plot()</code> on them directly.
</p>


<h3>Value</h3>

<p><code>aem()</code> returns an object of class <code>aem</code> which is a list consisting of <code>k</code>, <code>top</code>, <code>base</code>, <code>n</code>,
a list containing all elements with the names of the objects specified in <code>...</code>, and a logical <code>solved</code>
indicating if the model is solved.
</p>
<p><code>solve.aem()</code> returns the solved <code>aem</code> object, i.e. after finding the solution
to the system of equations as constructed by the contained elements.
</p>


<h3>See Also</h3>

<p><code>add_element()</code> <code>contours()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">k &lt;- 10
top &lt;- 10
base &lt;- 0
n &lt;- 0.2
TR &lt;- k * (top - base)

w &lt;- well(xw = 50, yw = 0, Q = 200)
rf &lt;- constant(xc = -500, yc = 0, h = 20)
uf &lt;- uniformflow(gradient = 0.002, angle = -45, TR = TR)
hdw &lt;- headwell(xw = 0, yw = 100, rw = 0.3, hc = 8)
ls &lt;- linesink(x0 = -200, y0 = -150, x1 = 200, y1 = 150, sigma = 1)

# Creating aem ----
m &lt;- aem(k, top, base, n, w, rf, uf, hdw, ls)

# or with elements in named list
m &lt;- aem(k, top, base, n,
         list('well' = w, 'constant' = rf, 'flow' = uf, 'headwell' = hdw, 'river' = ls),
         type = 'confined')

# Solving ----
m &lt;- solve(m)

# solving requires a reference point (constant) element if head-specified elements are supplied
try(
  m &lt;- aem(k = k, top = top, base = base, n = n, w, uf, hdw)
)

# Plotting ----
plot(ls)
plot(w, add = TRUE)
plot(uf) # empty

plot(m, xlim = c(-500, 500), ylim = c(-250, 250))

xg &lt;- seq(-500, 500, length = 200)
yg &lt;- seq(-250, 250, length = 100)

contours(m, x = xg, y = yg, col = 'dodgerblue', nlevels = 20)
plot(m, add = TRUE)

</code></pre>


</div>