<div class="container">

<table style="width: 100%;"><tr>
<td>local_fit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Local fit functions</h2>

<h3>Description</h3>

<script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script><p>These functions define the way in which each local fit/prediction is done
within each iteration in the <code>mbl</code> function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">local_fit_pls(pls_c, modified = FALSE, max_iter = 100, tol = 1e-6)

local_fit_wapls(min_pls_c, max_pls_c, modified = FALSE,
                max_iter = 100, tol = 1e-6)

local_fit_gpr(noise_variance = 0.001)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pls_c</code></td>
<td>
<p>an integer indicating the number of pls components to be used in
the local regressions when the partial least squares (<code>local_fit_pls</code>)
method is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modified</code></td>
<td>
<p>a logical indicating whether the modified version of the pls
algorithm (Shenk and Westerhaus, 1991 and Westerhaus, 2014). Default is
<code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_iter</code></td>
<td>
<p>an integer indicating the maximum number of iterations in
case <code>tol</code> is not reached. Defaul is 100.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>a numeric value indicating the convergence for calculating the
scores. Default is 1-e6.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_pls_c</code></td>
<td>
<p>an integer indicating the minimum number of pls components
to be used in the local regressions when the weighted average partial least
squares (<code>local_fit_wapls</code>) method is used. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_pls_c</code></td>
<td>
<p>integer indicating the maximum number of pls components
to be used in the local regressions when the weighted average partial least
squares (<code>local_fit_wapls</code>) method is used. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>noise_variance</code></td>
<td>
<p>a numeric value indicating the variance of the noise
for Gaussian process local regressions (<code>local_fit_gpr</code>). Default is
0.001.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>These functions are used to indicate how to fit
the regression models within the <code>mbl</code> function.
</p>
<p>There are three possible options for performing these regressions:
</p>

<ul>
<li>
<p>Partial least squares (pls, <code>local_fit_pls</code>): It uses the
orthogonal scores (non-linear iterative partial least squares, nipals)
algorithm. The only parameter which needs to be optimized is the number of
pls components.
</p>
</li>
<li>
<p>Weighted average pls (<code>local_fit_wapls</code>): This method was
developed by Shenk et al. (1997) and it used as the regression method in the
widely known LOCAL algorithm. It uses multiple models generated by multiple
pls components (i.e. between a minimum and a maximum number of pls
components). At each local partition the final predicted value is a ensemble
(weighted average) of all the predicted values generated by the multiple pls
models. The weight for each component is calculated as follows:
</p>
\[w_{j}  =  \frac{1}{s_{1:j}\times g_{j}}\]
<p>where \(s_{1:j}\) is the root mean square of the
spectral reconstruction error of the unknown (or target) observation(s)
when a total of \(j\) pls components are used and
\(g_{j}\) is the root mean square of the squared regression
coefficients corresponding to the \(j\)th pls component (see
Shenk et al., 1997 for more details).
</p>
</li>
<li>
<p>Gaussian process with dot product covariance (<code>local_fit_gpr</code>):
Gaussian process regression is a probabilistic and non-parametric Bayesian
method. It is commonly described as a collection of random variables which
have a joint Gaussian distribution and it is characterized by both a mean
and a covariance function (Rasmussen and Williams, 2006). The covariance
function used in the implemented method is the dot product. The only
parameter to be taken into account in this method is the noise. In this
method, the process for predicting the response variable of a new sample
(\(y_u\)) from its predictor variables
(\(x_u\)) is carried out first by computing a prediction
vector (\(A\)). It is derived from a reference/training observations
congaing both a response vector (\(Y\)) and predictors (\(X\)) as follows:
</p>
\[A = (X  X^{T} + \sigma^2 I)^{-1} Y\]
<p>where  \(\sigma^2\) denotes the variance of the noise and \(I\) the
identity matrix (with dimensions equal to the number of observations in
\(X\)). The prediction of \(y_{u}\) is then done as follows:
</p>
\[\hat{y}_{u} = (x_{u}x_{u}^{T}) A\]

</li>
</ul>
<p>The <code>modified</code> argument in the pls methods (<code>local_fit_pls()</code>
and <code>local_fit_wapls()</code>) is used to indicate if
a modified version of the pls algorithm (modified pls or mpls) is to be used.
The modified pls was proposed Shenk and Westerhaus
(1991, see also Westerhaus, 2014) and it differs from the standard pls method
in the way the weights of the predictors (used to compute the matrix of
scores) are obtained. While pls uses the covariance between  response(s)
and predictors (and later their deflated versions corresponding at each pls
component iteration) to obtain these weights, the modified pls uses the
correlation as weights. The authors indicate that by using correlation,
a larger potion of the response variable(s) can be explained.
</p>


<h3>Value</h3>

<p>An object of class <code>local_fit</code> mirroring the input arguments.
</p>


<h3>Author(s)</h3>

<p><a href="https://orcid.org/0000-0002-5369-5120">Leonardo Ramirez-Lopez</a>
</p>


<h3>References</h3>

<p>Shenk, J. S., &amp; Westerhaus, M. O. 1991. Populations structuring of
near infrared spectra and modified partial least squares regression.
Crop Science, 31(6), 1548-1555.
</p>
<p>Shenk, J., Westerhaus, M., and Berzaghi, P. 1997. Investigation of a LOCAL
calibration procedure for near infrared instruments. Journal of Near Infrared
Spectroscopy, 5, 223-232.
</p>
<p>Rasmussen, C.E., Williams, C.K. Gaussian Processes for Machine Learning.
Massachusetts Institute of Technology: MIT-Press, 2006.
</p>
<p>Westerhaus, M. 2014. Eastern Analytical Symposium Award for outstanding
Wachievements in near infrared spectroscopy: my contributions to
Wnear infrared spectroscopy. NIR news, 25(8), 16-20.
</p>


<h3>See Also</h3>

<p><code>mbl</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">local_fit_wapls(min_pls_c = 3, max_pls_c = 12)
</code></pre>


</div>