<div class="container">

<table style="width: 100%;"><tr>
<td>mkReTrms</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create list of structures needed for models with random effects</h2>

<h3>Description</h3>

<p>From the result of <code>findbars</code> applied to a model formula and
and the evaluation frame, create the model matrix, etc. associated with
random-effects terms.  See the description of the returned value for a
detailed list.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mkReTrms(
  bars,
  fr,
  drop.unused.levels = TRUE,
  reorder.terms = TRUE,
  reorder.vars = FALSE,
  calc.lambdat = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>bars</code></td>
<td>
<p>a list of parsed random-effects terms</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fr</code></td>
<td>
<p>a model frame in which to evaluate these terms</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>drop.unused.levels</code></td>
<td>
<p>(logical) drop unused factor levels?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reorder.terms</code></td>
<td>
<p>arrange random effects terms in decreasing order of number of groups (factor levels)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reorder.vars</code></td>
<td>
<p>arrange columns of individual random effects terms in alphabetical order?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calc.lambdat</code></td>
<td>
<p>(logical) compute <code>Lambdat</code> and <code>Lind</code> components? (At present these components
are needed for <code>lme4</code> machinery but not for <code>glmmTMB</code>, and may be large in some cases; see Bates <em>et al.</em> 2015</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a list with components
</p>
<table>
<tr style="vertical-align: top;">
<td><code>Zt</code></td>
<td>
<p>transpose of the sparse model matrix for the random effects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ztlist</code></td>
<td>
<p>list of components of the transpose of the
random-effects model matrix, separated by random-effects term</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Lambdat</code></td>
<td>
<p>transpose of the sparse relative covariance factor</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Lind</code></td>
<td>
<p>an integer vector of indices determining the mapping of the
elements of the <code>theta</code> to the <code>"x"</code> slot of <code>Lambdat</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>initial values of the covariance parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lower</code></td>
<td>
<p>lower bounds on the covariance parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flist</code></td>
<td>
<p>list of grouping factors used in the random-effects terms</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cnms</code></td>
<td>
<p>a list of column names of the random effects according to
the grouping factors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Gp</code></td>
<td>
<p>a vector indexing the association of
elements of the conditional mode vector
with random-effect terms; if <code>nb</code> is the vector of numbers
of conditional modes per term (i.e. number of groups times number
of effects per group), <code>Gp</code> is <code>c(0,cumsum(nb))</code>
(and conversely <code>nb</code> is <code>diff(Gp)</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nl</code></td>
<td>
<p>names of the terms (in the same order as <code>Zt</code>,
i.e. reflecting the <code>reorder.terms</code> argument)</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Bates D, Mächler M, Bolker B, Walker S (2015).
“Fitting Linear Mixed-Effects Models Using lme4.”
<em>Journal of Statistical Software</em>, <b>67</b>(1), 1–48.
<a href="https://doi.org/10.18637/jss.v067.i01">doi:10.18637/jss.v067.i01</a>.)
</p>


<h3>See Also</h3>

<p>Other utilities: 
<code>expandDoubleVerts()</code>,
<code>nobars()</code>,
<code>subbars()</code>
</p>


</div>