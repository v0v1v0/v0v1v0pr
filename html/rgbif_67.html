<div class="container">

<table style="width: 100%;"><tr>
<td>map_fetch</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fetch maps of GBIF occurrences</h2>

<h3>Description</h3>

<p>This function is a wrapper for the GBIF mapping api version 2.0.
The mapping API is a web map tile service making it straightforward to
visualize GBIF content on interactive maps, and overlay content from other
sources. It returns tile maps with number of
GBIF records per area unit that can be used in a variety of ways, for example
in interactive leaflet web maps. Map details are specified by a number of
query parameters, some of them optional. Full documentation of the GBIF
mapping api can be found at https://www.gbif.org/developer/maps
</p>


<h3>Usage</h3>

<pre><code class="language-R">map_fetch(
  source = "density",
  x = 0:1,
  y = 0,
  z = 0,
  format = "@1x.png",
  srs = "EPSG:4326",
  bin = NULL,
  hexPerTile = NULL,
  squareSize = NULL,
  style = NULL,
  taxonKey = NULL,
  datasetKey = NULL,
  country = NULL,
  publishingOrg = NULL,
  publishingCountry = NULL,
  year = NULL,
  basisOfRecord = NULL,
  return = "png",
  base_style = NULL,
  plot_terra = TRUE,
  curlopts = list(http_version = 2),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>source</code></td>
<td>
<p>(character) Either <code>density</code> for fast, precalculated tiles,
or <code>adhoc</code> for any search. Default: <code>density</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>(integer sequence) the column. Default: 0:1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>(integer sequence) the row. Default: 0</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>(integer) the zoom. Default: 0</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>format</code></td>
<td>
<p>(character) The data format, one of:
</p>

<ul>
<li> <p><code style="white-space: pre;">⁠@Hx.png⁠</code> for a 256px raster tile
</p>
</li>
<li> <p><code style="white-space: pre;">⁠@1x.png⁠</code> for a 512px raster tile (the default)
</p>
</li>
<li> <p><code style="white-space: pre;">⁠@2x.png⁠</code> for a 1024px raster tile
</p>
</li>
<li> <p><code style="white-space: pre;">⁠@3x.png⁠</code> for a 2048px raster tile
</p>
</li>
<li> <p><code style="white-space: pre;">⁠@4x.png⁠</code> for a 4096px raster tile
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>srs</code></td>
<td>
<p>(character) Spatial reference system. One of:
</p>

<ul>
<li> <p><code>EPSG:3857</code> (Web Mercator)
</p>
</li>
<li> <p><code>EPSG:4326</code> (WGS84 plate care?)
</p>
</li>
<li> <p><code>EPSG:3575</code> (Arctic LAEA on 10 degrees E)
</p>
</li>
<li> <p><code>EPSG:3031</code> (Antarctic stereographic)
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bin</code></td>
<td>
<p>(character) <code>square</code> or <code>hex</code> to aggregate occurrence counts into
squares or hexagons. Points by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hexPerTile</code></td>
<td>
<p>(integer) sets the size of the hexagons
(the number horizontally across a tile).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>squareSize</code></td>
<td>
<p>(integer) sets the size of the squares. Choose a factor
of 4096 so they tessalate correctly: probably from 8, 16, 32, 64, 128,
256, 512.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>style</code></td>
<td>
<p>(character) for raster tiles, choose from the available styles.
Defaults to classic.point for source="density" and "scaled.circle" for source="adhoc".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>taxonKey</code></td>
<td>
<p>(integer/numeric/character) search by taxon key, can only
supply 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datasetKey</code></td>
<td>
<p>(character) search by taxon key, can only supply 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>country</code></td>
<td>
<p>(character) search by taxon key, can only supply 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>publishingOrg</code></td>
<td>
<p>(character) search by taxon key, can only supply 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>publishingCountry</code></td>
<td>
<p>(character) search by taxon key, can only
supply 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>year</code></td>
<td>
<p>(integer) integer that limits the search to a certain year or,
if passing a vector of integers, multiple years, for example
<code>1984</code> or <code>c(2016, 2017, 2018)</code> or <code>2010:2015</code> (years 2010 to 2015). optional</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>basisOfRecord</code></td>
<td>
<p>(character) one or more basis of record states to
include records with that basis of record. The full list is: <code>c("OBSERVATION", "HUMAN_OBSERVATION", "MACHINE_OBSERVATION", "MATERIAL_SAMPLE", "PRESERVED_SPECIMEN", "FOSSIL_SPECIMEN", "LIVING_SPECIMEN", "LITERATURE", "UNKNOWN")</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return</code></td>
<td>
<p>(character) Either "png" or "terra".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>base_style</code></td>
<td>
<p>(character)  The style of the base map.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot_terra</code></td>
<td>
<p>(logical) Set whether the terra map be default plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>curlopts</code></td>
<td>
<p>options passed on to crul::HttpClient</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments passed to the adhoc interface.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The default settings, <code>return='png'</code>, will return a <code>magick-image</code>
png. This image will be a composite image of the the occurrence tiles fetched
and a base map. This map is primarily useful as a high quality image of
occurrence records.
</p>
<p>The args <code>x</code> and <code>y</code> can both be integer sequences. For example, <code>x=0:3</code> or
<code>y=0:1</code>. Note that the tile index starts at 0. Higher values of <code>z</code>, will
will produce more tiles that can be fetched and stitched together. Selecting
a too high value for <code>x</code> or <code>y</code> will produce a blank image.
</p>
<p>Setting <code>return='terra'</code> will return a <code>terra::SpatRaster </code> object. This
is primarily useful if you were interested in the underlying aggregated
occurrence density data.
</p>
<p>See the article
</p>


<h3>Value</h3>

<p>a <code>magick-image</code> or <code>terra::SpatRaster </code> object.
</p>


<h3>Author(s)</h3>

<p>John Waller and Laurens Geffert <a href="mailto:laurensgeffert@gmail.com">laurensgeffert@gmail.com</a>
</p>


<h3>References</h3>

<p>https://www.gbif.org/developer/maps
</p>
<p>https://api.gbif.org/v2/map/demo.html
</p>
<p>https://api.gbif.org/v2/map/demo13.html
</p>


<h3>See Also</h3>

<p><code>mvt_fetch()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 

# all occurrences
map_fetch()
# get artic map
map_fetch(srs='EPSG:3031') 
# only preserved specimens
map_fetch(basisOfRecord="PRESERVED_SPECIMEN")

# Map of occ in Great Britain
map_fetch(z=3,y=1,x=7:8,country="GB")
# Peguins with artic projection
map_fetch(srs='EPSG:3031',taxonKey=2481660,style='glacier.point', 
base_style="gbif-dark")

# occ from a long time ago
map_fetch(year=1600) 
# polygon style 
map_fetch(style="iNaturalist.poly",bin="hex")
# iNaturalist dataset plotted 
map_fetch(datasetKey="50c9509d-22c7-4a22-a47d-8c48425ef4a7",
  style="iNaturalist.poly")
 
# use source="adhoc" for more filters
map_fetch(z=1,
  source="adhoc",
  iucn_red_list_category="CR",
  style="scaled.circles",
  base_style='gbif-light')

# cropped map of Hawaii
map_fetch(z=5,x=3:4,y=12,source="adhoc",gadmGid="USA.12_1")



## End(Not run)
</code></pre>


</div>