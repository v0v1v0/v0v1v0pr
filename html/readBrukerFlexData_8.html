<div class="container">

<table style="width: 100%;"><tr>
<td>.hpc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>High Precision Calibration</h2>

<h3>Description</h3>

<p>Only basic support (not 100% identical results) for Bruker Daltonics' HPC.
HPC stands for <b>H</b>igh <b>P</b>recision <b>C</b>alibration.<br>
This is an internal function and should normally not used by the user.
</p>


<h3>Usage</h3>

<pre><code class="language-R">.hpc(mass, minMass, maxMass, hpcCoefficients)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mass</code></td>
<td>
<p><code>double</code>, mass calculated traditionally.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minMass</code></td>
<td>
<p><code>double</code>, lower Threshold for HPC. HPC is only defined
for a range of mass.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxMass</code></td>
<td>
<p><code>double</code>, upper Threshold for HPC. HPC is only defined
for a range of mass.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hpcCoefficients</code></td>
<td>
<p><code>doubles</code>, coefficients needed by the HPC
algorithm (see also:
<code>.extractHPCConstants</code>)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Bruker Daltonics doesn't explain how HPC works. All formula are results of
“trial and error”. That is why mass calculated by <code>.hpc</code>
differs little from original HPC mass.
(In example file 214 of 24860 mass are incorrect;
deviations: min: 6.103515625e-05, max: 0.02935791015625.) <br>
In the manual of mass spectrometry instruments of Bruker Daltonics machines
the *flex series you can find an article about HPC principles: <br>
Gobom, J. and Mueller, M. and Egelhofer V. and Theiss, D. and
Lehrach, H. and Nordhoff, E. (2002) <br>
“A Calibration Method That Simplifies and Improves Accurate
Determination of Peptide Molecular mass by MALDI-TOF MS.”,
<em>Anal Chem</em> <b>74</b>: 3915-3923 <br><a href="https://pubmed.ncbi.nlm.nih.gov/12175185/">https://pubmed.ncbi.nlm.nih.gov/12175185/</a>
</p>


<h3>Value</h3>

<p>A vector of HPC corrected mass (<code>double</code>).
</p>


<h3>Note</h3>

<p>Please note that .hpc is not correct! You have been warned.
</p>


<h3>References</h3>

<p>Gobom, J. and Mueller, M. and Egelhofer V. and Theiss, D. and
Lehrach, H. and Nordhoff, E. (2002) <br>
“A Calibration Method That Simplifies and Improves Accurate
Determination of Peptide Molecular mass by MALDI-TOF MS.”,
<em>Anal Chem</em> <b>74</b>: 3915-3923 <br><a href="https://pubmed.ncbi.nlm.nih.gov/12175185/">https://pubmed.ncbi.nlm.nih.gov/12175185/</a>
</p>


<h3>See Also</h3>

<p><code>readBrukerFlexDir</code>,
<code>readBrukerFlexFile</code>,
<code>.double2singlePrecision</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## load library
library("readBrukerFlexData")

## get examples directory
exampleDirectory &lt;- system.file("Examples", package="readBrukerFlexData")

## read example spectra
## please note: filterZeroIntensities=TRUE is used for compatibility reasons.
##              You should NOT use it!
noHpcSpec &lt;- readBrukerFlexFile(file.path(exampleDirectory,
    "hpc/fid/0_A20/1/1SRef/fid"), filterZeroIntensities=TRUE, useHpc=FALSE)
hpcSpec &lt;- readBrukerFlexFile(file.path(exampleDirectory,
    "hpc/fid/0_A20/1/1SRef/fid"), filterZeroIntensities=TRUE)

## plot spectrum
plot(noHpcSpec$spectrum$mass, noHpcSpec$spectrum$intensity, type="l",
     col="red", xlim=c(1296, 1300))
lines(hpcSpec$spectrum$mass, hpcSpec$spectrum$intensity, type="l",
      col="green", xlim=c(1296, 1300))
legend(x="topright", legend=c("no hpc", "hpc"), col=c("red", "green"), lwd=1)

## show difference between .hpc and original HPC
## load mzXML generated by Bruker Daltonics CompassXport 1.3.5
## you could do it like this:
#library("readMzXmlData")
#cpSpecHpcMzXml &lt;- readMzXmlFile(file.path(exampleDirectory,
#  "hpc/mzXML/hpc.mzXML"))

## or easily use:
data(cpSpecHpcMzXml)

## reduce R double precision to single precision because our CompassXport 1.3.5
## supports only mzXML with precision=32 (only for compatibility reasons)
noHpcSpec$spectrum$mass32 &lt;-
 readBrukerFlexData:::.double2singlePrecision(noHpcSpec$spectrum$mass)
hpcSpec$spectrum$mass32 &lt;-
 readBrukerFlexData:::.double2singlePrecision(hpcSpec$spectrum$mass)

## calculate deviance
d &lt;- noHpcSpec$spectrum$mass32-cpSpecHpcMzXml$spectrum$mass
dHPC &lt;- hpcSpec$spectrum$mass32-cpSpecHpcMzXml$spectrum$mass

## a little summary
cat("without .hpc:\n",
    "not matching: ", length(cpSpecHpcMzXml$spectrum$mass[d!=0]), " of ",
    length(cpSpecHpcMzXml$spectrum$mass), "; range: ",
    range(abs(d[d!=0])), "\nwith .hpc:\n",
    "not matching: ", length(cpSpecHpcMzXml$spectrum$mass[dHPC!=0]), " of ",
    length(cpSpecHpcMzXml$spectrum$mass), "; range: ",
    range(abs(d[dHPC!=0])), "\n")

##
## doing things manually
##
hpcMass &lt;- readBrukerFlexData:::.hpc(mass=noHpcSpec$spectrum$mass,
 minMass=noHpcSpec$metaData$hpc$limits["minMass"],
 maxMass=noHpcSpec$metaData$hpc$limits["maxMass"],
 hpcCoefficients=noHpcSpec$metaData$hpc$coefficients)

</code></pre>


</div>