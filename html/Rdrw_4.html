<div class="container">

<table style="width: 100%;"><tr>
<td>drw</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fitting univariate and multiviarate damped random walk processes</h2>

<h3>Description</h3>

<p>The function <code>drw</code> fits univariate and multivariate damped random walk processes on multiple time series data sets possibly with known measurement error standard deviations via state-space representation. This function <code>drw</code> evaluates the resulting likelihood function of the model parameters via Kalman-filtering whose minimum complexity is linear in the number of unique observation times. The function returns the maximum likelihood estimates or posterior samples of the model parameters. For astronomical data analyses, users need to pay attention to loading the data because R's default is to load only seven effective digits; see details below.
</p>


<h3>Usage</h3>

<pre><code class="language-R">drw(data1, data2, data3, data4, data5, 
    data6, data7, data8, data9, data10,
    n.datasets, method = "mle",
    bayes.n.burn, bayes.n.sample,
    mu.UNIFprior.range = c(-30, 30),
    tau.IGprior.shape = 1, tau.IGprior.scale = 1,
    sigma2.IGprior.shape = 1, sigma2.IGprior.scale = 1e-7)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data1</code></td>
<td>
<p>An (<code class="reqn">n_1</code> by 3) matrix for time series data 1. The first column has <code class="reqn">n_1</code> observation times, the second column contains <code class="reqn">n_1</code> measurements (magnitudes), the third column includes <code class="reqn">n_1</code> measurement error standard deviations. If the measurement error standard deviations are unknown, the third column must be a vector of <code class="reqn">n_1</code> zeros.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data2</code></td>
<td>
<p>Optional if more than one time series data set are available. An (<code class="reqn">n_2</code> by 3) matrix for time series data 2. The first column has <code class="reqn">n_2</code> observation times, the second column contains <code class="reqn">n_2</code> measurements/observations/magnitudes, the third column includes <code class="reqn">n_2</code> measurement error standard deviations. If the measurement error standard deviations are unknown, the third column must be a vector of <code class="reqn">n_2</code> zeros.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data3</code></td>
<td>
<p>Optional if more than two time series data sets are available. An (<code class="reqn">n_3</code> by 3) matrix for time series data 3. The first column has <code class="reqn">n_3</code> observation times, the second column contains <code class="reqn">n_3</code> measurements/observations/magnitudes, the third column includes <code class="reqn">n_3</code> measurement error standard deviations. If the measurement error standard deviations are unknown, the third column must be a vector of <code class="reqn">n_3</code> zeros.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data4</code></td>
<td>
<p>Optional if more than three time series data sets are available. An (<code class="reqn">n_4</code> by 3) matrix for time series data 4. The first column has <code class="reqn">n_4</code> observation times, the second column contains <code class="reqn">n_4</code> measurements/observations/magnitudes, the third column includes <code class="reqn">n_4</code> measurement error standard deviations. If the measurement error standard deviations are unknown, the third column must be a vector of <code class="reqn">n_4</code> zeros.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data5</code></td>
<td>
<p>Optional if more than four time series data sets are available. An (<code class="reqn">n_5</code> by 3) matrix for time series data 5. The first column has <code class="reqn">n_5</code> observation times, the second column contains <code class="reqn">n_5</code> measurements/observations/magnitudes, the third column includes <code class="reqn">n_5</code> measurement error standard deviations. If the measurement error standard deviations are unknown, the third column must be a vector of <code class="reqn">n_5</code> zeros.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data6</code></td>
<td>
<p>Optional if more than five time series data sets are available. An (<code class="reqn">n_6</code> by 3) matrix for time series data 6. The first column has <code class="reqn">n_6</code> observation times, the second column contains <code class="reqn">n_6</code> measurements/observations/magnitudes, the third column includes <code class="reqn">n_6</code> measurement error standard deviations. If the measurement error standard deviations are unknown, the third column must be a vector of <code class="reqn">n_6</code> zeros.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data7</code></td>
<td>
<p>Optional if more than six time series data sets are available. An (<code class="reqn">n_7</code> by 3) matrix for time series data 7. The first column has <code class="reqn">n_7</code> observation times, the second column contains <code class="reqn">n_7</code> measurements/observations/magnitudes, the third column includes <code class="reqn">n_7</code> measurement error standard deviations. If the measurement error standard deviations are unknown, the third column must be a vector of <code class="reqn">n_7</code> zeros.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data8</code></td>
<td>
<p>Optional if more than seven time series data sets are available. An (<code class="reqn">n_8</code> by 3) matrix for time series data 8. The first column has <code class="reqn">n_8</code> observation times, the second column contains <code class="reqn">n_8</code> measurements/observations/magnitudes, the third column includes <code class="reqn">n_8</code> measurement error standard deviations. If the measurement error standard deviations are unknown, the third column must be a vector of <code class="reqn">n_8</code> zeros.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data9</code></td>
<td>
<p>Optional if more than eight time series data sets are available. An (<code class="reqn">n_9</code> by 3) matrix for time series data 9. The first column has <code class="reqn">n_9</code> observation times, the second column contains <code class="reqn">n_9</code> measurements/observations/magnitudes, the third column includes <code class="reqn">n_9</code> measurement error standard deviations. If the measurement error standard deviations are unknown, the third column must be a vector of <code class="reqn">n_9</code> zeros.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data10</code></td>
<td>
<p>Optional if more than nine time series data sets are available. An (<code class="reqn">n_{10}</code> by 3) matrix for time series data 10. The first column has <code class="reqn">n_{10}</code> observation times, the second column contains <code class="reqn">n_{10}</code> measurements/observations/magnitudes, the third column includes <code class="reqn">n_{10}</code> measurement error standard deviations. If the measurement error standard deviations are unknown, the third column must be a vector of <code class="reqn">n_{10}</code> zeros. The current version of package allows up to ten time series data sets. If users have more than ten time series data sets to be modeled simultaneously, please contact the authors.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.datasets</code></td>
<td>
<p>The number of time series data sets to be modeled simultaneously. An integer value inclusively between 1 to 10. For example, if "<code>n.datasets = 3</code>", then users must enter <code>data1</code>, <code>data2</code>, and <code>data3</code> as inputs of <code>drw</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>If <code>method = "mle"</code>, it returns maximum likelihood estimates of the model parameters. If <code>method = "bayes"</code> it produces posterior samples of the model parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bayes.n.burn</code></td>
<td>
<p>Required for <code>method = "bayes"</code>. The number of warming-up iterations for a Markov chain Monte Carlo method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bayes.n.sample</code></td>
<td>
<p>Required for <code>method = "bayes"</code>. The size of a posterior sample for each parameter for a Markov chain Monte Carlo method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu.UNIFprior.range</code></td>
<td>
<p>Required for <code>method = "bayes"</code>. The range of the Uniform prior on each long-term avaerage <code class="reqn">\mu_j</code>of the process, where <code class="reqn">j</code> goes from 1 to the total number of time series data sets. The default range is (<code class="reqn">-30, 30</code>) for astronomical applications.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau.IGprior.shape</code></td>
<td>
<p>Required for <code>method = "bayes"</code>. The shape parameter of the invserse-Gamma prior on each timescale <code class="reqn">\tau_j</code> of the process, where <code class="reqn">j</code> goes from 1 to the total number of time series data sets. The default shape parameter is one for astronomical applications.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau.IGprior.scale</code></td>
<td>
<p>Required for <code>method = "bayes"</code>. The scale parameter of the invserse-Gamma prior on each timescale <code class="reqn">\tau_j</code>, where <code class="reqn">j</code> goes from 1 to the total number of time series data sets. The default scale parameter is one for astronomical applications.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma2.IGprior.shape</code></td>
<td>
<p>Required for <code>method = "bayes"</code>. The shape parameter of the invserse-Gamma prior on each short-term variability (variance) <code class="reqn">\sigma^2_j</code>, where <code class="reqn">j</code> goes from 1 to the total number of time series data sets. The default shape parameter is one for astronomical applications.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma2.IGprior.scale</code></td>
<td>
<p>Required for <code>method = "bayes"</code>. The scale parameter of the invserse-Gamma prior on each short-term variability (variance) <code class="reqn">\sigma^2_j</code>, where <code class="reqn">j</code> goes from 1 to the total number of time series data sets. The default shape parameter is 1e<code class="reqn">-7</code> for astronomical applications.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The multivariate damped random walk process <code class="reqn">{\bf X}(t)</code> is defined by the following stochastic differential equation:
</p>
<p style="text-align: center;"><code class="reqn">d {\bf X}(t) = -D_{{\bf\tau}}^{-1}({\bf X}(t) - {\bf\mu})dt + D_{{\bf\sigma}} d {\bf B}(t),</code>
</p>

<p>where <code class="reqn">{\bf X}(t)=\{X_1(t), \ldots, X_k(t)\}</code> is a vector of <code class="reqn">k</code> measurements/observations/magnitudes of the <code class="reqn">k</code> time series data sets in continuous time <code class="reqn">t\in R</code>, <code class="reqn">D_{\bf\tau}</code> is a <code class="reqn">k\times k</code> diagonal matrix whose diagonal elements are <code class="reqn">k</code> timescales with each <code class="reqn">\tau_j</code> representing the  timescale of the <code class="reqn">j</code>-th time series data, <code class="reqn">{\bf\mu}=\{\mu_1, \ldots, \mu_k\}</code> is a vector for long-term averages of the <code class="reqn">k</code> time series data sets, <code class="reqn">D_{{\bf\sigma}}</code> is <code class="reqn">k\times k</code> diagonal matrix whose diagonal elements are short-term variabilities (standard deviation) of <code class="reqn">k</code> time series data sets, and finally <code class="reqn">{\bf B}(t)=\{B_1(t), \ldots, B_k(t)\}</code> is a vector for <code class="reqn">k</code> standard Brownian motions whose <code class="reqn">k(k-1)/2</code> pairwise correlations are modeled by correlation parameters <code class="reqn">\rho_{jl}~(1\le j&lt;l\le k)</code> such that <code class="reqn">dB_j(t)B_l(t) = \rho_{jl} dt</code>.
</p>
<p>We evaluate this continuous-time process at <code class="reqn">n</code> discrete observation times <code class="reqn">{\bf t} = \{t_1, \ldots, t_n\}</code>.  The observed data <code class="reqn">{\bf x} = \{x_1, \ldots, x_n\}</code> are multiple time series data measured at irregularly spaced observation times <code class="reqn">{\bf t}</code> with possibly known measurement error standard deviations, <code class="reqn">\delta=\{\delta_1, \ldots, \delta_n\}</code>. Since one or more time series observations can be measured at each observation time <code class="reqn">t_i</code>, the length of a vector <code class="reqn">x_i</code> can be different, depending on how many time series observations are available at the <code class="reqn">i</code>-th observation time. We assume that these observed data <code class="reqn">{\bf x}</code> are realizations of the latent time series data sets <code class="reqn">{\bf X(t)} = \{{\bf X}(t_1), \ldots, {\bf X}(t_n)\}</code> with Gaussian measurement errors whose variances are <code class="reqn">\delta</code>. This is a typical setting of state-space modeling. We note that if the measurement error variances are unknown, <code class="reqn">\delta</code> must be set to zeros, which means that the observed data directly measure the latent values.
</p>
<p>Please note that when astronomical time series data are loaded on R by <code>read.table</code>, <code>read.csv</code>, etc., some decimal places of the the observation times are automatically rounded because R's default is to load seven effective digits. For example, R will load the observation time 51075.412789 as 51075.41. This default will produce many ties in observation times even though there is actually no tie in observation times. To prevent this, please type "<code>options(digits = 11)</code>" before loading the data if the observation times are in seven effective digits.
</p>


<h3>Value</h3>

<p>The outcomes of <code>drw</code> are composed of:
</p>

<dl>
<dt>mu</dt>
<dd>
<p>The maximum likelihood estimate(s) of the long-term average(s) if <code>method</code> is "mle", and the posterior sample(s) of the long-term average(s) if <code>method</code> is "bayes". In the former case (mle), it is a vector of length <code class="reqn">k</code>, where <code class="reqn">k</code> is the number of time series data sets used. In the later case (bayes), it is an (<code class="reqn">m</code> by <code class="reqn">k</code>) matrix where <code class="reqn">m</code> is the size of the posterior sample.</p>
</dd>
<dt>sigma</dt>
<dd>
<p>The maximum likelihood estimate(s) of the short-term variability (standard deviation) parameter(s) if <code>method</code> is "mle", and the posterior sample(s) of the short-term variability parameter(s) if <code>method</code> is "bayes". In the former case (mle), it is a vector of length <code class="reqn">k</code>, where <code class="reqn">k</code> is the number of time series data sets used. In the later case (bayes), it is an (<code class="reqn">m</code> by <code class="reqn">k</code>) matrix where <code class="reqn">m</code> is the size of the posterior sample.</p>
</dd>
<dt>tau</dt>
<dd>
<p>The maximum likelihood estimate(s) of the timescale(s) if <code>method</code> is "mle", and the posterior sample(s) of the timescale(s) if <code>method</code> is "bayes". In the former case (mle), it is a vector of length <code class="reqn">k</code>, where <code class="reqn">k</code> is the number of time series data sets used. In the later case (bayes), it is an (<code class="reqn">m</code> by <code class="reqn">k</code>) matrix where <code class="reqn">m</code> is the size of the posterior sample.</p>
</dd>
<dt>rho</dt>
<dd>
<p>Only when more than one time series data set are used. The maximum likelihood estimate(s) of the (cross-) correlation(s) if <code>method</code> is "mle", and the posterior sample(s) of the (cross-) correlation(s) if <code>method</code> is "bayes". In the former case (mle), it is a vector of length <code class="reqn">k(k-1)/2</code>, where <code class="reqn">k</code> is the number of time series data sets used, i.e., <code class="reqn">\rho_{12}, \ldots, \rho_{1k}, \rho_{23}, \ldots, \rho_{2k}, \ldots, \rho_{k-1, k}</code>. In the later case (bayes), it is an (<code class="reqn">m</code> by <code class="reqn">k(k-1)/2</code>) matrix where <code class="reqn">m</code> is the size of the posterior sample.</p>
</dd>
<dt>mu.accept.rate</dt>
<dd>
<p>Only when <code>method</code> is "bayes". The MCMC acceptance rate(s) of the long-term average parameter(s).</p>
</dd>
<dt>sigma.accept.rate</dt>
<dd>
<p>Only when <code>method</code> is "bayes". The MCMC acceptance rate(s) of the short-term variability parameter(s).</p>
</dd>
<dt>tau.accept.rate</dt>
<dd>
<p>Only when <code>method</code> is "bayes". The MCMC acceptance rate(s) of the timescale(s).</p>
</dd>
<dt>rho.accept.rate</dt>
<dd>
<p>Only when more than one time series data set are used with <code>method = "bayes"</code>. The MCMC acceptance rate(s) of the (cross-) correlation(s).</p>
</dd>
<dt>data.comb</dt>
<dd>
<p>The combined data set if more than one time series data set are used, and data1 if only one time series data set is used. This output is only available when <code>method</code> is set to "bayes".</p>
</dd>
</dl>
<h3>Author(s)</h3>

<p>Zhirui Hu and Hyungsuk Tak
</p>


<h3>References</h3>

<p>Zhirui Hu and Hyungsuk Tak (2020+), "Modeling Stochastic Variability in  Multi-Band Time Series Data," arXiv:2005.08049.
</p>


<h3>Examples</h3>

<pre><code class="language-R">########## Fitting a univariate damped random walk process

##### Fitting a univariate damped random walk process based on a simulation

n1 &lt;- 20 
# the number of observations in the data set

obs.time1 &lt;- cumsum(rgamma(n1, shape = 3, rate = 1))
# the irregularly-spaced observation times 

y1 &lt;- rnorm(n1)
# the measurements/observations/magnitudes

measure.error.SD1 &lt;- rgamma(n1, shape = 0.01)
# optional measurement error standard deviations, 
# which is typically known in astronomical time series data
# if not known in other applications, set them to zeros, i.e.,
# measure.error.SD1 &lt;- rep(0, n1)

data1 &lt;- cbind(obs.time1, y1, measure.error.SD1)
# combine the single time series data set into an n by 3 matrix

# Note that when astronomical time series data are loaded on R (e.g., read.table, read.csv), 
# the digits of the observation times are typically rounded to seven effective digits.
# That means rounding may occur, which produces ties in observation times even though
# the original observation times are not the same.
# In this case, type the following code before loading the data.
# options(digits = 11)

res1.mle &lt;- drw(data1 = data1, n.datasets = 1, method = "mle")
# obtain maximum likelihood estimates of the model parameters and 
# assign the result to object "res1.mle"

names(res1.mle)
# to see the maximum likelihood estimates,
# type "res1.mle$mu", "res1.mle$sigma", "res1.mle$tau"


res1.bayes &lt;- drw(data1 = data1, n.datasets = 1, method = "bayes", 
                  bayes.n.burn = 10, bayes.n.sample = 10)

# obtain 10 posterior samples of each model parameter and
# save the result to object "res1.bayes"

# names(res1.bayes)
# to work on the posterior sample of each parameter, try 
# "res1.bayes$mu.accept.rate", "res1.bayes$sigma.accept.rate", "res1.bayes$tau.accept.rate"
# "hist(res1.bayes$mu)", "mean(res1.bayes$mu)", "sd(res1.bayes$mu)",
# "median(log(res1.bayes$sigma, base = 10))", 
# "quantile(log(res1.bayes$tau, base = 10), prob = c(0.025, 0.975))"


##### Fitting a multivariate damped random walk process based on simulations

n2 &lt;- 10 
# the number of observations in the second data set

obs.time2 &lt;- cumsum(rgamma(n2, shape = 3, rate = 1))
# the irregularly-spaced observation times of the second data set

y2 &lt;- rnorm(n2)
# the measurements/observations/magnitudes of the second data set

measure.error.SD2 &lt;- rgamma(n2, shape = 0.01)
# optional measurement error standard deviations of the second data set, 
# which is typically known in astronomical time series data
# if not known in other applications, set them to zeros, i.e.,
# measure.error.SD2 &lt;- rep(0, n2)

data2 &lt;- cbind(obs.time2, y2, measure.error.SD2)
# combine the single time series data set into an n by 3 matrix


res2.mle &lt;- drw(data1 = data1, data2 = data2, n.datasets = 2, method = "mle")

# obtain maximum likelihood estimates of the model parameters and 
# assign the result to object "res2.mle"


res2.bayes &lt;- drw(data1 = data1, data2 = data2, n.datasets = 2, method = "bayes", 
                  bayes.n.burn = 10, bayes.n.sample = 10)

# obtain 10 posterior samples of each model parameter and
# save the result to object "res2.bayes"

# names(res2.bayes)
# to work on the posterior sample of each parameter, try 
# "hist(res2.bayes$mu[, 1])", "colMeans(res2.bayes$mu)", "apply(res2.bayes$mu, 2, sd)",
# "hist(log(res2.bayes$sigma[, 2], base = 10))", 
# "apply(log(res2.bayes$sigma, base = 10), 2, median)", 
# "apply(log(res2.bayes$tau, base = 10), 2, quantile, prob = c(0.025, 0.975))"
</code></pre>


</div>