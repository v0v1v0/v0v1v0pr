<div class="container">

<table style="width: 100%;"><tr>
<td>histMatch</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Image to Image Contrast Matching</h2>

<h3>Description</h3>

<p>Performs image to image contrast adjustments based on histogram matching using empirical cumulative
distribution functions from both images.
</p>


<h3>Usage</h3>

<pre><code class="language-R">histMatch(
  x,
  ref,
  xmask = NULL,
  refmask = NULL,
  nSamples = 1e+05,
  intersectOnly = TRUE,
  paired = TRUE,
  forceInteger = FALSE,
  returnFunctions = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>SpatRaster. Source raster which is to be modified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref</code></td>
<td>
<p>SpatRaster. Reference raster, to which x will be matched.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xmask</code></td>
<td>
<p>RasterLayer or SpatRaster. Mask layer for <code>x</code> to exclude pixels which might distort the histogram, i.e. are not present in <code>ref</code>. Any NA pixel in <code>xmask</code> will be ignored (<code>maskvalue = NA</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refmask</code></td>
<td>
<p>RasterLayer or SpatRaster. Mask layer for <code>ref</code>. Any NA pixel in <code>refmask</code> will be ignored (<code>maskvalue = NA</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nSamples</code></td>
<td>
<p>Integer. Number of random samples from each image to build the histograms.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intersectOnly</code></td>
<td>
<p>Logical. If <code>TRUE</code> sampling will only take place in the overlap extent of the two rasters. Otherwise the full rasters will be used for sampling.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>paired</code></td>
<td>
<p>Logical. If <code>TRUE</code> the corresponding pixels will be used in the overlap.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>forceInteger</code></td>
<td>
<p>Logical. Force integer output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnFunctions</code></td>
<td>
<p>Logical. If <code>TRUE</code> the matching functions will be returned instead of applying them to <code>x</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments to be passed to writeRaster.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A SpatRaster of <code>x</code> adjusted to the histogram of <code>ref</code>. If <code>returnFunctions  = TRUE</code> a list of functions (one for each layer) will be returned instead.
</p>


<h3>Note</h3>

<p><code>x</code> and <code>ref</code> must have the same number of layers.
</p>


<h3>References</h3>

<p>Richards and Jia: Remote Sensing Digital Image Analysis. Springer, Berlin, Heidelberg, Germany, 439pp.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(ggplot2)
library(terra)
## Original image a (+1 to prevent log(0))
img_a &lt;-  rlogo + 1
## Degraded image b
img_b &lt;- log(img_a)
## Cut-off half the image (just for better display)
img_b[, 1:50] &lt;- NA

## Compare Images before histMatching
ggRGB(img_a,1,2,3)+
        ggRGB(img_b, 1,2,3, ggLayer = TRUE, stretch = "lin", q = 0:1) +
        geom_vline(aes(xintercept = 50))+
        ggtitle("Img_a vs. Img_b")

## Do histogram matching
img_b_matched &lt;- histMatch(img_b, img_a)

## Compare Images after histMatching
ggRGB(img_a, 1, 2, 3)+
        ggRGB(img_b_matched, 1, 2, 3, ggLayer = TRUE, stretch = "lin", q = 0:1) +
        geom_vline(aes(xintercept = 50))+
        ggtitle("Img_a vs. Img_b_matched")

## Histogram comparison
opar &lt;- par(mfrow = c(1, 3), no.readonly = TRUE)
img_a[,1:50] &lt;- NA
redLayers &lt;- c(img_a, img_b, img_b_matched)[[c(1,4,7)]]
names(redLayers) &lt;- c("img_a", "img_b", "img_b_matched")

hist(redLayers) 
## Reset par 
par(opar)
</code></pre>


</div>