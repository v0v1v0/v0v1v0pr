<div class="container">

<table style="width: 100%;"><tr>
<td>fit.re</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit the random-effects model</h2>

<h3>Description</h3>

<p>This function builds the design matrix of the random-effects model and returns the fitted values and the corresponding statistics.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fit.re(
  theta_0,
  Y,
  rct.lst,
  maxit = 10000,
  factr = 1e+07,
  pgtol = 1e-08,
  lmm = 100,
  maxemit = 100,
  eps = 1e-05,
  trace = TRUE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>theta_0</code></td>
<td>
<p>A p-dimensional vector parameter as the initial guess for the inference.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>A 3-dimensional array whose dimensions are the time, the cell type and the clone respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rct.lst</code></td>
<td>
<p>list of biochemical reactions.
A differentiation move from cell type "A" to cell type "B" must be coded as "A-&gt;B"
Duplication of cell "A" must be coded as "A-&gt;1"
Death of cell "A" must be coded as "A-&gt;0"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxit</code></td>
<td>
<p>maximum number of iterations for the optimization step.
This argument is passed to optim() function. Details on "maxit" can be found in "optim()" documentation page.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>factr</code></td>
<td>
<p>controls the convergence of the "L-BFGS-B" method.
Convergence occurs when the reduction in the objective is within this factor of the machine tolerance.
Default is 1e7, that is a tolerance of about 1e-8.
This argument is passed to optim() function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pgtol</code></td>
<td>
<p>helps control the convergence of the "L-BFGS-B" method.
It is a tolerance on the projected gradient in the current search direction.
This defaults to zero, when the check is suppressed.
This argument is passed to optim() function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lmm</code></td>
<td>
<p>is an integer giving the number of BFGS updates retained in the "L-BFGS-B" method, It defaults to 5.
This argument is passed to optim() function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxemit</code></td>
<td>
<p>maximum number of iterations for the expectation-maximization algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eps</code></td>
<td>
<p>relative error for the value x and the objective function f(x) that has to be optimized
in the expectation-maximization algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trace</code></td>
<td>
<p>Non-negative integer. If positive, tracing information on the progress of the optimization is produced.
This parameter is also passed to the optim() function.
Higher values may produce more tracing information: for method "L-BFGS-B" there are six levels of tracing.
(To understand exactly what these do see the source code: higher levels give more detail.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>(defaults to TRUE) Logical value. If TRUE, then information messages on the progress of the
algorithm are printed to the console.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A 3-length list. First element is the output returned by "optim()" function (see "optim()" documentation for details)
along with the conditional expectation <code class="reqn">E[u \vert y]</code> and variance <code class="reqn">V[u \vert y]</code>
of the latent states u given the observed states y from the last step of the expectation-maximization algorithm.
Second element is a vector of statistics associated to the fitted random-effects model:
</p>

<table>
<tr>
<td style="text-align: left;">
<code>nPar</code> </td>
<td style="text-align: left;"> number of parameters of the base(null) model </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>cll</code> </td>
<td style="text-align: left;"> value of the conditional log-likelihood, in this case just the log-likelihood </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>mll</code> </td>
<td style="text-align: left;"> value of the marginal log-likelihood, in this case just the log-likelihood </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>cAIC</code> </td>
<td style="text-align: left;"> conditional Akaike Information Criterion (cAIC), in this case simply the AIC. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>mAIC</code> </td>
<td style="text-align: left;"> marginal Akaike Information Criterion (mAIC), in this case simply the AIC. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>Chi2</code> </td>
<td style="text-align: left;"> value of the <code class="reqn">\chi^2</code> statistic <code class="reqn">(y - M\theta)'S^{-1}(y - M\theta)</code>. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>p-value</code> </td>
<td style="text-align: left;"> p-value of the <code class="reqn">\chi^2</code> test for the null hypothesis that Chi2 follows a <code class="reqn">\chi^2</code> distribution with n - nPar degrees of freedom. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>KLdiv</code> </td>
<td style="text-align: left;"> Kullback-Leibler divergence of the random-effects model from the null model. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>KLdiv/N</code> </td>
<td style="text-align: left;"> Rescaled Kullback-Leibler divergence of the random-effects model from the null model. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>BhattDist_nullCond</code> </td>
<td style="text-align: left;"> Bhattacharyya distance between the random-effects model and the null model. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>BhattDist_nullCond/N</code> </td>
<td style="text-align: left;"> Rescaled Bhattacharyya distance between the random-effects model and the null model. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<p>The third element, called "design", is a list including:
</p>

<table>
<tr>
<td style="text-align: left;">
<code>M</code> </td>
<td style="text-align: left;"> A <code class="reqn">n \times K</code> dimensional (design) matrix. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>M_bdiag</code> </td>
<td style="text-align: left;">  A<code class="reqn">n \times Jp</code> dimensional block-diagonal design matrix. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>V</code> </td>
<td style="text-align: left;"> A <code class="reqn">p \times K</code> dimensional net-effect matrix. </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">rcts &lt;- c("A-&gt;1", "B-&gt;1", "C-&gt;1", "D-&gt;1",
          "A-&gt;0", "B-&gt;0", "C-&gt;0", "D-&gt;0",
          "A-&gt;B", "A-&gt;C", "C-&gt;D") ## set of reactions
ctps &lt;- head(LETTERS,4)
nC &lt;- 3 ## number of clones
S &lt;- 10 ## trajectory length
tau &lt;- 1 ## for tau-leaping algorithm
u_1 &lt;- c(.2, .15, .17, .09*5,
         .001, .007, .004, .002,
         .13, .15, .08)
u_2 &lt;- c(.2, .15, .17, .09,
         .001, .007, .004, .002,
         .13, .15, .08)
u_3 &lt;- c(.2, .15, .17*3, .09,
         .001, .007, .004, .002,
         .13, .15, .08)
theta_allcls &lt;- cbind(u_1, u_2, u_3) ## clone-specific parameters
rownames(theta_allcls) &lt;- rcts
s20 &lt;- 1 ## additional noise
Y &lt;- array(data = NA,
           dim = c(S + 1, length(ctps), nC),
           dimnames = list(seq(from = 0, to = S*tau, by = tau),
                           ctps,
                           1:nC)) ## empty array to store simulations
Y0 &lt;- c(100,0,0,0) ## initial state
names(Y0) &lt;- ctps
for (cl in 1:nC) { ## loop over clones
  Y[,,cl] &lt;- get.sim.tl(Yt = Y0,
                        theta = theta_allcls[,cl],
                        S = S,
                        s2 = s20,
                        tau = tau,
                        rct.lst = rcts,
                        verbose = TRUE)
}
null.res &lt;- fit.null(Y = Y,
                     rct.lst = rcts,
                     maxit = 0, ## needs to be increased (&gt;=100) for real applications
                     lmm = 0, ## needs to be increased (&gt;=5) for real applications
) ## null model fitting

re.res &lt;- fit.re(theta_0 = null.res$fit$par,
                 Y = Y,
                 rct.lst = rcts,
                 maxit = 0, ## needs to be increased (&gt;=100) for real applications
                 lmm = 0, ## needs to be increased (&gt;=5) for real applications
                 maxemit = 1 ## needs to be increased (&gt;= 100) for real applications
) ## random-effects model fitting
</code></pre>


</div>