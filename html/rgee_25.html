<div class="container">

<table style="width: 100%;"><tr>
<td>ee_extract</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Extract values from EE Images or ImageCollections objects</h2>

<h3>Description</h3>

<p>Extract values from an <code>ee$Image</code> based on the locations of a geometry object.
Users can utilize  <code>ee$Geometry$*</code>, <code>ee$Feature</code>, <code>ee$FeatureCollection</code>,
sf or sfc object for spatial filter.
This function emulates the functionality of the existing extract method.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ee_extract(
  x,
  y,
  fun = ee$Reducer$mean(),
  scale = NULL,
  sf = FALSE,
  via = "getInfo",
  container = "rgee_backup",
  lazy = FALSE,
  quiet = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>ee$Image.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>ee$Geometry$*, ee$Feature, ee$FeatureCollection, sfc or sf objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>ee$Reducer object. Function to summarize the values. The function
must take a single numeric value as an argument and return a single value.
See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>A nominal scale given in meters of the Image projection to work in.
By default 1000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sf</code></td>
<td>
<p>Logical. Should the function return an sf object?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>via</code></td>
<td>
<p>Character. Method for exporting the image.
Three methods are available: "getInfo", "drive", "gcs".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>container</code></td>
<td>
<p>Character. Name of the folder ('drive') or bucket ('gcs')
to export the image into (ignore if <code>via</code> is not defined as "drive" or
"gcs").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lazy</code></td>
<td>
<p>Logical. If TRUE, a <code>
future::sequential</code> object is created to evaluate the task in the future.
Ignore if <code>via</code> is set as "getInfo". See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>Logical. Suppress info message.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>ee$Image$reduceRegions additional parameters. See
<code>ee_help(ee$Image$reduceRegions)</code> for more details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The reducer functions that return one value are:
</p>

<ul>
<li>  <p><strong>allNonZero</strong>: Returns a Reducer that returns 1 if all of its
inputs are non-zero, 0 otherwise. <br></p>
</li>
<li> <p><strong>anyNonZero</strong>: Returns a Reducer that returns 1 if any of its
inputs are non-zero, 0 otherwise. <br></p>
</li>
<li> <p><strong>bitwiseAnd</strong>: Returns a Reducer that computes the bitwise-and
summation of its inputs.
</p>
</li>
<li> <p><strong>bitwiseOr</strong>: Returns a Reducer that computes the bitwise-or
summation of its inputs.
</p>
</li>
<li> <p><strong>count</strong>: Returns a Reducer that computes the number of
non-null inputs.
</p>
</li>
<li> <p><strong>first</strong>: Returns a Reducer that returns the first of its inputs.
</p>
</li>
<li> <p><strong>firstNonNull</strong>: Returns a Reducer that returns the first of
its non-null inputs.
</p>
</li>
<li> <p><strong>kurtosis</strong>: Returns a Reducer that Computes the kurtosis of
its inputs.
</p>
</li>
<li> <p><strong>last</strong>: Returns a Reducer that returns the last of its inputs.
</p>
</li>
<li> <p><strong>lastNonNull</strong>: Returns a Reducer that returns the last of its
non-null inputs.
</p>
</li>
<li> <p><strong>max</strong>: Creates a reducer that outputs the maximum value of
its (first) input. If numInputs is greater than one, also outputs the
corresponding values of the additional inputs.
</p>
</li>
<li> <p><strong>mean</strong>: Returns a Reducer that computes the (weighted)
arithmetic mean of its inputs.
</p>
</li>
<li> <p><strong>median</strong>: Create a reducer that will compute the median of
the inputs. For small numbers of inputs (up to maxRaw) the median will be
computed directly; for larger numbers of inputs the median will be derived
from a histogram.
</p>
</li>
<li> <p><strong>min</strong>: Creates a reducer that outputs the minimum value
of its (first) input.  If numInputs is greater than one, also outputs
additional inputs.
</p>
</li>
<li> <p><strong>mode</strong>: Create a reducer that will compute the mode of the
inputs.  For small numbers of inputs (up to maxRaw) the mode will be
computed directly; for larger numbers of inputs the mode will be derived
from a histogram.
</p>
</li>
<li> <p><strong>product</strong>: Returns a Reducer that computes the product of
its inputs.
</p>
</li>
<li> <p><strong>sampleStdDev</strong>: Returns a Reducer that computes the sample
standard deviation of its inputs.
</p>
</li>
<li> <p><strong>sampleVariance</strong>: Returns a Reducer that computes the sample
variance of its inputs.
</p>
</li>
<li> <p><strong>stdDev</strong>: Returns a Reducer that computes the standard
deviation of its inputs.
</p>
</li>
<li> <p><strong>sum</strong>: Returns a Reducer that computes the (weighted) sum
of its inputs.
</p>
</li>
<li> <p><strong>variance</strong>: Returns a Reducer that computes the variance
of its inputs.
</p>
</li>
</ul>
<h3>Value</h3>

<p>A data.frame or an sf object depending on the sf argument.
Column names are extracted from band names. Use <code>ee$Image$rename</code> to
rename the bands of an <code>ee$Image</code>. See <code>ee_help(ee$Image$rename)</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
library(rgee)
library(sf)

ee_Initialize(gcs = TRUE, drive = TRUE)

# Define a Image or ImageCollection: Terraclimate
terraclimate &lt;- ee$ImageCollection("IDAHO_EPSCOR/TERRACLIMATE") %&gt;%
 ee$ImageCollection$filterDate("2001-01-01", "2002-01-01") %&gt;%
ee$ImageCollection$map(
   function(x) {
     date &lt;- ee$Date(x$get("system:time_start"))$format('YYYY_MM_dd')
     name &lt;- ee$String$cat("Terraclimate_pp_", date)
     x$select("pr")$rename(name)
   }
 )

# Define a geometry
nc &lt;- st_read(
 dsn = system.file("shape/nc.shp", package = "sf"),
 stringsAsFactors = FALSE,
 quiet = TRUE
)


#Extract values - getInfo
ee_nc_rain &lt;- ee_extract(
 x = terraclimate,
 y = nc["NAME"],
 scale = 250,
 fun = ee$Reducer$mean(),
 sf = TRUE
)

# Extract values - drive (lazy = TRUE)
ee_nc_rain &lt;- ee_extract(
 x = terraclimate,
 y = nc["NAME"],
 scale = 250,
 fun = ee$Reducer$mean(),
 via = "drive",
 lazy = TRUE,
 sf = TRUE
)
ee_nc_rain &lt;- ee_nc_rain %&gt;% ee_utils_future_value()

# Extract values - gcs (lazy = FALSE)
ee_nc_rain &lt;- ee_extract(
 x = terraclimate,
 y = nc["NAME"],
 scale = 250,
 fun = ee$Reducer$mean(),
 via = "gcs",
 container = "rgee_dev",
 sf = TRUE
)

# Spatial plot
plot(
 ee_nc_rain["X200101_Terraclimate_pp_2001_01_01"],
 main = "2001 Jan Precipitation - Terraclimate",
 reset = FALSE
)

## End(Not run)
</code></pre>


</div>