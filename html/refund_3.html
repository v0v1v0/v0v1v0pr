<div class="container">

<table style="width: 100%;"><tr>
<td>af_old</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Construct an FGAM regression term</h2>

<h3>Description</h3>

<p>Defines a term <code class="reqn">\int_{T}F(X_i(t),t)dt</code> for inclusion in an <code>mgcv::gam</code>-formula (or
<code>{bam}</code> or <code>{gamm}</code> or <code>gamm4:::gamm</code>) as constructed by
<code>{fgam}</code>, where <code class="reqn">F(x,t)</code>$ is an unknown smooth bivariate function and <code class="reqn">X_i(t)</code>
is a functional predictor on the closed interval <code class="reqn">T</code>. Defaults to a cubic tensor product
B-spline with marginal second-order difference penalties for estimating <code class="reqn">F(x,t)</code>.  The
functional predictor must be fully observed on a regular grid
</p>


<h3>Usage</h3>

<pre><code class="language-R">af_old(
  X,
  argvals = seq(0, 1, l = ncol(X)),
  xind = NULL,
  basistype = c("te", "t2", "s"),
  integration = c("simpson", "trapezoidal", "riemann"),
  L = NULL,
  splinepars = list(bs = "ps", k = c(min(ceiling(nrow(X)/5), 20), min(ceiling(ncol(X)/5),
    20)), m = list(c(2, 2), c(2, 2))),
  presmooth = TRUE,
  Xrange = range(X),
  Qtransform = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>an <code>N</code> by <code>J=ncol(argvals)</code> matrix of function evaluations
<code class="reqn">X_i(t_{i1}),., X_i(t_{iJ}); i=1,.,N.</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>argvals</code></td>
<td>
<p>matrix (or vector) of indices of evaluations of <code class="reqn">X_i(t)</code>; i.e. a matrix with
<em>i</em>th row <code class="reqn">(t_{i1},.,t_{iJ})</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xind</code></td>
<td>
<p>Same as argvals. It will discard this argument in the next version of refund.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>basistype</code></td>
<td>
<p>defaults to <code>"te"</code>, i.e. a tensor product spline to represent <code class="reqn">F(x,t)</code> Alternatively,
use <code>"s"</code> for bivariate basis functions (see <code>{s}</code>) or <code>"t2"</code> for an alternative
parameterization of tensor product splines (see <code>{t2}</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>integration</code></td>
<td>
<p>method used for numerical integration. Defaults to <code>"simpson"</code>'s rule for
calculating entries in <code>L</code>. Alternatively and for non-equidistant grids, <code>"trapezoidal"</code>
or <code>"riemann"</code>. <code>"riemann"</code> integration is always used if <code>L</code> is specified</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>L</code></td>
<td>
<p>optional weight matrix for the linear functional</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>splinepars</code></td>
<td>
<p>optional arguments specifying options for representing and penalizing the
function <code class="reqn">F(x,t)</code>. Defaults to a cubic tensor product B-spline with marginal second-order
difference penalties, i.e. <code>list(bs="ps", m=list(c(2, 2), c(2, 2))</code>, see <code>{te}</code> or
<code>{s}</code> for details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>presmooth</code></td>
<td>
<p>logical; if true, the functional predictor is pre-smoothed prior to fitting; see
<code>{smooth.basisPar}</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xrange</code></td>
<td>
<p>numeric; range to use when specifying the marginal basis for the <em>x</em>-axis.  It may
be desired to increase this slightly over the default of <code>range(X)</code> if concerned about predicting
for future observed curves that take values outside of <code>range(X)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Qtransform</code></td>
<td>
<p>logical; should the functional be transformed using the empirical cdf and
applying a quantile transformation on each column of <code>X</code> prior to fitting?  This ensures
<code>Xrange=c(0,1)</code>.  If <code>Qtransform=TRUE</code> and <code>presmooth=TRUE</code>, presmoothing is done prior
to transforming the functional predictor</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list with the following entries:
</p>

<ol>
<li> <p><code>call</code> - a <code>"call"</code> to <code>te</code> (or <code>s</code>, <code>t2</code>) using the appropriately
constructed covariate and weight matrices.
</p>
</li>
<li> <p><code>argvals</code> - the <code>argvals</code> argument supplied to <code>af</code>
</p>
</li>
<li> <p><code>L</code>-the  matrix of weights used for the integration
</p>
</li>
<li> <p><code>xindname</code> - the name used for the functional predictor variable in the <code>formula</code> used by <code>mgcv</code>.
</p>
</li>
<li> <p><code>tindname</code> - the name used for <code>argvals</code> variable in the <code>formula</code> used by <code>mgcv</code>
</p>
</li>
<li> <p><code>Lname</code> - the name used for the <code>L</code> variable in the <code>formula</code> used by <code>mgcv</code>
</p>
</li>
<li> <p><code>presmooth</code> - the <code>presmooth</code> argument supplied to <code>af</code>
</p>
</li>
<li> <p><code>Qtranform</code> - the <code>Qtransform</code> argument supplied to <code>af</code>
</p>
</li>
<li> <p><code>Xrange</code> - the <code>Xrange</code> argument supplied to <code>af</code>
</p>
</li>
<li> <p><code>ecdflist</code> - a list containing one empirical cdf function from applying <code>{ecdf}</code>
to each (possibly presmoothed) column of <code>X</code>.  Only present if <code>Qtransform=TRUE</code>
</p>
</li>
<li> <p><code>Xfd</code> - an <code>fd</code> object from presmoothing the functional predictors using
<code>{smooth.basisPar}</code>.  Only present if <code>presmooth=TRUE</code>.  See <code>{fd}</code>.
</p>
</li>
</ol>
<h3>Author(s)</h3>

<p>Mathew W. McLean <a href="mailto:mathew.w.mclean@gmail.com">mathew.w.mclean@gmail.com</a> and Fabian Scheipl
</p>


<h3>References</h3>

<p>McLean, M. W., Hooker, G., Staicu, A.-M., Scheipl, F., and Ruppert, D. (2014). Functional
generalized additive models. <em>Journal of Computational and Graphical Statistics</em>, <b>23 (1)</b>,
pp. 249-269.
</p>


<h3>See Also</h3>

<p><code>{fgam}</code>, <code>{lf}</code>, mgcv's <code>{linear.functional.terms}</code>,
<code>{fgam}</code> for examples
</p>


</div>