<div class="container">

<table style="width: 100%;"><tr>
<td>allinone</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Apply all available (sequential) permutation testing approaches of variable importance measures with one function call</h2>

<h3>Description</h3>

<p>This is a helper function, which allows to perform all (sequential) permutation testing approaches of variable importance measures described in <code>rfvimptest</code>
with a single function call. This may be useful for comparing the results obtained using the different approaches.
Importantly, this function is computationally efficient by re-using the permuted variable importance values obtained
for the conventional permutation test (that performs all <code>Mmax</code> permutations) for the other approaches. For details
on the different approaches see <code>rfvimptest</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">allinone(
  data,
  yname,
  Mmax = 500,
  varnames = NULL,
  p0 = 0.06,
  p1 = 0.04,
  alpha = 0.05,
  beta = 0.2,
  A = 0.1,
  B = 10,
  h = 8,
  nperm = 1,
  ntree = 500,
  progressbar = TRUE,
  condinf = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A <code>data.frame</code> containing the variables in the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yname</code></td>
<td>
<p>Name of outcome variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Mmax</code></td>
<td>
<p>Maximum number of permutations used in each permutation test. Default is 500.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varnames</code></td>
<td>
<p>Optional. Names of the variables for which testing should be performed. By default all variables in <code>data</code> with the exception of the outcome variable are used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p0</code></td>
<td>
<p>The value of the p-value in the null hypothesis (H0: p = p0) of SPRT and SAPT. Default is 0.06.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p1</code></td>
<td>
<p>The value of the p-value in the alternative hypothesis (H1: p = p1) of SPRT and SAPT. Default is 0.04.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>The significance level of SPRT when p = p0. Also known as type I error. Default is 0.05.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>One minus the power of SPRT when p = p1. Also known as type II error. Default is 0.2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A</code></td>
<td>
<p>The quantity A in the formula of SAPT. Default is 0.1 for a type I error of 0.05. Usually not changed by the user.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>The quantity B in the formula of SAPT. Default is 10 (1/A) for a type I error of 0.05. Usually not changed by the user.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h</code></td>
<td>
<p>The quantity h in the formula for the sequential Monte Carlo p-value. The default value for h is 8. Larger values lead to more precise p-value estimates,
but are computationally more expensive.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nperm</code></td>
<td>
<p>The numbers of permutations of the out-of-bag observations over which the results are averaged, when calculating the variable importance measure values. Default is 1. Larger values than 1 can only be considered when <code>condinf=TRUE</code>, that is, when using random forests
with conditional inference trees (Hothorn et al., 2006) as base learners.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ntree</code></td>
<td>
<p>Number of trees per forest. Default is 500.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progressbar</code></td>
<td>
<p>Output the current progress of the calculations for each variable to the console? Default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>condinf</code></td>
<td>
<p>Set this value to <code>TRUE</code> if random forests using conditional inference trees (Hothorn et al., 2006) should
be used and to <code>FALSE</code> if classical random forests using CART trees should be used. Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments passed to <code>ranger::ranger</code> (if <code>condinf=FALSE</code>) or <br><code>party::cforest_unbiased()</code> (if <code>condinf=TRUE</code>).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Object of class <code>allinone</code> with elements
</p>
<table>
<tr style="vertical-align: top;">
<td><code>varimp</code></td>
<td>
<p>Variable importance for each considered independent variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testres</code></td>
<td>
<p>The results ("keep H0" vs. "accept H1") of the tests for each considered independent variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pvalues</code></td>
<td>
<p>The p-values of the tests for each considered independent variable. Note that p-values are only obtained for the
method types "pval" and "complete".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stoppedearly</code></td>
<td>
<p>For each independent variable, whether the calculations stopped early ("yes") or the maximum of <code>Mmax</code> permutations was reached ("no").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>perms</code></td>
<td>
<p>The number of permutations performed for each independent variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Mmax</code></td>
<td>
<p>Maximum number of permutations used in each permutation test.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ntree</code></td>
<td>
<p>Number of trees per forest.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>comptime</code></td>
<td>
<p>The time the computations needed.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Alexander Hapfelmeier, Roman Hornung
</p>


<h3>References</h3>


<ul>
<li>
<p> Breiman, L. (2001). Random forests. Mach Learn, 45:5-32, &lt;doi: <a href="https://doi.org/10.1023/A:1010933404324">10.1023/A:1010933404324</a>&gt;.
</p>
</li>
<li>
<p> Coleman, T., Peng, W., Mentch, L. (2019). Scalable and efficient hypothesis testing with random forests. arXiv preprint arXiv:1904.07830, &lt;doi: <a href="https://doi.org/10.48550/arXiv.1904.07830">10.48550/arXiv.1904.07830</a>&gt;.
</p>
</li>
<li>
<p> Hapfelmeier, A., Hornung, R., Haller, B. (2022). Sequential Permutation Testing of Random Forest Variable Importance Measures. arXiv preprint arXiv:2206.01284, &lt;doi: <a href="https://doi.org/10.48550/arXiv.2206.01284">10.48550/arXiv.2206.01284</a>&gt;.
</p>
</li>
<li>
<p> Hapfelmeier, A., Ulm, K. (2013). A new variable selection approach using Random Forests. CSDA 60:50–69, &lt;doi: <a href="https://doi.org/10.1016/j.csda.2012.09.020">10.1016/j.csda.2012.09.020</a>&gt;.
</p>
</li>
<li>
<p> Hapfelmeier, A., Hothorn, T., Ulm, K., Strobl, C. (2014). A new variable importance measure for random forests with missing data. Stat Comput 24:21–34, &lt;doi: <a href="https://doi.org/10.1007/s11222-012-9349-1">10.1007/s11222-012-9349-1</a>&gt;.
</p>
</li>
<li>
<p> Hothorn, T., Hornik, K., Zeileis, A. (2006). Unbiased Recursive Partitioning: A Conditional Inference Framework. J Comput Graph Stat 15(3):651–674, &lt;doi: <a href="https://doi.org/10.1198/106186006X133933">10.1198/106186006X133933</a>&gt;.
</p>
</li>
<li>
<p> Wright, M. N., Ziegler, A. (2017). ranger: A fast implementation of random forests for high dimensional data in C++ and R. J Stat Softw 77:1-17, &lt;doi: <a href="https://doi.org/10.18637/jss.v077.i01">10.18637/jss.v077.i01</a>&gt;.
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>rfvimptest</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">

# Load package:
library("rfvimptest")

# Set seed to obtain reproducible results:
set.seed(1234)

# Load example data:
data(hearth2)

# NOTE: For illustration purposes very small numbers of maximum
# permutations are considered in the below examples.
# This number would be much too small for actual applications.
# The default number is Max=500.

# When using condinf=FALSE (default) the results for the two-sample
# permutation tests are not obtained:
(ptest &lt;- allinone(data=hearth2, yname="Class",  Mmax=20))

# Variable importance values with p-values from the Monte Carlo p-value
# and the complete approach:
ptest$varimp
ptest$pvalues$pval
ptest$pvalues$complete


# When setting condinf=TRUE the results are obtained for all approaches,
# that is, including those for the two-sample permutation tests
# (in this illustration very small number of trees ntree=30 are used,
# in practice much larger numbers should be used; the default is ntree=500):
(ptest_ci &lt;- allinone(data=hearth2, yname="Class", condinf=TRUE, ntree=30, Mmax=10))
ptest_ci$testres



</code></pre>


</div>