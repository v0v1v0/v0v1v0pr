<div class="container">

<table style="width: 100%;"><tr>
<td>make_req</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>make_req</h2>

<h3>Description</h3>

<p>Easily generate a json request with correct schema to be passed to NIH RePORTER Project API
</p>


<h3>Usage</h3>

<pre><code class="language-R">make_req(
  criteria = list(fiscal_years = lubridate::year(Sys.Date())),
  include_fields = NULL,
  exclude_fields = NULL,
  offset = 0,
  limit = 500,
  sort_field = NULL,
  sort_order = NULL,
  message = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>criteria</code></td>
<td>
<p>list(); the RePORTER Project API query criteria used to filter results (projects).
<strong>See Details for schema and other spec rules.</strong></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include_fields</code></td>
<td>
<p>character(); optional; use to return only the specified fields from the result.
<strong>See Details for valid return field names</strong></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exclude_fields</code></td>
<td>
<p>character(); optional; use to exclude specified fields from the result.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>integer(1); optional; default: 0; usually not explicitly passed by user.
Used to set the start index of the results to be retrieved (indexed from 0). <strong>See Details</strong>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>limit</code></td>
<td>
<p>integer(1); optional; default: 500; restrict the number of project records returned per page/request
inside the calling function. Defaulted to the maximum allowed value of 500. Reducing this may help with
bandwidth/timeout issues.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sort_field</code></td>
<td>
<p>character(1); optional; use to sort the result by the specified field.
May be useful in retrieving complete result sets above the API maximum of 10K (but below 2x the max = 20K)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sort_order</code></td>
<td>
<p>character(1): optional; one of "asc" or "desc"; <code>sort_field</code> must be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>message</code></td>
<td>
<p>logical(1); default: TRUE; print a message with the JSON to console/stdout. You may want to
suppress this at times.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The maximum number of records that can be returned from any result set is 10,000. Also, the maximum record index
in the result set that can be returned is 9,999 - corresponding to the 10,000'th record in the set. These
constraints from the NIH API defy any intuition that the <code>offset</code> argument would be useful to return records
beyond this 10K limit. If you need to do this, you have two options:
</p>

<ul>
<li>
<p>You can break your request into several smaller requests to be retrieved individually. For example,
requesting records for one fiscal year (see: <code>fiscal_years</code>) at a time. This should be your first path
</p>
</li>
<li>
<p>If you have a result set between 10,001 and 20,000 records, you might try passing essentially the same request
twice, but
varying them by the sort order on some field (and taking care to avoid or remove overlapping results).
See the <code>sort_field</code> and <code>sort_order</code> arguments.
</p>
</li>
</ul>
<p><code>criteria</code> must be specified as a list and may include any of the following (all optional) top level elements:
</p>

<ul>
<li>
<p><code>use_relevance</code>: logical(1); if TRUE (default), it will sort the most closely matching records per the search
criteria to the top (i.e. the NHI sorts descending according to a calculated match score)
</p>
</li>
<li>
<p><code>fiscal_years</code>: numeric(); one or more fiscal years to retrieve projects that correspond to (or started in)
one of the fiscal years entered
</p>
</li>
<li>
<p><code>include_active_projects</code>: logical(1); if TRUE (default), adds in active projects without regard for <code>policy_years</code>
</p>
</li>
<li>
<p><code>pi_names</code>: list(); API will return records with Project Investigators (PIs) wildcard-matching any of the strings
requested.<br>
If provided, the list must contain three named character vector elements: <code>first_name</code>,
<code>last_name</code>, <code>any_name</code>. Each vector must contain at least one element - use a length-1
vector with an empty string (<code>= ""</code> or <code>= character(1)</code>) for any name field you do not wish to search on.
</p>
</li>
<li>
<p><code>multi_pi_only: logical(1)</code>; default: FALSE; when multiple <code>pi_names</code> are matched, setting this value to TRUE
changes the logic from returning project records associated with ANY matched PI name to those associated with ALL names.
</p>
</li>
<li>
<p><code>po_names</code>: list(); Project Officers (POs), otherwise same comments as for <code>pi_names</code>
</p>
</li>
<li>
<p><code>org_names</code>: character(); one or more strings to filter organization names. The <strong>provided string is implicitly
taken to include wildcards at head and tail</strong> ends; "JOHN" and "HOP" will both match "JOHNS HOPKINS UNIVERSITY", etc.
</p>
</li>
<li>
<p><code>org_names_exact_match</code>: character(); one or more strings to exactly match organization names
</p>
</li>
<li>
<p><code>pi_profile_ids</code>: numeric(); one or more project investigator profile IDs; results will match projects associated with
any of the IDs
</p>
</li>
<li>
<p><code>org_cities</code>: character(); one or more cities in which associated organizations may be based.
</p>
</li>
<li>
<p><code>org_states</code>: character(); one or more US States or Territories (note: requires the abbreviation codes: "NY", "PR", etc.)
in which a project organization may be based.
</p>
</li>
<li>
<p><code>project_nums</code>: character(); one or more project numbers (note: the alphanumeric variety of numbers); results will match
any of the specified strings. You may include explicit wildcard operators ("*") in the strings, e.g. "5UG1HD078437-\*"
</p>
</li>
<li>
<p><code>project_num_split</code>: list(6); the <code>project_nums</code> can be broken down to meaningful components which can be searched
individually using this argument.
These component codes are defined <a href="https://api.reporter.nih.gov/documents/Data%20Elements%20for%20RePORTER%20Project%20API_V2.pdf#page=31">here</a>
Your list must contain all of the following named elements:
</p>

<ul>
<li>
<p><code>appl_type_code</code>: character();
</p>
</li>
<li>
<p><code>activity_code</code>: character();
</p>
</li>
<li>
<p><code>ic_code</code>: character();
</p>
</li>
<li>
<p><code>serial_num</code>: character();
</p>
</li>
<li>
<p><code>support_year</code>: character();
</p>
</li>
<li>
<p><code>suffix_code</code>: character();
</p>
</li>
</ul>
<p>Provide a length-1 vector containing an empty string (<code>=""</code> or <code>=character(1)</code>) for any element you do not want to search on

</p>
</li>
<li>
<p><code>spending_categories</code>: list(2); a list containing the following named elements:
</p>

<ul>
<li>
<p><code>values</code>: numeric(): the NIH spending category code. These are congressionally defined and are
available <a href="https://api.reporter.nih.gov/documents/Data%20Elements%20for%20RePORTER%20Project%20API_V2.pdf#page=40">here</a>

</p>
</li>
<li>
<p><code>match_all</code>: logical(1); TRUE to return projects found in all categories; FALSE to return projects matching any one
of the categories.
</p>
</li>
</ul>
</li>
<li>
<p><code>funding_mechanism</code>: character(); one or more NIH funding mechanism codes used in the president's budget.
Available <a href="https://api.reporter.nih.gov/documents/Data%20Elements%20for%20RePORTER%20Project%20API_V2.pdf#page=14">here</a>
</p>
</li>
<li>
<p><code>org_countries</code>: character(); one or more country names; e.g. "United States"
</p>
</li>
<li>
<p><code>appl_ids</code>: numeric(); one or more application IDs (note: appl. IDs are natural numbers, unlike <code>project_nums</code>)
</p>
</li>
<li>
<p><code>agencies</code>: character(); one or more of the abbreviated NIH agency/institute/center names, available
<a href="https://grants.nih.gov/grants/acronym_list.htm#ao_two">here</a>
</p>
</li>
<li>
<p><code>is_agency_admin: logical(1)</code>; when specifying associated <code>agencies</code>, set this value to <code>TRUE</code> to further specify
that these agencies are administering the grant/project.
</p>
</li>
<li>
<p><code>is_agency_funding: logical(1)</code>; when specifying associated <code>agencies</code>, set this value to <code>TRUE</code> to further specify
that these agencies are funding the grant/project. 
</p>
</li>
<li>
<p><code>activity_codes: character()</code>; a 3-character code identifying the grant, contract, or intramural activity through which a project is supported.
This is a more detailed description within each funding mechanism. Codes are available
<a href="https://grants.nih.gov/grants/funding/ac_search_results.htm">here</a>
</p>
</li>
<li>
<p><code>award_types: character()</code>; (aka Type of Application) one or more grant/application type codes numbered 1-9.
See types <a href="https://grants.nih.gov/grants/how-to-apply-application-guide/prepare-to-apply-and-register/type-of-applications.htm">here</a>
</p>
</li>
<li>
<p><code>dept_types: character()</code>; one or more of NIH standardized department type names (e.g. "PEDIATRICS"). Valid names are provided
<a href="https://nexus.od.nih.gov/all/2021/04/09/how-are-schools-and-departments-assigned-to-nih-grants/">here</a>
</p>
</li>
<li>
<p><code>cong_dists: character()</code>; one or more US congressional districts (e.g. "NY-20") which the project can be associated with.
See <a href="https://en.wikipedia.org/wiki/List_of_United_States_congressional_districts">here</a>
</p>
</li>
<li>
<p><code>foa: character()</code>; one or more FOA (Funding Opportunity Announcements). Multiple projects may be tied to a single FOA.
See <a href="https://grants.nih.gov/grants/how-to-apply-application-guide/prepare-to-apply-and-register/understand-funding-opportunities.htm">here</a>
</p>
</li>
<li>
<p><code>project_start_date</code>: list(2); provide a range for the project start date. Must pass as list containing the following named elements:
</p>

<ul>
<li>
<p><code>from_date</code>: character(1); string date in %Y-%m-%d format. See <code>?base::format</code> for converting from date class.
</p>
</li>
<li>
<p><code>to_date</code>: character(1); string date in %Y-%m-%d format.
</p>
</li>
</ul>
</li>
<li>
<p><code>project_end_date: list(2)</code>; provide a range for the project end date - similar to <code>project_start_date</code>.
</p>

<ul>
<li>
<p><code>from_date</code>: character(1); string date in %Y-%m-%d format. See <code>?base::format</code> for converting from date class.
</p>
</li>
<li>
<p><code>to_date</code>: character(1); string date in %Y-%m-%d format.
</p>
</li>
</ul>
</li>
<li>
<p><code>organization_type: character()</code>; one or more types of applicant organizations (e.g. "SCHOOLS OF MEDICINE"). There does not appear to be a
documented list of valid values, but you can obtain one by pulling all records in a recent year and extracting unique values.
</p>
</li>
<li>
<p><code>award_notice_date: list(2)</code>; the award notice date as a range, or you can provide just one of the min/max date, but if you do you must provide the other as an empty string.
</p>

<ul>
<li>
<p><code>from_date</code>: character(1); string date in %Y-%m-%d format. See <code>?base::format</code> for converting from date class.
</p>
</li>
<li>
<p><code>to_date</code>: character(1); string date in %Y-%m-%d format.
</p>
</li>
</ul>
</li>
<li>
<p><code>award_amount_range: list(2)</code>; a numeric range - if you don't want to filter by this sub-criteria (but are filtering on some other award criteria),
enter 0 for min and 1e9 for max
</p>

<ul>
<li>
<p><code>min_amount: numeric(1)</code>; a real number between 0 and something very large
</p>
</li>
<li>
<p><code>max_amount: numeric(1)</code>; a real number between 0 and something very large
</p>
</li>
</ul>
</li>
<li>
<p><code>exclude_subprojects: logical(1)</code>; default: FALSE; related to multiproject research awards, TRUE will limit results to just the parent project.
</p>
</li>
<li>
<p><code>sub_project_only: logical(1)</code>; default: FALSE; similar to <code>exclude_subprojects</code>, this field will limit results to just the subprojects,
excluding the parent.
</p>
</li>
<li>
<p><code>newly_added_projects_only: logical(1)</code>; default: FALSE; return only those projects "newly added" (this is left undefined in the official
documentation) to the system.
</p>
</li>
<li>
<p><code>covid_response: character();</code> one or more special selector codes used to return projects awarded to study COVID-19 and related topics as funded
and classified according to the below valid values/funding sources:
</p>

<ul>
<li>
<p><code>All</code>: all COVID-19 projects
</p>
</li>
<li>
<p><code>Reg-CV</code>: those funded by regular NIH Appropriated funds
</p>
</li>
<li>
<p><code>CV</code>: those funded by the Coronavirus Preparedness and Response Supplemental Appropriations Act, 2020
</p>
</li>
<li>
<p><code>C3</code>: those funded by the CARES Act
</p>
</li>
<li>
<p><code>C4</code>: those funded by the Paycheck Protection Program and Health Care Enhancement Act
</p>
</li>
<li>
<p><code>C5</code>: those funded by the Coronavirus Response and Relief Supplemental Appropriations Act, 2021
</p>
</li>
<li>
<p><code>C6</code>: those funded by the American Rescue Plan Act, 2021
</p>
</li>
</ul>
</li>
<li>
<p><code>full_study_sections: list(6)</code>; (not documented in API notes) Review activities of the Center for Scientific Review (CSR) are organized into
Integrated Review Groups (IRGs). Each IRG represents a cluster of study sections around a general scientific area. Applications generally are assigned
first to an IRG, and then to a specific study section within that IRG for evaluation of scientific merit.<br>
This gets a bit complicated so we provide <a href="https://public.csr.nih.gov/StudySections">this resource</a> for further reading.
If providing this criteria, you must include each of the below named elements as character vectors:
</p>

<ul>
<li>
<p><code>irg_code</code>: character(); Integrated Review Group
</p>
</li>
<li>
<p><code>sra_designator_code</code>: character(); Scientific Review Administrator 
</p>
</li>
<li>
<p><code>sra_flex_code</code>: character(); 
</p>
</li>
<li>
<p><code>group_code</code>: character(); 
</p>
</li>
<li>
<p><code>name</code>: character(); 
</p>
</li>
<li>
<p><code>url</code>: character(); 
</p>
</li>
</ul>
</li>
<li>
<p><code>advanced_text_search</code>: list(3); used to perform string search in the Project Title ("projecttitle"),
Abstract ("abstract"), and/or Project Terms ("terms") fields.
If providing this criteria, you must include each of the below named elements:
</p>

<ul>
<li>
<p><code>operator: character(1)</code>; one of "and", "or", "advanced". "and", "or" will be the logical operator between all provided search terms.
"advanced" allows the user to pass a boolean search string directly.
</p>
</li>
<li>
<p><code>search_field: character()</code>; can be one or multiple of "abstract", "terms", "projecttitle" passed as a vector of length 1 to 3.
To search all fields, the user can alternatively pass a length 1 character vector containing the string "all" or "".
</p>
</li>
<li>
<p><code>search_text: character(1)</code>; pass one or multiple search terms separated by spaces, without any quotations. If searching in
"advanced" mode, provide a boolean search string - you may use parentheses, AND, OR, NOT, and *escaped* double quotes
(e.g. <code>search_text = "(brain AND damage) OR (\"insane in the membrane\") AND cure"</code>)
</p>
</li>
</ul>
</li>
</ul>
<h4>Field Names</h4>

<p>Full listing of available field names which can be specified in <code>include_fields</code>, <code>exclude_fields</code>, and <code>sort_field</code>
is located <a href="https://api.reporter.nih.gov/documents/Data%20Elements%20for%20RePORTER%20Project%20API_V2.pdf">here</a>
</p>



<h3>Value</h3>

<p>A standard json (<code>jsonlite</code> flavor) object containing the valid JSON request string which can
be passed to <code>get_nih_data</code> or elsewhere
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(repoRter.nih)

## all projects funded in the current (fiscal) year
req &lt;- make_req() 

## projects funded in 2019 through 2021
req &lt;- make_req(criteria = list(fiscal_years = 2019:2021))

## projects funded in 2021 where the principal investigator first name is
## "Michael" or begins with "Jo" 
req &lt;- make_req(criteria = 
                    list(fiscal_years = 2021,
                         pi_names = 
                             list(first_name = c("Michael", "Jo*"),
                                  last_name = c(""), # must specify
                                  any_name = character(1) # same here
                                  )
                         )
                )

## all covid-related projects except those funded by American Rescue Plan
## and specify the fields to return, sorting ascending on ApplId column
req &lt;- make_req(criteria = 
                    list(covid_response = c("Reg-CV", "CV", "C3", "C4", "C5")
                    ),
                include_fields = 
                    c("ApplId", "SubprojectId", "FiscalYear", "Organization",
                      "AwardAmount", "CongDist", "CovidResponse",
                      "ProjectDetailUrl"),
                sort_field = "ApplId",
                sort_order = "asc")
                
## using advanced_text_search with boolean search string

string &lt;- "(head AND trauma) OR \"brain damage\" AND NOT \"psychological\""
req &lt;- make_req(criteria = 
                    list(advanced_text_search =
                         list(operator = "advanced",
                              search_field = c("terms", "abstract"),
                              search_text = string
                              )
                         )
                )

</code></pre>


</div>