<div class="container">

<table style="width: 100%;"><tr>
<td>do_admb</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Compile and/or run an ADMB model, collect output</h2>

<h3>Description</h3>

<p>Compile an ADMB model, run it, collect output
</p>


<h3>Usage</h3>

<pre><code class="language-R">do_admb(fn, data = NULL, params = NULL, bounds = NULL, phase = NULL,
  re = NULL, data_type = NULL, safe = TRUE, profile = NULL,
  profile.opts = NULL, mcmc = NULL, mcmc.opts = mcmc.control(),
  impsamp = FALSE, verbose = FALSE, run.opts = run.control(),
  objfunname = "f", workdir = getwd(), admb_errors = c("stop", "warn",
  "ignore"), extra.args)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fn</code></td>
<td>
<p>(character) base name of a TPL function, located in the working
directory</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a named list of input data variables (order must match TPL file): each element of the list can either be a single value, or a list containing elements
</p>

<ul>
<li>
<p>valuethe value of the data
</p>
</li>
<li>
<p>data_typecharacter: possible values as in <code>storage.mode</code>, typically "integer" or "numeric": this overrides R2admb's attempts to guess whether variables are supposed to be integers or floats (default NA)
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>params</code></td>
<td>
<p>a named list of starting parameter values (order must match TPL file): each element of the list can either be a single value, or a list containing elements
</p>

<dl>
<dt>value</dt>
<dd>
<p>starting value of the parameter (default 0)</p>
</dd>
<dt>bounds</dt>
<dd>
<p>two-element vector of lower and upper bounds</p>
</dd>
<dt>phase</dt>
<dd>
<p>integer, specifying phase: not implemented yet</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bounds</code></td>
<td>
<p>named list of 2-element vectors of lower and upper bounds for
specified parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phase</code></td>
<td>
<p>named numeric vector of phases (not implemented yet)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>re</code></td>
<td>
<p>a named list of the identities and dimensions of any random effects
vectors or matrices used in the TPL file</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data_type</code></td>
<td>
<p>a named vector specifying (optional) data types for
parameters, in parname="storage mode" format (e.g.
<code>c(x="integer",y="numeric")</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>safe</code></td>
<td>
<p>(logical) compile in safe mode?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>profile</code></td>
<td>
<p>(logical) generate likelihood profiles? (untested!)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>profile.opts</code></td>
<td>
<p>(list) list of options, including
</p>

<ul><li>
<p>parsvector of names of parameters to profile
</p>
</li></ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcmc</code></td>
<td>
<p>(logical) run MCMC around best fit?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcmc.opts</code></td>
<td>
<p>options for MCMC (see <code>mcmc.control</code> for details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>impsamp</code></td>
<td>
<p>(logical) run importance sampling?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>(logical) print details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run.opts</code></td>
<td>
<p>options for ADMB run (see <code>run.control</code> for details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>objfunname</code></td>
<td>
<p>(character) name for objective function in TPL file (only relevant if <code>checkparam</code> is set to "write")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>workdir</code></td>
<td>
<p>temporary working directory (dat/pin/tpl files will be copied)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>admb_errors</code></td>
<td>
<p>how to treat ADMB errors (in either compilation or run): use "ignore" option at your own risk!</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extra.args</code></td>
<td>
<p>(character) extra argument string to pass to admb</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>do_admb</code> will attempt to do everything required to start from the model
definition (TPL file) specified by <code>fn</code>, the data list, and the list of
input parameters, compile and run (i.e. minimize the objective function of)
the model in AD Model Builder, and read the results back into an object of
class <code>admb</code> in R. If <code>checkparam</code> or <code>checkdata</code> are set to
"write", it will attempt to construct a DATA section, and construct or
(augment an existing) PARAMETER section (which may contain definitions of
non-input parameters to be used in the model). It copies the input TPL file
to a backup (.bak); on finishing, it restores the original TPL file and
leaves the auto-generated TPL file in a file called [fn]_gen.tpl.
</p>


<h3>Value</h3>

<p>An object of class <code>admb</code>.
</p>


<h3>Note</h3>

<p>1. Mixed-case file names are ignored by ADMB; this function makes a
temporary copy with the file name translated to lower case. 2. Parameter
names containing periods/full stops will not work, because this violates C
syntax (currently not checked). 3. There are many, many, implicit
restrictions and assumptions: for example, all vectors and matrices are
assumed to be indexed starting from 1.
</p>


<h3>Author(s)</h3>

<p>Ben Bolker
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Not run: 
setup_admb()
file.copy(system.file("tplfiles","ReedfrogSizepred0.tpl",package="R2admb"),"tadpole.tpl")
tadpoledat &lt;-
 data.frame(TBL = rep(c(9,12,21,25,37),each=3),
            Kill = c(0,2,1,3,4,5,0,0,0,0,1,0,0,0,0L),
            nexposed=rep(10,15))
m1 &lt;- do_admb("tadpole",
             data=c(list(nobs=15),tadpoledat),
             params=list(c=0.45,d=13,g=1),
             bounds=list(c=c(0,1),d=c(0,50),g=c(-1,25)),
             run.opts=run.control(checkparam="write",
               checkdata="write",clean="all"))
m2 &lt;- do_admb("tadpole",
             data=c(list(nobs=15),tadpoledat),
             params=list(c=list(0.45,bounds=c(0,1)),
                         d=list(13,bounds=c(0,50)),
                         g=list(1,bounds=c(-1,25))),
             run.opts=run.control(checkparam="write",
               checkdata="write",clean="all"))
unlink("tadpole.tpl")

## End(Not run)

</code></pre>


</div>