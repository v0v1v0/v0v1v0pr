<div class="container">

<table style="width: 100%;"><tr>
<td>predict.fbps</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Prediction for fast bivariate <em>P</em>-spline (fbps)</h2>

<h3>Description</h3>

<p>Produces predictions given a <code>fbps</code> object and new data
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'fbps'
predict(object, newdata, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>an object returned by <code>fbps</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p>a data frame or list consisting of x and z values for which predicted values are desired. 
vectors of x and z need to be of the same length.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list with components </p>
<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a vector of x given in newdata</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>a vector of z given in newdata</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitted.values</code></td>
<td>
<p>a vector of
fitted values corresponding to x and z given in newdata</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Luo Xiao <a href="mailto:lxiao@jhsph.edu">lxiao@jhsph.edu</a>
</p>


<h3>References</h3>

<p>Xiao, L., Li, Y., and Ruppert, D. (2013). Fast bivariate
<em>P</em>-splines: the sandwich smoother. <em>Journal of the Royal
Statistical Society: Series B</em>, 75(3), 577â€“599.
</p>


<h3>Examples</h3>

<pre><code class="language-R">##########################
#### True function   #####
##########################
n1 &lt;- 60
n2 &lt;- 80
x &lt;- (1: n1)/n1-1/2/n1
z &lt;- (1: n2)/n2-1/2/n2
MY &lt;- array(0,c(length(x),length(z)))
sigx &lt;- .3
sigz &lt;- .4
for(i in 1: length(x))
  for(j in 1: length(z))
 {
    #MY[i,j] &lt;- .75/(pi*sigx*sigz) *exp(-(x[i]-.2)^2/sigx^2-(z[j]-.3)^2/sigz^2)
    #MY[i,j] &lt;- MY[i,j] + .45/(pi*sigx*sigz) *exp(-(x[i]-.7)^2/sigx^2-(z[j]-.8)^2/sigz^2)
    MY[i,j] = sin(2*pi*(x[i]-.5)^3)*cos(4*pi*z[j])
  }

##########################
#### Observed data   #####
##########################
sigma &lt;- 1
Y &lt;- MY + sigma*rnorm(n1*n2,0,1)

##########################
####   Estimation    #####
##########################
est &lt;- fbps(Y,list(x=x,z=z))
mse &lt;- mean((est$Yhat-MY)^2)
cat("mse of fbps is",mse,"\n")
cat("The smoothing parameters are:",est$lambda,"\n")

########################################################################
########## Compare the estimated surface with the true surface #########
########################################################################

par(mfrow=c(1,2))
persp(x,z,MY,zlab="f(x,z)",zlim=c(-1,2.5), phi=30,theta=45,expand=0.8,r=4,
      col="blue",main="True surface")
persp(x,z,est$Yhat,zlab="f(x,z)",zlim=c(-1,2.5),phi=30,theta=45,
      expand=0.8,r=4,col="red",main="Estimated surface")

##########################
####   prediction    #####
##########################

# 1. make prediction with predict.fbps() for all pairs of x and z given in the original data
#    ( it's expected to have same results as Yhat obtianed using fbps() above )
newdata &lt;- list(x= rep(x, length(z)), z = rep(z, each=length(x)))
pred1 &lt;- predict(est, newdata=newdata)$fitted.values
pred1.mat &lt;- matrix(pred1, nrow=length(x))
par(mfrow=c(1,2))
image(pred1.mat); image(est$Yhat)
all.equal(as.numeric(pred1.mat), as.numeric(est$Yhat))

# 2. predict for pairs of first 10 x values and first 5 z values
newdata &lt;- list(x= rep(x[1:10], 5), z = rep(z[1:5], each=10))
pred2 &lt;- predict(est, newdata=newdata)$fitted.values
pred2.mat &lt;- matrix(pred2, nrow=10)
par(mfrow=c(1,2))
image(pred2.mat); image(est$Yhat[1:10,1:5])
all.equal(as.numeric(pred2.mat), as.numeric(est$Yhat[1:10,1:5]))
# 3. predict for one pair 
newdata &lt;- list(x=x[5], z=z[3])
pred3 &lt;- predict(est, newdata=newdata)$fitted.values
all.equal(as.numeric(pred3), as.numeric(est$Yhat[5,3]))
</code></pre>


</div>