<div class="container">

<table style="width: 100%;"><tr>
<td>booteval.relimp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2> Functions to Bootstrap Relative Importance Metrics </h2>

<h3>Description</h3>

<p>These functions provide bootstrap confidence intervals for relative importances. 
<code>boot.relimp</code> uses the R package boot to do the actual bootstrapping of requested metrics 
(which may take quite a while), 
while <code>booteval.relimp</code> evaluates the results and provides confidence intervals.
Output from <code>booteval.relimp</code> is printed with a tailored print method, and a plot method
produces bar plots with confidence indication of the relative importance metrics. 
</p>


<h3>Usage</h3>

<pre><code class="language-R">## generic function
boot.relimp(object, ...)

## default S3 method
## Default S3 method:
boot.relimp(object, x = NULL, ..., b = 1000, type = "lmg", 
    rank = TRUE, diff = TRUE, rela = FALSE, always = NULL, 
    groups = NULL, groupnames = NULL, fixed=FALSE, 
    weights = NULL, design = NULL)

## S3 method for formula objects
## S3 method for class 'formula'
boot.relimp(formula, data, weights, na.action, ..., subset = NULL)

## S3 method for objects of class lm
## S3 method for class 'lm'
boot.relimp(object, type = "lmg", groups = NULL, groupnames=NULL, always = NULL, 
    ..., b=1000)

## function for evaluating bootstrap results
booteval.relimp(bootrun, bty = "perc", level = 0.95, 
    sort = FALSE, norank = FALSE, nodiff = FALSE, 
    typesel = c("lmg", "pmvd", "last", "first", "betasq", "pratt", "genizi", "car"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object   </code></td>
<td>
<p> cf. <code>calc.relimp</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula   </code></td>
<td>
<p> cf. <code>calc.relimp</code>.
But note the additional restriction that - in connection with the <code>design=</code>-option - 
it is currently not possible to use factors, interactions or calculated quantities in a formula.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x   </code></td>
<td>
<p> cf. <code>calc.relimp</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b</code></td>
<td>
<p> is the number of bootstrap runs requested on boot.relimp (default: <code>b=1000</code>). 
Make sure to set this to a lower number, if you are simply testing code. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p> cf. <code>calc.relimp</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rank</code></td>
<td>
<p> is a logical requesting bootstrapping of ranks (<code>rank=TRUE</code>, default) for each metric from type </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>diff</code></td>
<td>
<p> is a logical requesting bootstrapping of pairwise differences in relative importance (<code>diff=TRUE</code>, 
default) for each metric in type </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rela</code></td>
<td>
<p> cf. <code>calc.relimp</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>always </code></td>
<td>
<p> cf. <code>calc.relimp</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groups </code></td>
<td>
<p> cf. <code>calc.relimp</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groupnames </code></td>
<td>
<p> cf. <code>calc.relimp</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights </code></td>
<td>
<p> cf. <code>calc.relimp</code> for specification of weights. 
See also the Details section of this help page for usage of different types of weights. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>design </code></td>
<td>
<p> cf. <code>calc.relimp</code>. But note that there are 
currently some restrictions regarding usability of other possibilities, when using a <code>design</code> 
in <code>boot.relimp</code>: formulae can only be simpler than usual, and factors, interactions or 
calculated variables in formulae are not permitted.
</p>
<p>For a description of the bootstrap method's treatment of designs, see the details section.
In the current version, using a design in bootstrapping must be considered EXPERIMENTAL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed</code></td>
<td>
<p> is a logical requesting bootstrapping for a fixed design matrix (if TRUE). 
The default is bootstrapping for randomly drawn samples (fixed = FALSE). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p> cf. <code>calc.relimp</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p> cf. <code>calc.relimp</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p> cf. <code>calc.relimp</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p> usable for further arguments, particularly all arguments of the default method can be given to all other methods </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bootrun</code></td>
<td>
<p> is an object of class <code>relimplmboot</code> created by function <code>boot.relimp</code>. 
It hands over all relevant information on the bootstrap runs to function <code>booteval.relimp</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bty</code></td>
<td>
<p> is the type of bootstrap interval requested (a character string), 
as handed over to the function <code>boot.ci</code> from package <code>boot</code>. 
Possible choices are <code>bca</code>, <code>perc</code>, <code>basic</code> and <code>norm</code>. 
<code>student</code> is not supported.  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p> is a single confidence level or a numeric vector of confidence levels. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sort</code></td>
<td>
<p> is a logical requesting output sorted by size of relative contribution (<code>sort=TRUE</code>) or by variable position in list (<code>sort=FALSE</code>, default). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>norank</code></td>
<td>
<p> is a logical that suppresses of rank letters (<code>norank=TRUE</code>) even if ranks have been bootstrapped. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nodiff</code></td>
<td>
<p> is a logical that suppresses output of confidence intervals for differences (<code>nodiff=TRUE</code>), even if differences have been bootstrapped. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>typesel</code></td>
<td>
<p> provides the metrics that are to be reported. Default: all available ones 
(intersection of those available in object <code>bootrun</code> and those requested in <code>typesel</code>). 
<code>typesel</code> accepts the same values as <code>type</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Calculations of metrics are based on the function <code>calc.relimp</code>. 
Bootstrapping is done with the R package <code>boot</code>, 
resampling the full observation vectors by default (combinations of response, weights and regressors, cf. Fox (2002)). 
If <code>fixed=TRUE</code> is specified, bootstrapping is based on residuals rather than full observations, 
keeping the X-variables fixed.
</p>
<p>If the <code>weights</code> option is used, weights are resampled together with the full observations, 
and weighted contributions are calculated for each resample (no re-normalization is done within the resamples.)
</p>
<p>Please note that usage of weights in linear models can have very different reasons. 
One motivation is a different variability of different observations, where weights are the inverse variances. 
This is the way <code>weights</code> are treated in function <code>lm</code> and also in <code>calc.relimp</code> and in <code>boot.relimp</code>, 
if a vector of weights is given with the <code>weights</code> option. Specifically, weights do not affect the 
resampling probability in bootstrapping, i.e. each observation has the same probability to be included in resamples.
</p>
<p>If the weights in a data frame represent the multiplicity of each observation (i.e. there are several units with 
identical combination of values in the data, and the weights represent the number of units with exactly this value 
pattern for each row of the data frame), they can also be directly used as weights in <code>calc.relimp</code> for 
calculating the metrics. However, such frequency weights cannot be appropriately accomodated in <code>boot.relimp</code>; 
instead, the data frame with frequencies has to be expanded to include one row for each unit before using the 
resampling routine (e.g. using function <code>untable</code> from package <span class="pkg">reshape</span> or function <code>expand.table</code> 
from package <span class="pkg">epitools</span>.
</p>
<p>In survey situations, weights are used to generate a more representative picture of the population: 
an observation's weight is typically the number of units of the population that this single observed unit represents. 
In this situation, there is no reason to consider observations with higher weights as less variable than observations 
with lower weights; thus, while estimates can again be obtained treating the weights in the same way as mentioned before,
their usage in estimation of standard errors and in bootstrapping is different. 
In order to appropriately accomodate survey weights for these purposes, it is not sufficient to only provide the 
weights vector; instead, it is necessary to provide a design generated with package <span class="pkg">survey</span> or an object of 
class <code>svyglm</code> (produced by function <code>svyglm</code>) that includes the appropriate design information.
</p>
<p>Clusters are a way to take care of dependency structures like in longitudinal data. 
Thus, while relaimpo does not (currently) cover linear mixed models (e.g. produced by function <code>lme</code>), it is possible to 
accomodate clustered data by applying function <code>svyglm</code> with linear link function and gaussian distribution 
to a design that contains clusters. The bootstrapping approach subsequently takes care of the dependence by considering 
clusters as sampling units. Users who want to use this approach can mimic the second example below.
</p>
<p>If the <code>design</code> option is used (experimental), resampling is done within package <span class="pkg">survey</span>, 
and the resampled contributions are also calculated within package survey. The results from these calculations 
are plugged into an object from package <span class="pkg">boot</span>, and confidence interval calculation is subsequently handled in 
<span class="pkg">boot</span>. The approach is considered experimental: so far no simulation studies have been conducted for 
complex survey designs, and because of limited experience (in spite of thorough testing) it is not unlikely that 
bugs will be found by users who are routinely using complex survey designs.
</p>
<p>The output provides results for all selected relative importance metrics. 
The output object can be printed and plotted (description of syntax: <code>classesmethods.relaimpo</code>).   
</p>
<p>Printed output: In addition to the standard output of <code>calc.relimp</code> 
(one row for each regressor, one column for each bootstrapped metric), 
there is a table of confidence intervals for each selected metric 
(one row per combination of regressor and metric). 
This table is enhanced by information on rank confidence intervals, 
if ranks have been bootstrapped (<code>rank=TRUE</code>) and <code>norank=FALSE</code>. 
In addition, if differences have been bootstrapped (<code>diff=TRUE</code>) and <code>nodiff=FALSE</code>, 
there is a table of estimated pairwise differences with confidence intervals.
</p>
<p>Graphical output: Application of the plot method to the object created by <code>booteval.relimp</code> 
yields barplot representations for all bootstrapped metrics (all in one graphics window). Confidence level (<code>lev=</code>) 
and number of characters in variable names to be used (<code>names.abbrev=</code>) can be modified. 
Confidence bounds are indicated on the graphs by added vertical lines. 
<code>par()</code> options can be used for modifying output (exceptions: <code>mfrow</code>, <code>oma</code> and 
<code>mar</code> are overridden by the plot method).
</p>


<h3>Value</h3>

<p>The value of <code>boot.relimp</code> is of class <code>relimplmboot</code>. It is designed to be useful as input for <code>booteval.relimp</code> and is not further described here. 
<code>booteval.relimp</code> returns an object of class <code>relimplmbooteval</code>, the items of which can be accessed by 
the <code>$</code> or the <code>@</code> extractors. 
</p>
<p>In addition to the items described for function <code>calc.relimp</code>, which are also available here, 
the following items may be of interest for further calculations:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>metric.lower </code></td>
<td>
<p>matrix of lower confidence bounds for “metric”: one row for each confidence level, 
one column for each element of “metric”. “metric” can be any of <code>lmg</code>, <code>lmg.rank</code>, 
<code>lmg.diff</code>, ... 
(replace <code>lmg</code> with other available relative importance metrics, cf. <code>calc.relimp</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metric.upper </code></td>
<td>
<p>matrix of upper confidence bounds for “metric”: one row for each confidence level, 
one column for each element of “metric”</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metric.boot </code></td>
<td>
<p>matrix of bootstrap results for “metric”: one row for each bootstrap run, 
one column for each element of “metric”. 
Here, “metric” can be chosen as any of the above-mentioned and also as <code class="reqn">R^2</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nboot </code></td>
<td>
<p>number of bootstrap runs underlying the evaluations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level </code></td>
<td>
<p>confidence levels</p>
</td>
</tr>
</table>
<h3>Warning </h3>

<p>The bootstrap confidence intervals should be used for exploratory purposes only. 
They can be somewhat liberal: Limited simulations for percentile intervals have shown that non-coverage probabilities 
can be up to twice the nominal probabilities. More investigations are needed.
</p>
<p>Be aware that the method itself needs some computing time in case of many regressors. 
Hence, bootstrapping should be used with awareness of computing time issues.
</p>
<p><code>relaimpo</code> is a package for univariate linear models. 
Using <code>relaimpo</code> on objects that inherit from class <code>lm</code> but are not univariate linear model objects 
may produce nonsensical results without warning. Objects of class <code>mlm</code> or <code>glm</code> with link functions other than identity 
or family other than gaussian lead to an error message. 
</p>


<h3>Note</h3>

<p> There are two versions of this package. The version on CRAN is globally licensed under GPL version 2 (or later). 
There is an extended version with the interesting additional metric <code>pmvd</code> that is licensed according to GPL version 2
under the geographical restriction "outside of the US" because of potential issues with US patent 6,640,204. This version can be obtained 
from Ulrike Groempings website (cf. references section). Whenever you load the package, a display tells you, which version you are loading. </p>


<h3>Author(s)</h3>

<p> Ulrike Groemping, BHT Berlin </p>


<h3>References</h3>

<p>Chevan, A. and Sutherland, M. (1991) Hierarchical Partitioning. <em>The American Statistician</em> <b>45</b>, 90–96.
</p>
<p>Darlington, R.B. (1968) Multiple regression in psychological research and practice. <em>Psychological Bulletin</em>  <b>69</b>, 161–182.
</p>
<p>Feldman, B. (2005) Relative Importance and Value. Manuscript (Version 1.1, March 19 2005), downloadable at <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2255827">https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2255827</a>
</p>
<p>Fox, J. (2002) Bootstrapping regression models. <em>An R and S-PLUS Companion to Applied Regression: A web appendix to the book</em>.  
<a href="https://socialsciences.mcmaster.ca/jfox/Books/Companion-2E/appendix/Appendix-Bootstrapping.pdf">https://socialsciences.mcmaster.ca/jfox/Books/Companion-2E/appendix/Appendix-Bootstrapping.pdf</a>.
</p>
<p>Genizi, A. (1993) Decomposition of R2 in multiple regression with correlated regressors. <em>Statistica Sinica</em> <b>3</b>, 407–420. 
Downloadable at <a href="https://www3.stat.sinica.edu.tw/statistica/password.asp?vol=3&amp;num=2&amp;art=10">https://www3.stat.sinica.edu.tw/statistica/password.asp?vol=3&amp;num=2&amp;art=10</a>
</p>
<p>Groemping, U. (2006) Relative Importance for Linear Regression in R: The Package relaimpo 
<em>Journal of Statistical Software</em> <b>17</b>, Issue 1. 
Downloadable at <a href="https://www.jstatsoft.org/v17/i01">https://www.jstatsoft.org/v17/i01</a>
</p>
<p>Lindeman, R.H., Merenda, P.F. and Gold, R.Z. (1980) <em>Introduction to Bivariate and Multivariate Analysis</em>, Glenview IL: Scott, Foresman.
</p>
<p>Zuber, V. and Strimmer, K. (2010) <em>Variable importance and model selection by decorrelation</em>. Preprint, downloadable at <a href="https://arxiv.org/abs/1007.5516">https://arxiv.org/abs/1007.5516</a>
</p>
<p>Go to <a href="https://prof.bht-berlin.de/groemping/relaimpo/">https://prof.bht-berlin.de/groemping/relaimpo/</a> for further information and references.
</p>


<h3>See Also</h3>

 <p><span class="pkg">relaimpo</span>, <code>calc.relimp</code>, <code>mianalyze.relimp</code>, 
<code>classesmethods.relaimpo</code>  </p>


<h3>Examples</h3>

<pre><code class="language-R">#####################################################################
### Example: relative importance of various socioeconomic indicators 
###          for Fertility in Switzerland
### Fertility is first column of data set swiss
#####################################################################
data(swiss)
   # bootstrapping
       bootswiss &lt;- boot.relimp(swiss, b = 100,  
                type = c("lmg", "last", "first", "pratt"),
                rank = TRUE, diff = TRUE, rela = TRUE)
       # for demonstration purposes only 100 bootstrap replications

       #alternatively, use formula interface
       bootsub &lt;- boot.relimp(Fertility~Education+Catholic+Infant.Mortality, swiss, 
              subset=Catholic&gt;40, b = 100, type = c("lmg", "last", "first", "pratt"),
              rank = TRUE, diff = TRUE)
       # for demonstration purposes only 100 bootstrap replications

   #default output (percentily intervals, as of Version 2 of the package)
    booteval.relimp(bootswiss)
    plot(booteval.relimp(bootswiss))

    #sorted printout, chosen confidence levels, chosen interval method
    #store as object
        result &lt;- booteval.relimp(bootsub, bty="bca", 
              sort = TRUE, level=c(0.8,0.9))
         #because of only 100 bootstrap replications, 
         #default bca intervals produce warnings
    #output driven by print method
        result
    #result plotting with default settings 
    #(largest confidence level, names abbreviated to length 4)
        plot(result)
    #result plotting with modified settings (chosen confidence level, 
    #names abbreviated to chosen length)
        plot(result, level=0.8,names.abbrev=5)
    #result plotting with longer names shown vertically
        par(las=2)
        plot(result, level=0.9,names.abbrev=6)
    #plot does react to options set with par()
    #exceptions: mfrow, mar and oma are set within the plot routine itself

#####################################################################
### Example: bootstrapping clustered data                            
###          data taken from example.lmm of package lmm
### y is change in pulse (heart beats per minute) 
###    15 min (occ 1 to 3) and 90 min (occ 4 to 6) after 
###    treatment with Placebo (occ 1 or 4) low (occ 2 or 5) 
###    or high (occ 3 or 6) dose of marihuana
### each of 9 subjects is observed under most or all 
### of the 6 possible conditions
#####################################################################
## create example data from package lmm
y &lt;- c(16,20,16,20,-6,-4,
    12,24,12,-6,4,-8,
    8,8,26,-4,4,8,
    20,8,20,-4,
    8,4,-8,22,-8,
    10,20,28,-20,-4,-4,
    4,28,24,12,8,18,
    -8,20,24,-3,8,-24,
    20,24,8,12)
occ &lt;- c(1,2,3,4,5,6,
      1,2,3,4,5,6,
      1,2,3,4,5,6,
      1,2,5,6,
      1,2,3,5,6,
      1,2,3,4,5,6,
      1,2,3,4,5,6,
      1,2,3,4,5,6,
      2,3,4,5)
subj &lt;- c(1,1,1,1,1,1,
       2,2,2,2,2,2,
       3,3,3,3,3,3,
       4,4,4,4,
       5,5,5,5,5,
       6,6,6,6,6,6,
       7,7,7,7,7,7,
       8,8,8,8,8,8,
       9,9,9,9)
### manual creation of dummies
### reference category placebo after 90min (occ=4)
dumm1 &lt;- as.numeric(occ==1)
dumm2 &lt;- as.numeric(occ==2)
dumm3 &lt;- as.numeric(occ==3)
dumm5 &lt;- as.numeric(occ==5)
dumm6 &lt;- as.numeric(occ==6)

## create data frame
dat &lt;- data.frame(y,dumm1,dumm2,dumm3,dumm5,dumm6,subj)

### create design with clusters
des &lt;- svydesign(id=~subj,data=dat)

### apply bootstrapping
### using the design with subjects as clusters implies that 
###     clusters are generally kept in or excluded as a whole
### of course, b=100 is too small, only chosen for speed of package creation 
bt &lt;- boot.relimp(y~dumm1+dumm2+dumm3+dumm5+dumm6,data=dat,
   design=des,b=100,type=c("lmg","first","last","betasq","pratt"))

### calculate and display results
booteval.relimp(bt,lev=0.9,nodiff=TRUE)

</code></pre>


</div>