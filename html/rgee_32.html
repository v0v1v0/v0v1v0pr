<div class="container">

<table style="width: 100%;"><tr>
<td>ee_imagecollection_to_local</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Save an EE ImageCollection to the local system.</h2>

<h3>Description</h3>

<p>Save an EE ImageCollection to the local system.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ee_imagecollection_to_local(
  ic,
  region,
  dsn = NULL,
  via = "drive",
  container = "rgee_backup",
  scale = NULL,
  maxPixels = 1e+09,
  lazy = FALSE,
  public = TRUE,
  add_metadata = TRUE,
  timePrefix = TRUE,
  quiet = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ic</code></td>
<td>
<p>ee$ImageCollection to be saved to the system.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>region</code></td>
<td>
<p>EE Geometry (ee$Geometry$Polygon). The
CRS needs to be the same that the <code>ic</code> argument. Otherwise, it will be
forced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dsn</code></td>
<td>
<p>Character. Output filename. If missing, a temporary file will
be created for each image.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>via</code></td>
<td>
<p>Character. Method to export the image. Two methods are available:
"drive", "gcs". See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>container</code></td>
<td>
<p>Character. Name of the folder ('drive') or bucket ('gcs')
to be exported into (ignored if <code>via</code> is not defined as "drive" or
"gcs").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>Numeric. The resolution in meters per pixel. Defaults
to the native resolution of the image.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxPixels</code></td>
<td>
<p>Numeric. The maximum allowable number of pixels in the exported image.
If the exported region covers more pixels than the specified limit in the given projection,
the task will fail. Defaults to 100,000,000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lazy</code></td>
<td>
<p>Logical. If TRUE, a <code>
future::sequential</code> object is created to evaluate the task in the future.
See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>public</code></td>
<td>
<p>Logical. If TRUE, a public link to the image is created.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_metadata</code></td>
<td>
<p>Add metadata to the stars_proxy object. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timePrefix</code></td>
<td>
<p>Logical. Add current date and time (<code>Sys.time()</code>) as
a prefix to export files. This parameter helps to avoid exporting files
with the same name. By default TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>Logical. Suppress info message</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Extra exporting argument. See ee_image_to_drive and</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>ee_imagecollection_to_local</code> supports the download of <code>ee$Images</code>
using two different options: "drive"
(<a href="https://CRAN.R-project.org/package=googledrive">Google Drive</a>) and "gcs"
(<a href="https://CRAN.R-project.org/package=googleCloudStorageR">
Google Cloud Storage</a>). In both cases, <code>ee_imagecollection_to_local</code>
works as follow:
</p>

<ul>
<li>
<p>1. A task  is initiate (i.e., <code>ee$batch$Task$start()</code>) to
transfer the <code>ee$Image</code> from Earth Engine to the intermediate container
specified in the argument <code>via</code>.
</p>
</li>
<li>
<p>2. If the argument <code>lazy</code> is TRUE, the task will not be
monitored. This is useful to lunch several tasks simultaneously and
calls them later using <code>ee_utils_future_value</code> or
<code>future::value</code>. At the end of this step,
the <code>ee$Images</code> are stored on the path specified in the argument
<code>dsn</code>.
</p>
</li>
<li>
<p>3. Finally, if the <code>add_metadata</code>  argument is set to TRUE,
a list containing the following elements will be appended to the <code>dsn</code> argument.
</p>

<ul><li>
<p><b>if via is "drive":</b>
</p>

<ul>
<li>
<p><b>ee_id: </b>Name of the Earth Engine task.
</p>
</li>
<li>
<p><b>drive_name: </b>Name of the Image in Google Drive.
</p>
</li>
<li>
<p><b>drive_id: </b>Id of the Image in Google Drive.
</p>
</li>
<li>
<p><b>drive_download_link: </b>Download link to the image.
</p>
</li>
</ul>
</li></ul>
<ul><li>
<p><b>if via is "gcs":</b>
</p>

<ul>
<li>
<p><b>ee_id: </b>Name of the Earth Engine task.
</p>
</li>
<li>
<p><b>gcs_name: </b>Name of the Image in Google Cloud Storage.
</p>
</li>
<li>
<p><b>gcs_bucket: </b>Name of the bucket.
</p>
</li>
<li>
<p><b>gcs_fileFormat: </b>Format of the image.
</p>
</li>
<li>
<p><b>gcs_public_link: </b>Download link to the image.
</p>
</li>
<li>
<p><b>gcs_URI: </b>gs:// link to the image.
</p>
</li>
</ul>
</li></ul>
</li>
</ul>
<p>For getting more information about exporting data from Earth Engine, take
a look at the
<a href="https://developers.google.com/earth-engine/guides/exporting">Google
Earth Engine Guide - Export data</a>.
</p>


<h3>Value</h3>

<p>If add_metadata is FALSE, <code>ee_imagecollection_to_local</code> will
return a character vector containing the filename of the images downloaded.
Otherwise, if add_metadata is TRUE, will return a list with extra information
related to the exportation (see details).
</p>


<h3>See Also</h3>

<p>Other image download functions: 
<code>ee_as_raster()</code>,
<code>ee_as_rast()</code>,
<code>ee_as_stars()</code>,
<code>ee_as_thumbnail()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
library(rgee)
library(raster)
ee_Initialize(drive = TRUE, gcs = TRUE)

# USDA example
loc &lt;- ee$Geometry$Point(-99.2222, 46.7816)
collection &lt;- ee$ImageCollection('USDA/NAIP/DOQQ')$
  filterBounds(loc)$
  filterDate('2008-01-01', '2020-01-01')$
  filter(ee$Filter$listContains("system:band_names", "N"))

# From ImageCollection to local directory
ee_crs &lt;- collection$first()$projection()$getInfo()$crs
geometry &lt;- collection$first()$geometry(proj = ee_crs)$bounds()
tmp &lt;- tempdir()

## Using drive
# one by once
ic_drive_files_1 &lt;- ee_imagecollection_to_local(
  ic = collection,
  region = geometry,
  scale = 250,
  dsn = file.path(tmp, "drive_")
)

# all at once
ic_drive_files_2 &lt;- ee_imagecollection_to_local(
  ic = collection,
  region = geometry,
  scale = 250,
  lazy = TRUE,
  dsn = file.path(tmp, "drive_")
)

# From Google Drive to client-side
doqq_dsn &lt;- ic_drive_files_2 %&gt;% ee_utils_future_value()
sapply(doqq_dsn, '[[', 1)

## End(Not run)
</code></pre>


</div>