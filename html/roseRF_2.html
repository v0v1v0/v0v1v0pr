<div class="container">

<table style="width: 100%;"><tr>
<td>roseRF_gplm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>ROSE random forest estimator for the generalised partially linear model</h2>

<h3>Description</h3>

<p>Estimates the parameter of interest <code class="reqn">\theta_0</code> in the generalised partially linear model
</p>
<p style="text-align: center;"><code class="reqn">g(\mathbb{E}[Y|X,Z]) = X\theta_0 + f_0(Z),</code>
</p>
<p> for some (strictly increasing, differentiable) link function <code class="reqn">g</code>, which can be reposed in terms of
the ‘nuisance functions’ <code class="reqn">(\mathbb{E}[X|Z], \mathbb{E}[g(\mathbb{E}[Y|X,Z])|Z])</code> as </p>
<p style="text-align: center;"><code class="reqn">g\big(\mathbb{E}[Y|X,Z])-\mathbb{E}[g(\mathbb{E}[Y|X,Z])|Z]\big) = (X-\mathbb{E}[X|Z])\theta_0.</code>
</p>



<h3>Usage</h3>

<pre><code class="language-R">roseRF_gplm(
  y_on_xz_formula,
  y_on_xz_learner,
  y_on_xz_pars = list(),
  Gy_on_z_formula,
  Gy_on_z_learner,
  Gy_on_z_pars = list(),
  x_formula,
  x_learner,
  x_pars = list(),
  M1_formula = x_formula,
  M1_learner = x_learner,
  M1_pars = x_pars,
  M2_formula = NA,
  M2_learner = NA,
  M2_pars = list(),
  M3_formula = NA,
  M3_learner = NA,
  M3_pars = list(),
  M4_formula = NA,
  M4_learner = NA,
  M4_pars = list(),
  M5_formula = NA,
  M5_learner = NA,
  M5_pars = list(),
  link = "identity",
  data,
  K = 5,
  S = 1,
  max.depth = 10,
  num.trees = 500,
  min.node.size = max(10, ceiling(0.01 * (K - 1)/K * nrow(data))),
  replace = TRUE,
  sample.fraction = 0.8
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y_on_xz_formula</code></td>
<td>
<p>a two-sided formula object describing the model for <code class="reqn">\mathbb{E}[Y|X,Z]</code> (regressing <code class="reqn">Y</code> on <code class="reqn">(X)</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y_on_xz_learner</code></td>
<td>
<p>a string specifying the regression method to fit the regression as given by <code>y_on_xz_formula</code> (e.g. <code>randomforest, xgboost, neuralnet, gam</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y_on_xz_pars</code></td>
<td>
<p>a list containing hyperparameters for the <code>y_on_xz_learner</code> chosen. Default is an empty list, which performs hyperparameter tuning.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Gy_on_z_formula</code></td>
<td>
<p>a two-sided formula object describing the model for <code class="reqn">\mathbb{E}[g(\mathbb{E}[Y|X,Z])|Z]</code> (regressing <code class="reqn">g(\hat{E}[Y|X,Z])</code> on <code class="reqn">Z</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Gy_on_z_learner</code></td>
<td>
<p>a string specifying the regression method to fit the regression as given by <code>Gy_on_z_formula</code> (e.g. <code>randomforest, xgboost, neuralnet, gam</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Gy_on_z_pars</code></td>
<td>
<p>a list containing hyperparameters for the <code>Gy_on_z_learner</code> chosen. Default is an empty list, which performs hyperparameter tuning.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x_formula</code></td>
<td>
<p>a two-sided formula object describing the model for <code class="reqn">\mathbb{E}[X|Z]</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x_learner</code></td>
<td>
<p>a string specifying the regression method to fit the regression of <code class="reqn">X</code> on <code class="reqn">Z</code> as given by <code>x_formula</code> (e.g. <code>randomforest, xgboost, neuralnet, gam</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x_pars</code></td>
<td>
<p>a list containing hyperparameters for the <code>x_learner</code> chosen. Default is an empty list, which performs hyperparameter tuning.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M1_formula</code></td>
<td>
<p>a two-sided formula object for the model <code class="reqn">\mathbb{E}[M_1(X)|Z]</code>. Default is <code class="reqn">M_1(X)=X</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M1_learner</code></td>
<td>
<p>a string specifying the regression method for <code class="reqn">\mathbb{E}[M_1(X)|Z]</code> estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M1_pars</code></td>
<td>
<p>a list containing hyperparameters for the <code>M1_learner</code> chosen.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M2_formula</code></td>
<td>
<p>a two-sided formula object for the model <code class="reqn">\mathbb{E}[M_2(X)|Z]</code>. Default is no formula / regression (i.e. <code class="reqn">J=1</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M2_learner</code></td>
<td>
<p>a string specifying the regression method for <code class="reqn">\mathbb{E}[M_2(X)|Z]</code> estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M2_pars</code></td>
<td>
<p>a list containing hyperparameters for the <code>M2_learner</code> chosen.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M3_formula</code></td>
<td>
<p>a two-sided formula object for the model <code class="reqn">\mathbb{E}[M_3(X)|Z]</code>. Default is no formula / regression (i.e. <code class="reqn">J=1</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M3_learner</code></td>
<td>
<p>a string specifying the regression method for <code class="reqn">\mathbb{E}[M_3(X)|Z]</code> estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M3_pars</code></td>
<td>
<p>a list containing hyperparameters for the <code>M3_learner</code> chosen.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M4_formula</code></td>
<td>
<p>a two-sided formula object for the model <code class="reqn">\mathbb{E}[M_4(X)|Z]</code>. Default is no formula / regression (i.e. <code class="reqn">J=1</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M4_learner</code></td>
<td>
<p>a string specifying the regression method for <code class="reqn">\mathbb{E}[M_4(X)|Z]</code> estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M4_pars</code></td>
<td>
<p>a list containing hyperparameters for the <code>M4_learner</code> chosen.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M5_formula</code></td>
<td>
<p>a two-sided formula object for the model <code class="reqn">\mathbb{E}[M_5(X)|Z]</code>. Default is no formula / regression (i.e. <code class="reqn">J=1</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M5_learner</code></td>
<td>
<p>a string specifying the regression method for <code class="reqn">\mathbb{E}[M_5(X)|Z]</code> estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M5_pars</code></td>
<td>
<p>a list containing hyperparameters for the <code>M5_learner</code> chosen.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>link</code></td>
<td>
<p>link function (<code class="reqn">g</code>). Options include <code>identity</code>, <code>log</code>, <code>sqrt</code>, <code>logit</code>, <code>probit</code>. Default is <code>identity</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame containing the variables for the partially linear model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>
<p>the number of folds used for <code class="reqn">K</code>-fold cross-fitting. Default is 5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S</code></td>
<td>
<p>the number of repeats to mitigate the randomness in the estimator on the sample splits used for <code class="reqn">K</code>-fold cross-fitting. Default is 5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.depth</code></td>
<td>
<p>Maximum depth parameter used for ROSE random forests. Default is 5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num.trees</code></td>
<td>
<p>Number of trees used for a single ROSE random forest. Default is 50.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.node.size</code></td>
<td>
<p>Minimum node size of a leaf in each tree. Default is <code>max(10,ceiling(0.01 (K-1)/K nrow(data)))</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>replace</code></td>
<td>
<p>Whether sampling for a single random tree are performed with (bootstrap) or without replacement. Default is <code>TRUE</code> (i.e. bootstrap).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample.fraction</code></td>
<td>
<p>Proportion of data used for each random tree. Default is 0.8.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The estimator of interest <code class="reqn">\theta_0</code> solves the estimating equation
</p>
<p style="text-align: center;"><code class="reqn">\sum_{i}\psi(Y_i,X_i,Z_i; \theta,\hat{\eta}(Z),\hat{w}(Z)) = 0,</code>
</p>

<p style="text-align: center;"><code class="reqn">\psi(Y,X,Z;\theta,\eta_0,w) := \sum_{j=1}^J w_j(Z) \big( M_j(X) - \mathbb{E}[M_j(X)|Z] \big) g'(\mu(X,Z;\theta,\eta_0)) \big(Y-\mu(X,Z;\theta,\eta_0)\big) ,</code>
</p>

<p style="text-align: center;"><code class="reqn">\mu(X,Z;\theta,\eta_0) := g^{-1}\big(\mathbb{E}[g(\mathbb{E}[Y|X,Z])|Z] + (X-\mathbb{E}[X|Z])\theta\big),</code>
</p>

<p style="text-align: center;"><code class="reqn">\eta_0 := \big(\mathbb{E}[Y|Z=\cdot], \mathbb{E}[X|Z=\cdot]\big),</code>
</p>

<p>where <code class="reqn">M_1(X),\ldots,M_J(X)</code> denotes user-chosen functions of <code class="reqn">(X)</code>
and <code class="reqn">w(Z)=\big(w_1(Z),\ldots,w_J(Z)\big)</code> denotes weights estimated via ROSE random forests.
The default takes <code class="reqn">J=1</code> and <code class="reqn">M_1(X)=X</code>; if taking <code class="reqn">J\geq 2</code> we recommend care
in checking the applicability and appropriateness of any additional user-chosen
regression tasks.
</p>
<p>The parameter of interest <code class="reqn">\theta_0</code> is estimated using a DML2 / <code class="reqn">K</code>-fold cross-fitting
framework, to allow for arbitrary (faster than <code class="reqn">n^{1/4}</code>-consistent) learners for <code class="reqn">\hat{\eta}</code> i.e. solving
the estimating equation
</p>
<p style="text-align: center;"><code class="reqn">\sum_{k \in [K]}\sum_{i \in I_k}\psi(Y_i,X_i,Z_i; \theta,\hat{\eta}^{(k)}(Z),\hat{w}^{(k)}(Z)) = 0,</code>
</p>

<p>where <code class="reqn">I_1,\ldots,I_K</code> denotes a partition of the index set for the datapoints <code class="reqn">(Y_i,X_i,Z_i)</code>,
<code class="reqn">\hat{\eta}^{(k)}</code> denotes an estimator for <code class="reqn">\eta_0</code> trained on the data indexed by
<code class="reqn">I_k^c</code>, and <code class="reqn">\hat{w}^{(k)}</code> denotes a ROSE random forest (again trained on the data
indexed by <code class="reqn">I_k^c</code>).
</p>


<h3>Value</h3>

<p>A list containing:
</p>

<dl>
<dt><code>theta</code></dt>
<dd>
<p>The estimator of <code class="reqn">\theta_0</code>.</p>
</dd>
<dt><code>stderror</code></dt>
<dd>
<p>Huber robust estimate of the standard error of the <code class="reqn">\theta_0</code>-estimator.</p>
</dd>
<dt><code>coefficients</code></dt>
<dd>
<p>Table of <code class="reqn">\theta_0</code> coefficient estimator, standard error, z-value and p-value.</p>
</dd>
</dl>
</div>