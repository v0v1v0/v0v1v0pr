<div class="container">

<table style="width: 100%;"><tr>
<td>query_fb_marketing_api</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Query 'Facebook Marketing' API</h2>

<h3>Description</h3>

<p>Query 'Facebook Marketing' API
</p>


<h3>Usage</h3>

<pre><code class="language-R">query_fb_marketing_api(
  location_unit_type,
  lat_lon = NULL,
  radius = NULL,
  radius_unit = NULL,
  location_keys = NULL,
  location_types = c("home", "recent"),
  locales = NULL,
  interests = NULL,
  behaviors = NULL,
  college_years = NULL,
  education_majors = NULL,
  education_schools = NULL,
  education_statuses = NULL,
  family_statuses = NULL,
  income = NULL,
  industries = NULL,
  life_events = NULL,
  relationship_statuses = NULL,
  work_positions = NULL,
  work_employers = NULL,
  excl_interests = NULL,
  excl_behaviors = NULL,
  excl_college_years = NULL,
  excl_education_majors = NULL,
  excl_education_schools = NULL,
  excl_education_statuses = NULL,
  excl_family_statuses = NULL,
  excl_income = NULL,
  excl_industries = NULL,
  excl_life_events = NULL,
  excl_relationship_statuses = NULL,
  excl_work_positions = NULL,
  excl_work_employers = NULL,
  user_os = NULL,
  wireless_carrier = NULL,
  gender = c(1, 2),
  age_min = 18,
  age_max = 65,
  flex_target = NULL,
  version,
  creation_act,
  token,
  sleep_time = 0.1,
  show_result = FALSE,
  verbose = TRUE,
  add_query = FALSE,
  add_query_hide_credentials = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>location_unit_type</code></td>
<td>
<p>Either <code>"coordinates"</code> (for buffer around single point) or type of geographic location, including: <code>"countries"</code>, <code>"regions"</code>, <code>"cities"</code>, <code>"zips"</code>, <code>"places"</code>, <code>"geo_markets"</code>, <code>"electoral_district"</code>, or <code>"country_groups"</code>. See the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/basic-targeting#location">Basic Targetting</a> documentation for more information.
</p>


<h4>——————————</h4>

<p><strong>If location_unit_type is "coordinates"</strong>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat_lon</code></td>
<td>
<p>Coordinates, c(lat, lon). For example, <code>c(38.90, -77.01)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius</code></td>
<td>
<p>Radius around coordinate</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>radius_unit</code></td>
<td>
<p>Unit for radius; either <code>"kilometer"</code> or <code>"mile"</code>
</p>


<h4>——————————</h4>

<p><strong>If location_unit_type is not "coordinates"</strong>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>location_keys</code></td>
<td>
<p>Key associated with location. Use the <code>get_fb_parameter_ids</code> function to get location keys; see <a href="https://worldbank.github.io/rsocialwatcher/articles/rsocialwatcher-vignette.html#location-ids">here</a> for examples.
</p>


<h4>——————————</h4>

<p><strong>Other location parameters</strong>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>location_types</code></td>
<td>
<p>Either: (1) <code>"home"</code> (people whose stated location in Facebook profile "current city" is in an area, valided by IP), (2) <code>"recent"</code> (people whose recent location is in the selected area, determined by mobile device data), (3) <code>"travel_in"</code> (people whose most recent location is in selected area and more than 100 miles from stated current city), (4) <code>c("home", "recent")</code> (for people in either category)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>locales</code></td>
<td>
<p>Locales ID. For more information on locales, see the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/advanced-targeting#additional">Advanced Targeting Documentation</a>
</p>


<h4>——————————</h4>

<p><strong>Parameters:</strong>
</p>

<ul>
<li>
<p> Within parameters, vectors (<code>c()</code>) specify OR conditions and lists (<code>list()</code>) specify AND conditions. For example, <code>interests = c(6003349442621, 6003139266461)</code> will target users who are interested in either entertainment OR movies, while <code>interests = list(6003349442621, 6003139266461)</code> will target users who are interested in either entertainment AND movies.
</p>
</li>
<li>
<p> Across parameters, AND conditions are used. For example, if enter <code>interests = 6003349442621</code> and <code>behaviors = 6008297697383</code> are specified, the function will query Facebook users interested in entertainment AND are frequent travelers.
</p>
</li>
<li>
<p> Or conditions across parameters can be specified using the <code>flex_target</code> argument; see <a href="https://worldbank.github.io/rsocialwatcher/articles/rsocialwatcher-vignette.html#query_data_ids_andor_flex">package documentation</a> for examples.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interests</code></td>
<td>
<p>Interest IDs. For example, <code>interests = c(6003349442621, 6003139266461)</code> will target users who are interested in either entertainment or movies. Use <code>get_fb_parameter_ids(type = "interests", ...)</code> to get dataframe with IDs and descriptions. For more information, see the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/basic-targeting#interests">Basic Targeting Documentation</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>behaviors</code></td>
<td>
<p>Behavior IDs. For example, <code>behaviors = c(6002714895372, 6008297697383)</code> will target users who are either frequent travelers or returned from travels 2 weeks ago. Use <code>get_fb_parameter_ids(type = "behaviors", ...)</code> to get dataframe with IDs and descriptions. For more information, see the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/basic-targeting#behaviors">Basic Targeting Documentation</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>college_years</code></td>
<td>
<p>College graduation years. For example, <code>college_years = c(2014, 2015)</code> will target users who graduated college in 2014 or 2015. For more information, see the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/advanced-targeting#education_and_workplace">Advanced Targeting Documentation</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>education_majors</code></td>
<td>
<p>Education major IDs. For example, <code>education_majors = 123</code> will target users who majored in computer science. Use <code>get_fb_parameter_ids(type = "education_majors", q = "Computer", ...)</code> to get dataframe with IDs and descriptions. For more information, see the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/advanced-targeting#education_and_workplace">Advanced Targeting Documentation</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>education_schools</code></td>
<td>
<p>School IDs. For example, <code>education_schools = 105930651606</code> will taget users at/who graduated from Harvard University. Use <code>get_fb_parameter_ids(type = "education_schools", q = "Harvard", ...)</code> to get dataframe with IDs and descriptions. For more information, see the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/advanced-targeting#education_and_workplace">Advanced Targeting Documentation</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>education_statuses</code></td>
<td>
<p>Education status IDs. For example, <code>education_statuses = c(9,10)</code> will yeild those who report to have either a Master degree or professional degree. Use <code>get_fb_parameter_ids(type = "education_statuses", ...)</code> to get dataframe with IDs and descriptions. For more information, see the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/advanced-targeting#education_and_workplace">Advanced Targeting Documentation</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family_statuses</code></td>
<td>
<p>Family status IDs. For example, <code>family_statuses = c(6023080302983, 6023005681983)</code> targets users who are parents with preteens or parents with teenagers. Use <code>get_fb_parameter_ids(type = "family_statuses")</code> to get dataframe with IDs and descriptions. For more information, see the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/advanced-targeting#demographic">Advanced Targeting Documentation</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>income</code></td>
<td>
<p>Income IDs. For example, <code>income = c(6107813553183, 6107813554583)</code> targets users with a household income in the top 10%-25% or 25%-50% of ZIP codes (US). Use <code>get_fb_parameter_ids(type = "income")</code> to get dataframe with IDs and descriptions. For more information, see the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/advanced-targeting#demographic">Advanced Targeting Documentation</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>industries</code></td>
<td>
<p>Industries IDs. For example, <code>industries = c(6008888980183, 6008888972183)</code> targets users who work in sales or legal services. Use <code>get_fb_parameter_ids(type = "industries")</code> to get dataframe with IDs and descriptions. For more information, see the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/advanced-targeting#demographic">Advanced Targeting Documentation</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>life_events</code></td>
<td>
<p>Life event IDs. For example, <code>life_events = c(6005149512172, 6005149512172)</code> targets users who recently moved or are in a new job. Use <code>get_fb_parameter_ids(type = "life_events")</code> to get dataframe with IDs and descriptions. For more information, see the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/advanced-targeting#demographic">Advanced Targeting Documentation</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>relationship_statuses</code></td>
<td>
<p>Relationship status IDs. For example, <code>relationship_statuses = c(3,4)</code> targets those who are married or engaged. Use <code>get_fb_parameter_ids(type = "relationship_statuses")</code> to get dataframe with IDs and descriptions. For more information, see the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/advanced-targeting#demographic">Advanced Targeting Documentation</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>work_positions</code></td>
<td>
<p>Work position IDs. For example, <code>work_positions = 105763692790962</code> will target users who indicate they are contractors. Use <code>get_fb_parameter_ids(type = "work_positions", ...)</code> to get dataframe with IDs and descriptions. For more information, see the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/advanced-targeting#education_and_workplace">Advanced Targeting Documentation</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>work_employers</code></td>
<td>
<p>Work employer IDs. For example, <code>work_employers = 50431654</code> will target users who work for Microsoft. Use <code>get_fb_parameter_ids(type = "work_employers", ...)</code> to get dataframe with IDs and descriptions. For more information, see the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/advanced-targeting#education_and_workplace">Advanced Targeting Documentation</a>.
</p>


<h4>——————————</h4>

<p><strong>Exlcude Facebook users from query by select parameters</strong>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excl_interests</code></td>
<td>
<p>Interest IDs to exclude.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excl_behaviors</code></td>
<td>
<p>Behavior IDs to exclude.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excl_college_years</code></td>
<td>
<p>Colleage year IDs to exclude.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excl_education_majors</code></td>
<td>
<p>Education major IDs to exclude.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excl_education_schools</code></td>
<td>
<p>Education school IDs to exclude.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excl_education_statuses</code></td>
<td>
<p>Education status IDs to exclude.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excl_family_statuses</code></td>
<td>
<p>Family status IDs to exclude.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excl_income</code></td>
<td>
<p>Income IDs to exclude.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excl_industries</code></td>
<td>
<p>Industry IDs to exclude.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excl_life_events</code></td>
<td>
<p>Life event IDs to exclude.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excl_relationship_statuses</code></td>
<td>
<p>Relationship status IDs to exclude.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excl_work_positions</code></td>
<td>
<p>Work position IDs to exclude.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excl_work_employers</code></td>
<td>
<p>Work employer IDs to exclude.
</p>


<h4>——————————</h4>

<p><strong>Non-Flexible parameters:</strong>
</p>

<ul>
<li>
<p> Across parameters, AND conditions are used. For example, if <code>gender = 1</code> and <code>age_min = 30</code>, queries users that are male AND are over 30 years old.
</p>
</li>
<li>
<p> These parameters <em>cannot</em> be specified in <code>flex_targeting</code>
</p>
</li>
<li>
<p> Within parameters, vectors (<code>c()</code>) specify OR conditions. AND conditions cannot be specified within these parameters.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>user_os</code></td>
<td>
<p>User operating systems. For example, <code style="white-space: pre;">⁠user_os = ('iOS', 'Android')⁠</code> targets those that use either an iOS or Android OS; <code>user_os = c("Android_ver_4.2_and_above")</code> targets those using Android version 4.2 and above; and <code>user_os = c("iOS_ver_8.0_to_9.0")</code> targets those using iOS version 8.0 to 9.0. Different versions can be specified. For more information, see the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/advanced-targeting#demographic">Advanced Targeting Documentation</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wireless_carrier</code></td>
<td>
<p>Wireless carrier. If set to <code>Wifi</code>, then targets those connecting via a Wifi network. For more information, see the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/advanced-targeting#demographic">Advanced Targeting Documentation</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gender</code></td>
<td>
<p>Genders to target; 1 targets males and 2 targets females. Default is both. See <code>gender</code> in the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/basic-targeting#demographics">Basic Targeting Documentation</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>age_min</code></td>
<td>
<p>Minimum age. Default is 18. See <code>age_min</code> in the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/basic-targeting#demographics">Basic Targeting Documentation</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>age_max</code></td>
<td>
<p>Maximum age. Default is 65. See <code>age_max</code> in the <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/basic-targeting#demographics">Basic Targeting Documentation</a>.
</p>


<h4>——————————</h4>

<p><strong>Flex targeting parameters</strong>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flex_target</code></td>
<td>
<p>Flexible targeting allows for more complicated parameter specifications. For example, specifying OR conditions across parameter types (eg, behaviors, interests, etc). For information on how to use flexible targeting, see <a href="https://worldbank.github.io/rsocialwatcher/articles/rsocialwatcher-vignette.html#across-parameter-types-flexible-targetting">the documentation here</a>.
</p>


<h4>——————————</h4>

<p><strong>Parameters for credentials</strong>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>version</code></td>
<td>
<p>API version. e.g., "v19.0"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>creation_act</code></td>
<td>
<p>Facebook creation act</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>token</code></td>
<td>
<p>Facebook API token
</p>


<h4>——————————</h4>

<p><strong>Scraping parameters</strong>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sleep_time</code></td>
<td>
<p>How much time (in seconds) to pause between each query (default: <code>0.1</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_result</code></td>
<td>
<p>After each query, whether to print the number of monthly active users (default: <code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Display messages that indicate the function is pausing before making additional queries. Pausing can result from API key rate limits or no internet (default: <code>TRUE</code>).
</p>


<h4>——————————</h4>

<p><strong>Return query text</strong>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_query</code></td>
<td>
<p>If <code>TRUE</code>, add query text as variable in returned dataframe</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_query_hide_credentials</code></td>
<td>
<p>If <code>TRUE</code> (and <code>add_query</code> is <code>TRUE</code>), hide the <code>creation_act</code> and <code>token</code> from the query text returned in the dataframe</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Dataframe that includes (1) daily and monthly active users and (2) parameter values
</p>


<h3>See Also</h3>

<p><code>get_fb_parameter_ids()</code> To get IDs and descriptions for behaviors, demographics, interests, and locales. For additional details on how to use the package, see <a href="https://worldbank.github.io/rsocialwatcher/articles/rsocialwatcher-vignette.html">the documentation here</a>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
#### Define version, creation act, and token
VERSION = "enter-version"
CREATION_ACT = "creation_act"
TOKEN = "enter-token"

#### Query data
## All Facebook users in US
query_fb_marketing_api(
location_unit_type = "countries",
location_keys      = "US",
version            = VERSION, 
creation_act       = CREATION_ACT, 
token              = TOKEN)

## All Facebook users in US with interest in concernts
concert_id &lt;- get_fb_parameter_ids(type = "interests", version = VERSION, token = TOKEN) %&gt;% 
  filter(name == "Concerts (music event)") %&gt;%
  pull(id) 

query_fb_marketing_api(
  location_unit_type = "countries",
  location_keys      = "US",
  interests          = concert_id,
  version            = VERSION, 
  creation_act       = CREATION_ACT, 
  token              = TOKEN)



## End(Not run)
</code></pre>


</div>