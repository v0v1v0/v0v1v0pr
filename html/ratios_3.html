<div class="container">

<table style="width: 100%;"><tr>
<td>Correction.AdheringParticles</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Correction.AdheringParticles</h2>

<h3>Description</h3>

<p>Suppose element data of one data set (DT1) are biased because the concentrations are the result of a mixture of two substances, of which one substance are the element concentrations of DT2.
In order to correct DT1 to <code class="reqn">DT_{corrected}</code> a fraction of DT2 has to be subtracted from DT1.
The basic equation for the correction is:
</p>
<p style="text-align: center;"><code class="reqn">
DT_{corrected}=\frac{DT1 - x * DT2}{1 - x}
</code>
</p>

<p>whereof <em>x</em> is the amount of DT2 to be subtracted.
</p>
<p>The function is written for the case that <em>x</em> is unknown.
To calculate <em>x</em> the condition is that in <code class="reqn">DT_{corrected}</code> at least one element concentration is zero or known.
Suppose <code class="reqn">vars_{i}</code> has a very low concentration, close to zero, in <code class="reqn">DT_{corrected}</code>: <code class="reqn">DT_{corrected}[vars_{i}]=0</code>, then:
</p>
<p style="text-align: center;"><code class="reqn">
x =  \frac{DT1[vars_{i}]}{DT2[vars_{i}]}
</code>
</p>

<p>The function was developed for the use to correct plant concentrations for adhering particles:
Exact and reproducible analysis of element concentrations in plant tissue is the basis for many research fields such as environmental, health, phytomining, agricultural or provenance studies.
Unfortunately plant samples collected in the field will always contain particles on their tissue surfaces such as airborne dust or soil particles.
If not removed these particles may induce a bias to the element concentrations measured in plant samples.
</p>
<p>For full description of the calculations and the background of correction plants for adhering particles please refer to:
</p>
<p>Pospiech, S., Fahlbusch, W., Sauer, B., Pasold, T., &amp; Ruppert, H. (2017). Alteration of trace element concentrations in plants by adhering particles–Methods of correction. <em>Chemosphere, 182, 501-508</em>.
and the section Details.
</p>


<h3>Usage</h3>

<pre><code class="language-R">Correction.AdheringParticles(DT1, DT2 = NULL, vars = NULL,
  vars_ignore = c("As", "Se", "Sn", "V", "Be", "Ge", "Pt"), method, element,
  id.vars, group1.vars, group2.vars, var_subgroup, offset = 0,
  use_only_DT2 = TRUE, DT2_replace = NULL, Errors = TRUE,
  return_as_list = TRUE, negative_values = FALSE,
  set_statistical_0 = FALSE, Error_method = "gauss", STD_DT1 = STD_Plant,
  STD_DT2 = STD_Soil, minNr_DT1 = 100, minNr_DT2 = 100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>DT1</code></td>
<td>
<p>data.frame or data.table, samples in rows and variables in columns</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>DT2</code></td>
<td>
<p>data.frame or data.table, samples in rows and variables in columns.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vars</code></td>
<td>
<p>optional, character vector of column names of DT1 and DT2, default is function <code>select.VarsElements</code>.
Please make sure the columns given in <code>vars</code> are of class numeric.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vars_ignore</code></td>
<td>
<p>character vector of column names, only for 'method 3'.
These variables are ignored for calculating the median of amount of DT2 (<em>x</em>) in 'method 3'.
Please note: the functions returns corrected values for these columns because they are only ignored for calculating the median of <em>x</em>.
Default is "As", "Se", "Sn", "V", "Be", "Ge" and "Pt". Please see Details for further explanation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>characters (no character vector!, please give m3 instead of "m3") denoting the method. Options are <em>m1</em>, <em>m2</em> and <em>m3</em> and <em>subtr</em>.
Default is m3. Please see details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>element</code></td>
<td>
<p>string, only for method 1. Denotes the column with which amount of DT2 (<em>x</em>) is to be calculated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id.vars</code></td>
<td>
<p>column with unique (!) entries for each row. Class can be integer (corresponding row numbers) or character (e.g. sample IDs).
If missing, all columns but <code>vars</code> will be assigned to it.
Please note: Function is faster and more stable if <code>id.vars</code> is provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group1.vars</code></td>
<td>
<p>character vector, column name(s) for subsetting DT1 and DT2</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group2.vars</code></td>
<td>
<p>optional, column name for subsetting DT1 and DT2 if some entries in <code>group1.vars</code> are empty.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var_subgroup</code></td>
<td>
<p>optional, character vector of one column name of DT1. This option affects the only the error calculation, hence it is ignored if <code>Errors</code> is set to FALSE.
If provided, DT1 is split into subsets by <code>group1.vars</code> <em>and</em> 'var_subgroup' and the error will calculated for each of these subset.
Please read in the Details for further information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>numeric, default is 0. The offset diminishes the subtracted amount of DT2 <em>x</em>: x = x - offset.
If used with m2 all concentrations will stay &gt; 0.
Reasonable offset is e.g. offset = 0.0001</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_only_DT2</code></td>
<td>
<p>logical, default is FALSE. If there are not enough DT2 data of the location should the DT2s of the region be used? If the <code>use_only_DT2</code> is set to FALSE then the Upper Crust is used for the correction.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>DT2_replace</code></td>
<td>
<p>optional, if a DT1 sample does not have DT2 data of the corresponding location with this option you can define which data you would like to use as DT2.
Default is the build-in data set UpperCrust (geochemical composition of the earth's upper crust).
If you would like to have something else, please provide a named vector/ one-row data.table with values used instead of DT2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Errors</code></td>
<td>
<p>logical, should absolute errors get calculated appended to the list - output? Default is FALSE.
If Errors are set to TRUE it overrides the option <code>return_as_list</code> and always returns a list.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return_as_list</code></td>
<td>
<p>logical, should the result get returned as list? Default is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>negative_values</code></td>
<td>
<p>logical, should negative values be returned? If set to FALSE negative values are set to 0. Default is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>set_statistical_0</code></td>
<td>
<p>logical, only for method 3.
Should all values of the variables contributing to the median of <em>x</em> be set to 0? Default is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Error_method</code></td>
<td>
<p>method with which the error should be calculated. At the moment you can choose between "gauss" (default) and "biggest".
See Details for explanation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>STD_DT1</code></td>
<td>
<p>optional, data.frame or data.table object for calculating errors for DT1, e.g. the standards. Please see Details. If left empty a default of 5.2% relative error is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>STD_DT2</code></td>
<td>
<p>optional, data.frame or data.table object for calculating errors for DT2, e.g. the standards. Please see Details. If left empty a default of 5.2% relative error is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minNr_DT1</code></td>
<td>
<p>minimum numbers of samples/observations in DT1 for calculating a relative error of observations.
If the number of observations of DT1 is smaller than <code>minNr_DT1</code> the error is calculated via the data set <code>STD_DT1</code>.
Default is 50.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minNr_DT2</code></td>
<td>
<p>minimum numbers of samples/observations in DT2 for calculating a relative error of observations.
If the number of observations of DT1 is smaller than <code>minNr_DT2</code> the error is calculated via the data set <code>STD_DT2</code>.
Default is 50.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The main option of this function is the <code>method</code> which determines how the amount of DT2 to be subtracted, the <em>x</em>, is going to be calculated.
There are four options:
</p>

<ul>
<li>
<p> Method 1: calculate <em>x</em> via a fixed element
</p>
</li>
<li>
<p> Method 2: calculate <em>x</em> via the element with the smallest ratio between DT1[vars] and DT2[vars]
</p>
</li>
<li>
<p> Method 3: calculate <em>x</em> via the median of several, very small ratios between DT1[vars] and DT2[vars]
</p>
</li>
<li>
<p> Method subtr: calculate the concentrations for <code class="reqn">x * DT2[vars]</code>
</p>
</li>
</ul>
<p>To Method 1:
For example using Ti as <code>element</code> <code class="reqn">DT_{corrected}</code> is calculated with <code class="reqn"> x = DT1[Ti]/DT2[Ti]</code>.
Typical elements for the option <code>element</code> are e.g. Ti, Al, Zr, Sc, ...
This will eventually lead to negative concentrations for some elements.
</p>
<p>To Method 2:
This method subtracts the smallest possible content of DT2 from DT1 (smallest <em>x</em>).
For each row/sample the element with the smallest <em>x</em> of all ratios <code class="reqn"> x = DT1[vars]/DT2[vars]</code> of each sample is taken as <em>element</em>,
hence every sample is corrected based on a different <em>element</em>.
With this method there are no negative concentrations.
</p>
<p>To Method 3:
In order to reduce the uncertainty of the content of DT2 in DT1 (<em>x</em>) based on only one element as in method 1 and 2 an average of several <em>x</em> of elements can be calculated.
With <code class="reqn">\Delta x</code> being the absolute error of <em>x</em> the median is calculated by all <em>x</em> of elements which values <code class="reqn"> x - \Delta x</code> are smaller than <code class="reqn"> x_{smallest} + \Delta x_{smallest}</code>.
The value of the median <code class="reqn">\bar{x}</code> is then used as <em>x</em>.
This will eventually lead to negative concentrations for some elements.
Because statistically the <em>x</em> of all elements, which error overlaps the error of the element with smallest <em>x</em>, are indistinguishable we suggest to set all elements contributing to <code class="reqn">\bar{x}</code> to zero, because these small values should not be interpreted:
Set option <code>set_statistical_0</code> to TRUE.
</p>
<p>It is advisable to exclude elements with a huge error margin in the option <code>vars_ignore</code> because they could severely increase the median <code class="reqn">\bar{x}</code> by "opening" the window of error-ranges for many elements with significantly higher ratios.
This could lead to an unnatural high median <code class="reqn">\bar{x}</code> resulting into an overcorrection.
</p>
<p>If option <code>id.vars</code> is provided the functions prints the 'group1.vars' and 'id.vars' of the sample.
</p>
<p>For examples and more information please refer to:
Pospiech, S., Fahlbusch, W., Sauer, B., Pasold, T., &amp; Ruppert, H. (2017). Alteration of trace element concentrations in plants by adhering particles–Methods of correction. <em>Chemosphere, 182, 501-508</em>.
</p>


<h3>Value</h3>

<p>data.frame (or data.table if DT1 is data.table) according to <code>method</code>.
</p>


<h3>Author(s)</h3>

<p>Solveig Pospiech
</p>


<h3>See Also</h3>

<p>Other ratio functions: <code>preparationDT2</code>,
<code>ratioDT</code>,
<code>ratio_append_smallest</code>
</p>


</div>