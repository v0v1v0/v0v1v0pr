<div class="container">

<table style="width: 100%;"><tr>
<td>late.regu.path</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Model-assisted inference for local average treatment effects along regularization paths</h2>

<h3>Description</h3>

<p>This function implements model-assisted inference for local average treatment effects (LATEs) using regularized calibrated estimation along regularization paths for instrument propensity score (IPS) estimation, 
while based on cross validation for the treatment and outcome regressions.
</p>


<h3>Usage</h3>

<pre><code class="language-R">late.regu.path(fold, nrho = NULL, rho.seq = NULL, y, tr, iv, fx, gx, hx,
  arm = 2, d1 = NULL, d2 = NULL, ploss = "cal", yloss = "gaus",
  off = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fold</code></td>
<td>
<p>A vector of length 3, with the second and third components giving the fold number for cross validation in the treatment and outcome regressions respectively. The first component is not used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrho</code></td>
<td>
<p>A vector of length 3 giving the number of tuning parameters in a regularization path for IPS estimation and that in cross validation for the treatment and outcome regressions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho.seq</code></td>
<td>
<p>A list of two vectors giving the tuning parameters for IPS estimation (first vector), treatment (second vector) and outcome (third vector) regressions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>An <code class="reqn">n</code> x <code class="reqn">1</code> vector of observed outcomes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tr</code></td>
<td>
<p>An <code class="reqn">n</code> x <code class="reqn">1</code> vector of treatment indicators (=1 if treated or 0 if untreated).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iv</code></td>
<td>
<p>An <code class="reqn">n</code> x <code class="reqn">1</code> vector of instruments (0 or 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fx</code></td>
<td>
<p>An <code class="reqn">n</code> x <code class="reqn">p</code> matix of covariates, used in the instrument propensity score model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gx</code></td>
<td>
<p>An <code class="reqn">n</code> x <code class="reqn">q_1</code> matix of covariates, used in the treatment regression models. In theory, <code>gx</code> should be a subvector of <code>gx</code>, hence <code class="reqn">p\leq q_1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hx</code></td>
<td>
<p>An <code class="reqn">n</code> x <code class="reqn">q_2</code> matix of covariates, used in the outcome regression models. In theory, <code>hx</code> should be a subvector of <code>gx</code>, hence <code class="reqn">p\leq q_2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>arm</code></td>
<td>
<p>An integer 0, 1 or 2 indicating whether <code class="reqn">\theta_0</code>, <code class="reqn">\theta_1</code> or both are computed; see <strong>Details</strong> for <code>late.aipw</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d1</code></td>
<td>
<p>Degree of truncated polynomials of fitted values from treatment regression to be included as regressors in the outcome regression (NULL: no adjustment, 0: piecewise constant, 1: piecewise linear etc.).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d2</code></td>
<td>
<p>Number of knots of fitted values from treatment regression to be included as regressors in the outcome regression, with knots specified as the <code class="reqn">i</code>/(<code>d2</code>+1)-quantiles for <code class="reqn">i</code>=1,...,<code>d2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ploss</code></td>
<td>
<p>A loss function used in instrument propensity score estimation (either "ml" for likelihood estimation or "cal" for calibrated estimation).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yloss</code></td>
<td>
<p>A loss function used in outcome regression (either "gaus" for continuous outcomes or "ml" for binary outcomes).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>off</code></td>
<td>
<p>A <code class="reqn">2</code> x <code class="reqn">1</code> vector of offset values (e.g., the true values in simulations) used to calculate the z-statistics from augmented IPW estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to <code>glm.regu.cv</code> and <code>glm.regu.path</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ips</code></td>
<td>
<p>A list of 2 objects, giving the results from fitting the IPS models by <code>glm.regu.path</code> for <code>iv</code>=0 (first) and <code>iv</code>=1 (second).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mfp</code></td>
<td>
<p>A list of 2 matrices of fitted instrument propensity scores, along the IPS regularization path, for <code>iv</code>=0 (first matrix) and <code>iv</code>=1 (second matrix).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tps</code></td>
<td>
<p>A list of 2 lists of objects for <code>iv</code>=0 (first) and <code>iv</code>=1 (second), where each object gives the results from fitting the treatment regression models by <code>glm.regu.cv</code> for an IPS tuning parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mft</code></td>
<td>
<p>A list of 2 matrices of fitted treatment regression models based on cross validation, along the IPS regularization path, for <code>iv</code>=0 (first matrix) and <code>iv</code>=1 (second matrix).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>or</code></td>
<td>
<p>A list of 4 lists of objects for <code>iv</code>=0, <code>tr</code>=0 (first), <code>iv</code>=0, <code>tr</code>=1 (second), <code>iv</code>=1, <code>tr</code>=0 (third) and  <code>iv</code>=1, <code>tr</code>=1 (fourth), containing the results from fitting the outcome regression models by <code>glm.regu.cv</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mfo</code></td>
<td>
<p>A list of 4 matrices of fitted outcome regression models based on cross validation, along the IPS regularization path, for <code>iv</code>=0, <code>tr</code>=0 (first), <code>iv</code>=0, <code>tr</code>=1 (second), <code>iv</code>=1, <code>tr</code>=0 (third) and  <code>iv</code>=1, <code>tr</code>=1 (fourth). Two matrices are set to <code>NA</code> if <code>arm</code>=0 or 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est</code></td>
<td>
<p>A list containing the results from augmented IPW estimation by <code>late.aipw</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>A vector of tuning parameters leading to converged results in IPS estimation.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Sun, B. and Tan, Z. (2020) High-dimensional model-assisted inference for local average treatment effects with instrumental variables, arXiv:2009.09286.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
data(simu.iv.data)
n &lt;- dim(simu.iv.data)[1]
p &lt;- dim(simu.iv.data)[2]-3

y &lt;- simu.iv.data[,1]
tr &lt;- simu.iv.data[,2]
iv &lt;- simu.iv.data[,3]
x &lt;- simu.iv.data[,3+1:p]
x &lt;- scale(x)


late.path.rcal &lt;- late.regu.path(fold=5*c(0,1,1), nrho=(1+10)*c(1,1,1), rho.seq=NULL,
                   y, tr, iv, fx=x, gx=x, hx=x, arm=2, d1=1, d2=3, ploss="cal", yloss="gaus")


late.path.rcal$est


</code></pre>


</div>