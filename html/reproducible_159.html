<div class="container">

<table style="width: 100%;"><tr>
<td>movedCache</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Deal with moved cache issues</h2>

<h3>Description</h3>

<p>If a user manually copies a complete Cache folder (including the db file and rasters folder),
there are issues that must be addressed, depending on the Cache backend used.
If using DBI (e.g., RSQLite or Postgres), the db table must be renamed. Run
this function after a manual copy of a cache folder. See examples for one way to do that.
</p>


<h3>Usage</h3>

<pre><code class="language-R">movedCache(
  new,
  old,
  drv = getDrv(getOption("reproducible.drv", NULL)),
  conn = getOption("reproducible.conn", NULL),
  verbose = getOption("reproducible.verbose")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>new</code></td>
<td>
<p>Either the path of the new <code>cachePath</code> where the cache was moved or copied to, or
the new DB Table Name</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>old</code></td>
<td>
<p>Optional, if there is only one table in the <code>new</code> cache path.
Either the path of the previous <code>cachePath</code> where the cache was moved or copied from, or
the old DB Table Name</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>drv</code></td>
<td>
<p>if using a database backend, drv must be an object that
inherits from DBIDriver e.g., from package RSQLite, e.g., SQLite</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conn</code></td>
<td>
<p>an optional DBIConnection object, as returned by dbConnect().</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Numeric, -1 silent (where possible), 0 being very quiet,
1 showing more messaging, 2 being more messaging, etc.
Default is 1. Above 3 will output much more information about the internals of
Caching, which may help diagnose Caching challenges. Can set globally with an
option, e.g., <code style="white-space: pre;">⁠options('reproducible.verbose' = 0) to reduce to minimal⁠</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>When the backend database for a <code>reproducinle</code> cache is an SQL database, the files
on disk cannot be copied manually to a new location because they contain internal
tables. Because <code>reproducible</code> gives the main table a name based on the <code>cachePath</code>
path, calls to <code>Cache</code> will attempt to call this internally if it detects a
name mismatch.
</p>


<h3>Value</h3>

<p><code>movedCache</code> does not return anything; it is called for its side effects.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data.table::setDTthreads(2)
tmpdir &lt;- "tmpdir"
tmpCache &lt;- "tmpCache"
tmpCacheDir &lt;- normalizePath(file.path(tempdir(), tmpCache), mustWork = FALSE)
tmpdirPath &lt;- normalizePath(file.path(tempdir(), tmpdir), mustWork = FALSE)
bb &lt;- Cache(rnorm, 1, cachePath = tmpCacheDir)

# Copy all files from tmpCache to tmpdir
froms &lt;- normalizePath(dir(tmpCacheDir, recursive = TRUE, full.names = TRUE),
  mustWork = FALSE
)
dir.create(file.path(tmpdirPath, "rasters"), recursive = TRUE, showWarnings = FALSE)
dir.create(file.path(tmpdirPath, "cacheOutputs"), recursive = TRUE, showWarnings = FALSE)
file.copy(
  from = froms, overwrite = TRUE,
  to = gsub(tmpCache, tmpdir, froms)
)

# Can use 'movedCache' to update the database table, though will generally
#   happen automatically, with message indicating so
movedCache(new = tmpdirPath, old = tmpCacheDir)
bb &lt;- Cache(rnorm, 1, cachePath = tmpdirPath) # should recover the previous call

</code></pre>


</div>