<div class="container">

<table style="width: 100%;"><tr>
<td>hist_tad</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Time-at-Depth histogram
</h2>

<h3>Description</h3>

<p>generates daily or back-to-back (e.g. Day-vs-Night-) Time-at-Depth histograms from binned depth or depth time series data
</p>


<h3>Usage</h3>

<pre><code class="language-R">hist_tad(df, 
            bin_breaks=NULL, bin_prefix="Bin", 
            select_id, select_from='Ptt', aggregate_by='Ptt',
            date, min_perc,
            main, xlab='Time at Depth (%)', ylab="Depth (m)", labeling=TRUE,
            xlim=c(0, 100), adaptive.xlim=FALSE, 
            split_by=NULL, split_levels, xlab2=split_levels, 
            ylab.side=2, ylab.line, ylab.font=1,
            xlab.side=3, xlab.line=2.5, xlab.font=1,
            xlab2.side=1, xlab2.line=1, xlab2.font=2,
            main.side=3, main.line=3.8, main.font=1,
            col=c("darkgrey", "white"),
            xticks, ylabels,
            do_mid.ticks=TRUE, yaxis.pos=0, 
            mars, space=0,
            plot_sd=TRUE, plot_se, plot_nrec=TRUE, plot_ntags=TRUE,
            cex=1.2, cex.main=cex, cex.lab=cex, cex.inf=cex.axis,cex.axis=1, 
            return.sm=FALSE, 
            subplot=FALSE, inside=FALSE,Type="TAD")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>dataframe that either contains depth time series data (as a vector "Depth") or several vectors of Time-at-Depth frequencies. In the latter case, column names composed of a common <code>bin_prefix</code> (default is "Bin.") hold the pre-binned Time-at-Depth frequencies whose depth limits are defined in <code>bin_breaks</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bin_breaks, bin_prefix</code></td>
<td>

<p><code>bin_breaks</code> is a numeric vector of depth bin breaks for the histogram data. In case of binned data (e.g. from standard wildlife computer histogram files), column names with a <code>bin_prefix</code> are expected to contain the preprossesed data (by default: Bin1, Bin2, Bin3, etc.). Alternatively, depth time series data will be directly converted using function ts2histos.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>select_id, select_from</code></td>
<td>

<p>these arguments allow to take a direct subset of the input dataframe. <code>select_from</code> defines the vector whereas <code>select_id</code> defines the identification key(s) that should be selected.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aggregate_by</code></td>
<td>

<p>character vector defining the columns by which the tagging data should be aggregated. Should contain columns that identify tags (e.g. Serial, Ptt, DeployID) the date and/or day time period (to seperate records from night, day, dawn and dusk see classify_DayTime). Default values are: date, Day and Ptt.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>date</code></td>
<td>

<p>An optional vector to select depth data of a specified date/-range.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_perc</code></td>
<td>

<p>optional number, defining the minimum data coverage (in percent) of histogram entries obtained from depth time series data.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main, xlab, ylab, labeling</code></td>
<td>

<p>The titles for the plot, x- and y-axes to be plotted if <code>labeling</code> is set <code>TRUE</code> (default).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlim, adaptive.xlim</code></td>
<td>

<p>a vector defining the limits (x1,x2) of the x-axis, by default c(0,100). However, if <code>adaptive.xlim</code> is set <code>TRUE</code>, these limits will be overwritten, and the maximum value (xlim[2]) will be chosen from the histogram data.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>split_by</code></td>
<td>

<p>Name of the logical vector by which TaD data should be splitted (e.g. daytime; see classify_DayTime).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>split_levels, xlab2</code></td>
<td>

<p>Character vector defining the name and order of the levels of the split_by vector (e.g. c("Night", "Day") for split_by vector 'day.time'. The same groups are plotted as a second x-axis label if not defined otherwise (<code>xlab2</code>=<code>split_levels</code>). 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab.side, ylab.line, ylab.font</code></td>
<td>

<p>side, line and font of second y-axis label.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab.side, xlab.line, xlab.font</code></td>
<td>

<p>side, line and font of first x-axis label.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab2.side, xlab2.line, xlab2.font</code></td>
<td>

<p>side, line and font of second x-axis labels.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main.side, main.line, main.font</code></td>
<td>

<p>side, line and font of plot title.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>

<p>colours to be used for the TaD-histogram, by default 'grey' and 'white' (corresponding to the values of split_by/split_levels).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xticks, ylabels</code></td>
<td>

<p>tick labels of the x-axis and ylabels of the y-axis to show in the plot.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do_mid.ticks</code></td>
<td>

<p>whether centered tick-labels, indicating the depth range of histogram cells, shall be plotted (by default <code>FALSE</code>). Alternatively, tick labels will be indicated at the breakpoints of the histrogram cells.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yaxis.pos</code></td>
<td>

<p>x-axis coordinate at which the y-axis should be plotted (by default xlim[1], and thus 0).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mars</code></td>
<td>

<p>a numerical vector of the form <code>c(bottom, left, top, right)</code>, decribing the number of margin lines to be specified on the each side of the plot. The default is <code>c(2.1, 4.1, 6.1, 2.1)</code>. In case that <code>do_mid.ticks</code> is <code>TRUE</code> margins are: <code>c(2.1, 8, 6.1, 2.1)</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>space</code></td>
<td>

<p>the space between the histogram bars.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot_sd, plot_se, plot_nrec , plot_ntags</code></td>
<td>

<p>whether standard deviation or standard error bars, the number of records and tags shall be plotted (default is <code>TRUE</code>) inside the TaD/TaT histogram. (if plot_se is <code>TRUE</code>, plot_sd will be overwritten!).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex, cex.main, cex.lab, cex.inf, cex.axis</code></td>
<td>

<p>font size of the title (<code>cex.main</code>), x- and y-axes labels (<code>cex.lab</code>), other labels, like the number of records (<code>cex.inf</code>) as well as of the tick marks.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.sm</code></td>
<td>

<p>whether summary information of the TaD histograms, including the number of records per summary period, the relative frequencies per bin and corresponding standard deviation, should be plotted (default is <code>TRUE</code>).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subplot, inside</code></td>
<td>

<p>whether the TaD histogram is a subplot or an inner plot of a figure (default is <code>FALSE</code>). 
If <code>subplot</code> or <code>inside</code> are set <code>TRUE</code>, graphic margins will not be set by <code>hist_tad</code>.
In case that <code>inside</code> is <code>TRUE</code>, no axis-labels and titels wil be plotted.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Type</code></td>
<td>

<p>The Type of data to be plotted (<code>TAD</code>: Time-at-Depth histograms; <code>TAT</code>: Time-at-Temperature histograms)
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Time-at-Temperature (Tat) and Time-at-Depth (TaD) fequencies are a standard data product of archival tags (incl. tag models TDR-Mk9, PAT-Mk10 and miniPAT by <a href="https://wildlifecomputers.com/">Wildlife Computers</a>) that allow to assess habitat preferences of tagged animals (see function read_histos).  It can be likewise generated from transmitted or recovered time series data sets using function ts2histos. 
</p>
<p>However, different depth and temperature bin breaks are often used during different deployment programs, which makes a later comparitive analysis of TaT and TaT data difficult. For such cases, the function combine_histos and merge_histos can be applied to merge TaT and TaD frequencies based on common bin breaks of different tags.
</p>
<p>The purpose of this function is the visualization of Time-at-Depth (TaD) histograms, whereas hist_tad is the related function for Time-at-Temperature (TaT) data.
</p>


<h3>Author(s)</h3>

<p>Robert K. Bauer
</p>


<h3>See Also</h3>

<p>ts2histos, combine_histos, merge_histos, hist_tat</p>


<h3>Examples</h3>

<pre><code class="language-R">ts_file &lt;- system.file("example_files/104659-Series.csv",package="RchivalTag")
ts_df &lt;- read_TS(ts_file)
head(ts_df)

tad_breaks &lt;- c(0, 2, 5, 10, 20, 50, 100, 200, 300, 400, 600, 2000)
tat_breaks &lt;- c(10,12,15,17,18,19,20,21,22,23,24,27)

## example 1a) convert only DepthTS data to daily TAD frequencies:
ts2histos(ts_df, tad_breaks = tad_breaks)
hist_tad(ts_df, bin_breaks = tad_breaks)
hist_tad(ts_df, bin_breaks = tad_breaks, do_mid.ticks = FALSE)

## convert 1b) only TemperatureTS data to daily TAT frequencies:
tat &lt;- ts2histos(ts_df, tat_breaks = tat_breaks)
hist_tat(ts_df, bin_breaks = tat_breaks, do_mid.ticks = FALSE)
hist_tat(tat$TAT$merged, do_mid.ticks = FALSE)

## convert 1c) DepthTS &amp; TemperatureTS data to daily TAD &amp; TAT frequencies:
ts2histos(ts_df, tad_breaks = tad_breaks, tat_breaks = tat_breaks)

## convert 1d) back-to-back histogram showing day vs night TAD frequencies:
ts_df$Lat &lt;- 4; ts_df$Lon=42.5 ## required geolocations to estimate daytime
head(ts_df)
ts_df2 &lt;- classify_DayTime(get_DayTimeLimits(ts_df)) # estimate daytime
head(ts_df2)

ts2histos(ts_df2, tad_breaks = tad_breaks,split_by = "daytime")
hist_tad(ts_df2, bin_breaks = tad_breaks,split_by = "daytime", do_mid.ticks = FALSE)


## example 2) rebin daily TAD frequencies:
tad &lt;- ts2histos(ts_df, tad_breaks = tad_breaks)
tad2 &lt;- rebin_histos(hist_list = tad, tad_breaks = tad_breaks[c(1:3,6:12)])
par(mfrow=c(2,2))
hist_tad(tad, do_mid.ticks = FALSE) ## example for multiple individuals
hist_tad(tad$TAD$merged, do_mid.ticks = FALSE)
hist_tad(tad$TAD$merged, bin_breaks = tad_breaks[c(1:3,6:12)]) ## from inside hist_tad


## example 3) read, merge and plot TAD frequency data from several files:
## part I - read histogram data from two files:
hist_dat_1 &lt;- read_histos(system.file("example_files/104659-Histos.csv",package="RchivalTag"))
hist_dat_2 &lt;- read_histos(system.file("example_files/104659b-Histos.csv",package="RchivalTag"))
## note the second list is based on the same data (tag), but on different bin_breaks

## part II - combine TAD/TAT frecuency data from seperate files in one list:
hist_dat_combined &lt;- combine_histos(hist_dat_1, hist_dat_2)
par(mfrow=c(2,1))
hist_tad(hist_dat_combined)
hist_tat(hist_dat_combined)

## part III - force merge TAD/TAT frecuency data from seperate files 
# in one list, by applying common bin_breaks:
hist_dat_merged &lt;- merge_histos(hist_dat_combined,force_merge = TRUE)
hist_tad(hist_dat_merged)
hist_tat(hist_dat_merged)

## part IV - plot merged data:
hist_tad(hist_dat_merged) # of all tags
unique(hist_dat_merged$TAD$merged$df$DeployID) ## list unique tags in merged list
hist_tad(hist_dat_merged, select_id = "15P1019b", select_from = 'DeployID') # of one tag

## part V - unmerge data:
unmerge_histos(hist_dat_merged)
</code></pre>


</div>