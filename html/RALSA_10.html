<div class="container">

<table style="width: 100%;"><tr>
<td>lsa.merge.data</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Merge study data from different countries and/or respondents</h2>

<h3>Description</h3>

<p><code>lsa.merge.data</code> combines data from different countries and/or different respondents (e.g. students and teachers, or students and schools).
</p>


<h3>Usage</h3>

<pre><code class="language-R">lsa.merge.data(inp.folder, file.types, ISO, out.file)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>inp.folder</code></td>
<td>
<p>Folder containing the data sets. The data sets must be <code>.RData</code>, produced
by <code>lsa.convert.data</code>. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>file.types</code></td>
<td>
<p>What file types (i.e. respondents) shall be merged? See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ISO</code></td>
<td>
<p>Vector containing character ISO codes of the countries' data files to include
in the merged file. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>out.file</code></td>
<td>
<p>Full path to the file the data shall be stored in. The object stored in the
file will have the same name. See details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function merges files from studies where the files are per country and respondent type (e.g. student, school, teacher). That is, all studies except PISA.
</p>
<p>The <code>inp.folder</code> specifies the path to the folder containing the <code>.RData</code> files produced by <code>lsa.convert.data</code>. The folder must contain only files for a single study, single cycle and single population (e.g. TIMSS 2015 grade 4 or TIMSS 2015 grade 8, but not both), or mode of administration (e.g. either PIRLS 2016 or ePIRLS 2016, but not both; or TIMSS 2019 or TIMSS 2019 Bridge, but not both). All files in the input folder must be exported with the same option (<code>TRUE</code> or <code>FALSE</code>) of the <code>missing.to.NA</code> argument of the <code>lsa.convert.data</code> function. If input folder is not provided to the argument, the working folder (<code>getwd()</code>) will be used.
</p>
<p>The <code>file.types</code> is a list of the respondent types as component names and their variables as elements to be merged. The file type names are three-character codes, the first three characters of the corresponding file names. The elements are vectors of upper case variable names, <code>NULL</code> takes all variables in the corresponding file. For example, in TIMSS <code>asg</code> will merge only student-level data from grade 4, <code>c(asg, atg)</code> will merge the student-level and teacher-level data from grade 4, <code>c(bsg, btm)</code> will merge student-level and mathematics teacher-level data from grade 8. If a merge is not possible by the study design, the function will stop with an error. See the examples.
</p>
<p>The <code>ISO</code> is a character vector specifying the countries whose data shall be merged. The elements of the vector are the fourth, fifth and sixth characters in the file names. For example, <code>c("aus", "swe", "svn")</code> will merge the data from Australia, Sweden and Slovenia for the file types specified in <code>file.types</code>. The three-letter ISO codes for each country can be found in the user guide for the study in scope. For example, the ISO codes of the countries participating in PIRLS 2016 can be found in its user guide on pages 52-54. If file for specific country does not exist in the <code>inp.folder</code>, a warning will be issued. If the <code>ISO</code> argument is missing, the files for all countries in the folder will be merged for the specified <code>file.types</code>.
</p>
<p>The <code>out.file</code> must contain full path (including the <code>.RData</code> extension, if missing, it will be added) to the output file (i.e. the file containing merged data). The file contains object with the same name and has a class extension <code>lsa.data</code>. It has additional attribute <code>file.type</code> showing data from which respondents is available after the merging has been done. For example, merging the student-level data with teacher-level data in TIMSS grade 4 will assign "std.bckg.tch.bckg" to this attribute. The object has two additional attributes: study name (<code>study</code>) and study cycle (<code>cycle</code>). The object in the <code>.RData</code> file is keyed on the country ID variable. If output folder is not provided, the merged file will be saved in the working folder (<code>getwd()</code>) as <code>merged_data.RData</code>.
</p>


<h3>Value</h3>

<p><code>.RData</code> data file containing an object with class <code>lsa.data</code>, an extension of the <code>data.table</code> class. The <code>data.table</code> object has the same name as the <code>.RData</code> file it is saved in. The object contains the data from different respondents and/or countries merged and has additional attributes: study name (<code>study</code>), study cycle (<code>cycle</code>), and respondent file type (<code>file.type</code>). Each variable has its own additional attributes: its own label attached to it, if it existed in the source SPSS file. If the <code>missing.to.NA</code> in the source file was set to <code>TRUE</code>, each variable has an attribute <code>missings</code>, containing the user-defined missing values.
</p>


<h3>References</h3>

<p>Foy, P. (Ed.). (2018). <em>PIRLS 2016 User Guide for the International Database</em>. TIMSS &amp; PIRLS International Study Center.
</p>


<h3>See Also</h3>

<p><code>lsa.convert.data</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Merge TIMSS 2015 grade 4 student and teacher variables for Australia, Chinese Taipei and
# Slovenia taking all variables in both files
## Not run: 
lsa.merge.data(inp.folder = "C:/Data", file.types = list(asg = NULL, atg = NULL),
ISO = c("aus", "twn", "svnn"), out.file = "C:/Merged/Merged.RData")

## End(Not run)

# Same as the above, taking just few variables from each file
## Not run: 
lsa.merge.data(inp.folder = "C:/Data",
file.types = list(asg = c("ASBG01", "ASBG02A", "ASBG02B"),
atg = c("ATBG01", "ATBG02", "ATBG03")), ISO = c("aus", "twn", "svnn"),
out.file = "C:/Merged/Merged.RData")

## End(Not run)

</code></pre>


</div>