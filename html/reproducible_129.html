<div class="container">

<table style="width: 100%;"><tr>
<td>gdalProject</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>3-Step postProcess sequence for SpatRasters using <code>gdalwarp</code>
</h2>

<h3>Description</h3>

<p><code>gdalProject</code> is a thin wrapper around <code>sf::gdal_utils('gdalwarp', ...)</code> with specific options
set, notably, <code>-r</code> to <code>method</code> (in the ...), <code>-t_srs</code> to the crs of the <code>toRas</code>,
<code>-te</code> to the extent of the <code>toRas</code>, <code>-te_srs</code> to the <code>crs</code> of the <code>toRas</code>,
<code>-dstnodata = NA</code>, and <code>-overwrite</code>.
</p>
<p><code>gdalResample</code> is a thin wrapper around <code>sf::gdal_utils('gdalwarp', ...)</code> with specific options
set, notably, <code style="white-space: pre;">⁠"-r", "near"⁠</code>, <code>-te</code>, <code>-te_srs</code>, <code>tr</code>, <code>-dstnodata = NA</code>, <code>-overwrite</code>.
</p>
<p><code>gdalMask</code> is a thin wrapper around <code>sf::gdal_utils('gdalwarp', ...)</code> with specific options
set, notably, <code>-cutline</code>, <code>-dstnodata = NA</code>, and <code>-overwrite</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">gdalProject(
  fromRas,
  toRas,
  filenameDest,
  verbose = getOption("reproducible.verbose"),
  ...
)

gdalResample(
  fromRas,
  toRas,
  filenameDest,
  verbose = getOption("reproducible.verbose"),
  ...
)

gdalMask(
  fromRas,
  maskToVect,
  writeTo = NULL,
  verbose = getOption("reproducible.verbose"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fromRas</code></td>
<td>
<p>see <code>from</code> argument from <code>postProcessTo()</code>, but can only be a  <code>SpatRaster</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>toRas</code></td>
<td>
<p>see <code>to</code> argument from <code>postProcessTo()</code>, but can only be a  <code>SpatRaster</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filenameDest</code></td>
<td>
<p>A filename with an appropriate extension (e.g., <code>.tif</code>) for
<code>gdal</code> to write the output to. Since this function is conceived to be part of a
chain, and not the final step, this function does not use <code>writeTo</code>, which is
reserved for the final step in the chain.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Numeric, -1 silent (where possible), 0 being very quiet,
1 showing more messaging, 2 being more messaging, etc.
Default is 1. Above 3 will output much more information about the internals of
Caching, which may help diagnose Caching challenges. Can set globally with an
option, e.g., <code style="white-space: pre;">⁠options('reproducible.verbose' = 0) to reduce to minimal⁠</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>For <code>gdalProject</code>, this can be <code>method</code>. For <code>gdalMask</code> can be <code>destinationPath</code> and <code>touches</code>.
For all <code style="white-space: pre;">⁠gdal*⁠</code>, this can also be and <code>datatype</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maskToVect</code></td>
<td>
<p>see <code>maskTo</code> argument from <code>maskTo()</code>, but can only be a <code>SpatVector</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>writeTo</code></td>
<td>
<p>Optional character string of a filename to use <code>writeRaster</code> to save the final
object. Default is <code>NULL</code>, which means there is no <code>writeRaster</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>These three functions are used within <code>postProcessTo</code>, in the sequence:
<code>gdalProject</code>, <code>gdalResample</code> and <code>gdalMask</code>, when <code>from</code> and <code>projectTo</code> are <code>SpatRaster</code> and
<code>maskTo</code> is a <code>SpatVector</code>, but only if <code>options(reproducible.gdalwarp = TRUE)</code> is set.
</p>
<p>This sequence is a slightly different order than the sequence when <code>gdalwarp = FALSE</code> or
the arguments do not match the above. This sequence was determined to be faster and
more accurate than any other sequence, including running all three steps in one
<code>gdalwarp</code> call (which <code>gdalwarp</code> can do). Using one-step <code>gdalwarp</code> resulted in
very coarse pixelation when converting from a coarse resolution to fine resolution, which
visually was inappropriate in test cases.
</p>


<h3>See Also</h3>

<p><code>gdalResample()</code>, and <code>gdalMask()</code> and the overarching <code>postProcessTo()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># prepare dummy data -- 3 SpatRasters, 2 SpatVectors
# need 2 SpatRaster
rf &lt;- system.file("ex/elev.tif", package = "terra")
elev1 &lt;- terra::rast(rf)
#'
ras2 &lt;- terra::deepcopy(elev1)
ras2[ras2 &gt; 200 &amp; ras2 &lt; 300] &lt;- NA_integer_
terra::values(elev1) &lt;- rep(1L, terra::ncell(ras2))
#'
# a polygon vector
f &lt;- system.file("ex/lux.shp", package = "terra")
vOrig &lt;- terra::vect(f)
v &lt;- vOrig[1:2, ]
#'
utm &lt;- terra::crs("epsg:23028") # $wkt
vInUTM &lt;- terra::project(vOrig, utm)
vAsRasInLongLat &lt;- terra::rast(vOrig, resolution = 0.008333333)
res100 &lt;- 100
rInUTM &lt;- terra::rast(vInUTM, resolution = res100)
# crop, reproject, mask, crop a raster with a vector in a different projection
#  --&gt; gives message about not enough information
t1 &lt;- postProcessTo(elev1, to = vInUTM)
# crop, reproject, mask a raster to a different projection, then mask
t2a &lt;- postProcessTo(elev1, to = vAsRasInLongLat, maskTo = vInUTM)


# using gdal directly --&gt; slightly different mask
opts &lt;- options(reproducible.gdalwarp = TRUE)
t2b &lt;- postProcessTo(elev1, to = vAsRasInLongLat, maskTo = vInUTM)
t3b &lt;- postProcessTo(elev1, to = rInUTM, maskTo = vInUTM)
options(opts)
</code></pre>


</div>