<div class="container">

<table style="width: 100%;"><tr>
<td>RogueTaxa</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Drop rogue taxa to generate a more informative consensus</h2>

<h3>Description</h3>

<p><code>RogueTaxa()</code> finds wildcard leaves whose removal increases the resolution
or branch support values of a consensus tree, using the relative
bipartition, shared phylogenetic, or mutual clustering concepts of
information.
</p>


<h3>Usage</h3>

<pre><code class="language-R">RogueTaxa(
  trees,
  info = c("spic", "scic", "fspic", "fscic", "rbic"),
  return = c("taxa", "tree"),
  bestTree = NULL,
  computeSupport = TRUE,
  dropsetSize = 1,
  neverDrop = character(0),
  labelPenalty = 0,
  mreOptimization = FALSE,
  threshold = 50,
  verbose = FALSE
)

QuickRogue(
  trees,
  info = "phylogenetic",
  p = 0.5,
  log = TRUE,
  average = "median",
  deviation = "mad",
  neverDrop,
  fullSeq = FALSE,
  parallel = FALSE
)

C_RogueNaRok(
  bootTrees = "",
  runId = "tmp",
  treeFile = "",
  computeSupport = TRUE,
  dropsetSize = 1,
  excludeFile = "",
  workDir = "",
  labelPenalty = 0,
  mreOptimization = FALSE,
  threshold = 50
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>trees</code></td>
<td>
<p>List of trees to analyse.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>info</code></td>
<td>
<p>Concept of information to employ; see details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return</code></td>
<td>
<p>If <code>taxa</code>, returns the leaves identified as rogues; if <code>tree</code>,
return a consensus tree omitting rogue taxa.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>computeSupport</code></td>
<td>
<p>Logical: If <code>FALSE</code>, then instead of trying to maximize
the support in the consensus tree, RogueNaRok will try to maximize the number
of bipartitions in the final tree by pruning taxa.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dropsetSize</code></td>
<td>
<p>Integer specifying maximum size of dropset per iteration.
If <code>dropsetSize == n</code>, then RogueNaRok will test in each iteration which
tuple of <code>n</code> taxa increases the optimality criterion the most, pruning
taxa accordingly.
This improves the result, but run times will increase at least linearly.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>neverDrop</code></td>
<td>
<p>Tip labels that should not be dropped from the consensus.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labelPenalty</code></td>
<td>
<p>A weight factor to penalize for dropset size when
<code>info = "rbic"</code>.
The higher the value, the more conservative the algorithm is in pruning taxa.
The default value of <code>0</code> gives the <abbr><span class="acronym">RBIC</span></abbr>; <code>1</code> gives Pattengale's
criterion.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold, mreOptimization</code></td>
<td>
<p>A threshold or mode for the consensus tree
that is optimized. Specify a value between 50 (majority rule consensus,
the default) and 100 (strict consensus), or set <code>mreOptimization = TRUE</code>
for the extended majority rule consensus.
Note that rogue taxa identified with respect to different thresholds can
vary substantially.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical specifying whether to display output from RogueNaRok.
If <code>FALSE</code>, output will be included as an attribute of the return value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>Proportion of trees that must contain a split before it is included
in the consensus under consideration.  0.5, the default, corresponds to a
majority rule tree; 1.0 will maximize the information content of the
strict consensus.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log</code></td>
<td>
<p>Logical specifying whether to log-transform distances when
calculating leaf stability.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>average</code></td>
<td>
<p>Character specifying whether to use <code>"mean"</code> or <code>"median"</code>
tip distances to calculate leaf stability.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deviation</code></td>
<td>
<p>Character specifying whether to use <code>"sd"</code> or <code>"mad"</code> to
calculate leaf stability.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fullSeq</code></td>
<td>
<p>Logical specifying whether to list all taxa (<code>TRUE</code>), or
only those that improve information content when all are dropped (<code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>Logical specifying whether parallel execution should take
place in C++.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bootTrees</code></td>
<td>
<p>Path to a file containing a collection of bootstrap trees.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>runId</code></td>
<td>
<p>An identifier for this run, appended to output files.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>treeFile, bestTree</code></td>
<td>
<p>If a single best-known tree (such as an ML or MP tree)
is provided, RogueNaRok optimizes the bootstrap support in this
best-known tree (still drawn from the bootstrap trees);
the <code>threshold</code> parameter is ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excludeFile</code></td>
<td>
<p>Taxa in this file (one taxon per line) will not be
considered for pruning.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>workDir</code></td>
<td>
<p>Path to a working directory where output files are created.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>"Rogue" or (loosely) "wildcard" taxa (Nixon and Wheeler 1992) are
leaves whose position in a tree is poorly constrained, typically because
much of the phylogenetic data associated with the taxon is either missing or
in conflict with other data (Kearney 2002).
</p>
<p>These functions use heuristic methods to identify rogue taxa whose removal
improves the information content of a consensus tree, by the definitions
of information discussed below.
</p>


<h3>Value</h3>

<p><code>RogueTaxa()</code> returns a <code>data.frame</code>. Each row after the first,
which describes the starting tree, describes a dropset operation.
Columns describe:
</p>

<ul>
<li> <p><code>num</code>: Sequential index of the drop operation
</p>
</li>
<li> <p><code>taxNum</code>: Numeric identifier of the dropped leaves
</p>
</li>
<li> <p><code>taxon</code>: Text identifier of dropped leaves
</p>
</li>
<li> <p><code>rawImprovement</code>: Improvement in score obtained by this operation
</p>
</li>
<li> <p><code>IC</code>: Information content of tree after dropping all leaves so far,
by the measure indicated by <code>info</code>.
</p>
</li>
</ul>
<p><code>C_RogueNaRok()</code> returns <code>0</code> if successful; <code>-1</code> on error.
</p>


<h3>Functions</h3>


<ul><li> <p><code>QuickRogue()</code>: Shortcut to "fast" heuristic, with option to return
evaluation of all taxa using <code>fullSeq = TRUE</code>.
</p>
</li></ul>
<h3>Information criteria</h3>

<p>The splitwise phylogenetic information content measure produces the best
results (Smith 2022).
It uses the splitwise information content as a shortcut, which involves
double counting of some information (which may or may not be desirable).
The same holds for the mutual clustering information measure; this measure
is less obviously suited to the detection of rogues.
This measure interprets split frequency as a proxy for the probability
that a split is true, which is a valid interpretation of a Bayesian posterior
sample (Holder et al. 2008),
a reasonable but imperfect interpretation of a bootstrap sample
(Berry and Gascuel 1996), and a bad interpretation of a sample of
most parsimonious trees.
</p>
<p>The "relative bipartition information criterion" (<abbr><span class="acronym">RBIC</span></abbr>) is
the sum of all support values divided by the maximum possible support in a
fully bifurcating tree with the initial set of taxa.
The relative bipartition information content approach employs the
'RogueNaRok' implementation (Aberer et al. 2013), which can handle
large trees relatively quickly.
The <abbr><span class="acronym">RBIC</span></abbr> is is not strictly a measure of information and can
produce undesirable results (Wilkinson and Crotti 2017).
</p>
<p><code>C_RogueNaRok()</code> directly interfaces the 'RogueNaRok' C implementation,
with no input checking; be aware that invalid input will cause undefined
behaviour and is likely to crash R.
</p>


<h3>Author(s)</h3>

<p><a href="https://smithlabdurham.github.io/">Martin R. Smith</a>
(<a href="mailto:martin.smith@durham.ac.uk">martin.smith@durham.ac.uk</a>), linking to
<a href="https://github.com/aberer/RogueNaRok/">RogueNaRok</a>
C library by Andre Aberer (&lt;andre.aberer at googlemail.com&gt;)
</p>


<h3>References</h3>

<p>Aberer AJ, Krompass D, Stamatakis A (2013).
“Pruning rogue taxa improves phylogenetic accuracy: an efficient algorithm and webservice.”
<em>Systematic Biology</em>, <b>62</b>(1), 162–166.
<a href="https://doi.org/10.1093/sysbio/sys078">doi:10.1093/sysbio/sys078</a>.<br><br> Berry V, Gascuel O (1996).
“On the interpretation of bootstrap trees: appropriate threshold of clade selection and induced gain.”
<em>Molecular Biology and Evolution</em>, <b>13</b>(7), 999–1011.
<a href="https://doi.org/10.1093/molbev/13.7.999">doi:10.1093/molbev/13.7.999</a>.<br><br> Holder MT, Sukumaran J, Lewis PO (2008).
“A justification for reporting the majority-rule consensus tree in Bayesian phylogenetics.”
<em>Systematic Biology</em>, <b>57</b>(5), 814–821.
<a href="https://doi.org/10.1080/10635150802422308">doi:10.1080/10635150802422308</a>.<br><br> Kearney M (2002).
“Fragmentary taxa, missing data, and ambiguity: mistaken assumptions and conclusions.”
<em>Systematic Biology</em>, <b>51</b>(2), 369–381.
<a href="https://doi.org/10.1080/10635150252899824">doi:10.1080/10635150252899824</a>.<br><br> Nixon KC, Wheeler QD (1992).
“Extinction and the origin of species.”
In Novacek MJ, Wheeler QD (eds.), <em>Extinction and phylogeny</em>, chapter Extinction and the origin of species, 119-143.
Columbia University Press, New York.<br><br> Smith MR (2022).
“Using information theory to detect rogue taxa and improve consensus trees.”
<em>Systematic Biology</em>, <b>71</b>(5), 986–1008.
<a href="https://doi.org/10.1093/sysbio/syab099">doi:10.1093/sysbio/syab099</a>.<br><br> Wilkinson M, Crotti M (2017).
“Comments on detecting rogue taxa using RogueNaRok.”
<em>Systematics and Biodiversity</em>, <b>15</b>(4), 291–295.
<a href="https://doi.org/10.1080/14772000.2016.1252440">doi:10.1080/14772000.2016.1252440</a>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library("TreeTools", warn.conflicts = FALSE)

trees &lt;- list(read.tree(text = ("(a, (b, (c, (d, (e, (X1, X2))))));")),
              read.tree(text = ("((a, (X1, X2)), (b, (c, (d, e))));")))
RogueTaxa(trees, dropsetSize = 2)

trees &lt;- list(
     read.tree(text = "((a, y), (b, (c, (z, ((d, e), (f, (g, x)))))));"),
     read.tree(text = "(a, (b, (c, (z, (((d, y), e), (f, (g, x)))))));"),
     read.tree(text = "(a, (b, ((c, z), ((d, (e, y)), ((f, x), g)))));"),
     read.tree(text = "(a, (b, ((c, z), ((d, (e, x)), (f, (g, y))))));"),
     read.tree(text = "(a, ((b, x), ((c, z), ((d, e), (f, (g, y))))));")
     )
cons &lt;- consensus(trees, p = 0.5)
plot(cons)
LabelSplits(cons, SplitFrequency(cons, trees) / length(trees))
reduced &lt;- RogueTaxa(trees, info = "phylogenetic", ret = "tree")
plot(reduced)
LabelSplits(reduced, SplitFrequency(reduced, trees) / length(trees))

QuickRogue(trees, fullSeq = TRUE)

bootTrees &lt;- system.file("example/150.bs", package = "Rogue")
tmpDir &lt;- tempdir()
XX &lt;- capture.output( # Don't print verbose run details to console
  C_RogueNaRok(bootTrees, workDir = tmpDir)
)

# Results have been written to our temporary directory
oldwd &lt;- setwd(tmpDir)
head(read.table("RogueNaRok_droppedRogues.tmp", header = TRUE))

# Delete temporary files
file.remove("RogueNaRok_droppedRogues.tmp")
file.remove("RogueNaRok_info.tmp")

setwd(oldwd)
</code></pre>


</div>