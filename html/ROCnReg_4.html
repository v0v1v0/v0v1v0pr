<div class="container">

<table style="width: 100%;"><tr>
<td>AROC.sp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Semiparametric frequentist inference for the covariate-adjusted ROC curve (AROC).
</h2>

<h3>Description</h3>

<p>This function estimates the covariate-adjusted ROC curve (AROC) using the semiparametric approach proposed by Janes and Pepe (2009).
</p>


<h3>Usage</h3>

<pre><code class="language-R">AROC.sp(formula.h, group, tag.h, data, 
    est.cdf.h = c("normal", "empirical"), pauc = pauccontrol(),
    p = seq(0, 1, l = 101), B = 1000, ci.level = 0.95, 
  	parallel = c("no", "multicore", "snow"), ncpus = 1, cl = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula.h</code></td>
<td>
<p>A <code>formula</code> object specifying the location regression model to be fitted in the healthy population (see Details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group</code></td>
<td>
<p>A character string with the name of the variable that distinguishes healthy from diseased individuals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tag.h</code></td>
<td>
<p>The value codifying healthy individuals in the variable <code>group</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame representing the data and containing all needed variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est.cdf.h</code></td>
<td>
<p>A character string. It indicates how the conditional distribution function of the diagnostic test in the healthy population is estimated. Options are <code>"normal"</code> and <code>"empirical"</code> (see Details). The default is <code>"normal"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pauc</code></td>
<td>
<p>A list of control values to replace the default values returned by the function <code>pauccontrol</code>. This argument is used to indicate whether the partial area under the covariate-adjusted ROC curve (pAAUC) should be computed, and in case it is computed, whether the focus should be placed on restricted false positive fractions (FPFs) or on restricted true positive fractions (TPFs), and the upper bound for the FPF (if focus is FPF) or the lower bound for the TPF (if focus is TPF).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>Set of false positive fractions (FPF) at which to estimate the covariate-adjusted ROC curve. This set is also used to compute the area under the covariate-adjusted ROC curve (AAUC) using Simpson's rule. Thus, the length of the set should be an odd number, and it should be rich enough for an accurate estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>An integer value specifying the number of bootstrap resamples for the construction of the confidence intervals. The default is 1000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci.level</code></td>
<td>
<p>An integer value (between 0 and 1) specifying the confidence level. The default is 0.95.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>A characters string with the type of parallel operation: either "no" (default), "multicore" (not available on Windows) or "snow".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncpus</code></td>
<td>
<p>An integer with the number of processes to be used in parallel operation. Defaults to 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cl</code></td>
<td>
<p>An object inheriting from class <code>cluster</code> (from the <code>parallel</code> package), specifying an optional parallel or snow cluster if parallel = "snow". If not supplied, a cluster on the local machine is created for the duration of the call.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Estimates the covariate-adjusted ROC curve (AROC) defined as
</p>
<p style="text-align: center;"><code class="reqn">AROC\left(p\right) = Pr\{1 - F_{\bar{D}}(Y_D | \mathbf{X}_{D}) \leq p\},</code>
</p>

<p style="text-align: center;"><code class="reqn">F_{\bar{D}}(y|\mathbf{x}) = Pr\{Y_{\bar{D}} \leq y | \mathbf{X}_{\bar{D}} = \mathbf{x}\}.</code>
</p>
<p> The method implemented in this function estimates the outer probability empirically (see Janes and Pepe, 2009) and <code class="reqn">F_{\bar{D}}(\cdot|\mathbf{x})</code> is estimated assuming a semiparametric location regression model for <code class="reqn">Y_{\bar{D}}</code>, i.e., 
</p>
<p style="text-align: center;"><code class="reqn">Y_{\bar{D}} = \mathbf{X}_{\bar{D}}^{T}\mathbf{\beta}_{\bar{D}} + \sigma_{\bar{D}}\varepsilon_{\bar{D}},</code>
</p>

<p>where <code class="reqn">\varepsilon_{\bar{D}}</code> has zero mean, variance one, and distribution function <code class="reqn">G_{\bar{D}}</code>. As a consequence, we have
</p>
<p style="text-align: center;"><code class="reqn">F_{\bar{D}}(y | \mathbf{x}) = G_{\bar{D}}\left(\frac{y-\mathbf{x}^{T}\mathbf{\beta}_{\bar{D}}}{\sigma_{\bar{D}}}\right).</code>
</p>

<p>In line with the assumptions made about the distribution of <code class="reqn">\varepsilon_{\bar{D}}</code>, estimators will be referred to as: (a) "normal", where a standard Gaussian error is assumed, i.e., <code class="reqn">G_{\bar{D}}(y) = \Phi(y)</code>; and, (b) "empirical", where no assumption is made about the distribution (in this case, <code class="reqn">G_{\bar{D}}</code> is empirically estimated on the basis of standardised residuals).
</p>
<p>The area under the AROC curve is
</p>
<p style="text-align: center;"><code class="reqn">AAUC=\int_0^1 AROC(p)dp,</code>
</p>

<p>and there exists a closed-form estimator. With regard to the partial area under the AROC curve, when <code>focus = "FPF"</code> and assuming an upper bound <code class="reqn">u_1</code> for the FPF, what it is computed is
</p>
<p style="text-align: center;"><code class="reqn">pAAUC_{FPF}(u_1)=\int_0^{u_1} AROC(p)dp,</code>
</p>

<p>where again there exists a closed-form estimator. The returned value is the normalised pAAUC, <code class="reqn">pAAUC_{FPF}(u_1)/u_1</code> so that it ranges from <code class="reqn">u_1/2</code> (useless test) to 1 (perfect marker). Conversely, when <code>focus = "TPF"</code>, and assuming a lower bound for the TPF of <code class="reqn">u_2</code>, the partial area corresponding to TPFs lying in the interval <code class="reqn">(u_2,1)</code> is computed as </p>
<p style="text-align: center;"><code class="reqn">pAAUC_{TPF}(u_2)=\int_{AROC^{-1}(u_2)}^{1}AROC(p)dp-\{1-AROC^{-1}(u_2)\}\times u_2.</code>
</p>
<p> Here, the computation of the integral is done numerically. The returned value is the normalised pAAUC, <code class="reqn">pAAUC_{TPF}(u_2)/(1-u_2)</code>, so that it ranges from <code class="reqn">(1-u_2)/2</code> (useless test) to 1 (perfect test).
</p>


<h3>Value</h3>

<p>As a result, the function provides a list with the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>The matched call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>The original supplied data argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>missing.ind</code></td>
<td>
<p>A logical value indicating whether for each pair of observations (test outcomes and covariates) missing values occur.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>marker</code></td>
<td>
<p>The name of the diagnostic test variable in the dataframe.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group</code></td>
<td>
<p>The value of the argument <code>group</code> used in the call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tag.h</code></td>
<td>
<p>The value of the argument <code>tag.h</code> used in the call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>The value of the argument <code>formula.h</code> used in the call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est.cdf.h</code></td>
<td>
<p>The value of the argument <code>est.cdf.h</code> used in the call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>Set of false positive fractions (FPF) at which the covariate-adjusted ROC (AROC) curve has been estimated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci.level</code></td>
<td>
<p>The value of the argument <code>ci.level</code> used in the call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ROC</code></td>
<td>
<p>Estimated covariate-adjusted ROC curve (AROC), and <code>ci.level</code>*100% pointwise confidence bands (if computed)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AUC</code></td>
<td>
<p>Estimated area under the covariate-adjusted ROC curve (AAUC), and <code>ci.level</code>*100% confidence intervals (if required).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pAUC</code></td>
<td>
<p>If computed, estimated partial area under the covariate-adjusted ROC curve (pAAUC) and <code>ci.level</code>*100%  confidence interval (if computed). Note that the returned values are normalised, so that the maximum value is one.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p>Object of class <code>lm</code> with the fitted regression model in the healthy population.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coeff</code></td>
<td>
<p>Estimated regression coefficients (and <code>ci.level</code>*100% confidence interval if <code>B</code> greater than zero) from the fit of the linear model in the healthy population, as specified in <code>formula.h</code>.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Janes, H., and Pepe, M.S. (2009). Adjusting for covariate effects on classification accuracy using the covariate-adjusted receiver operating characteristic curve. Biometrika, 96(2), 371 - 382.
</p>


<h3>See Also</h3>

<p><code>AROC.bnp</code>, <code>AROC.sp</code>, <code>AROC.kernel</code>, <code>pooledROC.BB</code>, <code>pooledROC.emp</code>, <code>pooledROC.kernel</code>, <code>pooledROC.dpm</code>, <code>cROC.bnp</code>, <code>cROC.sp</code> or <code>AROC.kernel</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(ROCnReg)
data(psa)
# Select the last measurement
newpsa &lt;- psa[!duplicated(psa$id, fromLast = TRUE),]

# Log-transform the biomarker
newpsa$l_marker1 &lt;- log(newpsa$marker1)

m3 &lt;- AROC.sp(formula.h = l_marker1 ~ age,
group = "status", 
tag.h = 0,
data = newpsa,
est.cdf.h = "normal",
pauc = pauccontrol(compute = TRUE, focus = "FPF", value = 0.5),
p = seq(0,1,l=101), 
B = 500)

summary(m3)

plot(m3)


</code></pre>


</div>