<div class="container">

<table style="width: 100%;"><tr>
<td>Rchoice</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimate discrete choice model with random parameters</h2>

<h3>Description</h3>

<p>Estimation of discrete choice models such as Binary (logit and probit), 
Poisson and Ordered (logit and probit) model with random coefficients for cross-sectional and panel data using simulated maximum likelihood.
</p>


<h3>Usage</h3>

<pre><code class="language-R">Rchoice(
  formula,
  data,
  subset,
  weights,
  na.action,
  family,
  start = NULL,
  ranp = NULL,
  R = 40,
  haltons = NA,
  seed = NULL,
  correlation = FALSE,
  panel = FALSE,
  index = NULL,
  mvar = NULL,
  print.init = FALSE,
  init.ran = 0.1,
  gradient = TRUE,
  ...
)

## S3 method for class 'Rchoice'
terms(x, ...)

## S3 method for class 'Rchoice'
model.matrix(object, ...)

## S3 method for class 'Rchoice'
coef(object, ...)

## S3 method for class 'Rchoice'
fitted(object, ...)

## S3 method for class 'Rchoice'
residuals(object, ...)

## S3 method for class 'Rchoice'
df.residual(object, ...)

## S3 method for class 'Rchoice'
update(object, new, ...)

## S3 method for class 'Rchoice'
logLik(object, ...)

## S3 method for class 'Rchoice'
print(
  x,
  digits = max(3, getOption("digits") - 3),
  width = getOption("width"),
  ...
)

## S3 method for class 'Rchoice'
summary(object, ...)

## S3 method for class 'summary.Rchoice'
print(
  x,
  digits = max(3, getOption("digits") - 3),
  width = getOption("width"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a symbolic description of the model to be estimated. The <code>formula</code> consists in two parts. The first one is reserved for standard variables with fixed and random parameters. The second one is reserved for variables that enter in the mean of the random parameters. See for example <code>rFormula</code>,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>the data. It may be a <code>pdata.frame</code> object or an ordinary <code>data.frame</code>,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>an optional vector specifying a subset of observations,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>an optional vector of weigths,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>a function wich indicated what should happen when the data
contains <code>NA</code>'s,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>the distribution to be used. It might be <code>family = binomial("probit")</code> for a Probit Model, <code>family = binomial("logit")</code> for a Logit model, <code>family = ordinal("probit")</code> for an Ordered Probit Model, <code>family = ordinal("logit")</code> for a Ordered Logit Model for an Ordered Logit Model, and  <code>family = "poisson"</code> for a Poisson Model,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>
<p>a vector of starting values,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ranp</code></td>
<td>
<p>a named vector whose names are the random parameters and values the distribution:
"<code>n</code>" for normal, "<code>ln</code>" for log-normal, "<code>cn</code>" for truncated normal, "<code>u</code>" for uniform, "<code>t</code>" for triangular, "<code>sb</code>" for Johnson Sb,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>
<p>the number of draws if <code>ranp</code> is not <code>NULL</code>,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>haltons</code></td>
<td>
<p>only relevant if <code>ranp</code> is not <code>NULL</code>. If not <code>NULL</code>, halton sequence is used
instead of pseudo-random numbers. If <code>haltons=NA</code>, some default values are used for
the prime of the sequence and for the number of element dropped. Otherwise, <code>haltons</code> should
be a list with elements <code>prime</code> and <code>drop</code>,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>the seed for the pseudo-random draws. This is only relevant if <code>haltons = NULL</code>,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>correlation</code></td>
<td>
<p>only relevant if <code>ranp</code> is not <code>NULL</code>. If <code>TRUE</code>, the correlation between random parameters is taken into account,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>panel</code></td>
<td>
<p>if <code>TRUE</code> a panel data model is estimated,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>index</code></td>
<td>
<p>a string indicating the ‘id’ for individuals in the data. This argument is not required if data is a <code>pdata.frame</code> object,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mvar</code></td>
<td>
<p>only valid if <code>ranp</code> is not <code>NULL</code>. This is a named list, where the names correspond to the variables with random parameters, and the values correspond to the variables that enter in the mean of each random parameters,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.init</code></td>
<td>
<p>if <code>TRUE</code>, the initial values for the optimization procedure are printed,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init.ran</code></td>
<td>
<p>initial values for standard deviation of random parameters. Default is 0.1,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gradient</code></td>
<td>
<p>if <code>FALSE</code>, numerical gradients are used for the optimization procedure of models with random parameters,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments passed to <code>maxLik</code>,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x, object</code></td>
<td>
<p>and object of class <code>Rchoice</code>,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new</code></td>
<td>
<p>an updated formula for the update method,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>number of digits,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>width</code></td>
<td>
<p>width,</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The models are estimated using the <code>maxLik</code> function from <code>maxLik</code> package.
</p>
<p>If <code>ranp</code> is not <code>NULL</code>, the random parameter  model is estimated.   
A random parameter model or random coefficient models permits regression parameter to 
vary across individuals according to some distribution. A fully parametric 
random parameter model specifies the latent variable  <code class="reqn">y^{*}</code> conditional on regressors
<code class="reqn">x</code> and given parameters <code class="reqn">\beta_i</code> to have conditional density <code class="reqn">f(y|x, \beta_i)</code> where
<code class="reqn">\beta_i</code> are iid with density <code class="reqn">g(\beta_i|\theta_i)</code>. The density is assumed a priori by the user by the argument
<code>ranp</code>. If the parameters are assumed to be normally distributed <code class="reqn">\beta_i ~ N(\beta, \Sigma)</code>, then the random parameter are constructed as: </p>
<p style="text-align: center;"><code class="reqn">\beta_{ir}=\beta+L\omega_{ir}</code>
</p>
<p> where <code class="reqn">LL'=\Sigma</code> and <code class="reqn">\omega_{ir}</code> is the r-th draw from standard normal distribution for individual <code class="reqn">i</code>. 
</p>
<p>Once the model is specified by the argument <code>family</code>, the model is estimated using 
Simulated Maximum Likelihood (SML). The probabilities, given by <code class="reqn">f(y|x, \beta_i)</code>, are simulated using <code>R</code> pseudo-draws if <code>halton=NULL</code> or <code>R</code> halton draws if <code>halton = NA</code>. The user can also specified the primes and the number of dropped elements for the halton draws. For example, if the model consists of two random parameters, the user can specify <code>haltons = list("prime" = c(2, 3), "drop" = c(11, 11))</code>. 
</p>
<p>A random parameter hierarchical model can be estimated by including heterogeneity in the mean of the 
random parameters: </p>
<p style="text-align: center;"><code class="reqn">\beta_{ir}=\beta+\pi's_i+L\omega_{ir}</code>
</p>
 <p><span class="pkg">Rchoice</span> manages the variables in the hierarchical model by the <code>formula</code> object: all the hierarchical variables (<code class="reqn">s_i</code>) are included after the <code>|</code> symbol. The argument <code>mvar</code> indicate which variables enter in each random parameter. See examples below
</p>


<h3>Value</h3>

<p>An object of class “<code>Rchoice</code>”, a list elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>coefficients</code></td>
<td>
<p>the named vector of coefficients,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>type of model,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>link</code></td>
<td>
<p>distribution of the errors,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logLik</code></td>
<td>
<p>a set of values of the maximum likelihood procedure,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mf</code></td>
<td>
<p>the model framed used,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>the formula (a Formula object),</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p><code>proc.time()</code> minus the start time,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>freq</code></td>
<td>
<p>frequency of dependent variable,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>draws</code></td>
<td>
<p>type of draws used,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R.model</code></td>
<td>
<p><code>TRUE</code> if a random parameter model is fitted,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>
<p>number of draws used,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bi</code></td>
<td>
<p>an array of dimension <code class="reqn">N \times R \times K</code> with the individual parameters,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Qir</code></td>
<td>
<p>matrix of dimension <code class="reqn">N \times R</code> representing <code class="reqn">P_{ir}/\sum_r P_{ir}</code>,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ranp</code></td>
<td>
<p>vector indicating the variables with random parameters and their distribution,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probabilities</code></td>
<td>
<p>the fitted probabilities for each individuals,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>residuals</code></td>
<td>
<p>the residuals,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the matched call.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Mauricio Sarrias <a href="mailto:msarrias86@gmail.com">msarrias86@gmail.com</a>
</p>


<h3>References</h3>

<p>Greene, W. H. (2012). Econometric Analysis. 7 edition. Prentice Hall.
</p>
<p>Train, K. (2009). Discrete Choice Methods with Simulation. Cambridge university press.
</p>


<h3>See Also</h3>

<p><code>plot.Rchoice</code>, <code>effect.Rchoice</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Probit model
data("Workmroz")
probit &lt;- Rchoice(lfp ~ k5 + k618 + age + wc + hc + lwg + inc,  
                 data = Workmroz, family = binomial('probit'))
summary(probit)

## Poisson model
data("Articles")
poisson &lt;- Rchoice(art ~ fem + mar + kid5 + phd + ment, data = Articles, family = poisson)
summary(poisson)

## Ordered probit model
data("Health")
oprobit &lt;- Rchoice(newhsat ~ age + educ + hhinc + married + hhkids, 
data = Health, family = ordinal('probit'), subset = year == 1988)
summary(oprobit)

## Poisson Model with Random Parameters
poisson.ran &lt;- Rchoice(art ~ fem + mar + kid5 + phd + ment, 
                       data = Articles,  family = poisson,
                       ranp = c(kid5 = "n", phd = "n", ment = "n"))
summary(poisson.ran)                      

## Poisson Model with Correlated Random Parameters
poissonc.ran &lt;- Rchoice(art ~ fem + mar + kid5 + phd + ment, 
                       data = Articles, 
                       ranp = c(kid5 = "n", phd = "n", ment = "n"), 
                       family = poisson, 
                       correlation =  TRUE,
                       R = 20)
summary(poissonc.ran)

## Hierarchical Poisson Model
poissonH.ran &lt;- Rchoice(art ~ fem + mar + kid5 + phd + ment | fem + phd,
                       data = Articles,
                       ranp = c(kid5 = "n", phd = "n", ment = "n"),
                       mvar = list(phd = c("fem"), ment = c("fem", "phd")),
                       family = poisson,
                       R = 10)
summary(poissonH.ran)

## Ordered Probit Model with Random Effects and Random Parameters
Health$linc &lt;- log(Health$hhinc)
oprobit.ran &lt;- Rchoice(newhsat ~ age + educ + married + hhkids + linc,
                     data = Health[1:2000, ],
                     family = ordinal('probit'),
                     ranp = c(constant = "n", hhkids = "n", linc = "n"),
                     panel = TRUE,
                     index = "id",
                     R = 10,
                     print.init = TRUE)
summary(oprobit.ran)
 


</code></pre>


</div>