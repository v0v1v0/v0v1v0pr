<div class="container">

<table style="width: 100%;"><tr>
<td>cdb_flag</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Flag potential issues in matrices of a COM(P)ADRE database</h2>

<h3>Description</h3>

<p>Adds columns to the data slot of a 'CompadreDB' object that flag potential
problems in the matrix population models. These columns can subsequently be
used to subset the database by logical argument.
</p>
<p>Optional checks include:
</p>

<ul>
<li> <p><code>check_NA_A</code>: missing values in 'matA'? Missing ('NA') values in
matrices prevent most calculations using those matrices.
</p>
</li>
<li> <p><code>check_NA_U</code>: missing values in 'matU'? Missing ('NA') values in
matrices prevent most calculations using those matrices.
</p>
</li>
<li> <p><code>check_NA_F</code>: missing values in 'matF'? Missing ('NA') values in
matrices prevent most calculations using those matrices.
</p>
</li>
<li> <p><code>check_NA_C</code>: missing values in 'matC'? Missing ('NA') values in
matrices prevent most calculations using those matrices.
</p>
</li>
<li> <p><code>check_zero_U</code>: 'matU' all zeros (including 'NA')? Submatrices
composed entirely of zero values can be problematic. There may be good
biological reasons for this phenomenon. For example, in the particular
focal population in the particular focal year, there was truly zero
survival recorded. Nevertheless, zero-value submatrices can cause some
calculations to fail and it may be necessary to exclude them.
</p>
</li>
<li> <p><code>check_zero_F</code>: 'matF' all zeros (including 'NA')? Submatrices
composed entirely of zero values can be problematic. There may be good
biological reasons for this phenomenon. For example, in the particular
focal population in the particular focal year, there was truly zero
reproduction recorded. Nevertheless, zero-value submatrices can cause some
calculations to fail and it may be necessary to exclude them.
</p>
</li>
<li> <p><code>check_zero_U_colsum</code>: Columns of 'matU' that sum to zero imply
that there is is no survival from that particular stage. This may be a
perfectly valid parameterisation for a particular year/place but is
biologically unreasonable in the longer term and users may wish to exclude
problematic matrices from their analysis.
</p>
</li>
<li> <p><code>check_singular_U</code>: 'matU' singular? Matrices are said to be
singular if they cannot be inverted. Inversion is required for many matrix
calculations and, therefore, singularity can cause some calculations to
fail.
</p>
</li>
<li> <p><code>check_component_sum</code>: do 'matU'/'matF'/'matC' submatrices sum
to 'matA' (see <em>Details</em>)? A complete MPM ('matA') can be split into
its component submatrices (i.e., 'matU', 'matF' and  'matC'). The sum of
these submatrices should equal the complete MPM (i.e., 'matA' = 'matU' +
'matF' + 'matC'). Sometimes, however, errors occur so that the submatrices
do NOT sum to 'matA'. Normally, this is caused by rounding errors, but more
significant errors are possible.
</p>
</li>
<li> <p><code>check_ergodic</code>: is 'matA' ergodic (see
<code>isErgodic</code>)? Some matrix calculations require that
the MPM ('matA') be ergodic. Ergodic MPMs are those where there is a single
asymptotic stable state that does not depend on initial stage structure.
Conversely, non-ergodic MPMs are those where there are multiple asymptotic
stable states, which depend on initial stage structure. MPMs that are
non-ergodic are usually biologically unreasonable, both in terms of their
life cycle description and their projected dynamics. They cause some
calculations to fail.
</p>
</li>
<li> <p><code>check_irreducible</code>: is 'matA' irreducible (see
<code>isIrreducible</code>)? Some matrix calculations require
that the MPM ('matA') be irreducible. Irreducible MPMs are those where
parameterised transition rates facilitate pathways from all stages to all
other stages. Conversely, reducible MPMs depict incomplete life cycles
where pathways from all stages to every other stage are not possible. MPMs
that are reducible are usually biologically unreasonable, both in terms of
their life cycle description and their projected dynamics. They cause some
calculations to fail. Irreducibility is necessary but not sufficient for
ergodicity.
</p>
</li>
<li> <p><code>check_primitive</code>: is 'matA' primitive (see
<code>isPrimitive</code>)? A primitive matrix is non-negative
matrix that is irreducible and has only a single eigenvalue of maximum
modulus. This check is therefore redundant due to the overlap with
'check_irreducible' and 'checkErdogic'.
</p>
</li>
<li> <p><code>check_surv_gte_1</code>: does 'matU' contains values that are equal
to or greater than 1? Survival is bounded between 0 and 1. Values in excess
of 1 are biologically unreasonable.
</p>
</li>
</ul>
<h3>Usage</h3>

<pre><code class="language-R">cdb_flag(
  cdb,
  checks = c("check_NA_A", "check_NA_U", "check_NA_F", "check_NA_C", "check_zero_U",
    "check_zero_F", "check_zero_C", "check_zero_U_colsum", "check_singular_U",
    "check_component_sum", "check_ergodic", "check_irreducible", "check_primitive",
    "check_surv_gte_1")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>cdb</code></td>
<td>
<p>A CompadreDB object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>checks</code></td>
<td>
<p>Character vector specifying which checks to run.
</p>
<p>Defaults to all, i.e. <code>c("check_NA_A", "check_NA_U", "check_NA_F",
  "check_NA_C", "check_zero_U", "check_singular_U", "check_component_sum",
  "check_ergodic", "check_irreducible", "check_primitive",
  "check_surv_gte_1")</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For the flag <code>check_component_sum</code>, a value of <code>NA</code> will be
returned if the matrix sum of matU, matF, and matC consists only of zeros
and/or <code>NA</code>, indicating that the matrix has not been split.
</p>


<h3>Value</h3>

<p>Returns <code>cdb</code> with extra columns appended to the data slot
(columns have the same names as the corresponding elements of
<code>checks</code>) to indicate (TRUE/FALSE) whether there are potential
problems with the matrices corresponding to a given row of the data.
</p>


<h3>Author(s)</h3>

<p>Owen Jones &lt;jones@biology.sdu.dk&gt;
</p>
<p>Julia Jones &lt;juliajones@biology.sdu.dk&gt;
</p>
<p>Roberto Salguero-Gomez &lt;rob.salguero@zoo.ox.ac.uk&gt;
</p>
<p>Danny Buss &lt;dlb50@cam.ac.uk&gt;
</p>
<p>Patrick Barks &lt;patrick.barks@gmail.com&gt;
</p>


<h3>References</h3>

<p>Stott, I., Townley, S., &amp; Carslake, D. 2010. On reducibility and
ergodicity of population projection matrix models. Methods in Ecology and
Evolution. 1 (3), 242-252
</p>


<h3>See Also</h3>

<p>Other data checking: 
<code>cdb_check_species()</code>,
<code>cdb_collapse()</code>,
<code>cdb_compare()</code>,
<code>mpm_methods</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">CompadreFlag &lt;- cdb_flag(Compadre)

# only check whether matA has missing values, and whether matA is ergodic
CompadreFlag &lt;- cdb_flag(Compadre, checks = c("check_NA_A", "check_ergodic"))
</code></pre>


</div>