<div class="container">

<table style="width: 100%;"><tr>
<td>penalty_with_intensity_link</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Helper function (volatility-normalized pricing error) for calibration of equity-linked default intensity</h2>

<h3>Description</h3>

<p>Given a set SDE parameters, form a volatility term structure that fairly precisely matches
the supplied prices of the <code>variance_instruments</code>.  Then use that term structure and
the default intensity to price all the <code>fit_instruments</code>, and compare them to the
<code>fit_instrument_prices</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">penalty_with_intensity_link(
  p,
  s,
  h,
  variance_instruments,
  variance_instrument_prices,
  variance_instrument_spreads,
  fit_instruments,
  fit_instrument_prices,
  fit_instrument_spreads,
  fit_instrument_weights,
  S0,
  num_time_steps = 30,
  const_short_rate = 0,
  discount_factor_fcn = function(T, t) {     exp(-const_short_rate * (T - t)) },
  ...,
  relative_spread_tolerance = 0.15,
  num_variance_time_steps = 30
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>Power of default intensity</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>s</code></td>
<td>
<p>Proportion of constant default intensity</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h</code></td>
<td>
<p>Base default intensity</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variance_instruments</code></td>
<td>
<p>A list of instruments in strictly increasing order
of maturity, from which the volatility term structure will be inferred.  Once the
calibration is finished, the chosen parameters will reproduce the prices of
these instruments with fairly high precision.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variance_instrument_prices</code></td>
<td>
<p>Central price targets for the variance instruments</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variance_instrument_spreads</code></td>
<td>
<p>Bid-offer spreads used to normalize errors
in variance instrument prices during term structure fitting</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit_instruments</code></td>
<td>
<p>A list of instruments in any order, from which the
mispricing penalties used for judging fit quality will be computed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit_instrument_prices</code></td>
<td>
<p>Central price targets for the variance instruments</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit_instrument_spreads</code></td>
<td>
<p>Bid-offer spreads used to normalize errors
in fit instrument prices during default intensity</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit_instrument_weights</code></td>
<td>
<p>Weights applied to relative errors in fit
instrument prices before summing to form the penalty</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S0</code></td>
<td>
<p>Current underlying price</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_time_steps</code></td>
<td>
<p>Time step count passed on to <code>find_present_value</code>
while fitting instrument values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>const_short_rate</code></td>
<td>
<p>A constant to use for the instantaneous interest rate in case <code>discount_factor_fcn</code>
is not given</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>discount_factor_fcn</code></td>
<td>
<p>A function for computing present values to
time <code>t</code> of various cashflows occurring during this timestep, with
arguments <code>T</code>, <code>t</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments passed to <code>price_with_intensity_link</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>relative_spread_tolerance</code></td>
<td>
<p>Tolerance to apply in
calling <code>fit_variance_cumulation</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_variance_time_steps</code></td>
<td>
<p>Number of time steps to use in
calling <code>fit_variance_cumulation</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Forms implied Black-Scholes volatilities from all supplied mid prices, and their
implied bid and offer prices, as well as from the prices computed by the grid solver. Each
instrument is then assigned an error term component in proportion to its weight
and the pricing error (in implied vol terms) divided by the spread (also in implied
vol terms).
</p>


<h3>See Also</h3>

<p><code>price_with_intensity_link</code> for the pricing function
</p>


</div>