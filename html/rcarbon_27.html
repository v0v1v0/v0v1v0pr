<div class="container">

<table style="width: 100%;"><tr>
<td>permTest</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Random mark permutation test for SPDs</h2>

<h3>Description</h3>

<p>Global and local significance test for comparing shapes of multiple SPDs using random permutations.
</p>


<h3>Usage</h3>

<pre><code class="language-R">permTest(
  x,
  marks,
  timeRange,
  backsight = 10,
  changexpr = expression((t1/t0)^(1/d) - 1),
  nsim,
  bins = NA,
  runm = NA,
  datenormalised = FALSE,
  spdnormalised = FALSE,
  raw = FALSE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A <code>CalDates</code> class object containing the calibrated radiocarbon dates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>marks</code></td>
<td>
<p>A numerical or character vector containing the marks associated to each radiocarbon date.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timeRange</code></td>
<td>
<p>A vector of length 2 indicating the start and end date of the analysis in cal BP.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>backsight</code></td>
<td>
<p>A single numeric value defining the distance in time between the focal year and the backsight year for computing the rate of change. Default is 10.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>changexpr</code></td>
<td>
<p>An expression for calculating the rate of change in SPD between the focal year and a backsight year. Available input options are t1 (the SPD for the focal year), t0 (the SPD for the backsight year), d (the distance between t0 and t1), and any other standard constants and mathematical operators. A sensible default is provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsim</code></td>
<td>
<p>Number of random permutations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bins</code></td>
<td>
<p>A vector indicating which bin each radiocarbon date is assigned to.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>runm</code></td>
<td>
<p>A number indicating the window size of the moving average to smooth the SPD. If set to <code>NA</code> no moving average is applied.Default is NA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datenormalised</code></td>
<td>
<p>If set to TRUE the total probability mass of each calibrated date will be made to sum to unity (the default in most radiocarbon calibration software). This argument will only have an effect if the dates in <code>x</code> were calibrated without normalisation (via normalised=FALSE in the <code>calibrate</code> function), in which case setting <code>datenormalised=TRUE</code> here will rescale each dates probability mass to sum to unity before aggregating the dates, while setting <code>datenormalised=FALSE</code> will ensure unnormalised dates are used for both observed and simulated SPDs. Default is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spdnormalised</code></td>
<td>
<p>A logical variable indicating whether the total probability mass of the SPD is normalised to sum to unity.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raw</code></td>
<td>
<p>A logical variable indicating whether all permuted SPDs should be returned or not. Default is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>A logical variable indicating whether extra information on progress should be reported. Default is TRUE.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function generates a distribution of expected SPDs by randomly shuffling the marks assigned to each <em>bin</em> (see <code>spd</code> for details on binning). The resulting distribution of probabilities for each <em>mark</em> (i.e. group of dates) for each calendar year is z-transformed, and a 95% simulation envelope is computed. Local significant departures are defined as instances where the observed SPD (which is also z-transformed) is outside such envelope. A global significance is also computed by comparing the total "area" outside the simulation envelope in the observed and simulated data.
</p>


<h3>Value</h3>

<p>An object of class <code>SpdPermTest</code> with the following elements
</p>

<ul>
<li>
<p><code>observed</code> A list containing data.frames with the summed probability (column <em>PrDens</em> for each calendar year (column <em>calBP</em> for each mark/group
</p>
</li>
<li>
<p><code>envelope</code> A list containing matrices with the lower and upper bound values of the simulation envelope for each mark/group 
</p>
</li>
<li>
<p><code>pValueList</code> A list of p-value associated with each mark/group  
</p>
</li>
</ul>
<h3>References</h3>

<p>Crema, E.R., Habu, J., Kobayashi, K., Madella, M., (2016). Summed Probability Distribution of 14 C Dates Suggests Regional Divergences in the Population Dynamics of the Jomon Period in Eastern Japan. PLOS ONE 11, e0154809. doi:10.1371/journal.pone.0154809
</p>


<h3>Examples</h3>

<pre><code class="language-R">## compare demographic trajectories in Netherlands and Denmark  
## Not run:  
data(euroevol)
nld.dnk = subset(euroevol,Country=="Netherlands"|Country=="Denmark")
bins = binPrep(nld.dnk$SiteID,nld.dnk$C14Age,h=200)
dates = calibrate(nld.dnk$C14Age,nld.dnk$C14SD,normalised=FALSE)
res = permTest(dates,marks=as.character(nld.dnk$Country),nsim=1000,
bins=bins,runm=200,timeRange=c(10000,4000))
round(res$pValueList,4) #extract p-values
summary(res)
par(mfrow=c(2,1))
plot(res,focalm="Netherlands",main="Netherlands")
plot(res,focalm="Denmark",main="Denmark")

## End(Not run)
</code></pre>


</div>