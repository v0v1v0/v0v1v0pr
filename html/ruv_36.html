<div class="container">

<table style="width: 100%;"><tr>
<td>variance_adjust</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Adjust Estimated Variances
</h2>

<h3>Description</h3>

<p>Calculate rescaled variances, empirical variances, etc.  For use with RUV model fits.
</p>


<h3>Usage</h3>

<pre><code class="language-R">variance_adjust(fit, ctl.idx = NULL, ebayes = TRUE, pooled=TRUE, evar = TRUE,
                rsvar = TRUE, bin = 10, rescaleconst = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>

<p>A RUV model fit (a list), as returned by RUV2 / RUV4 / RUVinv / RUVrinv
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ctl.idx</code></td>
<td>

<p>An index vector to specify the negative controls for use with the rescaled variances method.  If unspecified, by default <code>fit$ctl</code> is used.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ebayes</code></td>
<td>

<p>A logical variable.  Should empirical bayes variance estimates be calculated?
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pooled</code></td>
<td>

<p>A logical variable.  Should pooled variance estimates be calculated?
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>evar</code></td>
<td>

<p>A logical variable.  Should empirical variance estimates be calculated?
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rsvar</code></td>
<td>

<p>A logical variable.  Should rescaled variance estimates be calculated?
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bin</code></td>
<td>

<p>The bin size to use when calculating empirical variances.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rescaleconst</code></td>
<td>

<p>Can be used to speed up execution.  See <code>get_empirical_variances</code>.
</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An RUV model fit (a list).  In addition to the elements of the list returned by RUV2 / RUV4 / RUVinv / RUVrinv, the list will now contain:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>sigma2.ebayes</code></td>
<td>
<p>Estimates of sigma^2 using the empirical bayes shrinkage method of Smyth (2004)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df.ebayes</code></td>
<td>
<p>Estimate of degrees of freedom using the empirical bayes shrinkage method of Smyth (2004)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma2.pooled</code></td>
<td>
<p>Estimate of sigma^2 pooled (averaged) over all genes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df.pooled</code></td>
<td>
<p>Degrees of freedom for pooled estimate</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varbetahat</code></td>
<td>
<p>"Standard" estimate of the variance of <code>betahat</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varbetahat.rsvar</code></td>
<td>
<p>"Rescaled Variances" estimate of the variance of <code>betahat</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varbetahat.evar</code></td>
<td>
<p>"Empirical Variances" estimate of the variance of <code>betahat</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varbetahat.ebayes</code></td>
<td>
<p>"Empirical Bayes" estimate of the variance of <code>betahat</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varbetahat.rsvar.ebayes</code></td>
<td>
<p>"Rescaled Empirical Bayes" estimate of the variance of <code>betahat</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varbetahat.pooled</code></td>
<td>
<p>"Pooled" estimate of the variance of <code>betahat</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varbetahat.rsvar.pooled</code></td>
<td>
<p>"Rescaled pooled" estimate of the variance of <code>betahat</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varbetahat.evar.pooled</code></td>
<td>
<p>Similar to the above, but all genes used to determine the rescaling, not just control genes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.rsvar</code></td>
<td>
<p>P-values, after applying the method of rescaled variances</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.evar</code></td>
<td>
<p>P-values, after applying the method of empirical variances</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.ebayes</code></td>
<td>
<p>P-values, after applying the empirical bayes method of Smyth (2004)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.pooled</code></td>
<td>
<p>P-values, after pooling variances</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.rsvar.ebayes</code></td>
<td>
<p>P-values, after applying the empirical bayes method of Smyth (2004) and the method of rescaled variances</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.rsvar.pooled</code></td>
<td>
<p>P-values, after pooling variances and the method of rescaled variances</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.evar.pooled</code></td>
<td>
<p>Similar to the above, but all genes used to determine the rescaling, not just control genes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Fpvals.ebayes</code></td>
<td>
<p>F test p-values, after applying the empirical bayes method of Smyth (2004)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Fpvals.pooled</code></td>
<td>
<p>F test p-values, after pooling variances</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.BH</code></td>
<td>
<p>FDR-adjusted p-values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Fpvals.BH</code></td>
<td>
<p>FDR-adjusted p-values (from F test)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.rsvar.BH</code></td>
<td>
<p>FDR-adjusted p-values (from p.rsvar)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.evar.BH</code></td>
<td>
<p>FDR-adjusted p-values (from p.evar)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.ebayes.BH</code></td>
<td>
<p>FDR-adjusted p-values (from p.ebayes)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.rsvar.ebayes.BH</code></td>
<td>
<p>FDR-adjusted p-values (from p.rsvar.ebayes)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Fpvals.ebayes.BH</code></td>
<td>
<p>FDR-adjusted F test p-values (from Fpvals.ebayes)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.pooled.BH</code></td>
<td>
<p>FDR-adjusted p-values (from p.pooled)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.rsvar.pooled.BH</code></td>
<td>
<p>FDR-adjusted p-values (from p.rsvar.pooled)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.evar.pooled.BH</code></td>
<td>
<p>FDR-adjusted p-values (from p.evar.pooled)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Fpvals.pooled.BH</code></td>
<td>
<p>FDR-adjusted F test p-values (from Fpvals.pooled)</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Johann Gagnon-Bartsch
</p>


<h3>References</h3>

<p>Using control genes to correct for unwanted variation in microarray data.  Gagnon-Bartsch and Speed, 2012.  Available at: <a href="http://biostatistics.oxfordjournals.org/content/13/3/539.full">http://biostatistics.oxfordjournals.org/content/13/3/539.full</a>. 
</p>
<p>Removing Unwanted Variation from High Dimensional Data with Negative Controls.  Gagnon-Bartsch, Jacob, and Speed, 2013.  Available at: <a href="http://statistics.berkeley.edu/tech-reports/820">http://statistics.berkeley.edu/tech-reports/820</a>.
</p>
<p>Linear models and empirical bayes methods for assessing differential expression in microarray experiments.  Smyth, 2004.
</p>


<h3>See Also</h3>

<p><code>RUV2</code>, <code>RUV4</code>, <code>RUVinv</code>, <code>RUVrinv</code>, <code>get_empirical_variances</code>, <code>sigmashrink</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Create some simulated data
m = 50
n = 10000
nc = 1000
p = 1
k = 20
ctl = rep(FALSE, n)
ctl[1:nc] = TRUE
X = matrix(c(rep(0,floor(m/2)), rep(1,ceiling(m/2))), m, p)
beta = matrix(rnorm(p*n), p, n)
beta[,ctl] = 0
W = matrix(rnorm(m*k),m,k)
alpha = matrix(rnorm(k*n),k,n)
epsilon = matrix(rnorm(m*n),m,n)
Y = X%*%beta + W%*%alpha + epsilon

## Run RUV-inv
fit = RUVinv(Y, X, ctl)

## Get adjusted variances and p-values
fit = variance_adjust(fit)
</code></pre>


</div>