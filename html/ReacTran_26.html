<div class="container">

<table style="width: 100%;"><tr>
<td>tran.cylindrical</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Diffusive Transport in cylindrical (r, theta, z) and spherical (r, theta, phi)
coordinates.
</h2>

<h3>Description</h3>

<p>Estimates the transport term (i.e. the rate of change of a concentration
due to diffusion) in a cylindrical (r, theta, z) or spherical (r, theta, phi) 
coordinate system.
</p>


<h3>Usage</h3>

<pre><code class="language-R">tran.cylindrical (C, C.r.up = NULL, C.r.down = NULL, 
                  C.theta.up = NULL, C.theta.down = NULL, 
                  C.z.up = NULL, C.z.down = NULL, 
                  flux.r.up = NULL, flux.r.down = NULL, 
                  flux.theta.up = NULL, flux.theta.down = NULL,          
                  flux.z.up = NULL, flux.z.down = NULL, 
                  cyclicBnd = NULL,
                  D.r = NULL, D.theta = D.r, D.z = D.r, 
                  r = NULL, theta = NULL, z = NULL)

tran.spherical (C, C.r.up = NULL, C.r.down = NULL, 
                C.theta.up = NULL, C.theta.down = NULL, 
                C.phi.up = NULL, C.phi.down = NULL, 
                flux.r.up = NULL, flux.r.down = NULL, 
                flux.theta.up = NULL, flux.theta.down = NULL,          
                flux.phi.up = NULL, flux.phi.down = NULL, 
                cyclicBnd = NULL,
                D.r = NULL, D.theta = D.r, D.phi = D.r, 
                r = NULL, theta = NULL, phi = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>C </code></td>
<td>
<p>concentration, expressed per unit volume, defined at the centre
of each grid cell; Nr*Nteta*Nz (cylindrica) or Nr*Ntheta*Nphi (spherical
coordinates) array [M/L3].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C.r.up </code></td>
<td>
<p>concentration at upstream boundary in r(x)-direction; 
one value [M/L3].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C.r.down </code></td>
<td>
<p>concentration at downstream boundary in r(x)-direction;
one value [M/L3].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C.theta.up </code></td>
<td>
<p>concentration at upstream boundary in theta-direction;
one value [M/L3].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C.theta.down </code></td>
<td>
<p>concentration at downstream boundary in theta-direction;
one value [M/L3].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C.z.up </code></td>
<td>
<p>concentration at upstream boundary in z-direction (cylindrical
coordinates); one value [M/L3].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C.z.down </code></td>
<td>
<p>concentration at downstream boundary in z-direction(cylindrical
coordinates); one value [M/L3].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C.phi.up </code></td>
<td>
<p>concentration at upstream boundary in phi-direction (spherical
coordinates); one value [M/L3].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C.phi.down </code></td>
<td>
<p>concentration at downstream boundary in phi-direction(spherical
coordinates); one value [M/L3].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flux.r.up </code></td>
<td>
<p>flux across the upstream boundary in r-direction,
positive = INTO model domain; one value [M/L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flux.r.down </code></td>
<td>
<p>flux across the downstream boundary in r-direction,
positive = OUT of model domain; one value [M/L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flux.theta.up </code></td>
<td>
<p>flux across the upstream boundary in theta-direction,
positive = INTO model domain; one value [M/L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flux.theta.down </code></td>
<td>
<p>flux across the downstream boundary in theta-direction,
positive = OUT of model domain; one value [M/L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flux.z.up </code></td>
<td>
<p>flux across the upstream boundary in z-direction(cylindrical
coordinates); positive = INTO model domain; one value [M/L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flux.z.down </code></td>
<td>
<p>flux across the downstream boundary in z-direction,
(cylindrical coordinates); positive = OUT of model domain; one value [M/L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flux.phi.up </code></td>
<td>
<p>flux across the upstream boundary in phi-direction(spherical
coordinates); positive = INTO model domain; one value [M/L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flux.phi.down </code></td>
<td>
<p>flux across the downstream boundary in phi-direction,
(spherical coordinates); positive = OUT of model domain; one value [M/L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cyclicBnd </code></td>
<td>
<p>If not <code>NULL</code>, the direction in which a cyclic 
boundary is defined, i.e. <code>cyclicBnd = 1</code> for the <code>r</code> direction, 
<code>cyclicBnd = 2</code> for the <code>theta</code> direction and 
<code>cyclicBnd = c(1,2)</code> for both the <code>r</code> and <code>theta</code> direction.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>D.r </code></td>
<td>
<p>diffusion coefficient in r-direction, defined on grid cell
interfaces. One value or a vector of length (Nr+1), [L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>D.theta </code></td>
<td>
<p>diffusion coefficient in theta-direction, defined on grid cell
interfaces. One value or or a vector of length (Ntheta+1), [L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>D.z </code></td>
<td>
<p>diffusion coefficient in z-direction, defined on grid cell
interfaces for cylindrical coordinates. One value or a vector of length 
(Nz+1) [L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>D.phi </code></td>
<td>
<p>diffusion coefficient in phi-direction, defined on grid cell
interfaces for cylindrical coordinates. One value or a vector of length 
(Nphi+1) [L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r </code></td>
<td>
<p>position of adjacent cell interfaces in the r-direction. 
A vector of length Nr+1 [L].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta </code></td>
<td>
<p>position of adjacent cell interfaces in the theta-direction.
A vector of length Ntheta+1 [L].  Theta should be within [0,2 pi]
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z </code></td>
<td>
<p>position of adjacent cell interfaces in the z-direction (cylindrical
coordinates). A vector of length Nz+1 [L].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi </code></td>
<td>
<p>position of adjacent cell interfaces in the phi-direction (spherical
coordinates). A vector of length Nphi+1 [L]. Phi should be within [0,2 pi]
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>tran.cylindrical</code> performs (diffusive) transport in cylindrical coordinates
</p>
<p><code>tran.spherical</code> performs (diffusive) transport in spherical coordinates
</p>
<p>The <b>boundary conditions</b> are either
</p>

<ul>
<li>
<p> (1) zero gradient
</p>
</li>
<li>
<p> (2) fixed concentration
</p>
</li>
<li>
<p> (3) fixed flux
</p>
</li>
<li>
<p> (4) cyclic boundary
</p>
</li>
</ul>
<p>This is also the order of priority. The cyclic boundary overrules the other.
If fixed concentration, fixed flux, and cyclicBnd are <code>NULL</code> then
the boundary is zero-gradient
</p>
<p>A cyclic boundary condition has concentration and flux at upstream and 
downstream boundary the same. It is useful mainly for the <code>theta</code> and 
<code>phi</code> direction.
</p>
<p>** Do  not expect too much of this equation: do not try to use it with 
many boxes ** 
</p>


<h3>Value</h3>

<p>a list containing:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>dC </code></td>
<td>
<p>the rate of change of the concentration C due to transport,
defined in the centre of each grid cell, a Nr*Nteta*Nz (cylindrical) or 
Nr*Ntheta*Nphi (spherical coordinates) array. [M/L3/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flux.r.up </code></td>
<td>
<p>flux across the upstream boundary in r-direction,
positive = INTO model domain. A matrix of dimension Nteta*Nz (cylindrical) 
or Ntheta*Nphi (spherical) [M/L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flux.r.down </code></td>
<td>
<p>flux across the downstream boundary in r-direction,
positive = OUT of model domain. A matrix of dimension Nteta*Nz (cylindrical)
or Ntheta*Nphi (spherical) [M/L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flux.theta.up </code></td>
<td>
<p>flux across the upstream boundary in theta-direction,
positive = INTO model domain. A matrix of dimension Nr*Nz (cylindrical) or 
or Nr*Nphi (spherical) [M/L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flux.theta.down </code></td>
<td>
<p>flux across the downstream boundary in theta-direction,
positive = OUT of model domain. A matrix of dimension Nr*Nz (cylindrical) or 
Nr*Nphi (spherical) [M/L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flux.z.up </code></td>
<td>
<p>flux across the upstream boundary in z-direction,
for cylindrical coordinates; 
positive = OUT of model domain. A matrix of dimension Nr*Nteta [M/L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flux.z.down </code></td>
<td>
<p>flux across the downstream boundary in z-direction 
for cylindrical coordinates; 
positive = OUT of model domain. A matrix of dimension Nr*Nteta [M/L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flux.phi.up </code></td>
<td>
<p>flux across the upstream boundary in phi-direction,
for spherical coordinates;
positive = OUT of model domain. A matrix of dimension Nr*Nteta [M/L2/T].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flux.phi.down </code></td>
<td>
<p>flux across the downstream boundary in phi-direction,
for spherical coordinates;
positive = OUT of model domain. A matrix of dimension Nr*Nteta [M/L2/T].
</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code>tran.polar</code> 
for a discretisation of 2-D transport equations in polar coordinates
</p>
<p><code>tran.1D</code>,   <code>tran.2D</code>,  <code>tran.3D</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## =============================================================================
## Testing the functions
## =============================================================================
# Grid definition
r.N     &lt;- 4   # number of cells in r-direction
theta.N &lt;- 6   # number of cells in theta-direction
z.N     &lt;- 3   # number of cells in z-direction

D       &lt;- 100 # diffusion coefficient
 
r      &lt;- seq(0,   8, len = r.N+1)       # cell size r-direction [cm]
theta  &lt;- seq(0,2*pi, len = theta.N+1)   # theta-direction - theta: from 0, 2pi
phi    &lt;- seq(0,2*pi, len = z.N+1)       # phi-direction (0,2pi)
z      &lt;- seq(0,5, len = z.N+1)          # cell size z-direction [cm]
 
# Intial conditions 
C &lt;- array(dim = c(r.N, theta.N, z.N), data = 0)

# Concentration boundary conditions
tran.cylindrical (C = C, D.r = D, D.theta = D, 
  C.r.up = 1, C.r.down = 1,
  C.theta.up = 1, C.theta.down = 1, 
  C.z.up = 1, C.z.down = 1,
  r = r, theta = theta, z = z )

tran.spherical (C = C, D.r = D, D.theta = D, 
  C.r.up = 1, C.r.down = 1, C.theta.up = 1, C.theta.down = 1, 
  C.phi.up = 1, C.phi.down = 1,
  r = r, theta = theta, phi = phi)

# Flux boundary conditions
tran.cylindrical(C = C, D.r = D, r = r, theta = theta, z = z,
  flux.r.up = 10, flux.r.down = 10,
  flux.theta.up = 10, flux.theta.down = 10,
  flux.z.up = 10, flux.z.down = 10)

tran.spherical(C = C, D.r = D, r = r, theta = theta, phi = phi,
  flux.r.up = 10, flux.r.down = 10,
  flux.theta.up = 10, flux.theta.down = 10,
  flux.phi.up = 10, flux.phi.down = 10)

# cyclic boundary conditions
tran.cylindrical(C = C, D.r = D, r = r, theta = theta, z = z,
  cyclicBnd = 1:3)
tran.spherical(C = C, D.r = D, r = r, theta = theta, phi = phi,
  cyclicBnd = 1:3)

# zero-gradient boundary conditions
tran.cylindrical(C = C, D.r = D, r = r, theta = theta, z = z)
tran.spherical(C = C, D.r = D, r = r, theta = theta, phi = phi)

## =============================================================================
## A model with diffusion and first-order consumption
## =============================================================================

N     &lt;- 10          # number of grid cells
rr    &lt;- 0.005       # consumption rate
D     &lt;- 400

r       &lt;- seq (2, 4, len = N+1)
theta   &lt;- seq (0, 2*pi, len = N+1)
z       &lt;- seq (0, 3, len = N+1)
phi     &lt;- seq (0, 2*pi, len = N+1)

# The model equations
Diffcylin &lt;- function (t, y, parms)  {
  CONC  &lt;- array(dim = c(N, N, N), data = y)
  tran  &lt;- tran.cylindrical(CONC, 
        D.r = D, D.theta = D, D.z = D,
        r = r, theta = theta, z = z,
        C.r.up = 0,  C.r.down = 1,
        cyclicBnd = 2)
  dCONC &lt;- tran$dC  - rr * CONC
  return (list(dCONC))
}

Diffspher &lt;- function (t, y, parms)  {
  CONC  &lt;- array(dim = c(N, N, N), data = y)
  tran  &lt;- tran.spherical (CONC, 
        D.r = D, D.theta = D, D.phi = D,
        r = r, theta = theta, phi = phi,
        C.r.up = 0,  C.r.down = 1,
        cyclicBnd = 2:3)
  dCONC &lt;- tran$dC  - rr * CONC
  return (list(dCONC))
}

# initial condition: 0 everywhere, except in central point
y   &lt;- array(dim = c(N, N, N), data = 0)
N2  &lt;- ceiling(N/2)

y[N2, N2, N2] &lt;- 100  # initial concentration in the central point...

# solve to steady-state; cyclicBnd = 2, 
outcyl &lt;- steady.3D (y = y, func = Diffcylin, parms = NULL,
                  dim = c(N, N, N), lrw = 1e6, cyclicBnd = 2)

STDcyl &lt;- array(dim = c(N, N, N), data = outcyl$y)
image(STDcyl[,,1])

# For spherical coordinates, cyclic Bnd = 2, 3
outspher &lt;- steady.3D (y = y, func = Diffspher, parms = NULL, pos=TRUE,
                  dim = c(N, N, N), lrw = 1e6, cyclicBnd = 2:3)

#STDspher &lt;- array(dim = c(N, N, N), data = outspher$y)
#image(STDspher[,,1])

## Not run: 
  image(outspher)

## End(Not run)          
</code></pre>


</div>