<div class="container">

<table style="width: 100%;"><tr>
<td>rpm_MLPLE</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit a Revealed Preference Matchings Model</h2>

<h3>Description</h3>

<p><code>rpm_MLPLE</code> estimates the parameters of a revealed preference model
for men and women of certain
characteristics (or shared characteristics) of people of the opposite sex.
The model assumes a one-to-one stable matching using an observed set of
matchings and a set of (possibly dyadic) covariates to 
estimate the parameters for
linear equations of utilities.
It does this using an large-population likelihood based on ideas from Dagsvik (2000), Menzel (2015) and Goyal et al (2023).
</p>


<h3>Usage</h3>

<pre><code class="language-R">rpm_MLPLE(
  formula,
  Xdata,
  Zdata,
  Xid = NULL,
  Zid = NULL,
  pair_id = NULL,
  X_w = NULL,
  Z_w = NULL,
  pair_w = NULL,
  sampled = NULL,
  sampling_design = "stock-flow",
  fixed.margins = fixed.margins,
  control = control.rpm(),
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>formula; an <code>formula</code> object, of the form <code>
~ &lt;model terms&gt;</code>. For the details on the possible <code>&lt;model terms&gt;</code>, see
<code>rpm-terms</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xdata</code></td>
<td>
<p>data.frame for women. Each row is a woman, each column is a variable on that women
or her partnerships. It must contain the women's ID variable (see <code>Xid</code>) and
a variable with the ID of the women's partner. If the women is single the men's ID should be NA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Zdata</code></td>
<td>
<p>data.frame for men. Each row is a man, each column is a variable on that men
It must contain the men's ID variable (see <code>Zid</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xid</code></td>
<td>
<p>string The name of the variable in <code>Xdata</code> containing the IDs of the women.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Zid</code></td>
<td>
<p>string The name of the variable in <code>Zdata</code> containing the IDs of the men.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pair_id</code></td>
<td>
<p>string The name of the variable in <code>Xdata</code> containing the ID of the men paired with the women in
<code>Xid</code>. If the women is not paired it must be NA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X_w</code></td>
<td>
<p>string The name of the variable in <code>Xdata</code> containing the individual weight of the women.
If this is NULL then it is assumed the sample is unweighted from a population with 2000 women in it.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z_w</code></td>
<td>
<p>string The name of the variable in <code>Zdata</code> containing the individual weight of the man
If this is NULL then it is assumed the sample is unweighted from a population with 2000 men in it.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pair_w</code></td>
<td>
<p>string The name of the variable in <code>Xdata</code> containing the pair weight of that women.
If the women is not paired it should be NA.
If this is NULL then it is computed from the individual weights using the <code>sampling_design</code>.
Note that the pair weights currently do not play a role in the estimation. They do in the quasi-likelihood version of the code.
If this is NULL then it is assumed the sample is unweighted from a population with 2000 men in it.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sampled</code></td>
<td>
<p>string The name of the logical variable in <code>Xdata</code> and <code>Zdata</code> containing the 
indicator that the person was sampled directly (as distinct from being included as the match of a directly sampled
person. All single people are directly sampled.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sampling_design</code></td>
<td>
<p>string; The name of the sampling protocol used to select the survey data. Valid values are
<code>"stock-flow"</code> (default) (individuals are sampled, data contains both
singles and couples);
<code>"stock-stock"</code> (households are sampled, each household can be a single or a couple);
<code>"census"</code> (the sample is a census of the population of people).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed.margins</code></td>
<td>
<p>list If not NULL the numbers of men and women (i.e, in <code>pmfW</code> and <code>pmfM</code>) are assumed determined by
outside information and are hence fixed. In this case <code>fixed.margins</code> should be a list with two elements. The first is
a vector of women's margins for each type and the second is the men's margins for each type.
The default, NULL, means these are estimated from sample data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>A list of control parameters for algorithm tuning. Constructed using
<code>control.rpm</code>, which should be consulted for specifics.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical; if this is <code>TRUE</code>, the program will print out
additional information, including data summary statistics.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>It is usually called via the <code>rpm</code> function.
</p>
<p>The pairings are determined by the <code>pair_id</code> variable in <code>Xdata</code>. 
If that variable is NA then the women is
assumed to be single. If men are listed in <code>Zdata</code> and are not partnered then they are assumed single.
Weights are specified by three optional variables in <code>Xdata</code>.
</p>

<dl>
<dt>X_w</dt>
<dd>
<p>: This is character string of the name of the weight variable for women. The sum of the weights should be the
number of women in the population.</p>
</dd>
<dt>Z_w</dt>
<dd>
<p>: This is character string of the name of the weight variable for men. The sum of the weights should be the
number of men in the population.</p>
</dd>
<dt>pair_w</dt>
<dd>
<p>: This is character string of the name of the weight variable for pairs.</p>
</dd>
</dl>
<h3>Value</h3>

<p><code>rpm</code> returns an object of class <code>rpm.object</code>
that is a list consisting of the following elements: 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>coefficients</code></td>
<td>
<p>The bias-corrected bootstrap estimate of <code class="reqn">\theta</code>, the vector of
coefficients for the model parameters. This includes the model <code class="reqn">\beta</code> and the model <code class="reqn">\Gamma</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loglik</code></td>
<td>
<p>The value of the maximized log-likelihood.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exitflag</code></td>
<td>
<p>integer value with the status of the optimization (4 is success as 
<code>xtol_rel</code> or <code>xtol_abs</code> was reached). Other codes are 1 = generic success; 2 = optimization stopped because 
<code>ftol_rel</code> or <code>ftol_abs</code> was reached; 3 = optimization stopped 
because <code>stopval</code> was reached; 4 = optimization stopped because <code>xtol_rel</code> or <code>xtol_abs</code> was reached; 
5 = optimization stopped because
<code>maxeval</code> was reached; 6 = optimization stopped because <code>maxtime</code> was reached.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the call that was made to <code>nloptr</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x0</code></td>
<td>
<p>vector with starting values for the optimization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>message</code></td>
<td>
<p>more informative message with the status of the optimization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iterations</code></td>
<td>
<p>number of iterations that were executed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>objective</code></td>
<td>
<p>value if the objective function in the solution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>solution</code></td>
<td>
<p>optimal value of the controls.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>version</code></td>
<td>
<p>version of NLopt that was used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covar</code></td>
<td>
<p>Approximate covariance matrix of the estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eq</code></td>
<td>
<p>Values from the equality constraints. Larger values indicate non-convergence.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Goyal, Shuchi; Handcock, Mark S.; Jackson, Heide M.; Rendall, Michael S. and Yeung, Fiona C. (2023).
<em>A Practical Revealed Preference Model for Separating Preferences and Availability Effects in Marriage Formation</em>,
<em>Journal of the Royal Statistical Society</em>, A. <a href="https://doi.org/10.1093/jrsssa/qnad031">doi:10.1093/jrsssa/qnad031</a> 
</p>
<p>Dagsvik, John K. (2000) <em>Aggregation in Matching Markets</em> <em>International Economic Review</em>, Vol. 41, 27-57.
JSTOR: https://www.jstor.org/stable/2648822, <a href="https://doi.org/10.1111/1468-2354.00054">doi:10.1111/1468-2354.00054</a>
</p>
<p>Menzel, Konrad (2015).
<em>Large Matching Markets as Two-Sided Demand Systems</em>
Econometrica, Vol. 83, No. 3 (May, 2015), 897-941. <a href="https://doi.org/10.3982/ECTA12299">doi:10.3982/ECTA12299</a>
</p>


<h3>See Also</h3>

<p>control.rpm, summary.rpm, print.rpm
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(rpm)

data(fauxmatching)
fit &lt;- rpm(~match("edu") + WtoM_diff("edu",3),
          Xdata=fauxmatching$Xdata, Zdata=fauxmatching$Zdata,
          X_w="X_w", Z_w="Z_w",
          pair_w="pair_w", pair_id="pair_id", Xid="pid", Zid="pid",
          sampled="sampled",sampling_design="stock-flow")
summary(fit)

</code></pre>


</div>