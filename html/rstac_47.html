<div class="container">

<table style="width: 100%;"><tr>
<td>assets_functions</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Assets functions</h2>

<h3>Description</h3>

<p>These functions provide support to work with <code>doc_items</code> and
<code>doc_item</code> item objects.
</p>

<ul>
<li> <p><code>assets_download()</code>: Downloads the assets provided by the STAC API.
</p>
</li>
<li> <p><code>assets_url()</code>: <a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt="[Experimental]"></a> Returns a
character vector with each asset href. For the URL, you can add the
GDAL library drivers for the following schemes: HTTP/HTTPS files,
S3 (AWS S3) and GS (Google Cloud Storage).
</p>
</li>
<li> <p><code>assets_select()</code>: <a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt="[Experimental]"></a> Selects the
assets of each item by its name (<code>asset_names</code> parameter), by expressions
(<code>...</code> parameter), or by a selection function (<code>select_fn</code> parameter).
Note: This function can produce items with empty assets. In this case,
users can use the <code>items_compact()</code> function to remove items with no
assets.
</p>
</li>
<li> <p><code>assets_rename()</code>: <a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt="[Experimental]"></a> Rename each
asset using a named list or a function.
</p>
</li>
</ul>
<h3>Usage</h3>

<pre><code class="language-R">assets_download(
  items,
  asset_names = NULL,
  output_dir = getwd(),
  overwrite = FALSE,
  ...,
  use_gdal = FALSE,
  download_fn = NULL
)

## S3 method for class 'doc_item'
assets_download(
  items,
  asset_names = NULL,
  output_dir = getwd(),
  overwrite = FALSE,
  ...,
  use_gdal = FALSE,
  create_json = FALSE,
  download_fn = NULL
)

## S3 method for class 'doc_items'
assets_download(
  items,
  asset_names = NULL,
  output_dir = getwd(),
  overwrite = FALSE,
  ...,
  use_gdal = FALSE,
  download_fn = NULL,
  create_json = TRUE,
  items_max = Inf,
  progress = TRUE
)

## Default S3 method:
assets_download(
  items,
  asset_names = NULL,
  output_dir = getwd(),
  overwrite = FALSE,
  ...,
  use_gdal = FALSE,
  create_json = FALSE,
  download_fn = NULL
)

assets_url(items, asset_names = NULL, append_gdalvsi = FALSE)

## S3 method for class 'doc_item'
assets_url(items, asset_names = NULL, append_gdalvsi = FALSE)

## S3 method for class 'doc_items'
assets_url(items, asset_names = NULL, append_gdalvsi = FALSE)

## Default S3 method:
assets_url(items, asset_names = NULL, append_gdalvsi = FALSE)

assets_select(items, ..., asset_names = NULL, select_fn = NULL)

## S3 method for class 'doc_item'
assets_select(items, ..., asset_names = NULL, select_fn = NULL)

## S3 method for class 'doc_items'
assets_select(items, ..., asset_names = NULL, select_fn = NULL)

## Default S3 method:
assets_select(items, ..., asset_names = NULL, select_fn = NULL)

assets_rename(items, mapper = NULL, ...)

## S3 method for class 'doc_item'
assets_rename(items, mapper = NULL, ...)

## S3 method for class 'doc_items'
assets_rename(items, mapper = NULL, ...)

## Default S3 method:
assets_rename(items, mapper = NULL, ...)

has_assets(items)

## S3 method for class 'doc_item'
has_assets(items)

## S3 method for class 'doc_items'
has_assets(items)

## Default S3 method:
has_assets(items)

asset_key()

asset_eo_bands(field)

asset_raster_bands(field)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>items</code></td>
<td>
<p>a <code>doc_item</code> or <code>doc_items</code> object
representing the result of <code style="white-space: pre;">⁠/stac/search⁠</code>,
<code>/collections/{collectionId}/items</code> or
<code>/collections/{collectionId}/items/{itemId}</code> endpoints.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>asset_names</code></td>
<td>
<p>a <code>character</code> vector with the names of the assets
to be selected.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output_dir</code></td>
<td>
<p>a <code>character</code> directory in which the assets will be
saved. Default is the working directory (<code>getwd()</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overwrite</code></td>
<td>
<p>a <code>logical</code> if TRUE will replace the existing file,
if FALSE, a warning message is shown.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_gdal</code></td>
<td>
<p>a <code>logical</code> indicating if the file should be downloaded
by GDAL instead httr package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>download_fn</code></td>
<td>
<p>a <code>function</code> to handle download of assets for
each item to be downloaded. Using this function, you can change the
hrefs for each asset, as well as the way download is done.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>create_json</code></td>
<td>
<p>a <code>logical</code> indicating if a JSON file with item
metadata (<code>doc_item</code> or <code>doc_items</code>) must be created in the
output directory.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>items_max</code></td>
<td>
<p>a <code>numeric</code> corresponding to how many items will be
downloaded.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progress</code></td>
<td>
<p>a <code>logical</code> indicating if a progress bar must be
shown or not. Defaults to <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>append_gdalvsi</code></td>
<td>
<p>a <code>logical</code> value. If true, gdal drivers are
included in the URL of each asset. The following schemes are supported:
HTTP/HTTPS files, S3 (AWS S3) and GS (Google Cloud Storage).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>select_fn</code></td>
<td>
<p>a <code>function</code> to select assets an item
(<code>doc_item</code> or <code>doc_items</code>). This function receives as parameter
the asset element and, optionally, the asset name. Asset elements
contain metadata describing spatial-temporal objects. Users can provide
a function to select assets based on this metadata by returning a
logical value where <code>TRUE</code> selects the asset, and <code>FALSE</code> discards it.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mapper</code></td>
<td>
<p>either a named <code>list</code> or a <code>function</code> to rename assets
of an item (<code>doc_item</code> or <code>doc_items</code>). In the case of a named
list, use <code style="white-space: pre;">⁠&lt;old name&gt; = &lt;new name&gt;⁠</code> to rename the assets. The function
can be used to rename the assets by returning a <code>character</code> string using
the metadata contained in the asset object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>field</code></td>
<td>
<p>a <code>character</code> with the name of the asset field to
return.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Ellipsis argument (<code>...</code>) appears in different assets functions and
has distinct purposes:
</p>

<ul>
<li> <p><code>assets_download()</code>: ellipsis is used to pass
additional <code>httr</code> options to GET or POST
methods, such as add_headers or
set_cookies.
</p>
</li>
<li> <p><code>assets_select()</code>: ellipsis is used to pass expressions that will
be evaluated against each asset metadata. Expressions must be evaluated as
a logical value where <code>TRUE</code> selects the asset and <code>FALSE</code> discards it.
Multiple expressions are combine with <code>AND</code> operator. Expressions can
use <code>asset</code> helper functions (i.e. <code>asset_key()</code>, <code>asset_eo_bands()</code>,
and <code>asset_raster_bands()</code>). Multiple expressions are combined with
<code>AND</code> operator. <code>assets_select()</code> uses non-standard evaluation to evaluate
its expressions. That means users must escape any variable or call to
be able to use them in the expressions. The escape is done by using
<code>double-curly-braces</code>, i.e., <code>{{variable}}</code>.
</p>
<p><strong>WARNING:</strong> Errors in the evaluation of expressions are
considered as <code>FALSE</code>.
</p>
</li>
<li> <p><code>assets_rename()</code>: ellipsis is used to pass named parameters
to be processed in the same way as the named list in <code>mapper</code> argument.
</p>
</li>
</ul>
<h3>Value</h3>


<ul>
<li> <p><code>assets_download()</code>: returns the same input object item
(<code>doc_item</code> or <code>doc_items</code>) where <code>href</code> properties point to
the download assets.
</p>
</li>
<li> <p><code>assets_url()</code>: returns a character vector with all assets <code>href</code>
of an item (<code>doc_item</code> or <code>doc_items</code>).
</p>
</li>
<li> <p><code>assets_select()</code>: returns the same input object item
(<code>doc_item</code> or <code>doc_items</code>) with the selected assets.
</p>
</li>
<li> <p><code>assets_rename()</code>: returns the same input object item
(<code>doc_items</code> or <code>doc_item</code>) with the assets renamed.
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>stac_search()</code>, <code>items()</code>, <code>get_request()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
 # assets_download function
 stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
   stac_search(collections = "CB4-16D-2",
               datetime = "2019-06-01/2019-08-01") %&gt;%
   stac_search() %&gt;%
   get_request() %&gt;%
   assets_download(asset_names = "thumbnail", output_dir = tempdir())

## End(Not run)

## Not run: 
 # assets_url function
 stac_item &lt;- stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
  stac_search(collections = "CB4-16D-2", limit = 100,
         datetime = "2017-08-01/2018-03-01",
         bbox = c(-48.206,-14.195,-45.067,-12.272)) %&gt;%
  get_request() %&gt;% items_fetch(progress = FALSE)

 stac_item %&gt;% assets_url()

## End(Not run)

## Not run: 
 # assets_select function
 stac_item &lt;- stac("https://brazildatacube.dpi.inpe.br/stac/") %&gt;%
  stac_search(collections = "CB4-16D-2", limit = 100,
         datetime = "2017-08-01/2018-03-01",
         bbox = c(-48.206,-14.195,-45.067,-12.272)) %&gt;%
  get_request() %&gt;% items_fetch(progress = FALSE)

 stac_item %&gt;% assets_select(asset_names = "NDVI")

## End(Not run)

## Not run: 
items &lt;- stac("https://planetarycomputer.microsoft.com/api/stac/v1") %&gt;%
  stac_search(collections = c("landsat-8-c2-l2", "sentinel-2-l2a"),
              bbox = c(xmin = -64.85976089, ymin = -10.49199395,
                       xmax = -64.79272527, ymax =-10.44736091),
              datetime = "2019-01-01/2019-06-28",
              limit = 50) %&gt;%
  post_request()

# Selects assets by name
items &lt;- assets_select(items,
                       asset_names = c("B02", "B03", "SR_B1", "SR_B2"))
# Renames the landsat assets
items &lt;- assets_rename(items,
                       SR_B1 = "blue",
                       SR_B2 = "green",
                       B02   = "blue",
                       B03   = "green")
# Get the assets url's
assets_url(items)

## End(Not run)

</code></pre>


</div>