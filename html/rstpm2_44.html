<div class="container">

<table style="width: 100%;"><tr>
<td>nsx</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generate a Basis Matrix for Natural Cubic Splines (with eXtensions)</h2>

<h3>Description</h3>

<p>Generate the B-spline basis matrix for a natural cubic spline (with eXtensions).
</p>


<h3>Usage</h3>

<pre><code class="language-R">nsx(x, df = NULL, knots = NULL, intercept = FALSE,
    Boundary.knots = range(x), derivs = if (cure) c(2, 1) else c(2, 2),
    log = FALSE, centre = FALSE, 
    cure = FALSE, stata.stpm2.compatible = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>the predictor variable.  Missing values are allowed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>degrees of freedom. One can supply <code>df</code> rather than
knots; <code>ns()</code> then chooses <code>df - 1 - intercept + 4 - sum(derivs)</code> knots at
suitably chosen quantiles of <code>x</code> (which will ignore missing values).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>breakpoints that define the spline.  The default is no
knots; together with the natural boundary conditions this results in
a basis for linear regression on <code>x</code>.  Typical values are the
mean or median for one knot, quantiles for more knots.  See also
<code>Boundary.knots</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>
<p>if <code>TRUE</code>, an intercept is included in the
basis; default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Boundary.knots</code></td>
<td>
<p>boundary points at which to impose the natural
boundary conditions and anchor the B-spline basis (default the range
of the data).  If both <code>knots</code> and <code>Boundary.knots</code> are
supplied, the basis parameters do not depend on <code>x</code>. Data can
extend beyond <code>Boundary.knots</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>derivs</code></td>
<td>
<p>an integer vector of length 2 with values between 0 and
2 giving the derivative constraint order at
the left and right boundary knots; an order of 2 constrains the
second derivative to zero (f”(x)=0); an order of 1 constrains the
first and second derivatives to zero (f'(x)=f”(x)=0); an order of 0
constrains the zero, first and second derivatives to zero (f(x)=f'(x)=f”(x)=0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log</code></td>
<td>
<p>a Boolean indicating whether the underlying values have been
log transformed; (deprecated: only used to calculate derivatives in rstpm2:::stpm2Old</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>centre</code></td>
<td>
<p>if specified, then centre the splines at this value
(i.e. f(centre)=0) (default=FALSE)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cure</code></td>
<td>
<p>a Boolean indicated whether to estimate cure; changes the
default derivs argument, such that the right boundary has the first
and second derivatives constrained to zero; defaults to FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stata.stpm2.compatible</code></td>
<td>
<p>a Boolean to determine whether to use
Stata stpm's default knot placement; defaults to FALSE</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A matrix of dimension <code>length(x) * df</code> where either <code>df</code> was
supplied or if <code>knots</code> were supplied,
<code>df = length(knots) + 1 + intercept</code>.
Attributes are returned that correspond to the arguments to <code>ns</code>,
and explicitly give the <code>knots</code>, <code>Boundary.knots</code> etc for
use by <code>predict.nsx()</code>.
</p>
<p><code>nsx()</code> is based on the functions <code>ns</code> and <code>spline.des</code>.  It
generates a basis matrix for representing the family of
piecewise-cubic splines with the specified sequence of
interior knots, and the natural boundary conditions.  These enforce
the constraint that the function is linear beyond the boundary knots,
which can either be supplied, else default to the extremes of the
data.  A primary use is in modeling formula to directly specify a
natural spline term in a model.
</p>
<p>The extensions from <code>ns</code> are: specification of the
derivative constraints at the boundary knots; whether to centre the
knots; incorporation of cure using derivatives; compatible knots
with Stata's stpm2; and an indicator for a log-transformation of
<code>x</code> for calculating derivatives.
</p>


<h3>References</h3>

<p>Hastie, T. J. (1992)
Generalized additive models.
Chapter 7 of <em>Statistical Models in S</em>
eds J. M. Chambers and T. J. Hastie, Wadsworth &amp; Brooks/Cole.
</p>


<h3>See Also</h3>

<p><code>ns</code>, <code>bs</code>, <code>predict.nsx</code>, <code>SafePrediction</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">require(stats); require(graphics); require(splines)
nsx(women$height, df = 5)
summary(fm1 &lt;- lm(weight ~ ns(height, df = 5), data = women))

## example of safe prediction
plot(women, xlab = "Height (in)", ylab = "Weight (lb)")
ht &lt;- seq(57, 73, length.out = 200)
lines(ht, predict(fm1, data.frame(height=ht)))



















</code></pre>


</div>