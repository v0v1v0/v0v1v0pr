<div class="container">

<table style="width: 100%;"><tr>
<td>CNplot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Visualize the spectral condition number against the regularization parameter</h2>

<h3>Description</h3>

<p>Function that visualizes the spectral condition number of the regularized
precision matrix against the domain of the regularization parameter. The
function can be used to heuristically determine an acceptable (minimal)
value for the penalty parameter.
</p>


<h3>Usage</h3>

<pre><code class="language-R">CNplot(
  S,
  lambdaMin,
  lambdaMax,
  step,
  type = "Alt",
  target = default.target(S, type = "DUPV"),
  norm = "2",
  Iaids = FALSE,
  vertical = FALSE,
  value = 1e-100,
  main = "",
  nOutput = FALSE,
  verbose = TRUE,
  suppressChecks = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>S</code></td>
<td>
<p>Sample covariance <code>matrix</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambdaMin</code></td>
<td>
<p>A <code>numeric</code> giving the minimum value for the penalty
parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambdaMax</code></td>
<td>
<p>A <code>numeric</code> giving the maximum value for the penalty
parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>step</code></td>
<td>
<p>An <code>integer</code> determining the number of steps in moving
through the grid [<code>lambdaMin</code>, <code>lambdaMax</code>].</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>A <code>character</code> indicating the type of ridge estimator to be
used. Must be one of: "Alt", "ArchI", "ArchII".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target</code></td>
<td>
<p>A target <code>matrix</code> (in precision terms) for Type I ridge
estimators.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>norm</code></td>
<td>
<p>A <code>character</code> indicating the norm under which the condition
number is to be calculated/estimated. Must be one of: "1", "2".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Iaids</code></td>
<td>
<p>A <code>logical</code> indicating if the basic condition number plot
should be amended with interpretational aids.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vertical</code></td>
<td>
<p>A <code>logical</code> indicating if output graph should come with
a vertical line at a pre-specified value for the penalty parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>value</code></td>
<td>
<p>A <code>numeric</code> indicating a pre-specified value for the
penalty parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main</code></td>
<td>
<p>A <code>character</code> with which to specify the main title of the
output graph.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nOutput</code></td>
<td>
<p>A <code>logical</code> indicating if numeric output should be
returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>A <code>logical</code> indicating if information on progress should
be printed on screen.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>suppressChecks</code></td>
<td>
<p>A <code>logical</code> indicating if the input checks should
be suppressed.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Under certain target choices the proposed ridge estimators (see
<code>ridgeP</code>) are rotation equivariant, i.e., the eigenvectors of
<code class="reqn">\mathbf{S}</code> are left intact. Such rotation equivariant situations help
to understand the effect of the ridge penalty on the precision estimate: The
effect can be understood in terms of shrinkage of the eigenvalues of the
unpenalized precision estimate <code class="reqn">\mathbf{S}^{-1}</code>. Maximum shrinkage
implies that all eigenvalues are forced to be equal (in the rotation
equivariant situation). The spectral condition number w.r.t. inversion
(ratio of maximum to minimum eigenvalue) of the regularized precision matrix
may function as a heuristic in determining the (minimal) value of the
penalty parameter. A matrix with a high condition number is near-singular
(the relative distance to the set of singular matrices equals the reciprocal
of the condition number; Demmel, 1987) and its inversion is numerically
unstable. Such a matrix is said to be ill-conditioned. Numerically,
ill-conditioning will mean that small changes in the penalty parameter lead
to dramatic changes in the condition number. From a numerical point of view
one can thus track the domain of the penalty parameter for which the
regularized precision matrix is ill-conditioned. When plotting the condition
number against the (domain of the) penalty parameter, there is a point of
relative stabilization (when working in the <code class="reqn">p &gt; n</code> situation) that can
be characterized by a leveling-off of the acceleration along the curve when
plotting the condition number against the (chosen) domain of the penalty
parameter. This suggest the following fast heuristic for determining the
(minimal) value of the penalty parameter: The value of the penalty parameter
for which the spectral condition number starts to stabilize may be termed an
acceptable (minimal) value.
</p>
<p>The function outputs a graph of the (spectral) matrix condition number over
the domain [<code>lambdaMin</code>, <code>lambdaMax</code>]. When <code>norm = "2"</code> the
spectral condition number is calculated. It is determined by exact
calculation using the spectral decomposition. For most purposes this exact
calculation is fast enough, especially when considering rotation equivariant
situations (see <code>ridgeP</code>). For such situations the amenities for
fast eigenvalue calculation as provided by
<a href="https://CRAN.R-project.org/package=RSpectra">RSpectra</a> are used
internally. When exact computation of the spectral condition number is
deemed too costly one may approximate the computationally friendly
L1-condition number. This approximation is accessed through the
rcond function (Anderson et al. 1999).
</p>
<p>When <code>Iaids = TRUE</code> the basic condition number plot is amended/enhanced
with two additional plots (over the same domain of the penalty parameter as
the basic plot): The approximate loss in digits of accuracy (for the
operation of inversion) and an approximation to the second-order derivative
of the curvature in the basic plot. These interpretational aids can enhance
interpretation of the basic condition number plot and may support choosing a
value for the penalty parameter (see Peeters, van de Wiel, &amp; van Wieringen,
2016). When <code>vertical = TRUE</code> a vertical line is added at the constant
<code>value</code>. This option can be used to assess if the optimal penalty
obtained by, e.g., the routines <code>optPenalty.LOOCV</code> or
<code>optPenalty.aLOOCV</code>, has led to a precision estimate that is
well-conditioned.
</p>


<h3>Value</h3>

<p>The function returns a graph. If <code>nOutput = TRUE</code> the function
also returns an object of class <code>list</code>: </p>
<table>
<tr style="vertical-align: top;">
<td><code>lambdas</code></td>
<td>
<p>A <code>numeric</code>
vector representing all values of the penalty parameter for which the
condition number was calculated. The values of the penalty parameter are
log-equidistant.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conditionNumbers</code></td>
<td>
<p>A <code>numeric</code> vector containing
the condition number for each value of the penalty parameter given in
<code>lambdas</code>.</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>The condition number of a (regularized) covariance matrix is
equivalent to the condition number of its corresponding inverse, the
(regularized) precision matrix. Please note that the <code>target</code> argument
(for Type I ridge estimators) is assumed to be specified in precision terms.
In case one is interested in the condition number of a Type I estimator
under a covariance target, say <code class="reqn">\mathbf{\Gamma}</code>, then just specify
<code>target = solve</code>(<code class="reqn">\mathbf{\Gamma}</code>).
</p>


<h3>Author(s)</h3>

<p>Carel F.W. Peeters &lt;carel.peeters@wur.nl&gt;
</p>


<h3>References</h3>

<p>Anderson, E, Bai, Z., ..., Sorenson, D. (1999). LAPACK Users'
Guide (3rd ed.). Philadelphia, PA, USA: Society for Industrial and Applied
Mathematics.
</p>
<p>Demmel, J.W. (1987). On condition numbers and the distance to the nearest
ill-posed problem. Numerische Mathematik, 51: 251–289.
</p>
<p>Peeters, C.F.W., van de Wiel, M.A., &amp; van Wieringen, W.N. (2020). The
spectral condition number plot for regularization parameter evaluation.
Computational Statistics, 35: 629–646.
</p>


<h3>See Also</h3>

<p><code>covML</code>, <code>ridgeP</code>,
<code>optPenalty.LOOCV</code>, <code>optPenalty.aLOOCV</code>,
<code>default.target</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Obtain some (high-dimensional) data
p = 25
n = 10
set.seed(333)
X = matrix(rnorm(n*p), nrow = n, ncol = p)
colnames(X)[1:25] = letters[1:25]
Cx &lt;- covML(X)

## Assess spectral condition number across grid of penalty parameter
CNplot(Cx, lambdaMin = .0001, lambdaMax = 50, step = 1000)

## Include interpretational aids
CNplot(Cx, lambdaMin = .0001, lambdaMax = 50, step = 1000, Iaids = TRUE)

</code></pre>


</div>