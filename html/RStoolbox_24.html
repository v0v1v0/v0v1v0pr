<div class="container">

<table style="width: 100%;"><tr>
<td>radCor</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Radiometric Calibration and Correction</h2>

<h3>Description</h3>

<p>Implements several different methods for radiometric calibration and correction of Landsat data.
You can either specify a metadata file, or supply all neccesary values manually. 
With proper parametrization apref and sdos should work for other sensors as well.
</p>


<h3>Usage</h3>

<pre><code class="language-R">radCor(
  img,
  metaData,
  method = "apref",
  bandSet = "full",
  hazeValues,
  hazeBands,
  atmosphere,
  darkProp = 0.01,
  clamp = TRUE,
  verbose
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>img</code></td>
<td>
<p>SpatRaster</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metaData</code></td>
<td>
<p>object of class ImageMetaData or a path to the meta data (MTL) file.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Radiometric conversion/correction method to be used. There are currently four methods available (see Details):
"rad", "apref", "sdos", "dos", "costz".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bandSet</code></td>
<td>
<p>Numeric or character. original Landsat band numbers or names in the form of ("B1", "B2" etc). If set to 'full' all bands in the solar (optical) region will be processed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hazeValues</code></td>
<td>
<p>Numeric. Either a vector with dark DNs per <code>hazeBand</code> (method = 'sdos'); possibly estimated using estimateHaze. 
Or the 'starting haze value' (DN) for the relative scattering models in <code>method = 'dos' or 'costz'</code>. If not provided, hazeValues will be estimated in an automated fashion for all <code>hazeBands</code>. 
Argument only applies to methods 'sdos', 'dos' and 'costz'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hazeBands</code></td>
<td>
<p>Character or integer. Bands corresponding to <code>hazeValues</code> (method = 'sdos') or band to select starting haze value from ('dos' or 'costz').</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>atmosphere</code></td>
<td>
<p>Character. Atmospheric characteristics. Will be estimated if not expicilty provided. Must be one of <code>"veryClear", "clear", "moderate", "hazy"</code> or <code>"veryHazy"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>darkProp</code></td>
<td>
<p>Numeric. Estimated proportion of dark pixels in the scene. Used only for automatic guessing of hazeValues (typically one would choose 1 or 2%).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clamp</code></td>
<td>
<p>Logical. Enforce valid value range. By default reflectance will be forced to stay within [0,1] and radiance &gt;= 0 by replacing invalid values with the correspinding boundary, e.g. -0.1 will become 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical. Print status information.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The atmospheric correction methods (sdos, dos and costz) apply to the optical (solar) region of the spectrum and do not affect the thermal band.
</p>
<p>Dark object subtraction approaches rely on the estimation of atmospheric haze based on *dark* pixels. Dark pixels are assumed to have zero reflectance, hence the name.
It is then assumed further that any radiation originating from such *dark* pixels is due to atmospheric haze and 
not the reflectance of the surface itself.
</p>
<p>The folloiwing <code>methods</code> are available:  
</p>

<table>
<tr>
<td style="text-align: left;">
rad   </td>
<td style="text-align: left;"> Radiance </td>
</tr>
<tr>
<td style="text-align: left;">
apref </td>
<td style="text-align: left;"> Apparent reflectance (top-of-atmosphere reflectance) </td>
</tr>
<tr>
<td style="text-align: left;">
dos   </td>
<td style="text-align: left;"> Dark object subtratction following Chavez (1989) </td>
</tr>
<tr>
<td style="text-align: left;">
costz </td>
<td style="text-align: left;"> Dark object subtraction following Chavez (1996) </td>
</tr>
<tr>
<td style="text-align: left;">
sdos  </td>
<td style="text-align: left;"> Simple dark object subtraction. Classical DOS, Lhaze must be estimated for each band separately. 
</td>
</tr>
</table>
<p>If either "dos" or "costz"  are selected, radCor will use the atmospheric haze decay model described by Chavez (1989).
Depending on the <code>atmosphere</code> the following coefficients are used:
</p>

<table>
<tr>
<td style="text-align: left;">
veryClear </td>
<td style="text-align: left;"> <code class="reqn">\lambda^{-4.0}</code> </td>
</tr>
<tr>
<td style="text-align: left;">
clear     </td>
<td style="text-align: left;"> <code class="reqn">\lambda^{-2.0}</code> </td>
</tr>
<tr>
<td style="text-align: left;">
moderate  </td>
<td style="text-align: left;"> <code class="reqn">\lambda^{-1.0}</code> </td>
</tr>
<tr>
<td style="text-align: left;">
hazy      </td>
<td style="text-align: left;"> <code class="reqn">\lambda^{-0.7}</code> </td>
</tr>
<tr>
<td style="text-align: left;">
veryHazy  </td>
<td style="text-align: left;"> <code class="reqn">\lambda^{-0.5}</code> 
</td>
</tr>
</table>
<p>For Landsat 8, no values for extra-terrestrial irradiation (esun) are provided by NASA. These are, however, neccessary for DOS-based approaches. 
Therefore, these values were derived from a standard reference spectrum published by Thuillier et al. (2003) using the Landsat 8 OLI spectral response functions
</p>
<p>The implemented sun-earth distances neglect the earth's eccentricity. Instead we use a 100 year daily average (1979-2070).
</p>


<h3>Value</h3>

<p>SpatRaster with top-of-atmosphere radiance (<code class="reqn">W/(m^2 * srad * \mu m)</code>), at-satellite brightness temperature (K),
top-of-atmosphere reflectance (unitless) corrected for the sun angle or at-surface reflectance (unitless).
</p>


<h3>Note</h3>

<p>This was originally a fork of randcorr() function in the landsat package. This version works on SpatRasters and hence is suitable for large rasters.
</p>


<h3>References</h3>

<p>S. Goslee (2011): Analyzing Remote Sensing Data in R: The landsat Package. Journal of Statistical Software 43(4).
</p>
<p>G. Thuillier et al. (2003)  THE SOLAR SPECTRAL IRRADIANCE FROM 200 TO 2400 nm AS MEASURED BY THE SOLSPEC SPECTROMETER FROM THE ATLAS AND EURECA MISSIONS. Solar Physics 214(1): 1-22 (
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(terra)
## Import meta-data and bands based on MTL file
mtlFile  &lt;- system.file("external/landsat/LT52240631988227CUB02_MTL.txt", package="RStoolbox")
metaData &lt;- readMeta(mtlFile)
lsat_t &lt;- stackMeta(mtlFile)


## Convert DN to top of atmosphere reflectance and brightness temperature
lsat_ref &lt;- radCor(lsat_t, metaData = metaData, method = "apref")

## Correct DN to at-surface-reflecatance with DOS (Chavez decay model)
lsat_sref &lt;- radCor(lsat_t, metaData = metaData)

## Correct DN to at-surface-reflecatance with simple DOS 
## Automatic haze estimation
hazeDN    &lt;- estimateHaze(lsat_t, hazeBands = 1:4, darkProp = 0.01, plot = FALSE)
lsat_sref &lt;- radCor(lsat_t, metaData = metaData, method = "sdos",
                     hazeValues = hazeDN, hazeBands = 1:4)
</code></pre>


</div>