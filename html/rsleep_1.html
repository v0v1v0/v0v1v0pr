<div class="container">

<table style="width: 100%;"><tr>
<td>a7</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>A7 spindle detection algorithm</h2>

<h3>Description</h3>

<p>A sleep spindle detection algorithm that emulates human expert spindle scoring
</p>


<h3>Usage</h3>

<pre><code class="language-R">a7(
  x,
  sRate,
  window = 0.3,
  step = 0.1,
  butter_order = 5,
  A7absSigPow = 1.25,
  A7relSigPow = 1.6,
  A7sigmaCov = 1.3,
  A7sigmaCorr = 0.69
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>EEG signal in uV.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sRate</code></td>
<td>
<p>Sample rate of the signal.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>window</code></td>
<td>
<p>Size of the window in seconds. Default: 0.3</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>step</code></td>
<td>
<p>Size of the step between windows in seconds. Default: 0.1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>butter_order</code></td>
<td>
<p>Order of the Butterworth filters. Default: 5</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A7absSigPow</code></td>
<td>
<p>A7absSigPow treshold. Default: 1.25</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A7relSigPow</code></td>
<td>
<p>A7relSigPow treshold. Default: 1.6</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A7sigmaCov</code></td>
<td>
<p>A7sigmaCov treshold. Default: 1.3</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A7sigmaCorr</code></td>
<td>
<p>A7sigmaCorr treshold. Default: 0.69</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>A sleep spindle detection algorithm based on 4 features 
computed along segmented signal according to 'window' size 
and 'step' size parameters. 
</p>
<p>1. Absolute sigma power
</p>
<p style="text-align: center;"><code class="reqn">A7absSigPow = \log_{10} \left( \sum_{i=1}^{N} \frac{EEG\sigma_{i}^2}{N} \right)</code>
</p>

<p>2. Relative sigma power 
</p>
<p style="text-align: center;"><code class="reqn">A7relSigPow = zscore\left( \log_{10} \left( \frac{PSA_{11-16Hz}}{PSA_{4.5-30Hz}} \right) \right)</code>
</p>

<p>3. Sigma covariance 
</p>
<p style="text-align: center;"><code class="reqn">A7sigmaCov = zscore\left( \log_{10} \left( \frac{1}{N} \sum_{i=1}^{N} \left( EEG_{bf_i} - \mu_{EEG_{bf}} \right) \left( EEG_{\sigma_i} - \mu_{EEG_{\sigma}} \right) \right) \right)</code>
</p>

<p>4. Sigma correlation
</p>
<p style="text-align: center;"><code class="reqn">A7sigmaCor = \frac{\text{cov}(EEG_{bf}, EEG_{\sigma})}{sd_{EEG_{bf}} * sd_{EEG_{\sigma}}}</code>
</p>



<h3>Value</h3>

<p>Detected spindles and associated features.
</p>


<h3>References</h3>

<p>Lacourse, K., Delfrate, J., Beaudry, J., Peppard, P., &amp; Warby, S. C. (2019). A sleep spindle detection algorithm that emulates human expert spindle scoring. In Journal of Neuroscience Methods (Vol. 316, pp. 3â€“11). Elsevier BV. https://doi.org/10.1016/j.jneumeth.2018.08.014
</p>


<h3>Examples</h3>

<pre><code class="language-R">tryCatch({
  fpath &lt;- paste0(tempdir(),"c3m2_n2_200hz_uv.csv")

  download.file(
    url = "https://rsleep.org/data/c3m2_n2_200hz_uv.csv",
    destfile = fpath)

  # Read only a sample of the EEG signal
  s = read.csv(fpath,header = FALSE)[,1][25000:45000]

  file.remove(fpath)

  a7_results = a7(s, 200)

  # Plot the first detected spindle
  data = data.frame(x=s,index=seq_along(s))
  a = a7_results$spindles$idxStart[1]
  b = a7_results$spindles$idxEnd[1]
  data = data[(data$index &lt;= (b+600)) &amp; (data$index &gt;= (a-600)), ]
  library(ggplot2)
  ggplot(data, aes(x = index, y = x)) +
    geom_line() +
    geom_line(data = subset(data, index &gt;= a &amp; index &lt;= b), aes(x = index, y = x), color = "red") +
    labs(x = "Signal index", y = "C3-M2") +
    theme_minimal()
  
  # Visualise features distribution 

  hist(a7_results$df$absSigPow,main = "A7absSigPow")

  hist(a7_results$df$relSigPow,main = "A7relSigPow")

  hist(a7_results$df$sigmaCov,main = "A7sigmaCov")

  hist(a7_results$df$sigmaCorr,main = "A7sigmaCorr") 
 }, error = function(e) {
  print("Error executing this example, check your internet connection.")
  })
</code></pre>


</div>