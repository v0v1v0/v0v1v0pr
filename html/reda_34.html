<div class="container">

<table style="width: 100%;"><tr>
<td>rateReg</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Recurrent Events Regression Based on Counts and Rate Function</h2>

<h3>Description</h3>

<p>This function fits recurrent event data (event counts) by gamma frailty
model with spline rate function. The default model is the gamma frailty
model with one piece constant baseline rate function, which is equivalent to
negative binomial regression with the same shape and rate parameter in the
gamma prior. Spline (including piecewise constant) baseline hazard rate
function can be specified for the model fitting.
</p>


<h3>Usage</h3>

<pre><code class="language-R">rateReg(
  formula,
  data,
  subset,
  na.action,
  start = list(),
  control = list(),
  contrasts = NULL,
  ...
)

rateReg.control(
  df = NULL,
  degree = 0L,
  knots = NULL,
  Boundary.knots = NULL,
  periodic = FALSE,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p><code>Recur</code> object produced by function <code>Recur</code>.
The terminal events and risk-free episodes specified in <code>Recur</code>
will be ignored since the model does not support them.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>An optional data frame, list or environment containing the
variables in the model.  If not found in data, the variables are taken
from <code>environment(formula)</code>, usually the environment from which
function <code>rateReg</code> is called.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>An optional vector specifying a subset of observations to be
used in the fitting process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>A function that indicates what should the procedure do if
the data contains <code>NA</code>s.  The default is set by the na.action
setting of <code>options</code>.  The "factory-fresh" default is
<code>na.omit</code>.  Other possible values inlcude <code>na.fail</code>,
<code>na.exclude</code>, and <code>na.pass</code>. See <code>help(na.fail)</code> for
details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>
<p>An optional list of starting values for the parameters to be
estimated in the model.  See more in Section details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>An optional list of parameters to control the maximization
process of negative log likelihood function and adjust the baseline rate
function.  See more in Section details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contrasts</code></td>
<td>
<p>An optional list, whose entries are values (numeric
matrices or character strings naming functions) to be used as
replacement values for the contrasts replacement function and whose
names are the names of columns of data containing factors.  See
<code>contrasts.arg</code> of <code>model.matrix.default</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments passed to <code>rateReg.control()</code> and
<code>stats::constrOptim()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>A nonnegative integer to specify the degree of freedom of baseline
rate function. If argument <code>knots</code> or <code>degree</code> are specified,
<code>df</code> will be neglected whether it is specified or not.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>degree</code></td>
<td>
<p>A nonnegative integer to specify the degree of spline bases.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>A numeric vector that represents all the internal knots of
baseline rate function.  The default is <code>NULL</code>, representing no any
internal knots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Boundary.knots</code></td>
<td>
<p>A length-two numeric vector to specify the boundary
knots for baseline rate funtion. By default, the left boundary knot is
the smallest origin time and the right one takes the largest censoring
time from data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>periodic</code></td>
<td>
<p>A logical value indicating if periodic splines should be
used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>A logical value with default <code>TRUE</code>.  Set it to
<code>FALSE</code> to supress messages from this function.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Function <code>Recur</code> in the formula response by default first checks
the dataset and will report an error if the dataset does not fall into
recurrent event data framework.  Subject's ID will be pinpointed if its
observation violates any checking rule. See <code>Recur</code> for all the
checking rules.
</p>
<p>Function <code>rateReg</code> first constructs the design matrix from
the specified arguments: <code>formula</code>, <code>data</code>, <code>subset</code>,
<code>na.action</code> and <code>constrasts</code> before model fitting.
The constructed design matrix will be checked again to
fit the recurrent event data framework
if any observation with missing covariates is removed.
</p>
<p>The model fitting process involves minimization of negative log
likelihood function, which calls function <code>constrOptim</code>
internally. <code>help(constrOptim)</code> for more details.
</p>
<p>The argument <code>start</code> is an optional list
that allows users to specify the initial guess for
the parameter values for the minimization of
negative log likelihood function.
The available numeric vector elements in the list include
</p>

<ul>
<li> <p><code>beta</code>: Coefficient(s) of covariates,
set to be all 0.1 by default.
</p>
</li>
<li> <p><code>theta</code>: Parameter in Gamma(theta, 1 / theta) for
frailty random effect, set to be 0.5 by default.
</p>
</li>
<li> <p><code>alpha</code>: Coefficient(s) of baseline rate function,
set to be all 0.05 by default.
</p>
</li>
</ul>
<p>The argument <code>control</code> allows users to control the process of
minimization of negative log likelihood function passed to
<code>constrOptim</code> and specify the boundary knots of baseline rate function.
</p>


<h3>Value</h3>

<p>A <code>rateReg</code> object, whose slots include
</p>

<ul>
<li> <p><code>call</code>: Function call of <code>rateReg</code>.
</p>
</li>
<li> <p><code>formula</code>: Formula used in the model fitting.
</p>
</li>
<li> <p><code>nObs</code>: Number of observations.
</p>
</li>
<li> <p><code>spline</code>: A list contains
</p>

<ul>
<li> <p><code>spline</code>: The name of splines used.
</p>
</li>
<li> <p><code>knots</code>: Internal knots specified for the baseline
rate function.
</p>
</li>
<li> <p><code>Boundary.knots</code>: Boundary knots specified for the
baseline rate function.
</p>
</li>
<li> <p><code>degree</code>: Degree of spline bases specified in
baseline rate function.
</p>
</li>
<li> <p><code>df</code>: Degree of freedom of the model specified.
</p>
</li>
</ul>
</li>
<li> <p><code>estimates</code>: Estimated coefficients of covariates and
baseline rate function, and estimated rate parameter of
gamma frailty variable.
</p>
</li>
<li> <p><code>control</code>: The control list specified for model fitting.
</p>
</li>
<li> <p><code>start</code>: The initial guess specified for the parameters
to be estimated.
</p>
</li>
<li> <p><code>na.action</code>: The procedure specified to deal with
missing values in the covariate.
</p>
</li>
<li> <p><code>xlevels</code>: A list that records the levels in
each factor variable.
</p>
</li>
<li> <p><code>contrasts</code>: Contrasts specified and used for each
factor variable.
</p>
</li>
<li> <p><code>convergCode</code>: <code>code</code> returned by function
<code>optim</code>, which is an integer indicating why the
optimization process terminated. <code>help(optim)</code> for details.
</p>
</li>
<li> <p><code>logL</code>: Log likelihood of the fitted model.
</p>
</li>
<li> <p><code>fisher</code>: Observed Fisher information matrix.
</p>
</li>
</ul>
<h3>References</h3>

<p>Fu, H., Luo, J., &amp; Qu, Y. (2016).
Hypoglycemic events analysis via recurrent time-to-event (HEART) models.
<em>Journal Of Biopharmaceutical Statistics</em>, 26(2), 280â€“298.
</p>


<h3>See Also</h3>

<p><code>summary,rateReg-method</code> for summary of fitted model;
<code>coef,rateReg-method</code> for estimated covariate coefficients;
<code>confint,rateReg-method</code> for confidence interval of
covariate coefficients;
<code>baseRate,rateReg-method</code> for estimated coefficients of baseline
rate function;
<code>mcf,rateReg-method</code> for estimated MCF from a fitted model;
<code>plot,mcf.rateReg-method</code> for plotting estimated MCF.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(reda)

## constant rate function
(constFit &lt;- rateReg(Recur(time, ID, event) ~ group + x1, data = simuDat))

## six pieces' piecewise constant rate function
(piecesFit &lt;- rateReg(Recur(time, ID, event) ~ group + x1,
                      data = simuDat, subset = ID %in% 1:50,
                      knots = seq.int(28, 140, by = 28)))

## fit rate function with cubic spline
(splineFit &lt;- rateReg(Recur(time, ID, event) ~ group + x1, data = simuDat,
                      knots = c(56, 84, 112), degree = 3))

## more specific summary
summary(constFit)
summary(piecesFit)
summary(splineFit)

## model selection based on AIC or BIC
AIC(constFit, piecesFit, splineFit)
BIC(constFit, piecesFit, splineFit)

## estimated covariate coefficients
coef(piecesFit)
coef(splineFit)

## confidence intervals for covariate coefficients
confint(piecesFit)
confint(splineFit, "x1", 0.9)
confint(splineFit, 1, 0.975)

## estimated baseline rate function
splinesBase &lt;- baseRate(splineFit)
plot(splinesBase, conf.int = TRUE)

## estimated baseline mean cumulative function (MCF) from a fitted model
piecesMcf &lt;- mcf(piecesFit)
plot(piecesMcf, conf.int = TRUE, col = "blueviolet")

## estimated MCF for given new data
newDat &lt;- data.frame(x1 = rep(0, 2), group = c("Treat", "Contr"))
splineMcf &lt;- mcf(splineFit, newdata = newDat, groupName = "Group",
                 groupLevels = c("Treatment", "Control"))
plot(splineMcf, conf.int = TRUE, lty = c(1, 5))

## example of further customization by ggplot2
library(ggplot2)
plot(splineMcf) +
    geom_ribbon(aes(x = time, ymin = lower,
                    ymax = upper, fill = Group),
                data = splineMcf@MCF, alpha = 0.2) +
    xlab("Days")
</code></pre>


</div>