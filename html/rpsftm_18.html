<div class="container">

<table style="width: 100%;"><tr>
<td>rpsftm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Rank Preserving Structural Failure Time Model</h2>

<h3>Description</h3>

<p>Main Function used for estimating causal parameters under the Rank Preserving Structural Failure Time Model
</p>


<h3>Usage</h3>

<pre><code class="language-R">rpsftm(
  formula,
  data,
  censor_time,
  subset,
  na.action,
  test = survdiff,
  low_psi = -1,
  hi_psi = 1,
  alpha = 0.05,
  treat_modifier = 1,
  autoswitch = TRUE,
  n_eval_z = 100,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a formula with a minimal structure of <code>Surv(time, status)~rand(arm,rx)</code>.
Further terms can be added to the right hand side to adjust for covariates and use strata or 
cluster arguments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an optional data frame that contains variables</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>censor_time</code></td>
<td>
<p>variable or constant giving the time at which censoring would, or has occurred. 
This should be provided for all observations unlike standard Kaplan-Meier or Cox regression where 
it is only given for censored observations. If no value is given then re-censoring is not applied.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>expression indicating which subset of the rows of data should be used in the fit. 
This can be a logical vector (which is replicated to have length equal to the number of observations),
a numeric vector indicating which observation numbers are to be included (or excluded if negative), 
or a character vector of row names to be included. All observations are included by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>a missing-data filter function. This is applied to the model.frame after any subset 
argument has been used. Default is options()$na.action.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test</code></td>
<td>
<p>the survival regression function to calculate the z-statistic: survdiff, coxph, survreg</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>low_psi</code></td>
<td>
<p>the lower limit of the range to search for the causal parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hi_psi</code></td>
<td>
<p>the upper limit of the range to search for the causal parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>the significance level used to calculate confidence intervals</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>treat_modifier</code></td>
<td>
<p>an optional variable that psi is multiplied by on an individual observation level to give
differing impact to treatment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>autoswitch</code></td>
<td>
<p>a logical to autodetect cases of no switching. If TRUE, then if all observations in an arm
have perfect compliance then recensoring is not applied in that arm. If FALSE the recensoring is applied
regardless of perfect compliance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_eval_z</code></td>
<td>
<p>The number of points between hi_psi and low_psi at which to evaluate the Z-statistics
in the estimating equation. Default  is 100.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments to supply to the test function.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>the formula object <code>Surv(time, status)~rand(arm,rx)</code>. <code>rand()</code> stands 
for randomisation, both the randomly assigned and actual observed treatment. 
</p>

<ul>
<li>
<p> arm: the randomised treatment arm. a factor with 2 levels, or numeric variable with values 0/1.
</p>
</li>
<li>
<p> rx: the proportion of time on active treatment (arm=1 or the non-reference level of the factor)
</p>
</li>
</ul>
<p>Further adjustment terms can be added on the right hand side of the formula if desired, included <code>strata()</code>
or <code>cluster()</code> terms.
</p>


<h3>Value</h3>

<p>a rpsftm method object that is a list of the following:
</p>

<ul>
<li>
<p> psi: the estimated parameter
</p>
</li>
<li>
<p> fit: a survdiff object to produce Kaplan-Meier curves of the estimated counterfactual untreated failure times for each treatment arm
</p>
</li>
<li>
<p> CI: a vector of the confidence interval around psi
</p>
</li>
<li>
<p> Sstar: the recensored <code>Surv()</code> data using the estimate value of psi to give counterfactual untreated failure times.
</p>
</li>
<li>
<p> rand: the rand() object used to specify the allocated and observed amount of treatment.
</p>
</li>
<li>
<p> ans: the values from <code>uniroot_all</code> used to solve the estimating equation, 
but embedded within a list as per <code>uniroot</code>, with an extra element <code>root_all</code>,
a vector of all roots found in the case of multiple solutions. The first element of <code>root_all</code> 
is subsequently used.
</p>
</li>
<li>
<p> eval_z: a data frame with the Z-statistics from the estimating equation evaluated at
a sequence of values of psi. Used to plot and check if the range of values to search for solution
and limits of confidence intervals need to be modified.
</p>
</li>
<li>
<p> Further elements corresponding to either a <code>survdiff</code>, <code>coxph</code>, or <code>survreg</code> object. This will always include:
</p>

<ul>
<li>
<p> call: the R call object
</p>
</li>
<li>
<p> formula: a formula representing any adjustments, strata or clusters- used for the <code>update()</code> function
</p>
</li>
<li>
<p> terms: a more detailed representation of the model formula
</p>
</li>
</ul>
</li>
</ul>
<h3>Author(s)</h3>

<p>Simon Bond
</p>


<h3>See Also</h3>

<p><code>survdiff</code>, <code>coxph.object</code>, <code>survreg.object</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">?immdef
fit &lt;- rpsftm(Surv(progyrs, prog)~rand(imm,1-xoyrs/progyrs),immdef, censyrs)
print(fit)
summary(fit)
plot(fit)

</code></pre>


</div>