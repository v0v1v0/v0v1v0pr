<div class="container">

<table style="width: 100%;"><tr>
<td>rainfarm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Perform RainFARM downscaling</h2>

<h3>Description</h3>

<p>The input array is downscaled to finer spatial resolution
using the RainFARM stochastic precipitation downscaling method.
Orographic correction weights can be applied as described in
Terzago et al. (2018) doi: <a href="http://doi.org/10.5194/nhess-18-2825-2018">10.5194/nhess-18-2825-2018</a>.
Precipitation can be conserved globally (<code>fglob</code>), using convolution
(<code>fsmooth</code>) or over the original coarse-scale boxes.
</p>


<h3>Usage</h3>

<pre><code class="language-R">rainfarm(r, slope, nf, weights = 1, fglob = FALSE, fsmooth = TRUE,
  verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>matrix or array with large-scale field to downscale. Can be a
three-dimensional array with multiple frames at different times.
Spatial downscaling is performed separately for each element of the
third dimension of <code>r</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>slope</code></td>
<td>
<p>spatial spectral slope.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nf</code></td>
<td>
<p>refinement factor for spatial downscaling.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>matrix with weights for orographic downscaling generated
by the <code>rfweights()</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fglob</code></td>
<td>
<p>logical to conserve global average over domain.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fsmooth</code></td>
<td>
<p>logical to use smoothing for conservation.
If neither <code>fsmooth</code> or <code>fglob</code> is set precipitation is conserved over
each coarse pixel of the input field.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical to provide some progress report.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The downscaled array.
</p>


<h3>Author(s)</h3>

<p>Jost von Hardenberg, <a href="mailto:j.vonhardenberg@isac.cnr.it">j.vonhardenberg@isac.cnr.it</a>
</p>


<h3>References</h3>

<p>Terzago, S. et al. (2018). NHESS 18(11), 2825â€“2840
doi: <a href="http://doi.org/10.5194/nhess-18-2825-2018">10.5194/nhess-18-2825-2018</a>; D'Onofrio et al. (2014).
J of Hydrometeorology 15, 830-843 doi: <a href="http://doi.org/10.1175/JHM-D-13-096.1">10.1175/JHM-D-13-096.1</a>;
Rebora et. al. (2006), JHM 7, 724 doi: <a href="http://doi.org/10.1175/JHM517.1">10.1175/JHM517.1</a>.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Make some sample synthetic rainfall data
r &lt;- exp(rnorm(4 * 4 * 10))
dim(r) &lt;- c(4, 4, 10)
r[ , , 1]
#           [,1]      [,2]      [,3]      [,4]
# [1,] 1.8459816 1.8536550 2.1600665 1.3102116
# [2,] 1.3851011 1.4647348 0.2708219 0.4571810
# [3,] 0.2492451 0.8227134 0.4790567 1.9320403
# [4,] 0.5985922 3.3065678 2.1282795 0.6849944
# Downscale with spectral slope=1.7 to size 32x32
rd &lt;- rainfarm(r, 1.7, 8, fsmooth=FALSE) 
# Verify that downscaled data maintained original box averages
agg(rd[ , , 1], 4) 
#           [,1]      [,2]      [,3]      [,4]
# [1,] 1.8459816 1.8536550 2.1600665 1.3102116
# [2,] 1.3851011 1.4647348 0.2708219 0.4571810
# [3,] 0.2492451 0.8227134 0.4790567 1.9320403
# [4,] 0.5985922 3.3065678 2.1282795 0.6849944
</code></pre>


</div>