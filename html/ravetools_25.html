<div class="container">

<table style="width: 100%;"><tr>
<td>collapse</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Collapse array</h2>

<h3>Description</h3>

<p>Collapse array
</p>


<h3>Usage</h3>

<pre><code class="language-R">collapse(x, keep, ...)

## S3 method for class 'array'
collapse(
  x,
  keep,
  average = TRUE,
  transform = c("asis", "10log10", "square", "sqrt"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A numeric multi-mode tensor (array), without <code>NA</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep</code></td>
<td>
<p>Which dimension to keep</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to other methods</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>average</code></td>
<td>
<p>collapse to sum or mean</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transform</code></td>
<td>
<p>transform on the data before applying collapsing;
choices are <code>'asis'</code> (no change), <code>'10log10'</code> (used to calculate
decibel), <code>'square'</code> (sum-squared), <code>'sqrt'</code> (square-root and
collapse)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a collapsed array with values to be mean or summation along
collapsing dimensions
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Set ncores = 2 to comply to CRAN policy. Please don't run this line
ravetools_threads(n_threads = 2L)

# Example 1
x = matrix(1:16, 4)

# Keep the first dimension and calculate sums along the rest
collapse(x, keep = 1)
rowMeans(x)  # Should yield the same result

# Example 2
x = array(1:120, dim = c(2,3,4,5))
result = collapse(x, keep = c(3,2))
compare = apply(x, c(3,2), mean)
sum(abs(result - compare)) # The same, yield 0 or very small number (1e-10)




ravetools_threads(n_threads = -1)

# Example 3 (performance)

# Small data, no big difference
x = array(rnorm(240), dim = c(4,5,6,2))
microbenchmark::microbenchmark(
  result = collapse(x, keep = c(3,2)),
  compare = apply(x, c(3,2), mean),
  times = 1L, check = function(v){
    max(abs(range(do.call('-', v)))) &lt; 1e-10
  }
)

# large data big difference
x = array(rnorm(prod(300,200,105)), c(300,200,105,1))
microbenchmark::microbenchmark(
  result = collapse(x, keep = c(3,2)),
  compare = apply(x, c(3,2), mean),
  times = 1L , check = function(v){
    max(abs(range(do.call('-', v)))) &lt; 1e-10
  })



</code></pre>


</div>