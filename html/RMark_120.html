<div class="container">

<table style="width: 100%;"><tr>
<td>var.components.reml</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Variance components estimation using REML or maximum likelihood</h2>

<h3>Description</h3>

<p>Computes estimated effects, standard errors and variance components for a
set of estimates
</p>


<h3>Usage</h3>

<pre><code class="language-R">var.components.reml(
  theta,
  design,
  vcv = NULL,
  rdesign = NULL,
  initial = NULL,
  interval = c(-25, 10),
  REML = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>vector of parameter estimates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>design</code></td>
<td>
<p>design matrix for fixed effects combining parameter estimates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vcv</code></td>
<td>
<p>estimated variance-covariance matrix for parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rdesign</code></td>
<td>
<p>design matrix for random effect (do not use intercept form;
eg use ~-1+year instead of ~year); if NULL fits only iid error</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initial</code></td>
<td>
<p>initial values for variance components</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interval</code></td>
<td>
<p>interval bounds for log(sigma) to help optimization from
going awry</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>REML</code></td>
<td>
<p>if TRUE uses reml else maximum likelihood</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function <code>var.components</code> uses method of moments to estimate
a single process variance but cannot fit a more complex example.  It can
only estimate an iid process variance.  However, if you have a more
complicated structure in which you have random year effects and want to
estimate a fixed age effect then <code>var.components</code> will not work
because it will assume an iid error rather than allowing a common error for
each year as well as an iid error.  This function uses restricted maximum
likelihood (reml) or maximum likelihood to fit a fixed effects model with an
optional random effects structure.  The example below provides an
illustration as to how this can be useful.
</p>


<h3>Value</h3>

<p>A list with the following elements </p>
<table>
<tr style="vertical-align: top;">
<td><code>neglnl</code></td>
<td>
<p>negative
log-likelihood for fitted model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AICc</code></td>
<td>
<p>small sample corrected AIC for
model selection</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>variance component estimates; if rdesign=NULL,
only an iid error; otherwise, iid error and random effect error</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>dataframe with estimates and standard errors of betas for
design</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vcv.beta</code></td>
<td>
<p>variance-covariance matrix for beta</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Jeff Laake
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# This example is excluded from testing to reduce package check time
# Use dipper data with an age (0,1+)/time model for Phi
data(dipper)
dipper.proc=process.data(dipper,model="CJS")
dipper.ddl=make.design.data(dipper.proc,
   parameters=list(Phi=list(age.bins=c(0,.5,6))))
levels(dipper.ddl$Phi$age)=c("age0","age1+")
md=mark(dipper,model.parameters=list(Phi=list(formula=~time+age)),delete=TRUE)
# extract the estimates of Phi 
zz=get.real(md,"Phi",vcv=TRUE)
# assign age to use same intervals as these are not copied 
# across into the dataframe from get.real
zz$estimates$age=cut(zz$estimates$Age,c(0,.5,6),include=TRUE)
levels(zz$estimates$age)=c("age0","age1+")
z=zz$estimates
# Fit age fixed effects with random year component and an iid error
var.components.reml(z$estimate,design=model.matrix(~-1+age,z),
        zz$vcv,rdesign=model.matrix(~-1+time,z)) 
# Fitted model assuming no covariance structure to compare to 
# results with lme
xx=var.components.reml(z$estimate,design=model.matrix(~-1+age,z),
 matrix(0,nrow=nrow(zz$vcv),ncol=ncol(zz$vcv)),
 rdesign=model.matrix(~-1+time,z)) 
xx
sqrt(xx$sigmasq)
library(nlme)
nlme::lme(estimate~-1+age,data=z,random=~1|time)

</code></pre>


</div>