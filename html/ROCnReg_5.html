<div class="container">

<table style="width: 100%;"><tr>
<td>compute.threshold.AROC</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
AROC based threshold values.
</h2>

<h3>Description</h3>

<p>This function implements methods for estimating AROC-based threshold values.
</p>


<h3>Usage</h3>

<pre><code class="language-R">compute.threshold.AROC(object, criterion = c("FPF", "YI"), FPF, newdata,
  ci.level = 0.95, parallel = c("no", "multicore", "snow"), ncpus = 1, cl = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>An object of class <code>AROC</code> as produced by <code>AROC.bnp()</code>, <code>AROC.sp()</code>, or <code>AROC.kernel()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>criterion</code></td>
<td>
<p>A character string indicating whether the covariate-adjusted threshold values should be computed based on the Youden index (“YI”) or for a fixed set of false positive fractions (“FPF”).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>FPF</code></td>
<td>
<p>For criterion = FPF, a numeric vector with the FPF at which to calculate the AROC-based threshold values. Atomic values are also valid.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p>Optional data frame containing the values of the covariates at which the AROC-based threshold values will be computed. If not supplied, the function <code>cROCData</code> is used to build a default dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci.level</code></td>
<td>
<p>An integer value (between 0 and 1) specifying the confidence level. The default is 0.95.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>A characters string with the type of parallel operation: either "no" (default), "multicore" (not available on Windows) or "snow".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncpus</code></td>
<td>
<p>An integer with the number of processes to be used in parallel operation. Defaults to 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cl</code></td>
<td>
<p>An object inheriting from class <code>cluster</code> (from the <code>parallel</code> package), specifying an optional parallel or snow cluster if parallel = "snow". If not supplied, a cluster on the local machine is created for the duration of the call.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Estimates AROC-based threshold values based on two different criteria, namely, the Youden index (YI) and the one that gives rise to a pre-specified FPF. Before proceeding, we would like to mention that when the accuracy of a test is not affected by covariates, this does not necessarily imply that the covariate-specific ROC curve (which in this case is the same for all covariate values) coincides with the pooled ROC curve. It does coincide, however, with the AROC curve. Consequently, in all cases where covariates affect the test, even though they might not affect its discriminatory capacity, inferences based on the pooled ROC curve might be misleading. In such cases the AROC curve should be used instead. This also applies to the selection of (optimal) threshold values, which, as will be seen, might be covariate-specific (i.e., possibly different for different covariate values).
</p>
<p>For the AROC curve, the Youden Index is defined as
</p>
<p style="text-align: center;"><code class="reqn">YI = \max_{p}\{AROC(p) - p\},</code>
</p>

<p>The value <code class="reqn">p^{*}</code> (FPF) that achieves the maximum is then used to calculate the optimal (covariate-specific) YI threshold as follows
</p>
<p style="text-align: center;"><code class="reqn">c^{*}_{\mathbf{x}} = F_{\bar{D}}^{-1}(1-p^{*}|\mathbf{x}),</code>
</p>

<p>where
</p>
<p style="text-align: center;"><code class="reqn">F_{\bar{D}}(y|\mathbf{x}) = Pr(Y_{\bar{D}} \leq y | \mathbf{X}_{\bar{D}} = \mathbf{x}).</code>
</p>

<p>In a similar way, when using the criterion for a fixed FPF, the covariate-specific threshold values are obtained as follows
</p>
<p style="text-align: center;"><code class="reqn">c^{*}_{\mathbf{x}} = F_{\bar{D}}^{-1}(1-FPF|\mathbf{x}).</code>
</p>

<p>In both cases, we use the notation <code class="reqn">c^{*}_{\mathbf{x}}</code> to emphasise that this value depends on covariate <code class="reqn">\mathbf{x}</code>.
</p>


<h3>Value</h3>

<p>As a result, the function provides a list with the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>The matched call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p>Data frame containing the values of the covariates at which the AROC-based thresholds were computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thresholds</code></td>
<td>
<p>If method = "YI", the estimated AROC-based threshold corresponding to the Youden index, and if method = "FPF", AROC-based threshold corresponding to the specified FPF. For the Bayesian approach (<code>AROC.bnp</code>), in addition to the posterior mean, the <code>ci.level</code>*100% pointwise credible band is also returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>YI</code></td>
<td>
<p>If criterion = "YI", the AROC-based Youden index. For the Bayesian approach (<code>AROC.bnp</code>), in addition to the posterior mean, the <code>ci.level</code>*100% pointwise credible band is also returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>FPF</code></td>
<td>
<p>If criterion = "YI", the FPF where the Youden index is attained, and if criterion = "FPF", the supplied FPF argument. For the Bayesian approach (<code>AROC.bnp</code>), in addition to the posterior mean, the <code>ci.level</code>*100% pointwise credible band is also returned.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Inacio de Carvalho, V., and Rodriguez-Alvarez, M. X. (2022). The Covariate-Adjusted ROC Curve: The Concept and Its Importance, Review of Inferential Methods, and a New Bayesian Estimator. <em>Statistical Science</em>, <b>37</b>, 541 -561.
</p>
<p>Rodriguez-Alvarez, M. X., Roca-Pardinas, J., and Cadarso-Suarez, C. (2011). ROC curve and covariates: extending induced methodology to the non-parametric framework. <em>Statistics and Computing</em>, <b>21</b>, 483–499.
</p>
<p>Rutter, C.M. and Miglioretti, D. L. (2003). Estimating the Accuracy of Psychological Scales Using Longitudinal Data. <em>Biostatistics</em>, <b>4</b>, 97–107.
</p>
<p>Youden, W. J. (1950). Index for rating diagnostic tests. Cancer, <b>3</b>, 32–35.
</p>


<h3>See Also</h3>

<p><code>AROC.bnp</code>, <code>AROC.kernel</code> or <code>AROC.sp</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(ROCnReg)
data(psa)
# Select the last measurement
newpsa &lt;- psa[!duplicated(psa$id, fromLast = TRUE),]

# Log-transform the biomarker
newpsa$l_marker1 &lt;- log(newpsa$marker1)

AROC_bnp &lt;- AROC.bnp(formula.h = l_marker1 ~ f(age, K = 0),
              group = "status", 
              tag.h = 0, 
              data = newpsa,
              standardise = TRUE,
              p = seq(0,1,l=101),
              prior = priorcontrol.bnp(m0 = rep(0, 4), 
              S0 = 10*diag(4), nu = 6, Psi = diag(4),
              a = 2, b = 0.5, alpha = 1, L =10),
              mcmc = mcmccontrol(nsave = 500, nburn = 100, nskip = 1))

### Threshold values based on the YI
th_AROC_bnp_yi &lt;- compute.threshold.AROC(AROC_bnp, criterion = "YI")

# Plot results
plot(th_AROC_bnp_yi$newdata$age, th_AROC_bnp_yi$thresholds[,"est"], 
	type = "l", xlab = "Age", 
	ylab = "log(PSA)", ylim = c(0,3), 
	main = "Threshold values based on the Youden Index")
lines(th_AROC_bnp_yi$newdata$age, th_AROC_bnp_yi$thresholds[,"qh"], lty = 2)
lines(th_AROC_bnp_yi$newdata$age, th_AROC_bnp_yi$thresholds[,"ql"], lty = 2)

### Threshold values for a fixed FPF
th_AROC_bnp_fpf &lt;- compute.threshold.AROC(AROC_bnp, criterion = "FPF", FPF = 0.1)

# Plot results
plot(th_AROC_bnp_yi$newdata$age, th_AROC_bnp_fpf$thresholds[["0.1"]][,"est"], 
	type = "l", xlab = "Age", 
	ylab = "log(PSA)", ylim = c(0,3), 
	main = "Threshold values for a FPF = 0.1")
lines(th_AROC_bnp_yi$newdata$age, th_AROC_bnp_fpf$thresholds[["0.1"]][,"qh"], lty = 2)
lines(th_AROC_bnp_yi$newdata$age, th_AROC_bnp_fpf$thresholds[["0.1"]][,"ql"], lty = 2)



</code></pre>


</div>