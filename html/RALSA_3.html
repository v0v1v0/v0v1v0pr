<div class="container">

<table style="width: 100%;"><tr>
<td>lsa.bin.log.reg</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Compute binary logistic regression coefficients specified groups</h2>

<h3>Description</h3>

<p><code>lsa.bin.log.reg</code> computes binary logistic regression coefficients within groups defined by one or more variables.
</p>


<h3>Usage</h3>

<pre><code class="language-R">lsa.bin.log.reg(
  data.file,
  data.object,
  split.vars,
  bin.dep.var,
  bckg.indep.cont.vars,
  bckg.indep.cat.vars,
  bckg.cat.contrasts,
  bckg.ref.cats,
  PV.root.indep,
  interactions,
  standardize = FALSE,
  weight.var,
  norm.weight = FALSE,
  include.missing = FALSE,
  shortcut = FALSE,
  save.output = TRUE,
  output.file,
  open.output = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data.file</code></td>
<td>
<p>The file containing <code>lsa.data</code> object. Either this or
<code>data.object</code> shall be specified, but not both. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data.object</code></td>
<td>
<p>The object in the memory containing <code>lsa.data</code> object. Either
this or <code>data.file</code> shall be specified, but not both. See
details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>split.vars</code></td>
<td>
<p>Categorical variable(s) to split the results by. If no split
variables are provided, the results will be for the overall
countries' populations. If one or more variables are provided, the
results will be split by all but the last variable and the
percentages of respondents will be computed by the unique values of
the last splitting variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bin.dep.var</code></td>
<td>
<p>Name of a binary (i.e. just two distinct values) background or
contextual variable used as a dependent variable in the model. See
details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bckg.indep.cont.vars</code></td>
<td>
<p>Names of continuous independent background or contextual variables
used as predictors in the model. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bckg.indep.cat.vars</code></td>
<td>
<p>Names of categorical independent background or contextual variables
used as predictors in the model to compute contrasts for (see
<code>bckg.cat.contrasts</code> and <code>bckg.ref.cats</code>). See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bckg.cat.contrasts</code></td>
<td>
<p>String vector with the same length as the length of
<code>bckg.indep.cat.vars</code> specifying the type of contrasts to
compute in case <code>bckg.indep.cat.vars</code> are provided. See
details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bckg.ref.cats</code></td>
<td>
<p>Vector of integers with the same length as the length of
<code>bckg.indep.cat.vars</code> and <code>bckg.cat.contrasts</code> specifying
the reference categories for the contrasts to compute in case
<code>bckg.indep.cat.vars</code> are provided. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PV.root.indep</code></td>
<td>
<p>The root names for a set of plausible values used as a independent
variables in the model. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interactions</code></td>
<td>
<p>Interaction terms - a list containing vectors of length of two.
See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>standardize</code></td>
<td>
<p>Shall the dependent and independent variables be standardized to
produce beta coefficients? The default is <code>FALSE</code>. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight.var</code></td>
<td>
<p>The name of the variable containing the weights. If no name of a
weight variable is provide, the function will automatically select
the default weight variable for the provided data, depending on the
respondent type.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>norm.weight</code></td>
<td>
<p>Shall the weights be normalized before applying them, default is
<code>FALSE</code>. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include.missing</code></td>
<td>
<p>Logical, shall the missing values of the splitting variables be
included as categories to split by and all statistics produced for
them? The default (<code>FALSE</code>) takes all cases on the splitting
variables without missing values before computing any statistics.
See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shortcut</code></td>
<td>
<p>Logical, shall the "shortcut" method for IEA TIMSS, TIMSS Advanced,
TIMSS Numeracy, eTIMSS PSI, PIRLS, ePIRLS, PIRLS Literacy and RLII
be applied? The default (<code>FALSE</code>) applies the "full" design
when computing the variance components and the standard errors of
the estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save.output</code></td>
<td>
<p>Logical, shall the output be saved in MS Excel file (default) or
not (printed to the console or assigned to an object).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output.file</code></td>
<td>
<p>If <code>save.output = TRUE</code> (default), full path to the output file
including the file name. If omitted, a file with a default file name
"Analysis.xlsx" will be written to the working directory
(<code>getwd()</code>). Ignored if <code>save.output = FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>open.output</code></td>
<td>
<p>Logical, shall the output be open after it has been written? The
default (<code>TRUE</code>) opens the output in the default spreadsheet
program installed on the computer. Ignored if
<code>save.output = FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Either <code>data.file</code> or <code>data.object</code> shall be provided as source of data. If both of them are provided, the function will stop with an error message.
The function computes binary logistic regression coefficients by the categories of the splitting variables. The percentages of respondents in each group are computed within the groups specified by the last splitting variable. If no splitting variables are added, the results will be computed only by country.
</p>
<p>If <code>standardize = TRUE</code>, the variables will be standardized before computing any statistics to provide beta regression coefficients.
</p>
<p>A binary (i.e. dichotomous) background/contextual variable must be provided to <code>bin.dep.var</code> (numeric or factor). If more than two categories exist in the variable, the function will exit with an error. The function automatically recodes the two categories of the <code>bin.dep.var</code> to 0 and 1 if they are not as such (e.g. as 1 and 2 as in factors). If the variable of interest has more than two distinct values (can use the <code>lsa.var.dict</code> to see them), they can be collapsed using the <code>lsa.recode.vars</code>.
</p>
<p>Background/contextual variables passed to <code>bckg.indep.cont.vars</code> will be treated as numeric variables in the model. Variables with discrete number of categories (i.e. factors) passed to <code>bckg.indep.cat.vars</code> will be used to compute contrasts. In this case the type of contrast have to be passed to <code>bckg.cat.contrasts</code> and the number of the reference categories for each of the <code>bckg.indep.cat.vars</code>. The number of types of contrasts and the reference categories must be the same as the number of <code>bckg.indep.cat.vars</code>. The currently supported contrast coding schemes are:
</p>

<ul>
<li> <p><code>dummy</code> (also called "indicator" in logistic regression) - the odds ratios show what is the probability for a positive (i.e. 1) outcome in the binary dependent variable compared to the negative outcome (i.e. 0) per category of a variable in the <code>bckg.indep.cat.cats</code> compared to the reference category of that dummy coded variable. The intercept shows the log of the odds for the reference category when all other levels are 0.
</p>
</li>
<li> <p><code>deviation</code> (also called "effect" in logistic regression) - comparing the effect of each category (except for the reference) of the deviation coded variable to the overall effect (which is the intercept).
</p>
</li>
<li> <p><code>simple</code> - the same as for the <code>dummy</code> contrast coding, except for the intercept which in this case is the overall effect.
</p>
</li>
</ul>
<p>Note that when using <code>standardize = TRUE</code>, the contrast coding of <code>bckg.indep.cat.vars</code> is not standardized. Thus, the regression coefficients may not be comparable to other software solutions for analyzing large-scale assessment data which rely on, for example, SPSS or SAS where the contrast coding of categorical variables (e.g. dummy coding) takes place by default. However, the model statistics will be identical.
</p>
<p>Multiple continuous or categorical background variables and/or sets of plausible values can be provided to compute regression coefficients for. Please note that in this case the results will slightly differ compared to using each pair of the same background continuous variables or PVs in separate analysis. This is because the cases with the missing values are removed in advance and the more variables are provided, the more cases are likely to be removed. That is, the function support only listwisie deletion.
</p>
<p>Computation of regression coefficients involving plausible values requires providing a root of the plausible values names in <code>PV.root.dep</code> and/or <code>PV.root.indep</code>. All studies (except CivED, TEDS-M, SITES, TALIS and TALIS Starting Strong Survey) have a set of PVs per construct (e.g. in TIMSS five for overall mathematics, five for algebra, five for geometry, etc.). In some studies (say TIMSS and PIRLS) the names of the PVs in a set always start with character string and end with sequential number of the PV. For example, the names of the set of PVs for overall mathematics in TIMSS are BSMMAT01, BSMMAT02, BSMMAT03, BSMMAT04 and BSMMAT05. The root of the PVs for this set to be added to <code>PV.root.dep</code> or <code>PV.root.indep</code> will be "BSMMAT". The function will automatically find all the variables in this set of PVs and include them in the analysis. In other studies like OECD PISA and IEA ICCS and ICILS the sequential number of each PV is included in the middle of the name. For example, in ICCS the names of the set of PVs are PV1CIV, PV2CIV, PV3CIV, PV4CIV and PV5CIV. The root PV name has to be specified in <code>PV.root.dep</code> or <code>PV.root.indep</code> as "PV#CIV". More than one set of PVs can be added in <code>PV.root.indep</code>.
</p>
<p>The function can also compute two-way interaction effects between independent variables by passing a list to the <code>interactions</code> argument. The list must contain vectors of length two and all variables in these vectors <strong>must also be passed as independent variables</strong> (see the examples). Note the following:
</p>

<ul>
<li>
<p> When an interaction is between two independent background continuous variables (i.e. both are passed to <code>bckg.indep.cont.vars</code>), the interaction effect will be computed between them as they are.
</p>
</li>
<li>
<p> When the interaction is between two categorical variables (i.e. both are passed to <code>bckg.indep.cat.vars</code>), the interaction effect will be computed between each possible pair of categories of the two variables, except for the reference categories.
</p>
</li>
<li>
<p> When the interaction is between one continuous (i.e. passed to <code>bckg.indep.cont.vars</code>) and one categorical (i.e. passed to <code>bckg.indep.cat.vars</code>), the interaction effect will be computed between the continuous variable and each category of the categorical variable, except for the reference category.
</p>
</li>
<li>
<p> When the interaction is between a continuous variable (i.e. passed to <code>bckg.indep.cont.vars</code>) and a set of PVs (i.e. passed to <code>PV.root.indep</code>), the interaction effect is computed between the continuous variable and each PV in the set and the results are aggregated.
</p>
</li>
<li>
<p> When the interaction is between a categorical variable  (i.e. passed to <code>bckg.indep.cat.vars</code>) and a set of PVs (i.e. passed to <code>PV.root.indep</code>), the interaction effect is computed between each category of the categorical variable (except the reference category) and each PV in the set. The results are aggregated for each of the categories of the categorical variables and the set of PVs.
</p>
</li>
<li>
<p> When the interaction is between two sets of PVs (i.e. passed to <code>PV.root.indep</code>), the interaction effect is computed between the first PV in the first set and the first PV in the second set, the second PV in the first set and the second PV in the second set, and so on. The results are then aggregated.
</p>
</li>
</ul>
<p>If <code>norm.weight = TRUE</code>, the weights will be normalized before used in the model. This may be necessary in some countries in some studies extreme weights for some of the cases may result in inflated estimates due to model perfect separation. The consequence of normalizing weights is that the number of elements in the population will sum to the number of cases in the sample. Use with caution.
</p>
<p>If <code>include.missing = FALSE</code> (default), all cases with missing values on the splitting variables will be removed and only cases with valid values will be retained in the statistics. Note that the data from the studies can be exported in two different ways: (1) setting all user-defined missing values to <code>NA</code>; and (2) importing all user-defined missing values as valid ones and adding their codes in an additional attribute to each variable. If the <code>include.missing</code> is set to <code>FALSE</code> (default) and the data used is exported using option (2), the output will remove all values from the variable matching the values in its <code>missings</code> attribute. Otherwise, it will include them as valid values and compute statistics for them.
</p>
<p>The <code>shortcut</code> argument is valid only for TIMSS, eTIMSS PSI, TIMSS Advanced, TIMSS Numeracy, PIRLS, ePIRLS, PIRLS Literacy and RLII. Previously, in computing the standard errors, these studies were using 75 replicates because one of the schools in the 75 JK zones had its weights doubled and the other one has been taken out. Since TIMSS 2015 and PIRLS 2016 the studies use 150 replicates and in each JK zone once a school has its weights doubled and once taken out, i.e. the computations are done twice for each zone. For more details see Foy &amp; LaRoche (2016) and Foy &amp; LaRoche (2017). If replication of the tables and figures is needed, the <code>shortcut</code> argument has to be changed to <code>TRUE</code>.
The function provides two-tailed <em>t</em>-test and <em>p</em>-values for the regression coefficients.
</p>


<h3>Value</h3>

<p>If <code>save.output = FALSE</code>, a list containing the estimates and analysis information. If <code>save.output = TRUE</code> (default), an MS Excel (<code>.xlsx</code>) file (which can be opened in any spreadsheet program), as specified with the full path in the <code>output.file</code>. If the argument is missing, an Excel file with the generic file name "Analysis.xlsx" will be saved in the working directory (<code>getwd()</code>). The workbook contains four spreadsheets. The first one ("Estimates") contains a table with the results by country and the final part of the table contains averaged results from all countries' statistics. The following columns can be found in the table, depending on the specification of the analysis:
</p>

<ul>
<li> <p><code style="white-space: pre;">⁠&lt;⁠</code>Country ID<code style="white-space: pre;">⁠&gt;⁠</code> - a column containing the names of the countries in the file for which statistics are computed. The exact column header will depend on the country identifier used in the particular study.
</p>
</li>
<li> <p><code style="white-space: pre;">⁠&lt;⁠</code>Split variable 1<code style="white-space: pre;">⁠&gt;⁠</code>, <code style="white-space: pre;">⁠&lt;⁠</code>Split variable 2<code style="white-space: pre;">⁠&gt;⁠</code>... - columns containing the categories by which the statistics were split by. The exact names will depend on the variables in <code>split.vars</code>.
</p>
</li>
<li>
<p> n_Cases - the number of cases in the sample used to compute the statistics.
</p>
</li>
<li>
<p> Sum_<code style="white-space: pre;">⁠&lt;⁠</code>Weight variable<code style="white-space: pre;">⁠&gt;⁠</code> - the estimated population number of elements per group after applying the weights. The actual name of the weight variable will depend on the weight variable used in the analysis.
</p>
</li>
<li>
<p> Sum_<code style="white-space: pre;">⁠&lt;⁠</code>Weight variable<code style="white-space: pre;">⁠&gt;⁠</code><code style="white-space: pre;">⁠_⁠</code>SE - the standard error of the the estimated population number of elements per group. The actual name of the weight variable will depend on the weight variable used in the analysis.
</p>
</li>
<li>
<p> Percentages_<code style="white-space: pre;">⁠&lt;⁠</code>Last split variable<code style="white-space: pre;">⁠&gt;⁠</code> - the percentages of respondents (population estimates) per groups defined by the splitting variables in <code>split.vars</code>. The percentages will be for the last splitting variable which defines the final groups.
</p>
</li>
<li>
<p> Percentages_<code style="white-space: pre;">⁠&lt;⁠</code>Last split variable<code style="white-space: pre;">⁠&gt;⁠</code><code style="white-space: pre;">⁠_⁠</code>SE - the standard errors of the percentages from above.
</p>
</li>
<li>
<p> Variable - the variable names (background/contextual or PV root names, or contrast coded variable names).
</p>
</li>
<li>
<p> Coefficients - the logistic regression coefficients (intercept and slopes).
</p>
</li>
<li>
<p> Coefficients_SE - the standard error of the logistic regression coefficients (intercepts and slopes) for each independent variable (background/contextual or PV root names, or contrast coded variable names) in the model.
</p>
</li>
<li>
<p> Coefficients_SVR - the sampling variance component for the logistic regression coefficients if root PVs are specified either as dependent or independent variables.
</p>
</li>
<li>
<p> Coefficients_<code style="white-space: pre;">⁠&lt;⁠</code>root PV<code style="white-space: pre;">⁠&gt;⁠</code><code style="white-space: pre;">⁠_⁠</code>MVR - the measurement variance component for the logistic regression coefficients if root PVs are specified either as dependent or independent variables.
</p>
</li>
<li>
<p> Wald_Statistic - Wald (<em>z</em>) statistic for each coefficient.
</p>
</li>
<li>
<p> p_value - the <em>p</em>-value for the regression coefficients.
</p>
</li>
<li>
<p> Odds_Ratio - the odds ratios of the logistic regression.
</p>
</li>
<li>
<p> Odds_Ratio_SE - the standard errors for the odds ratios of the logistic regression.
</p>
</li>
<li>
<p> Wald_L95CI - the lower 95% model-based confidence intervals for the logistic regression coefficients.
</p>
</li>
<li>
<p> Wald_U95CI - the upper 95% model-based confidence intervals for the logistic regression coefficients.
</p>
</li>
<li>
<p> Odds_L95CI - the lower 95% model-based confidence intervals for the odds ratios.
</p>
</li>
<li>
<p> Odds_U95CI - the upper 95% model-based confidence intervals for the odds ratios.
</p>
</li>
</ul>
<p>When interaction terms are included, the cells with the interactions in the <code>Variables</code> column will contain the names of the two variables in each of the interaction terms, divided by colon, e.g. <code>ASBGSSB:ASBGHRL</code>.
</p>
<p>The second sheet contains the model statistics:
</p>

<ul>
<li> <p><code style="white-space: pre;">⁠&lt;⁠</code>Country ID<code style="white-space: pre;">⁠&gt;⁠</code> - a column containing the names of the countries in the file for which statistics are computed. The exact column header will depend on the country identifier used in the particular study.
</p>
</li>
<li> <p><code style="white-space: pre;">⁠&lt;⁠</code>Split variable 1<code style="white-space: pre;">⁠&gt;⁠</code>, <code style="white-space: pre;">⁠&lt;⁠</code>Split variable 2<code style="white-space: pre;">⁠&gt;⁠</code>... - columns containing the categories by which the statistics were split by. The exact names will depend on the variables in <code>split.vars</code>.
</p>
</li>
<li>
<p> Statistic - a column containing the Null Deviance (-2LL, no predictors in the model, just constant, also called "baseline"), Deviance (-2LL, after adding predictors, residual deviance, also called "new"), DF Null (degrees of freedom for the null deviance), DF Residual (degrees of freedom for the residual deviance), Akaike Information Criteria (AIC), Bayesian information criterion (BIC), model Chi-Square, different R-Squared statistics (Hosmer &amp; Lemeshow - HS, Cox &amp; Snell - CS, and Nagelkerke - N).
</p>
</li>
<li>
<p> Estimate - the numerical estimates for each of the above.
</p>
</li>
<li>
<p> Estimate_SE - the standard errors of the estimates from above.
</p>
</li>
<li>
<p> Estimate_SVR - the sampling variance component if PVs were included in the model.
</p>
</li>
<li>
<p> Estimate_MVR - the measurement variance component if PVs were included in the model.
</p>
</li>
</ul>
<p>The third sheet contains some additional information related to the analysis per country in columns:
</p>

<ul>
<li>
<p> DATA - used <code>data.file</code> or <code>data.object</code>.
</p>
</li>
<li>
<p> STUDY - which study the data comes from.
</p>
</li>
<li>
<p> CYCLE - which cycle of the study the data comes from.
</p>
</li>
<li>
<p> WEIGHT - which weight variable was used.
</p>
</li>
<li>
<p> DESIGN - which resampling technique was used (JRR or BRR).
</p>
</li>
<li>
<p> SHORTCUT - logical, whether the shortcut method was used.
</p>
</li>
<li>
<p> NREPS - how many replication weights were used.
</p>
</li>
<li>
<p> ANALYSIS_DATE - on which date the analysis was performed.
</p>
</li>
<li>
<p> START_TIME - at what time the analysis started.
</p>
</li>
<li>
<p> END_TIME - at what time the analysis finished.
</p>
</li>
<li>
<p> DURATION - how long the analysis took in hours, minutes, seconds and milliseconds.
</p>
</li>
</ul>
<p>The fourth sheet contains the call to the function with values for all parameters as it was executed. This is useful if the analysis needs to be replicated later.
</p>


<h3>References</h3>

<p>LaRoche, S., Joncas, M., &amp; Foy, P. (2016). Sample Design in TIMSS 2015. In M. O. Martin, I. V. S. Mullis, &amp; M. Hooper (Eds.), <em>Methods and Procedures in TIMSS 2015</em> (pp. 3.1-3.37). Chestnut Hill, MA: TIMSS &amp; PIRLS International Study Center.
</p>
<p>LaRoche, S., Joncas, M., &amp; Foy, P. (2017). Sample Design in PIRLS 2016. In M. O. Martin, I. V. S. Mullis, &amp; M. Hooper (Eds.), <em>Methods and Procedures in PIRLS 2016</em> (pp. 3.1-3.34). Chestnut Hill, MA: Lynch School of Education, Boston College.
</p>
<p>UCLA: Statistical Consulting Group. 2020. "R LIBRARY CONTRAST CODING SYSTEMS FOR CATEGORICAL VARIABLES." <em>IDRE Stats - Statistical Consulting Web Resources</em>. Retrieved June 16, 2020 (https://stats.idre.ucla.edu/r/library/r-library-contrast-coding-systems-for-categorical-variables/).
</p>
<p>Hilbe, J. M. (2015). <em>Practical Guide to Logistic Regression</em>. CRC Press.
</p>


<h3>See Also</h3>

<p><code>lsa.convert.data</code>, , <code>lsa.vars.dict</code>, <code>lsa.recode.vars</code>, <code>lsa.lin.reg</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Compute logistic regression predicting the log of the odds the students will respond
# "Agree a lot" when asked if teachers are fair (dependent variable, categorical), as a function
# of their own sense of school belonging (independent variable, continuous) using PIRLS 2016
# student data. Because the dependent variable has four categories, it needs to be recoded first
# into a dichotomous (using the \code{lsa.recode.vars}).
## Not run: 
lsa.recode.vars(data.file = "C:/temp/test.RData", src.variables = "ASBG12D",
old.new = "1=2;2=2;3=1;4=1;5=3", new.variables = "ASBG12Dr",
new.labels = c("Disagree", "Agree", "Omitted or invalid"),
missings.attr = "Omitted or invalid",
variable.labels = "GEN/AGREE/TEACHERS ARE FAIR - RECODED",
out.file = "C:/temp/test.RData")

lsa.bin.log.reg(data.file = "C:/temp/test.RData", split.vars = "ASBG01",
bin.dep.var = "ASBG12Dr", bckg.indep.cont.vars = "ASBGSSB")

## End(Not run)

# Perform the same analysis from above, this time use the overall student reading achievement
# as a predictor.
## Not run: 
lsa.bin.log.reg(data.object = test, split.vars = "ASBG01",
bin.dep.var = "ASBG12Dr", PV.root.indep = "ASRREA")

## End(Not run)

# Compute linear regression with interaction terms using PIRLS 2016 student data.
## Not run: 
lsa.bin.log.reg(data.file = "C:/temp/test.RData", bin.dep.var = "ASBG05B",
bckg.indep.cont.vars = "ASBGSSB", bckg.indep.cat.vars = c("ASBG01", "ASBG12B"),
PV.root.indep = c("ASRREA", "ASRLIT"),
interactions = list(c("ASBG12B", "ASBGSSB"), c("ASBG01", "ASRLIT")))

## End(Not run)

</code></pre>


</div>