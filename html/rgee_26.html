<div class="container">

<table style="width: 100%;"><tr>
<td>ee_gcs_to_local</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Move results from Google Cloud Storage to a local directory</h2>

<h3>Description</h3>

<p>Move results of an EE task saved in Google Cloud Storage to a local
directory.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ee_gcs_to_local(
  task,
  dsn,
  public = FALSE,
  metadata = FALSE,
  overwrite = TRUE,
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>task</code></td>
<td>
<p>List generated after the EE task is correctly finished. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dsn</code></td>
<td>
<p>Character. Output filename. If missing, a temporary
file (i.e. <code>tempfile()</code>) will be assigned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>public</code></td>
<td>
<p>Logical. If TRUE, a public link to Google Cloud Storage
resource is created. "Public Access Prevention" may need to be removed.
In addition, the bucket access control configuration must be "fine-grained".
See GCS public files documentation for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metadata</code></td>
<td>
<p>Logical. If TRUE, export the metadata related to the Google
Cloud Storage resource. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overwrite</code></td>
<td>
<p>A boolean argument that indicates
whether "filename" should be overwritten. By default TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>Logical. Suppress info message</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The task argument requires a status of "COMPLETED" because
the parameters required to identify EE items in Google Drive
are retrieved from <code>ee$batch$Export$*$toCloudStorage(...)$start()$status()</code>.
</p>
<p>If the argument <code>metadata</code> is TRUE, a list containing the following
elements is exported and appended to the output filename (dsn):
</p>

<ul>
<li>
<p><b>ee_id: </b>Name of the Earth Engine task.
</p>
</li>
<li>
<p><b>gcs_name: </b>Name of the Table in Google Cloud Storage.
</p>
</li>
<li>
<p><b>gcs_bucket: </b>Name of the bucket.
</p>
</li>
<li>
<p><b>gcs_fileFormat: </b>Format of the table.
</p>
</li>
<li>
<p><b>gcs_public_link: </b>Download link to the table.
</p>
</li>
<li>
<p><b>gcs_URI: </b>gs:// link to the table.
</p>
</li>
</ul>
<h3>Value</h3>

<p>If <code>metadata</code> is FALSE, will return the filename of the Google
Cloud Storage resource on their system. Otherwise, a list with two elements
(<code>dns</code> and <code>metadata</code>) is returned.
</p>


<h3>See Also</h3>

<p>Other generic download functions: 
<code>ee_drive_to_local()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
library(rgee)
library(stars)
library(sf)

ee_users()
ee_Initialize(gcs = TRUE)

# Define study area (local -&gt; earth engine)
# Communal Reserve Amarakaeri - Peru
rlist &lt;- list(xmin = -71.13, xmax = -70.95,ymin = -12.89, ymax = -12.73)
ROI &lt;- c(rlist$xmin, rlist$ymin,
         rlist$xmax, rlist$ymin,
         rlist$xmax, rlist$ymax,
         rlist$xmin, rlist$ymax,
         rlist$xmin, rlist$ymin)
ee_ROI &lt;- matrix(ROI, ncol = 2, byrow = TRUE) %&gt;%
  list() %&gt;%
  st_polygon() %&gt;%
  st_sfc() %&gt;%
  st_set_crs(4326) %&gt;%
  sf_as_ee()


# Get the mean annual NDVI for 2011
cloudMaskL457 &lt;- function(image) {
  qa &lt;- image$select("pixel_qa")
  cloud &lt;- qa$bitwiseAnd(32L)$
    And(qa$bitwiseAnd(128L))$
    Or(qa$bitwiseAnd(8L))
  mask2 &lt;- image$mask()$reduce(ee$Reducer$min())
  image &lt;- image$updateMask(cloud$Not())$updateMask(mask2)
  image$normalizedDifference(list("B4", "B3"))
}

ic_l5 &lt;- ee$ImageCollection("LANDSAT/LT05/C01/T1_SR")$
  filterBounds(ee$FeatureCollection(ee_ROI))$
  filterDate("2011-01-01", "2011-12-31")$
  map(cloudMaskL457)

# Create simple composite
mean_l5 &lt;- ic_l5$mean()$rename("NDVI")
mean_l5 &lt;- mean_l5$reproject(crs = "EPSG:4326", scale = 500)
mean_l5_Amarakaeri &lt;- mean_l5$clip(ee_ROI)

# Move results from Earth Engine to Drive
task_img &lt;- ee_image_to_gcs(
   image = mean_l5_Amarakaeri,
   bucket = "rgee_dev",
   fileFormat = "GEO_TIFF",
   region = ee_ROI,
   fileNamePrefix = "my_image_demo"
)

task_img$start()
ee_monitoring(task_img)

# Move results from Drive to local
img &lt;- ee_gcs_to_local(task = task_img)

## End(Not run)
</code></pre>


</div>