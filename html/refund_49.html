<div class="container">

<table style="width: 100%;"><tr>
<td>lf</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Construct an FLM regression term</h2>

<h3>Description</h3>

<p>Defines a term <code class="reqn">\int_{T}\beta(t)X_i(t)dt</code> for inclusion in an <code>mgcv::gam</code>-formula (or
<code>{bam}</code> or <code>{gamm}</code> or <code>gamm4:::gamm</code>) as constructed by
<code>{pfr}</code>, where <code class="reqn">\beta(t)</code> is an unknown coefficient
function and <code class="reqn">X_i(t)</code> is a functional predictor on the closed interval
<code class="reqn">T</code>. See
<code>{smooth.terms}</code> for a list of basis and penalty options; the
default is thin-plate regression splines, as this is the default option
for <code>[mgcv]{s}</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">lf(
  X,
  argvals = NULL,
  xind = NULL,
  integration = c("simpson", "trapezoidal", "riemann"),
  L = NULL,
  presmooth = NULL,
  presmooth.opts = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>functional predictors, typically expressed as an <code>N</code> by <code>J</code> matrix,
where <code>N</code> is the number of columns and <code>J</code> is the number of
evaluation points. May include missing/sparse functions, which are
indicated by <code>NA</code> values. Alternatively, can be an object of class
<code>"fd"</code>; see <code>[fda]{fd}</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>argvals</code></td>
<td>
<p>indices of evaluation of <code>X</code>, i.e. <code class="reqn">(t_{i1},.,t_{iJ})</code> for
subject <code class="reqn">i</code>. May be entered as either a length-<code>J</code> vector, or as
an <code>N</code> by <code>J</code> matrix. Indices may be unequally spaced. Entering
as a matrix allows for different observations times for each subject. If
<code>NULL</code>, defaults to an equally-spaced grid between 0 or 1 (or within
<code>X$basis$rangeval</code> if <code>X</code> is a <code>fd</code> object.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xind</code></td>
<td>
<p>same as argvals. It will not be supported in the next version of refund.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>integration</code></td>
<td>
<p>method used for numerical integration. Defaults to <code>"simpson"</code>'s rule
for calculating entries in <code>L</code>. Alternatively and for non-equidistant grids,
<code>"trapezoidal"</code> or <code>"riemann"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>L</code></td>
<td>
<p>an optional <code>N</code> by <code>ncol(argvals)</code> matrix giving the weights for the numerical
integration over <code>t</code>. If present, overrides <code>integration</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>presmooth</code></td>
<td>
<p>string indicating the method to be used for preprocessing functional predictor prior
to fitting. Options are <code>fpca.sc</code>, <code>fpca.face</code>, <code>fpca.ssvd</code>, <code>fpca.bspline</code>, and
<code>fpca.interpolate</code>. Defaults to <code>NULL</code> indicating no preprocessing. See
<code>{create.prep.func}</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>presmooth.opts</code></td>
<td>
<p>list including options passed to preprocessing method
<code>{create.prep.func}</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optional arguments for basis and penalization to be passed to
<code>mgcv::s</code>. These could include, for example,
<code>"bs"</code>, <code>"k"</code>, <code>"m"</code>, etc. See <code>[mgcv]{s}</code> for details.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a list with the following entries
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>a <code>call</code> to <code>te</code> (or <code>s</code>, <code>t2</code>) using the appropriately
constructed covariate and weight matrices</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>argvals</code></td>
<td>
<p>the <code>argvals</code> argument supplied to <code>lf</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>L</code></td>
<td>
<p>the  matrix of weights used for the integration</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xindname</code></td>
<td>
<p>the name used for the functional predictor variable in the <code>formula</code>
used by <code>mgcv</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tindname</code></td>
<td>
<p>the name used for <code>argvals</code> variable in the <code>formula</code> used by <code>mgcv</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>LXname</code></td>
<td>
<p>the name used for the <code>L</code> variable in the <code>formula</code> used by <code>mgcv</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>presmooth</code></td>
<td>
<p>the <code>presmooth</code> argument supplied to <code>lf</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prep.func</code></td>
<td>
<p>a function that preprocesses data based on the preprocessing method specified in <code>presmooth</code>. See
<code>{create.prep.func}</code></p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Mathew W. McLean <a href="mailto:mathew.w.mclean@gmail.com">mathew.w.mclean@gmail.com</a>, Fabian Scheipl,
and Jonathan Gellar
</p>


<h3>References</h3>

<p>Goldsmith, J., Bobb, J., Crainiceanu, C., Caffo, B., and Reich, D. (2011).
Penalized functional regression. <em>Journal of Computational and Graphical
Statistics</em>, 20(4), 830-851.
</p>
<p>Goldsmith, J., Crainiceanu, C., Caffo, B., and Reich, D. (2012). Longitudinal
penalized functional regression for cognitive outcomes on neuronal tract
measurements. <em>Journal of the Royal Statistical Society: Series C</em>,
61(3), 453-469.
</p>


<h3>See Also</h3>

<p><code>{pfr}</code>, <code>{af}</code>, mgcv's <code>{smooth.terms}</code>
and <code>{linear.functional.terms}</code>; <code>{pfr}</code> for additional examples
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(DTI)
DTI1 &lt;- DTI[DTI$visit==1 &amp; complete.cases(DTI),]

# We can apply various preprocessing options to the DTI data
fit1 &lt;- pfr(pasat ~ lf(cca, k=30), data=DTI1)
fit2 &lt;- pfr(pasat ~ lf(cca, k=30, presmooth="fpca.sc",
                       presmooth.opts=list(nbasis=8, pve=.975)), data=DTI1)
fit3 &lt;- pfr(pasat ~ lf(cca, k=30, presmooth="fpca.face",
                       presmooth.opts=list(m=3, npc=9)), data=DTI1)
fit4 &lt;- pfr(pasat ~ lf(cca, k=30, presmooth="fpca.ssvd"), data=DTI1)
fit5 &lt;- pfr(pasat ~ lf(cca, k=30, presmooth="bspline",
                       presmooth.opts=list(nbasis=8)), data=DTI1)
fit6 &lt;- pfr(pasat ~ lf(cca, k=30, presmooth="interpolate"), data=DTI1)

# All models should result in similar fits
fits &lt;- as.data.frame(lapply(1:6, function(i)
  get(paste0("fit",i))$fitted.values))
names(fits) &lt;- c("none", "fpca.sc", "fpca.face", "fpca.ssvd", "bspline", "interpolate")
pairs(fits)

</code></pre>


</div>