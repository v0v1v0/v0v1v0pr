<div class="container">

<table style="width: 100%;"><tr>
<td>ts2histos</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
convert depth and temperature time series data to discrete Time-at-Depth and Time-at-Temperature data (histogram data)
</h2>

<h3>Description</h3>

<p>convert depth and temperature time series data to discrete Time-at-Depth (TaD) and Time-at-Temperature (TaT) data (histogram data) at user-defined breakpoints
</p>


<h3>Usage</h3>

<pre><code class="language-R">ts2histos(ts_df, tad_breaks=NULL, tat_breaks=NULL, split_by=NULL, 
          aggregate_by="Ptt",min_perc, omit_negatives=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ts_df</code></td>
<td>

<p>dataframe of depth time series data. Obligatory columns are the numeric vector "Depth", "date" (of class Date) and "Serial". <code>split.by</code> defines an optional vector to consider (e.g. <code>day.period</code>).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tad_breaks, tat_breaks</code></td>
<td>

<p>a numeric vector, defining the depth and/or temperature breakpoints of the histogram cells.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>split_by</code></td>
<td>

<p>Name of the column with logical entries by which TaD/TaT data shall be splitted (e.g. daytime; see classify_DayTime.).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aggregate_by</code></td>
<td>

<p>character vector defining the columns by which the tagging data should be aggregated. Should contain columns that identify tags (e.g. Serial, Ptt, DeployID) the date and/or day time period (to seperate records from night, day, dawn and dusk see classify_DayTime). Default values are: date, Day and Ptt.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_perc</code></td>
<td>

<p>optional number, defining the minimum data coverage (in percent) of histogram entries obtained from depth time series data.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>omit_negatives</code></td>
<td>

<p>treat negative depth and temperature records as 0 (default is <code>TRUE</code>). 
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Time-at-Depth and Time-at-Temperature fequencies (histograms) are a standard data product of archival tags (incl. tag models TDR-Mk9, PAT-Mk10 and miniPAT by <a href="https://wildlifecomputers.com/">Wildlife Computers</a>) that allow to assess habitat preferences of tagged animals.  It can be likewise generated from transmitted or recovered time series data sets, which is the purpose of this function. 
</p>
<p>However, different depth and temperature bin breaks are often used during different deployment programs, which makes a later comparitive analysis of TaT and TaD data difficult. For such cases, the functions combine_histos and merge_histos can be applied to merge TaT and TaD frequencies based on common bin breaks of different tags.
</p>
<p>To visualize Time-at-Temperature (TaT) and Time-at-Depth (TaD) data, please see hist_tat and hist_tad, respectively.
</p>


<h3>Value</h3>

<p>A list-of-lists containing the loaded histogram data. Lists of TaD and TaT data are distinguished at the first nesting level. Further sublists include the <code>bin_breaks</code> and data.frames of the generated histogram data. <strong>The data.frames of the histogram data thereby also contain average (avg) and standard deviation (SD) of depth and temperature values that are likewise directly estimated from time series data</strong>, unlike read_histos-generated values that are estimated from the histogram data. The accuracy of latter estimates thus depends on the number and selection of bin breaks (see statistics-example in read_histos).
</p>
<p>$ TaD:List<br>
..$ merged  : List of 2<br>
.. ..$ bin_breaks: num<br> 
.. ..$ df        : data.frame <br>
.. .. ..$ DeployID <br>
.. .. ..$ Ptt <br>
.. .. ..$ datetime <br>
.. .. ..$ date <br>
.. .. ..$ Bin1 <br>
..
.. .. ..$ Bin? (up to number of bin breaks)<br>
.. .. ..$ avg (average depth estimated!! from histogram data)<br>
.. .. ..$ SD (average depth estimated!! from histogram data) <br></p>
<p>$ TaT:List<br> 
..$ merged  : List of 2<br>
.. ..$ bin_breaks: num<br> 
.. ..$ df        : data.frame (with columns as above)<br></p>


<h3>Author(s)</h3>

<p>Robert K. Bauer
</p>


<h3>See Also</h3>

<p>read_histos, hist_tad, merge_histos</p>


<h3>Examples</h3>

<pre><code class="language-R">### load sample depth and temperature time series data from miniPAT:
ts_file &lt;- system.file("example_files/104659-Series.csv",package="RchivalTag")
ts_df &lt;- read_TS(ts_file)
head(ts_df)

tad_breaks &lt;- c(0, 2, 5, 10, 20, 50, 100, 200, 300, 400, 600, 2000)
tat_breaks &lt;- c(10,12,15,17,18,19,20,21,22,23,24,27)


## example 1a) convert only DepthTS data to daily TaD frequencies:
ts2histos(ts_df, tad_breaks = tad_breaks)
# hist_tad(ts_df, bin_breaks = tad_breaks)
hist_tad(ts_df, bin_breaks = tad_breaks, do_mid.ticks = FALSE)

## convert 1b) only TemperatureTS data to daily TaT frequencies:
tat &lt;- ts2histos(ts_df, tat_breaks = tat_breaks)
hist_tat(ts_df, bin_breaks = tat_breaks, do_mid.ticks = FALSE)
hist_tat(tat$TAT$merged, do_mid.ticks = FALSE)

## convert 1c) DepthTS &amp; TemperatureTS data to daily TaD &amp; TaT frequencies:
histos &lt;- ts2histos(ts_df, tad_breaks = tad_breaks, tat_breaks = tat_breaks)
histos$TAD$merged$df$nperc ## check completeness of TAD data sets
histos$TAT$merged$df$nperc ## check completeness of TAT data sets
# histos &lt;- ts2histos(ts_df, tad_breaks = tad_breaks, tat_breaks = tat_breaks,min_perc = 90)

## convert 1d) back-to-back histogram showing day vs night TaD frequencies:
ts_df$Lat &lt;- 4; ts_df$Lon=42.5 ## required geolocations to estimate daytime
head(ts_df)
ts_df2 &lt;- classify_DayTime(get_DayTimeLimits(ts_df)) # estimate daytime
head(ts_df2)

ts2histos(ts_df2, tad_breaks = tad_breaks,split_by = "daytime")
hist_tad(ts_df2, bin_breaks = tad_breaks,split_by = "daytime", do_mid.ticks = FALSE)


## example 2) rebin daily TaD frequencies:
tad &lt;- ts2histos(ts_df, tad_breaks = tad_breaks)
tad2 &lt;- rebin_histos(hist_list = tad, tad_breaks = tad_breaks[c(1:3,6:12)])
par(mfrow=c(2,2))
hist_tad(tad, do_mid.ticks = FALSE) ## example for multiple individuals
hist_tad(tad$TAD$merged, do_mid.ticks = FALSE)
hist_tad(tad$TAD$merged, bin_breaks = tad_breaks[c(1:3,6:12)]) ## from inside hist_tad


</code></pre>


</div>