<div class="container">

<table style="width: 100%;"><tr>
<td>make_afun</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create a custom analysis function wrapping an existing function</h2>

<h3>Description</h3>

<p>Create a custom analysis function wrapping an existing function
</p>


<h3>Usage</h3>

<pre><code class="language-R">make_afun(
  fun,
  .stats = NULL,
  .formats = NULL,
  .labels = NULL,
  .indent_mods = NULL,
  .ungroup_stats = NULL,
  .format_na_strs = NULL,
  ...,
  .null_ref_cells = ".in_ref_col" %in% names(formals(fun))
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>(<code>function</code>)<br> the function to be wrapped in a new customized analysis function.
<code>fun</code> should return a named <code>list</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.stats</code></td>
<td>
<p>(<code>character</code>)<br> names of elements to keep from <code>fun</code>'s full output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.formats</code></td>
<td>
<p>(<code>ANY</code>)<br> vector or list of formats to override any defaults applied by <code>fun</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.labels</code></td>
<td>
<p>(<code>character</code>)<br> vector of labels to override defaults returned by <code>fun</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.indent_mods</code></td>
<td>
<p>(<code>integer</code>)<br> named vector of indent modifiers for the generated rows.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.ungroup_stats</code></td>
<td>
<p>(<code>character</code>)<br> vector of names, which must match elements of <code>.stats</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.format_na_strs</code></td>
<td>
<p>(<code>ANY</code>)<br> vector/list of <code>NA</code> strings to override any defaults applied by <code>fun</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments to <code>fun</code> which effectively become new defaults. These can still be
overridden by <code>extra_args</code> within a split.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.null_ref_cells</code></td>
<td>
<p>(<code>flag</code>)<br> whether cells for the reference column should be <code>NULL</code>-ed by the
returned analysis function. Defaults to <code>TRUE</code> if <code>fun</code> accepts <code>.in_ref_col</code> as a formal argument. Note
this argument occurs after <code>...</code> so it must be <em>fully</em> specified by name when set.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A function suitable for use in <code>analyze()</code> with element selection, reformatting, and relabeling
performed automatically.
</p>


<h3>Note</h3>

<p>Setting <code>.ungroup_stats</code> to non-<code>NULL</code> changes the <em>structure</em> of the value(s) returned by <code>fun</code>, rather than
just labeling (<code>.labels</code>), formatting (<code>.formats</code>), and selecting amongst (<code>.stats</code>) them. This means that
subsequent <code>make_afun</code> calls to customize the output further both can and must operate on the new structure,
<em>not</em> the original structure returned by <code>fun</code>. See the final pair of examples below.
</p>


<h3>See Also</h3>

<p><code>analyze()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">s_summary &lt;- function(x) {
  stopifnot(is.numeric(x))

  list(
    n = sum(!is.na(x)),
    mean_sd = c(mean = mean(x), sd = sd(x)),
    min_max = range(x)
  )
}

s_summary(iris$Sepal.Length)

a_summary &lt;- make_afun(
  fun = s_summary,
  .formats = c(n = "xx", mean_sd = "xx.xx (xx.xx)", min_max = "xx.xx - xx.xx"),
  .labels = c(n = "n", mean_sd = "Mean (sd)", min_max = "min - max")
)

a_summary(x = iris$Sepal.Length)

a_summary2 &lt;- make_afun(a_summary, .stats = c("n", "mean_sd"))

a_summary2(x = iris$Sepal.Length)

a_summary3 &lt;- make_afun(a_summary, .formats = c(mean_sd = "(xx.xxx, xx.xxx)"))

s_foo &lt;- function(df, .N_col, a = 1, b = 2) {
  list(
    nrow_df = nrow(df),
    .N_col = .N_col,
    a = a,
    b = b
  )
}

s_foo(iris, 40)

a_foo &lt;- make_afun(s_foo,
  b = 4,
  .formats = c(nrow_df = "xx.xx", ".N_col" = "xx.", a = "xx", b = "xx.x"),
  .labels = c(
    nrow_df = "Nrow df",
    ".N_col" = "n in cols", a = "a value", b = "b value"
  ),
  .indent_mods = c(nrow_df = 2L, a = 1L)
)

a_foo(iris, .N_col = 40)
a_foo2 &lt;- make_afun(a_foo, .labels = c(nrow_df = "Number of Rows"))
a_foo2(iris, .N_col = 40)

# grouping and further customization
s_grp &lt;- function(df, .N_col, a = 1, b = 2) {
  list(
    nrow_df = nrow(df),
    .N_col = .N_col,
    letters = list(
      a = a,
      b = b
    )
  )
}
a_grp &lt;- make_afun(s_grp,
  b = 3,
  .labels = c(
    nrow_df = "row count",
    .N_col = "count in column"
  ),
  .formats = c(nrow_df = "xx.", .N_col = "xx."),
  .indent_mods = c(letters = 1L),
  .ungroup_stats = "letters"
)
a_grp(iris, 40)
a_aftergrp &lt;- make_afun(a_grp,
  .stats = c("nrow_df", "b"),
  .formats = c(b = "xx.")
)
a_aftergrp(iris, 40)

s_ref &lt;- function(x, .in_ref_col, .ref_group) {
  list(
    mean_diff = mean(x) - mean(.ref_group)
  )
}

a_ref &lt;- make_afun(s_ref,
  .labels = c(mean_diff = "Mean Difference from Ref")
)
a_ref(iris$Sepal.Length, .in_ref_col = TRUE, 1:10)
a_ref(iris$Sepal.Length, .in_ref_col = FALSE, 1:10)

</code></pre>


</div>