<div class="container">

<table style="width: 100%;"><tr>
<td>powerCalData</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Calculate the power for testing <code class="reqn">\delta=0</code> based on a dataset
</h2>

<h3>Description</h3>

<p>Calculate the power for testing <code class="reqn">\delta=0</code> based on a dataset.
</p>


<h3>Usage</h3>

<pre><code class="language-R">powerCalData(
  nSubj, 
  triangle, 
  frame,
  alpha = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>nSubj</code></td>
<td>

<p>integer. number of subjects to be generated. Assume each subject has two observations.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>triangle</code></td>
<td>

<p>the difference of the expected value the the extended Mann-Whitney U statistics
between two prediction rules, i.e., <code class="reqn">\triangle = \eta^{(1)}_c - \eta^{(2)}_c</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>frame</code></td>
<td>

<p>A data frame with 5 columns: cid, subuid, status, score1, and score2.
<code>cid</code> indicates cluster id; <code>subuid</code> indicates unit ID within a cluster;
<code>status=1</code> indicates an eye is progressed;
<code>status=0</code> indicates an eye is not progressed;
<code>score1</code> represents the score based on prediction rule 1.
<code>score2</code> represents the score based on prediction rule 2.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>

<p>type I error rate
</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list with 11 elements. 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>power</code></td>
<td>
<p>the esstimated power</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>

<p><code class="reqn">\rho=corr\left(H\left(Z_{ij}\right), H\left(Z_{k\ell}\right)\right)</code>, where <code class="reqn">H=\Phi^{-1}</code> is the probit transformation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho11</code></td>
<td>

<p><code class="reqn">\rho_{11}=corr\left(H_{ij}^{(1)}, H_{i\ell}^{(1)}\right)</code>, where <code class="reqn">H=\Phi^{-1}</code> is the probit transformation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho22</code></td>
<td>

<p><code class="reqn">\rho_{22}=corr\left(H_{ij}^{(2)}, H_{i\ell}^{(2)}\right)</code>, where <code class="reqn">H=\Phi^{-1}</code> is the probit transformation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho12</code></td>
<td>

<p><code class="reqn">\rho_{12}=corr\left(H_{ij}^{(1)}, H_{i\ell}^{(2)}\right)</code>, where <code class="reqn">H=\Phi^{-1}</code> is the probit transformation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p11</code></td>
<td>

<p><code class="reqn">p_{11}=Pr(\delta_{i1}=1 \&amp; \delta_{i2}=1)</code>, where <code class="reqn">\delta_{ij}=1</code> if the <code class="reqn">j</code>-th subunit of the 
<code class="reqn">i</code>-th cluster has progressed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p10</code></td>
<td>

<p><code class="reqn">p_{10}=Pr(\delta_{i1}=1 \&amp; \delta_{i2}=0)</code>, where <code class="reqn">\delta_{ij}=1</code> if the <code class="reqn">j</code>-th subunit of the 
<code class="reqn">i</code>-th cluster has progressed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p01</code></td>
<td>

<p><code class="reqn">p_{01}=Pr(\delta_{i1}=0 \&amp; \delta_{i2}=1)</code>, where <code class="reqn">\delta_{ij}=1</code> if the <code class="reqn">j</code>-th subunit of the 
<code class="reqn">i</code>-th cluster has progressed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p00</code></td>
<td>

<p><code class="reqn">p_{00}=Pr(\delta_{i1}=0 \&amp; \delta_{i2}=0)</code>, where <code class="reqn">\delta_{ij}=1</code> if the <code class="reqn">j</code>-th subunit of the 
<code class="reqn">i</code>-th cluster has progressed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu1</code></td>
<td>

<p><code class="reqn">\mu_1=H(Y)-H(Y_c)</code> is the difference between probit transformation 
<code class="reqn">H(Y)</code> and probit-shift alternative <code class="reqn">H(Y_c)</code> for the first prediction score,
where <code class="reqn">Y</code> is the prediction score of a randomly selected progressing
subunit, and <code class="reqn">Y_c</code> is the counterfactual random variable
obtained if each subunit that had progressed actually had not progressed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu2</code></td>
<td>

<p><code class="reqn">\mu_2=H(Y)-H(Y_c)</code> is the difference between probit transformation 
<code class="reqn">H(Y)</code> and probit-shift alternative <code class="reqn">H(Y_c)</code> for the second prediction score,
where <code class="reqn">Y</code> is the prediction score of a randomly selected progressing
subunit, and <code class="reqn">Y_c</code> is the counterfactual random variable
obtained if each subunit that had progressed actually had not progressed.
</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Bernard Rosner &lt;stbar@channing.harvard.edu&gt;, 
Weiliang Qiu &lt;Weiliang.Qiu@gmail.com&gt;, 
Meiling Ting Lee &lt;MLTLEE@umd.edu&gt;
</p>


<h3>References</h3>

<p>Rosner B, Qiu W, and Lee MLT.
Assessing Discrimination of Risk Prediction Rules in a Clustered Data Setting.
Lifetime Data Anal. 2013 Apr; 19(2): 242-256.
</p>


<h3>Examples</h3>

<pre><code class="language-R">

set.seed(1234567)

datFrame = genSimDataGLMEM(nSubj = 30, beta0 = -6, sd.beta0i = 1.58, 
                          beta1 = 1.58, beta2 = -3.95, beta3 = 3.15, beta4 = 2.06,
                          beta5 = 0.51, beta6 = 1.47, beta7 = 3.11, 
                          p.smkcur = 0.08, p.inieye31 = 0.44, p.inieye32 = 0.42,
                          p.inieye41 = 0.12, p.inieye42 = 0.11, sd.lncalorc = 0.33)

print(dim(datFrame))
print(datFrame[1:2,])

# prediction rule 1
tt1 = getScore(fmla = prog~smkcur+lncalorc+inieye3+inieye4+factor(rtotfat), 
  cidVar = "cid", subuidVar = "subuid", statusVar = "prog", 
  datFrame = datFrame, mycorstr = "exchangeable",
  verbose = FALSE)
myframe1=tt1$frame

print(dim(myframe1))
print(myframe1[1:3,])

####
# prediction rule 2
tt2 = getScore(fmla = prog~smkcur+lncalorc+inieye3+inieye4, 
  cidVar = "cid", subuidVar = "subuid", statusVar = "prog", 
  datFrame = datFrame, mycorstr = "exchangeable",
  verbose = FALSE)
myframe2=tt2$frame

print(dim(myframe2))
print(myframe2[1:3,])

# combine scores from two prediction rules
myframe12=myframe1[, c("cid", "subuid", "status")]
myframe12$score1=myframe1$score
myframe12$score2=myframe2$score
print(dim(myframe12))
print(myframe12[1:3,])


res = powerCalData(nSubj = 30, triangle = 0.05, frame=myframe12, alpha = 0.05)

print(res)


</code></pre>


</div>