<div class="container">

<table style="width: 100%;"><tr>
<td>contribution</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Function to decompose the Relative Concentration Index into its components</h2>

<h3>Description</h3>

<p>Currently compatible with <code>lm</code>, <code>glm</code> logit and probit, <code>svyglm</code>, <code>coxph</code> and <code>mfx</code> marginal effects probit.
</p>


<h3>Usage</h3>

<pre><code class="language-R">contribution(object, ranker, correction = TRUE, type = "CI", intercept = "exclude")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>The model result object. class <code>coxph</code>, <code>glm</code>, <code>lm</code> or <code>svyglm</code>, <code>probitmfx</code>, <code>logitmfx</code>; the outcome should be the health variable and the predictors the components.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ranker</code></td>
<td>
<p>Ranking variable with the same length as the outcome.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>correction</code></td>
<td>
<p>A logical indicating whether the global and partial confidence should be corrected for negative values using imputation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Character, concentration index type that the decomposition should be applied to. Defaults to <code>CI</code>. Use <code>CIw</code> for binary outcomes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>
<p>Character, one of <code>exclude</code> or <code>include</code>, defaults to <code>exclude</code>. If <code>exclude</code>, the intercept coefficient will not included in the decomposition analysis, if set to <code>include</code>, it will be included.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>These functions decompose the Relative Concentration Index into its components using a (generalized) linear model, optionally using a survey design, or a Cox Proportional Hazards model. Print, summary and plot methods have been defined for the results.
</p>
<p>If <code>correction</code> is <code>TRUE</code> negative values of components or outcome are corrected using <code>correct_sign()</code> with option <code>shift = FALSE</code>.
</p>
<p>For non-linear models the decomposition needs to rely on a linear approximations of the effects. There are different approaches. One is to work on the scale of the <code>glm</code> coefficients and calculate the concentration index based on the predicted outcome. (Konings et al., 2010, Speybroeck et al., 2010). Another approach is to use marginal effects as beta coefficients and the original outcome (O'Donnel et al. 2008).
</p>
<p>This function supports both. For <code>glm</code>, <code>coxph</code>, and <code>svyglm</code> models, the first approach is used. The second approach is implemented for model objects of type <code>probitmfx</code> and <code>logitmfx</code> from the 'mfx' package. See examples.
</p>
<p>Per default, the intercept in models is excluded, but this can be changed by setting the the <code>intercept</code> argument to <code>include</code>, but this may conceptually make less sense and is more appropriate if the model does not contain an intercept.
</p>
<p>Use <code>decomposition()</code> function directly to manually specify coefficients, outcomes, and model matrices for arbitrary models.
</p>


<h3>Value</h3>

<p>An object of class <code>decomposition</code> containing the following components:
</p>

<ul>
<li> <p><code>betas</code> A numeric vector containing regression coefficients
</p>
</li>
<li> <p><code>partial_cis</code> A numeric vector containing partial confidence intervals
</p>
</li>
<li> <p><code>confints</code> A numeric vector containing 95\
</p>
</li>
<li> <p><code>averages</code> Weighted averages of every variable in the model
</p>
</li>
<li> <p><code>ci_contribution</code> Confidence intervals for contributions
</p>
</li>
<li> <p><code>overall_ci</code> Confidence intervals for the concentration index
</p>
</li>
<li> <p><code>corrected_coefficients</code> Corrected coefficients using  <code>correct_sign()</code> if, requested <code>FALSE</code> otherwise
</p>
</li>
<li> <p><code>outcome_corrected</code> Corrected outcome  <code>correct_sign()</code> if requested, <code>FALSE</code> otherwise
</p>
</li>
<li> <p><code>rows</code> Rownames of used rows in the model
</p>
</li>
</ul>
<h3>Warning</h3>

<p><code>ranker</code> should be chosen with care. Ideally, it is a variable from the same dataframe as the other variables. If not, redefine the row names in the model.
</p>


<h3>Author(s)</h3>

<p>Peter Konings
</p>


<h3>References</h3>

<p>Konings, P., Harper, S., Lynch, J., Hosseinpoor, A.R., Berkvens, D., Lorant, V., Geckova, A., Speybroeck, N., 2010. Analysis of socioeconomic health inequalities using the concentration index. Int J Public Health 55, 71–74. https://doi.org/10.1007/s00038-009-0078-y
</p>
<p>Speybroeck, N., Konings, P., Lynch, J., Harper, S., Berkvens, D., Lorant, V., Geckova, A., Hosseinpoor, A.R., 2010. Decomposing socioeconomic health inequalities. Int J Public Health 55, 347–351. https://doi.org/10.1007/s00038-009-0105-z
</p>
<p>O’Donnell, O., Doorslaer, E. van, Wagstaff, A., Lindelow, M., 2008. Analyzing Health Equity Using Household Survey Data: A Guide to Techniques and Their Implementation, World Bank Publications. The World Bank.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(housing)

## Linear regression direct decomposition
fit.lm &lt;- lm(bmi ~ sex + tenure + place + age,data = housing)
       
# decompose relative concentration index
contrib.lm &lt;- contribution(fit.lm, housing$income) 
summary(contrib.lm)
plot(contrib.lm, decreasing = FALSE, horiz = TRUE)

    
# GLM: Decomposition based on predicted outcome
fit.logit &lt;-glm(high.bmi ~ sex + tenure + place + age, data = housing)

contrib.logit &lt;- contribution(fit.logit, housing$income) 
summary(contrib.logit)
plot(contrib.logit, decreasing = FALSE,horiz = TRUE)


# GLM probit: Decomposition based on predicted outcome
fit.probit &lt;-glm(high.bmi ~ sex + tenure + place + age, data = housing, 
                family = binomial(link = probit))

# binary, set type to 'CIw'
contrib.probit &lt;- contribution(fit.probit, housing$income, type = "CIw") 
summary(contrib.probit)
plot(contrib.probit, decreasing = FALSE,horiz = TRUE)


# Marginal effects probit using package 'mfx': Decomposition based on predicted outcome
fit.mfx &lt;-mfx::probitmfx(high.bmi ~ sex + tenure + place + age, data = housing)

contrib.mfx &lt;- contribution(fit.mfx, housing$income, type = "CIw") 
summary(contrib.mfx, type="CIw")
plot(contrib.mfx, decreasing = FALSE, horiz = TRUE)


# package survey svy 
des = survey::svydesign(~1, data= housing, weights = rep(1, NROW(housing)))
fit.svy = survey::svyglm(bmi ~ tenure+height+weight, design = des)
contrib.svy = contribution(fit.svy, housing$income)


# adopted from the `coxph` example in survival package 
testcph &lt;- data.frame(time = c(4,3,1,1,2,2,3), 
              status = c(1,1,1,0,1,1,0), 
              x      = c(0,2,1,1,1,0,0), 
              sex    = c(0,0,0,0,1,1,1),
              income = c(100,50, 20, 20, 50, 60,100))
              
# Fit a stratified model 
fit.coxph = survival::coxph(survival::Surv(time, status) ~ x + survival::strata(sex), testcph) 
contrib.coxph = contribution(fit.coxph, testcph$income) 


</code></pre>


</div>