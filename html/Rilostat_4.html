<div class="container">

<table style="width: 100%;"><tr>
<td>get_ilostat</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Read Ilostat Data</h2>

<h3>Description</h3>

<p>Download datasets from ilostat <a href="https://ilostat.ilo.org">https://ilostat.ilo.org</a> via bulk download facility 
<a href="https://ilostat.ilo.org/data/bulk/">https://ilostat.ilo.org/data/bulk/</a>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">get_ilostat(
  id,
  segment = getOption("ilostat_segment", "indicator"),
  type = getOption("ilostat_type", "code"),
  lang = getOption("ilostat_lang", "en"),
  time_format = getOption("ilostat_time_format", "raw"),
  filters = getOption("ilostat_filter", "none"),
  fixed = getOption("ilostat_fixed", TRUE),
  detail = getOption("ilostat_detail", "full"),
  cache = getOption("ilostat_cache", TRUE),
  cache_update = getOption("ilostat_cache_update", TRUE),
  cache_dir = getOption("ilostat_cache_dir", NULL),
  cache_format = getOption("ilostat_cache_format", "rds"),
  back = getOption("ilostat_back", TRUE),
  cmd = getOption("ilostat_cmd", "none"),
  quiet = getOption("ilostat_quiet", FALSE)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>A code name for the dataset of interest.
See <code>get_ilostat_toc</code> or details for how to get code.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>segment</code></td>
<td>
<p>A character, way to get datasets by: <code>"indicator"</code> (default) or <code>"ref_area"</code>.
Can be set also with options(ilostat_segment = 'ref_area'),</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>a character, type of variables, <code>"code"</code> (default), <code>"label"</code> or <code>"both"</code>.
Can be set also with options(ilostat_type = 'both'),</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lang</code></td>
<td>
<p>a character, code for language. Available are <code>"en"</code> (default), 
<code>"fr"</code> and <code>"es"</code>. Can be set also with options(ilostat_lang = 'fr'),</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_format</code></td>
<td>
<p>a string giving a type of the conversion of the time
column from the ilostat format. "raw" (default)
does not do conversion and return time as character (ie. '2017', '2017Q1', '2017M01'). A "date" converted to
a <code>Date</code> with a first date of the period. A "date_last" converted to a <code>Date</code> with
a last date of the period and "num" converted to a numeric. Can be set also with 
options(ilostat_time_format = 'date'),</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filters</code></td>
<td>
<p>a list; <code>"none"</code> (default) to get a whole dataset or a named list of
filters to get just part of the table. Names of list objects are
ilostat variable codes and values are vectors of observation codes.
filters detect on variables, so could be partial, ie. <code>list(sex = 'T')</code> is
enough but equivalent to <code>list(sex = 'SEX_T')</code>. Additional options:
</p>
 
<ul>
<li>
<p><code>timefrom</code> : starting year of the return dataset,
</p>
</li>
<li>
<p><code>timeto</code> : ending year of the return dataset.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed</code></td>
<td>
<p>a logical, if <code>TRUE</code> (default), filters arguments pattern is a string to be matched as is,
Change to <code>FALSE</code> if more complex regex matching is needed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>detail</code></td>
<td>
<p>a character, <code>'full'</code> (default), whether <code>'serieskeysonly'</code>, return
only key, no data, no notes or <code>dataonly</code> return key and data, no notes or <code>'bestsourceonly'</code> return 
best source only at the series key levels, see details.
Can be set also with options(ilostat_detail = 'serieskeysonly'),</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cache</code></td>
<td>
<p>a logical whether to do caching. Default is <code>TRUE</code>. Affects
only queries from the ilostat bulk download facility. 
Can be set also with options(ilostat_cache = FALSE),</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cache_update</code></td>
<td>
<p>a logical whether to update cache. Check cache update with last.update attribute store on the cache file name 
and the one from the table of contents. Can be set also with
options(ilostat_cache_update = FALSE). Default is <code>TRUE</code>,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cache_dir</code></td>
<td>
<p>a path to a cache directory. The directory has to exist.
The <code>NULL</code> (default) uses and creates
'ilostat' directory in the temporary directory from
<code>tempdir</code>. The directory can also be set with
<code>option</code> ilostat_cache_dir,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cache_format</code></td>
<td>
<p>a character, format to store on the cache <code>"rds"</code> (default), but also <code>"csv"</code>, <code>"dta"</code>, 
<code>"sav"</code>, <code>"sas7bdat"</code>. useful for getting ilostat dataset directly on the <code>cache_dir</code> without R.  
Can be set also with options(ilostat_cache_format = 'dta'),</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>back</code></td>
<td>
<p>a logical, <code>TRUE</code> return dataframe on R or not <code>FALSE</code>, useful for just saving file in specific <code>cache_format</code>,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cmd</code></td>
<td>
<p>a character, R expression use for manipulate internal data frame <code>dat</code> object applied to each datasets retrieved 
If use, <code>cache</code> is set to FALSE. see examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>a logical, if <code>TRUE</code> , don't return message from processing, <code>FALSE</code> (default).
Can be set also with options(ilostat_quiet = TRUE),</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a tibble. One column for each dimension in the data and
the values column for numerical values, as well as the metadata columns.
The time column for a time dimension.
</p>


<h3>others</h3>

<p>Data sets are downloaded from the
ilostat bulk download facility. 
If only the table <code>id</code> is given, the whole table is downloaded from the
bulk download facility. 
</p>
<p>The bulk download facility is the fastest method to download whole datasets.
It is also often the only way as the sdmx API has limitation of maximum 
300 000 records at the same time and whole datasets usually exceeds that. 
</p>
<p>By default datasets from the bulk download facility are cached as they are
often rather large. 
</p>
<p>Cache files are stored in a temporary directory by default or in
a named directory if cache_dir or option ilostat_cache_dir is defined.
The cache can be emptied with <code>clean_ilostat_cache</code>.
</p>
<p>The <code>id</code>, a code, for the dataset can be searched with
the <code>get_ilostat_toc</code> or from the [bulk download facility](https://ilostat.ilo.org/data/bulk/).
</p>


<h3>Author(s)</h3>

<p>David Bescond <a href="mailto:bescond@ilo.org">bescond@ilo.org</a>
</p>


<h3>References</h3>

<p>See citation("Rilostat")
ilostat bulk download facility user guidelines <a href="https://ilostat.ilo.org/data/bulk/">https://ilostat.ilo.org/data/bulk/</a>
</p>


<h3>See Also</h3>

<p><code>get_ilostat_toc</code>, <code>label_ilostat</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
############# get simple dataset
 dat &lt;- get_ilostat("UNE_2UNE_SEX_AGE_NB_A")
 head(dat)
 dat &lt;- get_ilostat("NZL_Q", segment = "ref_area")
 head(dat)

 dir.create(file.path(tempdir(), "r_cache"))
 dat &lt;- get_ilostat("UNE_2UNE_SEX_AGE_NB_A", 
                  cache_dir = file.path(tempdir(), "r_cache"))
 head(dat)

 clean_ilostat_cache(cache_dir = file.path(tempdir(), "r_cache")) 

 options(ilostat_update = TRUE)
 dat &lt;- get_ilostat("UNE_2UNE_SEX_AGE_NB_A")
 head(dat)
 options(ilostat_update = FALSE)
 options(ilostat_cache_dir = file.path(tempdir(), "r_cache"))
 dat &lt;- get_ilostat("UNE_2UNE_SEX_AGE_NB_A")

 clean_ilostat_cache() 

############# get multiple datasets
 dat &lt;- get_ilostat(c("CPI_ACPI_COI_RT_M", 'CPI_ACPI_COI_RT_Q'), cache = FALSE)
 head(dat)
 toc &lt;- get_ilostat_toc(search = 'CPI_')
 head(toc)
 dat &lt;- get_ilostat(toc, cache = FALSE) #id as a tibble

############# get datasets with filters
 dat &lt;- get_ilostat(id = c("UNE_2UNE_SEX_AGE_NB_A", 'EMP_2EMP_SEX_AGE_NB_A'), 
 		filters = list(	ref_area = "FRA", 
 		classif1 = "AGE_YTHADULT_YGE15", 
 		time = "2016",
 		sex = c("T", 'SEX_F')), quiet = TRUE)
 head(dat)
 clean_ilostat_cache() 

############# store in other format
 dir.create(file.path(tempdir(), "ilostat"))

 dat &lt;- get_ilostat("UNE_2UNE_SEX_AGE_NB_A", 
                  cache_dir = file.path(tempdir(), "r_cache"), cache_format = 'csv')
 dat &lt;- get_ilostat("UNE_2UNE_SEX_AGE_NB_A", 
                  cache_dir = file.path(tempdir(), "r_cache"), cache_format = 'dta')

############# advanced manipulation

 dat &lt;- get_ilostat("UNE_2UNE_SEX_AGE_NB_A", cmd = "dat %&gt;% count(ref_area)", quiet = TRUE)
 label_ilostat(dat, code = 'ref_area')

 clean_ilostat_cache()

## End(Not run)
</code></pre>


</div>