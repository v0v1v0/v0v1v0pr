<div class="container">

<table style="width: 100%;"><tr>
<td>Map</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>R6 object (Map) to display Earth Engine (EE) spatial objects</h2>

<h3>Description</h3>

<p>Create interactive visualizations of spatial EE objects
(ee$FeatureCollection, ee$ImageCollection, ee$Geometry, ee$Feature, and
ee$Image.) using <code>leaflet</code> in the backend.
</p>


<h3>Usage</h3>

<pre><code class="language-R">Map
</code></pre>


<h3>Format</h3>

<p>An object of class environment with the
following functions:
</p>

<ul>
<li>  <p><strong>addLayer(eeObject, visParams, name = NULL, shown = TRUE,
opacity = 1, titiler_viz_convert = TRUE,
titiler_server = "https://api.cogeo.xyz/")</strong>: Adds a given EE object to the
map as a layer. <br></p>

<ul>
<li> <p><strong>eeObject:</strong> The object to add to the interactive map.<br></p>
</li>
<li> <p><strong>visParams:</strong> List of parameters for visualization.
See details.<br></p>
</li>
<li> <p><strong>name:</strong> The name of the layer.<br></p>
</li>
<li> <p><strong>shown:</strong> A flag indicating whether the
layer should be on by default. <br></p>
</li>
<li> <p><strong>opacity:</strong> The layer's opacity is represented as a number
between 0 and 1. Defaults to 1. <br></p>
</li>
<li> <p><strong>titiler_viz_convert:</strong> Logical. If it is TRUE, Map$addLayer
will transform the visParams to titiler style. Ignored if eeObject is
not a COG file. <br></p>
</li>
<li> <p><strong>titiler_server:</strong> TiTiler endpoint. Defaults to
"https://api.cogeo.xyz/".
</p>
</li>
</ul>
</li>
<li>  <p><strong>addLayers(eeObject, visParams, name = NULL, shown = TRUE,
opacity = 1)</strong>: Adds a given ee$ImageCollection to the map
as multiple layers. <br></p>

<ul>
<li> <p><strong>eeObject:</strong> The ee$ImageCollection to add to the interactive map.<br></p>
</li>
<li> <p><strong>visParams:</strong> List of parameters for visualization.
See details.<br></p>
</li>
<li> <p><strong>name:</strong> The name of layers.<br></p>
</li>
<li> <p><strong>shown:</strong> A flag indicating whether
layers should be on by default. <br></p>
</li>
<li> <p><strong>opacity:</strong> The layer's opacity is represented as a number
between 0 and 1. Defaults to 1. <br></p>
</li>
<li> <p><strong>nmax:</strong> Numeric. The maximum number of images to display.
By default 5.
</p>
</li>
</ul>
</li>
<li>  <p><strong>addLegend(visParams, name = "Legend", position = c("bottomright",
"topright", "bottomleft", "topleft"), color_mapping= "numeric", opacity = 1, ...)</strong>:
Adds a given ee$ImageCollection to the map as multiple layers. <br></p>

<ul>
<li> <p><strong>visParams:</strong> List of parameters for visualization.<br></p>
</li>
<li> <p><strong>name:</strong> The title of the legend.<br></p>
</li>
<li> <p><strong>position:</strong> Character. The position of the legend. By default bottomright. <br></p>
</li>
<li> <p><strong>color_mapping:</strong> Map data values (numeric or factor/character) to
colors according to a given palette. Use "numeric" ("discrete") for continuous
(categorical) data. For display characters use "character" and add to visParams
the element "values" containing the desired character names. <br></p>
</li>
<li> <p><strong>opacity:</strong> The legend's opacity is represented as a number between 0
and 1. Defaults to 1. <br></p>
</li>
<li> <p><strong>...:</strong> Extra legend creator arguments. See addLegend. <br></p>
</li>
</ul>
</li>
<li> <p><strong>setCenter(lon = 0, lat = 0, zoom = NULL)</strong>: Centers the map
view at the given coordinates with the given zoom level. If no zoom level
is provided, it uses 1 by default.
</p>

<ul>
<li> <p><strong>lon:</strong> The longitude of the center, in degrees.<br></p>
</li>
<li> <p><strong>lat:</strong> The latitude of the center, in degrees.<br></p>
</li>
<li> <p><strong>zoom:</strong> The zoom level, from 1 to 24.
</p>
</li>
</ul>
</li>
<li> <p><strong>setZoom(zoom = NULL)</strong>: Sets the zoom level of the map.
</p>

<ul><li> <p><strong>zoom:</strong> The zoom level, from 1 to 24.
</p>
</li></ul>
</li>
<li> <p><strong>centerObject(eeObject, zoom = NULL,
maxError = ee$ErrorMargin(1))</strong>: Centers the
map view on a given object. If no zoom level is provided, it will
be predicted according to the bounds of the Earth Engine object specified.
</p>

<ul>
<li> <p><strong>eeObject:</strong> EE object.<br></p>
</li>
<li> <p><strong>zoom:</strong> The zoom level, from 1 to 24.
</p>
</li>
<li> <p><strong>maxError:</strong> 	Max error when input
image must be reprojected to an explicitly
requested result projection or geodesic state.
</p>
</li>
</ul>
</li>
</ul>
<h3>Details</h3>

<p><code>Map</code> use the Earth Engine method
<a href="https://developers.google.com/earth-engine/api_docs#ee.data.getmapid/">
getMapId</a> to fetch and return an ID dictionary being used to create
layers in a <code>leaflet</code> object. Users can specify visualization
parameters to Map$addLayer by using the visParams argument. Each Earth
Engine spatial object has a specific format. For
<code>ee$Image</code>, the
<a href="https://developers.google.com/earth-engine/guides/image_visualization">
parameters</a> available are:
</p>

<table>
<tr>
<td style="text-align: left;">
<strong>Parameter</strong>
</td>
<td style="text-align: left;"> <strong>Description</strong>  </td>
<td style="text-align: left;"> <strong>Type</strong>
</td>
</tr>
<tr>
<td style="text-align: left;">
<strong>bands</strong>    </td>
<td style="text-align: left;">  Comma-delimited list of three band (RGB) </td>
<td style="text-align: left;">  list </td>
</tr>
<tr>
<td style="text-align: left;">
<strong>min</strong>      </td>
<td style="text-align: left;">  Value(s) to map to 0 </td>
<td style="text-align: left;">  number or list of three
numbers, one for each band </td>
</tr>
<tr>
<td style="text-align: left;">
<strong>max</strong>      </td>
<td style="text-align: left;">  Value(s) to map to 1 </td>
<td style="text-align: left;">  number or list of three
numbers, one for each band </td>
</tr>
<tr>
<td style="text-align: left;">
<strong>gain</strong>     </td>
<td style="text-align: left;">  Value(s) by which to multiply each pixel value </td>
<td style="text-align: left;">
number or list of three numbers, one for each band </td>
</tr>
<tr>
<td style="text-align: left;">
<strong>bias</strong>     </td>
<td style="text-align: left;">  Value(s) to add to each Digital Number
value </td>
<td style="text-align: left;"> number or list of three numbers, one for each band </td>
</tr>
<tr>
<td style="text-align: left;">
<strong>gamma</strong>    </td>
<td style="text-align: left;">  Gamma correction factor(s) </td>
<td style="text-align: left;">  number or list of
three numbers, one for each band </td>
</tr>
<tr>
<td style="text-align: left;">
<strong>palette</strong>  </td>
<td style="text-align: left;">  List of CSS-style color strings
(single-band only) </td>
<td style="text-align: left;">  comma-separated list of hex strings </td>
</tr>
<tr>
<td style="text-align: left;">
<strong>opacity</strong>   </td>
<td style="text-align: left;">  The opacity of the layer (from 0 to 1)  </td>
<td style="text-align: left;">  number </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<p>If you add an <code>ee$Image</code> to Map$addLayer without any additional
parameters, by default it assigns the first three bands to red,
green, and blue bands, respectively. The default stretch is based on the
min-max range. On the other hand, the available parameters for
<code>ee$Geometry</code>, <code>ee$Feature</code>, and <code>ee$FeatureCollection</code>
are:
</p>

<ul>
<li> <p><strong>color</strong>: A hex string in the format RRGGBB specifying the
color to use for drawing the features. By default #000000.
</p>
</li>
<li> <p><strong>pointRadius</strong>: The radius of the point markers. By default 3.
</p>
</li>
<li> <p><strong>strokeWidth</strong>: The width of lines and polygon borders. By
default 3.
</p>
</li>
</ul>
<h3>Value</h3>

<p>Object of class leaflet, with the following extra parameters: tokens, name,
opacity, shown, min, max, palette, and legend. Use the $ method to retrieve
the data (e.g. m$rgee$min).
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
library(rgee)
library(sf)

ee_Initialize()

# Case 1: Geometry*
geom1 &lt;- ee$Geometry$Point(list(-73.53, -15.75))
Map$centerObject(geom1, zoom = 8)
m1 &lt;- Map$addLayer(
  eeObject = geom1,
  visParams = list(
    pointRadius = 10,
    color = "FF0000"
  ),
  name = "Geometry-Arequipa"
)

# Case 2: Feature
feature_arq &lt;- ee$Feature(ee$Geometry$Point(list(-72.53, -15.75)))
m2 &lt;- Map$addLayer(
  eeObject = feature_arq,
  name = "Feature-Arequipa"
)
m2 + m1

# Case 4: Image
image &lt;- ee$Image("LANDSAT/LC08/C01/T1/LC08_044034_20140318")
Map$centerObject(image)
m4 &lt;- Map$addLayer(
  eeObject = image,
  visParams = list(
    bands = c("B4", "B3", "B2"),
    max = 10000
  ),
  name = "SF"
)

# Case 5: ImageCollection
nc &lt;- st_read(system.file("shape/nc.shp", package = "sf")) %&gt;%
  st_transform(4326) %&gt;%
  sf_as_ee()

ee_s2 &lt;- ee$ImageCollection("COPERNICUS/S2")$
  filterDate("2016-01-01", "2016-01-31")$
  filterBounds(nc)
ee_s2 &lt;- ee$ImageCollection(ee_s2$toList(2))

Map$centerObject(nc$geometry())
m5 &lt;- Map$addLayers(ee_s2)
m5

# Case 6: Map comparison
image &lt;- ee$Image("LANDSAT/LC08/C01/T1/LC08_044034_20140318")
Map$centerObject(image)
m_ndvi &lt;- Map$addLayer(
  eeObject = image$normalizedDifference(list("B5", "B4")),
  visParams = list(min = 0, max = 0.7),
  name = "SF_NDVI"
) + Map$addLegend(list(min = 0, max = 0.7), name = "NDVI", position = "bottomright", bins = 4)
m6 &lt;- m4 | m_ndvi
m6

# Case 7: digging up the metadata
m6$rgee$tokens
m5$rgee$tokens

# Case 8: COG support
# See parameters here: https://api.cogeo.xyz/docs

server &lt;- "https://storage.googleapis.com/pdd-stac/disasters/"
file &lt;- "hurricane-harvey/0831/20170831_172754_101c_3B_AnalyticMS.tif"
resource &lt;- paste0(server, file)
visParams &lt;- list(bands = c("B3", "B2", "B1"), min = 3000, max = 13500, nodata = 0)
Map$centerObject(resource)
Map$addLayer(resource, visParams = visParams, shown = TRUE)

## End(Not run)
</code></pre>


</div>