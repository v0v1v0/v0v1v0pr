<div class="container">

<table style="width: 100%;"><tr>
<td>diagnosticPlot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Diagnostic plots for a sequence of regression models</h2>

<h3>Description</h3>

<p>Produce diagnostic plots for a sequence of regression models, such as
submodels along a robust least angle regression sequence, or sparse least
trimmed squares regression models for a grid of values for the penalty
parameter.  Four plots are currently implemented.
</p>


<h3>Usage</h3>

<pre><code class="language-R">diagnosticPlot(object, ...)

## S3 method for class 'seqModel'
diagnosticPlot(object, s = NA, covArgs = list(), ...)

## S3 method for class 'perrySeqModel'
diagnosticPlot(object, covArgs = list(), ...)

## S3 method for class 'tslars'
diagnosticPlot(object, p, s = NA, covArgs = list(), ...)

## S3 method for class 'sparseLTS'
diagnosticPlot(
  object,
  s = NA,
  fit = c("reweighted", "raw", "both"),
  covArgs = list(),
  ...
)

## S3 method for class 'perrySparseLTS'
diagnosticPlot(
  object,
  fit = c("reweighted", "raw", "both"),
  covArgs = list(),
  ...
)

## S3 method for class 'setupDiagnosticPlot'
diagnosticPlot(
  object,
  which = c("all", "rqq", "rindex", "rfit", "rdiag"),
  ask = (which == "all"),
  facets = object$facets,
  size = c(2, 4),
  id.n = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>the model fit for which to produce diagnostic plots, or an
object containing all necessary information for plotting (as generated
by <code>setupDiagnosticPlot</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments to be passed down, eventually to
<code>geom_point</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>s</code></td>
<td>
<p>for the <code>"seqModel"</code> method, an integer vector giving
the steps of the submodels  for which to produce diagnostic plots (the
default is to use the optimal submodel).  For the <code>"sparseLTS"</code> method,
an integer vector giving the indices of the models for which to produce
diagnostic plots (the default is to use the optimal model for each of the
requested fits).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covArgs</code></td>
<td>
<p>a list of arguments to be passed to
<code>covMcd</code> for the regression diagnostic plot (see</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>an integer giving the lag length for which to produce the plot
(the default is to use the optimal lag length).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p>a character string specifying for which fit to produce
diagnostic plots.  Possible values are <code>"reweighted"</code> (the default) for
diagnostic plots for the reweighted fit, <code>"raw"</code> for diagnostic plots
for the raw fit, or <code>"both"</code> for diagnostic plots for both fits.
“Details”).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>which</code></td>
<td>
<p>a character string indicating which plot to show.  Possible
values are <code>"all"</code> (the default) for all of the following, <code>"rqq"</code>
for a normal Q-Q plot of the standardized residuals, <code>"rindex"</code> for a
plot of the standardized residuals versus their index, <code>"rfit"</code> for a
plot of the standardized residuals versus the fitted values, or
<code>"rdiag"</code> for a regression diagnostic plot  (standardized residuals
versus robust Mahalanobis distances of the predictor variables).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ask</code></td>
<td>
<p>a logical indicating whether the user should be asked before
each plot (see <code>devAskNewPage</code>). The default is to
ask if all plots are requested and not ask otherwise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>facets</code></td>
<td>
<p>a faceting formula to override the default behavior.  If
supplied, <code>facet_wrap</code> or
<code>facet_grid</code> is called depending on whether the formula
is one-sided or two-sided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>size</code></td>
<td>
<p>a numeric vector of length two giving the point and label size,
respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id.n</code></td>
<td>
<p>an integer giving the number of the most extreme observations
to be identified by a label.  The default is to use the number of identified
outliers, which can be different for the different plots.  See
“Details” for more information.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>In the normal Q-Q plot of the standardized residuals, a reference line is
drawn through the first and third quartile.  The <code>id.n</code> observations
with the largest distances from that line are identified by a label (the
observation number).  The default for <code>id.n</code> is the number of
regression outliers, i.e., the number of observations whose residuals are
too large (cf. <code>weights</code>).
</p>
<p>In the plots of the standardized residuals versus their index or the fitted
values, horizontal reference lines are drawn at 0 and +/-2.5.  The
<code>id.n</code> observations with the largest absolute values of the
standardized residuals are identified by a label (the observation
number).  The default for <code>id.n</code> is the number of regression outliers,
i.e., the number of observations whose absolute residuals are too large (cf.
<code>weights</code>).
</p>
<p>For the regression diagnostic plot, the robust Mahalanobis distances of the
predictor variables are computed via the minimum covariance determinant
(MCD) estimator based on only those predictors with non-zero coefficients
(see <code>covMcd</code>).  Horizontal reference lines are
drawn at +/-2.5 and a vertical reference line is drawn at the upper 97.5%
quantile of the <code class="reqn">\chi^{2}</code> distribution with <code class="reqn">p</code>
degrees of freedom, where <code class="reqn">p</code> denotes the number of predictors with
non-zero coefficients.  The <code>id.n</code> observations with the largest
absolute values of the standardized residuals and/or largest robust
Mahalanobis distances are identified by a label (the observation number).
The default for <code>id.n</code> is the number of all outliers: regression
outliers (i.e., observations whose absolute residuals are too large, cf.
<code>weights</code>) and leverage points (i.e.,
observations with robust Mahalanobis distance larger than the 97.5%
quantile of the <code class="reqn">\chi^{2}</code> distribution with <code class="reqn">p</code>
degrees of freedom).
</p>
<p>Note that the argument <code>alpha</code> for controlling the subset size
behaves differently for <code>sparseLTS</code> than for
<code>covMcd</code>.  For <code>sparseLTS</code>, the subset
size <code class="reqn">h</code> is determined by the fraction <code>alpha</code> of the number of
observations <code class="reqn">n</code>.  For <code>covMcd</code>, on the other
hand, the subset size also depends on the number of variables <code class="reqn">p</code> (see
<code>h.alpha.n</code>).  However, the <code>"sparseLTS"</code> and
<code>"perrySparseLTS"</code> methods attempt to compute the MCD using the same
subset size that is used to compute the sparse least trimmed squares
regressions.  This may not be possible if the number of selected variables
is large compared to the number of observations. In such cases,
<code>setupDiagnosticPlot</code> returns <code>NA</code>s for the robust
Mahalanobis distances, and the regression diagnostic plot fails.
</p>


<h3>Value</h3>

<p>If only one plot is requested, an object of class <code>"ggplot"</code> (see
<code>ggplot</code>), otherwise a list of such objects.
</p>


<h3>Author(s)</h3>

<p>Andreas Alfons
</p>


<h3>See Also</h3>

<p><code>ggplot</code>, <code>rlars</code>,
<code>grplars</code>, <code>rgrplars</code>, <code>tslarsP</code>,
<code>rtslarsP</code>, <code>tslars</code>, <code>rtslars</code>,
<code>sparseLTS</code>, <code>plot.lts</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## generate data
# example is not high-dimensional to keep computation time low
library("mvtnorm")
set.seed(1234)  # for reproducibility
n &lt;- 100  # number of observations
p &lt;- 25   # number of variables
beta &lt;- rep.int(c(1, 0), c(5, p-5))  # coefficients
sigma &lt;- 0.5      # controls signal-to-noise ratio
epsilon &lt;- 0.1    # contamination level
Sigma &lt;- 0.5^t(sapply(1:p, function(i, j) abs(i-j), 1:p))
x &lt;- rmvnorm(n, sigma=Sigma)    # predictor matrix
e &lt;- rnorm(n)                   # error terms
i &lt;- 1:ceiling(epsilon*n)       # observations to be contaminated
e[i] &lt;- e[i] + 5                # vertical outliers
y &lt;- c(x %*% beta + sigma * e)  # response
x[i,] &lt;- x[i,] + 5              # bad leverage points


## robust LARS
# fit model
fitRlars &lt;- rlars(x, y, sMax = 10)
# create plot
diagnosticPlot(fitRlars)


## sparse LTS
# fit model
fitSparseLTS &lt;- sparseLTS(x, y, lambda = 0.05, mode = "fraction")
# create plot
diagnosticPlot(fitSparseLTS)
diagnosticPlot(fitSparseLTS, fit = "both")
</code></pre>


</div>