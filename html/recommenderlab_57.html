<div class="container">

<table style="width: 100%;"><tr>
<td>sparseNAMatrix-class</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>

Sparse Matrix Representation With NAs Not Explicitly Stored
</h2>

<h3>Description</h3>


<p>Coerce from and to a
sparse matrix representation where <code>NA</code>s are not explicitly stored.
</p>


<h3>Usage</h3>

<pre><code class="language-R">dropNA(x)
dropNA2matrix(x)
dropNAis.na(x)
</code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p> a matrix for <code>dropNA()</code>, or a sparse matrix with dropped NA values
for <code>dropNA2matrix()</code> or <code>dropNAis.na()</code>.</p>
</td>
</tr></table>
<h3>Details</h3>

<p>The representation is based on
the sparse <code>dgCMatrix</code> in <span class="pkg">Matrix</span> but instead of zeros, <code>NA</code>s are dropped.
This is achieved by the following:
</p>

<ul>
<li>
<p> Zeros are represented with a very small value (<code>.Machine$double.xmin</code>)
so they do not get dropped in the sparse representation.
</p>
</li>
<li>
<p> NAs are converted to 0 before cercions to <code>dgCMatrix</code> to make them not explicitly stored.
</p>
</li>
</ul>
<p><b>Caution:</b> Be careful when working with the sparse matrix and sparse matrix operations
(multiplication, addition, etc.) directly.
</p>

<ul>
<li>
<p> Sparse matrix operations will see 0 where NAs should be.
</p>
</li>
<li>
<p> Actual zero ratings have a small, but non-zero value (<code>.Machine$double.xmin</code>).
</p>
</li>
<li>
<p> Sparse matrix operations that can result in a true 0
need to be followed by replacing the 0 with <code>.Machine$double.xmin</code> or other operations
(like subsetting) may drop the 0.
</p>
</li>
</ul>
<p><code>dropNAis.na()</code> correctly finds NA values in a sparse matrix with dropped NA values, while
<code>is.na()</code> does not work.
</p>
<p><code>dropNA2matrix()</code> converts the sparse representation into a dense matrix. NAs represented by
dropped values are converted to true NAs. Zeros are recovered by using <code>zapsmall()</code> which replaces
small values by 0.
</p>


<h3>Value</h3>


<p>Returns a dgCMatrix or a matrix, respectively.
</p>


<h3>See Also</h3>

<p><code>dgCMatrix</code> in <span class="pkg">Matrix</span>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">m &lt;- matrix(sample(c(NA,0:5),50, replace=TRUE, prob=c(.5,rep(.5/6,6))),
    nrow=5, ncol=10, dimnames = list(users=paste('u', 1:5, sep=''),
    items=paste('i', 1:10, sep='')))
m

## drop all NAs in the representation. Zeros are represented by very small values.
sparse &lt;- dropNA(m)
sparse

## convert back to matrix
dropNA2matrix(sparse)

## Note: be careful with the sparse representation!
## Do not use is.na, but use
dropNAis.na(sparse)
</code></pre>


</div>