<div class="container">

<table style="width: 100%;"><tr>
<td>read_functions</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Reads certain messages of an ITCH-file into a data.table</h2>

<h3>Description</h3>

<p>For faster file-reads (at the tradeoff of increased memory usages), you can
increase the <code>buffer_size</code> to 1GB (1e9) or more.
</p>
<p>If you access the same file multiple times, you can provide the message
counts as outputted from <code>count_messages()</code> to the <code>n_max</code>
argument, this allows skipping one pass over the file per read instruction.
</p>
<p>If you need to read in multiple message classes, you can specify multiple
message classes to <code>read_itch</code>, which results in only a single file pass.
</p>
<p>If the file is too large to be loaded into the workspace at once, you can
specify different <code>skip</code> and <code>n_max</code> to load only
a specific range of messages.
Alternatively, you can filter certain messages to another file using
<code>filter_itch()</code>, which is substantially faster than parsing a file
and filtering it.
</p>
<p>Note that all read functions allow both plain ITCH files as well as gzipped
files.
If a gzipped file is found, it will look for a plain ITCH file with
the same name and use that instead.
If this file is not found, it will be created by unzipping the archive.
Note that the unzipped file is NOT deleted by default (the file will be
created in the current working directory).
It might result in increased disk usage but reduces future read times for
that specific file.
To force RITCH to delete "temporary" files after uncompressing, use
<code>force_cleanup = TRUE</code> (only deletes the files if they were extracted
before, does not remove the archive itself).
</p>


<h3>Usage</h3>

<pre><code class="language-R">read_itch(
  file,
  filter_msg_class = NA,
  skip = 0,
  n_max = -1,
  filter_msg_type = NA_character_,
  filter_stock_locate = NA_integer_,
  min_timestamp = bit64::as.integer64(NA),
  max_timestamp = bit64::as.integer64(NA),
  filter_stock = NA_character_,
  stock_directory = NA,
  buffer_size = -1,
  quiet = FALSE,
  add_meta = TRUE,
  force_gunzip = FALSE,
  gz_dir = tempdir(),
  force_cleanup = TRUE
)

read_system_events(file, ..., add_descriptions = FALSE)

read_stock_directory(file, ..., add_descriptions = FALSE)

read_trading_status(file, ..., add_descriptions = FALSE)

read_reg_sho(file, ..., add_descriptions = FALSE)

read_market_participant_states(file, ..., add_descriptions = FALSE)

read_mwcb(file, ...)

read_ipo(file, ..., add_descriptions = FALSE)

read_luld(file, ...)

read_orders(file, ...)

read_modifications(file, ...)

read_trades(file, ...)

read_noii(file, ..., add_descriptions = FALSE)

read_rpii(file, ..., add_descriptions = FALSE)

get_orders(file, ...)

get_trades(file, ...)

get_modifications(file, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>the path to the input file, either a gz-archive or a plain ITCH file</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filter_msg_class</code></td>
<td>
<p>a vector of classes to load, can be "orders", "trades",
"modifications", ... see also <code>get_msg_classes()</code>.
Default value is to take all message classes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>skip</code></td>
<td>
<p>Number of messages to skip before starting parsing messages,
note the skip parameter applies to the specific message class, i.e., it would
skip the messages for each type (e.g., skip the first 10 messages for each class).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_max</code></td>
<td>
<p>Maximum number of messages to parse, default is to read all values.
Can also be a data.frame of msg_types and counts, as returned by
<code>count_messages()</code>.
Note the n_max parameter applies to the specific message class not the whole
file.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filter_msg_type</code></td>
<td>
<p>a character vector, specifying a filter for message types.
Note that this can be used to only return 'A' orders for instance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filter_stock_locate</code></td>
<td>
<p>an integer vector, specifying a filter for locate codes.
The locate codes can be looked up by calling <code>read_stock_directory()</code>
or by downloading from NASDAQ by using <code>download_stock_directory()</code>.
Note that some message types (e.g., system events, MWCB, and IPO) do not use
a locate code.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_timestamp</code></td>
<td>
<p>an 64 bit integer vector (see also <code>bit64::as.integer64()</code>)
of minimum timestamp (inclusive).
Note: min and max timestamp must be supplied with the same length or left empty.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_timestamp</code></td>
<td>
<p>an 64 bit integer vector (see also <code>bit64::as.integer64()</code>)
of maxium timestamp (inclusive).
Note: min and max timestamp must be supplied with the same length or left empty.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filter_stock</code></td>
<td>
<p>a character vector, specifying a filter for stocks.
Note that this a shorthand for the <code>filter_stock_locate</code> argument, as it
tries to find the stock_locate based on the <code>stock_directory</code> argument,
if this is not found, it will try to extract the stock directory from the file,
else an error is thrown.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stock_directory</code></td>
<td>
<p>A data.frame containing the stock-locate code relationship.
As outputted by <code>read_stock_directory()</code>.
Only used if <code>filter_stock</code> is set. To download the stock directory from
NASDAQs server, use <code>download_stock_directory()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>buffer_size</code></td>
<td>
<p>the size of the buffer in bytes, defaults to 1e8 (100 MB),
if you have a large amount of RAM, 1e9 (1GB) might be faster</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>if TRUE, the status messages are suppressed, defaults to FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_meta</code></td>
<td>
<p>if TRUE, the date and exchange information of the file are added, defaults to TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>force_gunzip</code></td>
<td>
<p>only applies if the input file is a gz-archive and a file with the same (gunzipped) name already exists.
if set to TRUE, the existing file is overwritten. Default value is FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gz_dir</code></td>
<td>
<p>a directory where the gz archive is extracted to.
Only applies if file is a gz archive. Default is <code>tempdir()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>force_cleanup</code></td>
<td>
<p>only applies if the input file is a gz-archive.
If force_cleanup=TRUE, the gunzipped raw file will be deleted afterwards.
Only applies when the gunzipped raw file did not exist before.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed to <code>read_itch</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_descriptions</code></td>
<td>
<p>add longer descriptions to shortened variables.
The added information is taken from the official ITCH documentation
see also <code>open_itch_specification()</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The details of the different messages types can be found in the official
ITCH specification (see also <code>open_itch_specification()</code>)
</p>

<ul><li> <p><code>read_itch</code>: Reads a message class message, can also read multiple
classes in one file-pass.
</p>
</li></ul>
<ul><li> <p><code>read_system_events</code>: Reads system event messages. Message type <code>S</code>
</p>
</li></ul>
<ul><li> <p><code>read_stock_directory</code>: Reads stock trading messages. Message type <code>R</code>
</p>
</li></ul>
<ul><li> <p><code>read_trading_status</code>: Reads trading status messages. Message type <code>H</code>
and <code>h</code>
</p>
</li></ul>
<ul><li> <p><code>read_reg_sho</code>: Reads messages regarding reg SHO. Message type <code>Y</code>
</p>
</li></ul>
<ul><li> <p><code>read_market_participant_states</code>: Reads messages regarding the
status of market participants. Message type <code>L</code>
</p>
</li></ul>
<ul><li> <p><code>read_mwcb</code>: Reads messages regarding Market-Wide-Circuit-Breakers
(MWCB). Message type <code>V</code> and <code>W</code>
</p>
</li></ul>
<ul><li> <p><code>read_ipo</code>: Reads messages regarding IPOs. Message type <code>K</code>
</p>
</li></ul>
<ul><li> <p><code>read_luld</code>: Reads messages regarding LULDs (limit up-limit down)
auction collars. Message type <code>J</code>
</p>
</li></ul>
<ul><li> <p><code>read_orders</code>: Reads order messages. Message type <code>A</code> and <code>F</code>
</p>
</li></ul>
<ul><li> <p><code>read_modifications</code>: Reads order modification messages. Message
type <code>E</code>, <code>C</code>, <code>X</code>, <code>D</code>, and <code>U</code>
</p>
</li></ul>
<ul><li> <p><code>read_trades</code>: Reads trade messages. Message type <code>P</code>, <code>Q</code> and <code>B</code>
</p>
</li></ul>
<ul><li> <p><code>read_noii</code>: Reads Net Order Imbalance Indicatio (NOII) messages.
Message type <code>I</code>
</p>
</li></ul>
<ul><li> <p><code>read_rpii</code>: Reads Retail Price Improvement Indicator (RPII)
messages. Message type <code>N</code>
</p>
</li></ul>
<p>For backwards compatability reasons, the following functions are provided as
well:
</p>

<ul><li> <p><code>get_orders</code>: Redirects to <code>read_orders</code>
</p>
</li></ul>
<ul><li> <p><code>get_trades</code>: Redirects to <code>read_trades</code>
</p>
</li></ul>
<ul><li> <p><code>get_modifications</code>: Redirects to <code>read_modifications</code>
</p>
</li></ul>
<h3>Value</h3>

<p>a data.table containing the messages
</p>


<h3>References</h3>

<p><a href="https://www.nasdaqtrader.com/content/technicalsupport/specifications/dataproducts/NQTVITCHspecification.pdf">https://www.nasdaqtrader.com/content/technicalsupport/specifications/dataproducts/NQTVITCHspecification.pdf</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
file &lt;- system.file("extdata", "ex20101224.TEST_ITCH_50", package = "RITCH")
od &lt;- read_orders(file, quiet = FALSE) # note quiet = FALSE is the default
tr &lt;- read_trades(file, quiet = TRUE)

## Alternatively
od &lt;- read_itch(file, "orders", quiet = TRUE)

ll &lt;- read_itch(file, c("orders", "trades"), quiet = TRUE)

od
tr
str(ll, max.level = 1)

## additional options:

# take only subset of messages
od &lt;- read_orders(file, skip = 3, n_max = 10)

# a message count can be provided for slightly faster reads
msg_count &lt;- count_messages(file, quiet = TRUE)
od &lt;- read_orders(file, n_max = msg_count)

## .gz archive functionality
# .gz archives will be automatically unzipped
gz_file &lt;- system.file("extdata", "ex20101224.TEST_ITCH_50.gz", package = "RITCH")
od &lt;- read_orders(gz_file)
# force a decompress and delete the decompressed file afterwards
od &lt;- read_orders(gz_file, force_gunzip = TRUE, force_cleanup = TRUE)

## read_itch()
otm &lt;- read_itch(file, c("orders", "trades"), quiet = TRUE)
str(otm, max.level = 1)

## read_system_events()
se &lt;- read_system_events(file, add_descriptions = TRUE, quiet = TRUE)
se

## read_stock_directory()
sd &lt;- read_stock_directory(file, add_descriptions = TRUE, quiet = TRUE)
sd

## read_trading_status()
ts &lt;- read_trading_status(file, add_descriptions = TRUE, quiet = TRUE)
ts

## read_reg_sho()
## Not run: 
# note the example file has no reg SHO messages
rs &lt;- read_reg_sho(file, add_descriptions = TRUE, quiet = TRUE)
rs

## End(Not run)

## read_market_participant_states()
## Not run: 
# note the example file has no market participant states
mps &lt;- read_market_participant_states(file, add_descriptions = TRUE,
                                      quiet = TRUE)
mps

## End(Not run)

## read_mwcb()
## Not run: 
# note the example file has no circuit breakers messages
mwcb &lt;- read_mwcb(file, quiet = TRUE)
mwcb

## End(Not run)

## read_ipo()
## Not run: 
# note the example file has no IPOs
ipo &lt;- read_ipo(file, add_descriptions = TRUE, quiet = TRUE)
ipo

## End(Not run)

## read_luld()
## Not run: 
# note the example file has no LULD messages
luld &lt;- read_luld(file, quiet = TRUE)
luld

## End(Not run)

## read_orders()
od &lt;- read_orders(file, quiet = TRUE)
od

## read_modifications()
mod &lt;- read_modifications(file, quiet = TRUE)
mod

## read_trades()
tr &lt;- read_trades(file, quiet = TRUE)
tr

## read_noii()
## Not run: 
# note the example file has no NOII messages
noii &lt;- read_noii(file, add_descriptions = TRUE, quiet = TRUE)
noii

## End(Not run)

## read_rpii()
## Not run: 
# note the example file has no RPII messages
rpii &lt;- read_rpii(file, add_descriptions = TRUE, quiet = TRUE)
rpii

## End(Not run)
</code></pre>


</div>