<div class="container">

<table style="width: 100%;"><tr>
<td>rec_with_table</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Recode with Table</h2>

<h3>Description</h3>

<p>Creates new variables by recoding variables in a dataset using the rules
specified in a variables details sheet
</p>


<h3>Usage</h3>

<pre><code class="language-R">rec_with_table(
  data,
  variables = NULL,
  database_name = NULL,
  variable_details = NULL,
  else_value = NA,
  append_to_data = FALSE,
  log = FALSE,
  notes = TRUE,
  var_labels = NULL,
  custom_function_path = NULL,
  attach_data_name = FALSE,
  id_role_name = NULL,
  name_of_environment_to_load = NULL,
  append_non_db_columns = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A dataframe containing the variables to be recoded.
Can also be a named list of dataframes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variables</code></td>
<td>
<p>Character vector containing the names of the new variables
to recode to or a dataframe containing a variables sheet.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>database_name</code></td>
<td>
<p>A String containing the name of the database containing
the original variables which should match up with a database from the
databaseStart column in the variables details sheet. Should be a character
vector if data is a named list where each vector item matches a name in the
data list and also matches with a value in the databaseStart column of a
variable details sheet.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variable_details</code></td>
<td>
<p>A dataframe containing the specifications
for recoding.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>else_value</code></td>
<td>
<p>Value (string, number, integer, logical or NA) that is used
to replace any values that are outside the specified ranges
(no rules for recoding).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>append_to_data</code></td>
<td>
<p>Logical, if <code>TRUE</code> (default), the newly
created variables will be appended to the original dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log</code></td>
<td>
<p>Logical, if <code>FALSE</code> (default), a log containing information
about the recoding will not be printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>notes</code></td>
<td>
<p>Logical, if <code>FALSE</code> (default), will not print the
content inside the 'Noteâ€œ column of the variable being recoded.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var_labels</code></td>
<td>
<p>labels vector to attach to variables in variables</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>custom_function_path</code></td>
<td>
<p>string containing the path to the file
containing functions to run for derived variables. This file will be sourced
and its functions loaded into the R environment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>attach_data_name</code></td>
<td>
<p>logical to attach name of database to end table</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id_role_name</code></td>
<td>
<p>name for the role to be used to generate id column</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name_of_environment_to_load</code></td>
<td>
<p>Name of package to load variables and
variable_details from</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>append_non_db_columns</code></td>
<td>
<p>boolean determening if data not present in
this cycle should be appended as NA</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <a href="https://github.com/Big-Life-Lab/recodeflow/blob/master/inst/extdata/PBC-variableDetails.csv">variable_details</a>
dataframe needs the following columns:
</p>

<dl>
<dt>variable</dt>
<dd>
<p>Name of the new variable created. The name of the new
variable can be the same as the original variable if it does not change
the original variable definition</p>
</dd>
<dt>toType</dt>
<dd>
<p>type the new variable
<em>cat = categorical, cont = continuous</em></p>
</dd>
<dt>databaseStart</dt>
<dd>
<p>Names of the databases that the original variable can
come from. Each database name should be seperated by a comma. For eg.,
"cchs2001_p, cchs2003_p,cchs2005_p,cchs2007_p"</p>
</dd>
<dt>variableStart</dt>
<dd>
<p>Names of the original variables within each database
specified in the databaseStart column. For eg. ,
"cchs2001_p::RACA_6A,cchs2003_p::RACC_6A,ADL_01". The final variable
specified is the name of the variable for all other databases specified in
databaseStart but not in this column. For eg., ADL_01 would be the original
variable name in the cchs2005_p and cchs2007_p databases.</p>
</dd>
<dt>fromType</dt>
<dd>
<p>variable type of start variable.
<em>cat = categorical or factor variable</em>
<em>cont = continuous variable (real number or integer)</em></p>
</dd>
<dt>recTo</dt>
<dd>
<p>Value to recode to</p>
</dd>
<dt>recFrom</dt>
<dd>
<p>Value/range being recoded from</p>
</dd>
</dl>
<p>Each row in the <em>variables details</em> sheet encodes the rule for recoding
value(s) of the original variable to a category in the new variable. The
categories of the new variable are encoded in the <em>recTo</em> column
and the value(s) of the original variable that recode to this new value
are encoded in the <em>recFrom</em> column. These recode columns follow a
syntax similar to the <em>sjmisc::rec()</em> function. Whereas in the
<em>sjmisc::rec()</em> function the recoding rules are in one string,
in the variables details sheet they are encoded over multiple rows and
columns (recFrom an recTo). For eg., a recoding rule in the sjmisc function
would like like "1=2;2=3" whereas in the variables details sheet this would
be encoded over two rows with recFrom and recTo values of the first row
being 1 and 2 and similarly for the second row it would be 2 and 3.
The rules for describing recoding pairs are shown below:
</p>

<dl>
<dt>recode pairs</dt>
<dd>
<p>Each recode pair is a row</p>
</dd>
<dt>multiple values</dt>
<dd>
<p>Multiple values from the old variable that should
be recoded into a new category of the new variable should be separated
with a comma. e.g.,
<em>recFrom = "1,2"; recTo = 1</em></p>
</dd>
</dl>
<p> will recode values of 1 and 2 in the
original variable to 1 in the new variable
</p>
<dl>
<dt>value range</dt>
<dd>
<p>A value range is indicated by a colon, e.g.
<em>recFrom= "1:4"; recTo = 1</em> will recode all values from 1to4 into 1</p>
</dd>
<dt>
<em>min</em> and <em>max</em>
</dt>
<dd>
<p>minimum and maximum values
are indicated by <em>min</em> (or <em>lo</em>) and <em>max</em> (or <em>hi</em>),
e.g. <em>recFrom = "min:4"; recTo = 1</em> will recode all values from the
minimum value of the original variable to 4 into 1</p>
</dd>
<dt><em>"else"</em></dt>
<dd>
<p>All other values, which have not been specified yet,
are indicated by <em>else</em>, e.g. <em>recFrom = "else"; recTo = NA</em>
will recode all other values (not specified in other rows) of the
original variable to "NA")</p>
</dd>
<dt><em>"copy"</em></dt>
<dd>
<p>the <em>else</em> token can be combined with
<em>copy</em>, indicating that all remaining, not yet recoded values should
stay the same (are copied from the original value), e.g.
<em>recFrom = "else"; recTo = "copy"</em></p>
</dd>
<dt>
<em>NA</em>'s</dt>
<dd>
<p><em>NA</em> values are allowed both for the original
and the new variable, e.g.
<em>recFrom "NA"; recTo = 1. or "recFrom = "3:5"; recTo = "NA"</em>
(recodes all NA into 1,
and all values from 3 to 5 into NA in the new variable)</p>
</dd>
</dl>
<h3>Value</h3>

<p>a dataframe that is recoded according to rules in variable_details.
</p>


<h3>Examples</h3>

<pre><code class="language-R">var_details &lt;-
  data.frame(
    "variable" = c("time", rep("status", times = 3), rep("trt", times = 2),
    "age", rep("sex", times = 2), rep("ascites", times = 2),
    rep("hepato", times = 2), rep("spiders", times = 2),
    rep("edema", times = 3),
    "bili", "chol", "albumin", "copper", "alk.phos", "ast",
    "trig", "platelet", "protime", rep("stage", times = 4)),
    "dummyVariable" = c("NA", "status0", "status1","status2", "trt1","trt2"
    ,"NA","sexM","sexF", "ascites0", "ascites1","hepato0","hepato1","
    spiders0","spiders1","edema0.0","edema0.5","edema1.0",
    rep("NA",times = 9), "stage1", "stage2","stage3","stage4"),
    "toType" = c("cont", rep("cat", times = 3), rep("cat", times = 2),
    "cont", rep("cat", times = 2), rep("cat", times = 2),
    rep("cat", times = 2),rep("cat", times = 2), rep("cat", times = 3),
    rep("cont", times = 9), rep("cat", times = 4)),
    "databaseStart" = rep("tester1, tester2", times = 31),
    "variableStart" = c("[time]", rep("[status]", times = 3), rep("[trt]",
    times = 2), "[age]", rep("[sex]", times = 2), rep("[ascites]",
    times = 2), rep("[hepato]", times = 2), rep("[spiders]", times = 2),
    rep("[edema]", times = 3), "[bili]", "[chol]", "[albumin]", "[copper]",
    "[alk.phos]", "[ast]", "[trig]", "[platelet]", "[protime]",
    rep("[stage]", times = 4)), "fromType" = c("cont", rep("cat", times = 3),
    rep("cat", times = 2), "cont", rep("cat", times = 2),
    rep("cat", times = 2), rep("cat", times = 2),rep("cat", times = 2),
    rep("cat", times = 3), rep("cont", times = 9), rep("cat", times = 4)),
    "recTo" = c("copy", "0", "1","2", "1","2","copy","m","f", "0", "1","0",
    "1","0","1","0.0","0.5","1.0",rep("copy",times = 9), "1", "2","3","4"),
    "catLabel" = c("", "status 0", "status 1","status 2", "trt 1","trt 2","",
    "sex m","sex f", "ascites 0", "ascites 1","hepato 0","hepato 1",
    "spiders 0","spiders 1","edema 0.0","edema 0.5","edema 1.0",
    rep("",times = 9), "stage 1", "stage 2","stage 3","stage 4"),
    "catLabelLong" = c("", "status 0", "status 1","status 2", "trt 1",
    "trt 2","","sex m","sex f", "ascites 0", "ascites 1","hepato 0","
    hepato 1","spiders 0","spiders 1","edema 0.0","edema 0.5","edema 1.0",
    rep("",times = 9), "stage 1", "stage 2","stage 3","stage 4"),
    "recFrom" = c("else", "0", "1","2", "1","2","else","m","f", "0", "1","0",
    "1","0","1","0.0","0.5","1.0",rep("else",times = 9), "1", "2","3","4"),
    "catStartLabel" = c("", "status 0", "status 1","status 2", "trt 1",
    "trt 2","","sex m","sex f", "ascites 0", "ascites 1","hepato 0",
    "hepato 1","spiders 0","spiders 1","edema 0.0","edema 0.5","edema 1.0",
    rep("",times = 9), "stage 1", "stage 2","stage 3","stage 4"),
    "variableStartShortLabel" = c("time", rep("status", times = 3),
    rep("trt", times = 2), "age", rep("sex", times = 2),
    rep("ascites", times = 2), rep("hepato", times = 2),
    rep("spiders", times = 2), rep("edema", times = 3), "bili", "chol",
    "albumin", "copper", "alk.phos", "ast", "trig", "platelet", "protime",
    rep("stage", times = 4)),
    "variableStartLabel" = c("time", rep("status", times = 3),
    rep("trt", times = 2), "age", rep("sex", times = 2),
    rep("ascites", times = 2), rep("hepato", times = 2),
    rep("spiders", times = 2), rep("edema", times = 3), "bili", "chol",
    "albumin", "copper", "alk.phos", "ast", "trig", "platelet", "protime",
    rep("stage", times = 4)),
    "units" = rep("NA", times = 31),
    "notes" = rep("This is sample survival pbc data", times = 31)
  )
var_sheet &lt;-
  data.frame(
    "variable" = c("time","status","trt", "age","sex","ascites","hepato",
    "spiders", "edema", "bili", "chol", "albumin", "copper", "alk.phos",
    "ast", "trig", "platelet", "protime", "stage"),
    "label" = c("time","status","trt", "age","sex","ascites","hepato",
    "spiders", "edema", "bili", "chol", "albumin", "copper", "alk.phos",
    "ast", "trig", "platelet", "protime", "stage"),
    "labelLong" = c("time","status","trt", "age","sex","ascites","hepato",
    "spiders", "edema", "bili", "chol", "albumin", "copper", "alk.phos",
    "ast", "trig", "platelet", "protime", "stage"),
    "section" = rep("tester", times=19),
    "subject" = rep("tester",times = 19),
    "variableType" = c("cont", "cat", "cat", "cont","cat", "cat", "cat",
    "cat", "cat", rep("cont", times = 9), "cat"),
    "databaseStart" = rep("tester1, tester2", times = 19),
    "units" = rep("NA", times = 19),
    "variableStart" = c("[time]","[status]", "[trt]", "[age]", "[sex]",
    "[ascites]","[hepato]","[spiders]","[edema]", "[bili]", "[chol]",
    "[albumin]", "[copper]", "[alk.phos]", "[ast]", "[trig]", "[platelet]",
    "[protime]","[stage]")
  )
library(survival)
tester1 &lt;- survival::pbc[1:209,]
tester2 &lt;- survival::pbc[210:418,]
db_name1 &lt;- "tester1"
db_name2 &lt;- "tester2"

rec_sample1 &lt;- rec_with_table(data = tester1,
variables = var_sheet,
variable_details = var_details,
database_name = db_name1)

rec_sample2 &lt;- rec_with_table(data = tester2,
variables = var_sheet,
variable_details = var_details,
database_name = db_name2)

</code></pre>


</div>