<div class="container">

<table style="width: 100%;"><tr>
<td>forcingFunctions</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generation of Forcing Functions in Fortran</h2>

<h3>Description</h3>

<p>Generates Fortran code to return the current values of forcing functions
based on interpolation in tabulated time series data.
</p>


<h3>Usage</h3>

<pre><code class="language-R">forcingFunctions(x)
</code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Data frame with colums 'name', 'file', 'column', 'mode', 'default'.
See below for expected entries.</p>
</td>
</tr></table>
<h3>Value</h3>

<p>A character string holding generated Fortran code. Must be written to
disk, e.g. using <code>write</code>, prior to compilation.
</p>


<h3>Note</h3>

<p>The fields of the input data frame are interpreted as follows:
</p>

<ul>
<li>
<p><code>name </code> Name of the forcing function as declared in the table
of functions.
</p>
</li>
<li>
<p><code>file </code> Name of the text file containing the time series data
either as an absolute or relative path.
Time information is expected as numeric values in the first column (e.g.
as number of seconds after some reference date).
The period is used as the decimal character in floating point numbers, 
numeric values can also be given in scientific format (e.g. as 0.314e+1).
Allowed column delimiters are blank, tab, or comma. A sequence of white
spaces collapses to a single delimiter but this is not the case for
commas. It is strictly recommended to use a consistent delimiter
character within a particular file.
Blank lines are allowed everywhere in the file, comment lines must start
with a '#'. The first non-blank, non-comment line is interpreted as
column headers and the name of the first column (holding time info)
is essentially ignored).

</p>
</li>
<li>
<p><code>column </code> Name of the column in <code>file</code> from which data are
to be read.
</p>
</li>
<li>
<p><code>mode </code> Integer code to control how the interpolation is
performed. Use 0 for constant interpolation with full weight given to the
value at the end of a time interval. Use 1 for constant interpolation
with full weight given to the value at the begin of a time interval. Any
other values (&lt; 0 or &gt; 1) result in linear interpolation with weights
being set automatically.
</p>
</li>
<li>
<p><code>default </code> Logical. If <code>FALSE</code>, the generated function has
the interface 'f(time)'. If <code>TRUE</code>, the generated function has a
two-argument interface 'f(time, z)'. If the actual argument 'z' is
<code>NaN</code>, the function behaves just like the single-argument version,
i.e. interpolation in tabulated data is performed. If 'z' is not
<code>NaN</code>, the function returns the value of 'z'.
</p>
</li>
</ul>
<p>The generated code provides a single module named 'forcings' which defines
as many forcing functions as there are rows in <code>x</code>.
The module 'forcings' needs to be made available to the compiler
(either at the command line or via inclusion in another file with Fortran's
include mechanism). In addition, it must be referenced in the module
'functions' with an appropriate 'use' statement (see example below).
</p>
<p>The generated function return scalar values of type double precision. If an
error condition is encountered, the return value of a functions equals the
largest possible double precision value (generated by Fortran's 'huge'
function). In addition, errors trigger calls of the subroutines 'rexit'
(at top level) or 'rwarn' (at lower levels). These two functions are
available automatically if the Fortran code is compiled using 'R CMD SHLIB'.
Otherwise, the two functions need to be defined (see examples below).
</p>
<p>In the two-argument version, the second argument is tested against <code>NaN</code>
using 'ISNAN'. This function is not part of the Fortran standard but it is
supported by most compilers, including gfortan. The Fortran 2003 standard
conformal function would be 'IS_IEEE_NAN' which is not yet supported by
compiler versions normally installed with R (March 2016).
</p>


<h3>Author(s)</h3>

<p>David Kneis <a href="mailto:david.kneis@tu-dresden.de">david.kneis@tu-dresden.de</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
  ! Example of a Fortran file to define functions
  include 'forcings.f95'   ! include generated forcings file in compilation
  module functions
  use forcings             ! make forcings available as functions
  implicit none
  contains
  ! ... any non-forcing functions go here ...
  end module

## End(Not run)

## Not run: 
  ! Definition of 'rexit' and 'rwarn' for testing of the generated code
  ! outside of R
  subroutine rexit (x)
    character(len=*), intent(in):: x
    write(*,*) "ERROR: ",trim(adjustl(x))
    stop 1
  end subroutine
  
  subroutine rwarn (x)
    character(len=*), intent(in):: x
    write(*,*) "WARNING: ",trim(adjustl(x))
  end subroutine

## End(Not run)
</code></pre>


</div>