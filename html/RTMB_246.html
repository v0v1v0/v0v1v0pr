<div class="container">

<table style="width: 100%;"><tr>
<td>Simulation</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulation</h2>

<h3>Description</h3>

<p>An RTMB objective function can be run in 'simulation mode' where standard likelihood evaluation is replaced by corresponding random number generation. This facilitates automatic simulation under some restrictions. Simulations can be obtained directly from the model object by <code>obj$simulate()</code> or used indirectly via checkConsistency.
</p>


<h3>Usage</h3>

<pre><code class="language-R">simref(n)

## S3 replacement method for class 'simref'
dim(x) &lt;- value

## S3 method for class 'simref'
length(x)

## S3 method for class 'simref'
dim(x)

## S3 method for class 'simref'
is.array(x)

## S3 method for class 'simref'
is.matrix(x)

## S3 method for class 'simref'
as.array(x, ...)

## S3 method for class 'simref'
is.na(x)

## S3 method for class 'simref'
x[...]

## S3 replacement method for class 'simref'
x[...] &lt;- value

## S3 method for class 'simref'
Ops(e1, e2)

## S3 method for class 'simref'
Math(x, ...)

## S3 method for class 'simref'
t(x)

## S3 method for class 'simref'
diff(x, lag = 1L, differences = 1L, ...)

## S3 method for class 'simref'
Summary(..., na.rm = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Length</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Object of class 'simref'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>value</code></td>
<td>
<p>Replacement (numeric)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Extra arguments</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>e1</code></td>
<td>
<p>First argument</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>e2</code></td>
<td>
<p>Second argument</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lag</code></td>
<td>
<p>As diff</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>differences</code></td>
<td>
<p>As diff</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>Ignored</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>In simulation mode all log density evaluation, involving either random effects or observations, is interpreted as probability assignment.
</p>
<p><b>direct vs indirect</b> Assignments can be 'direct' as for example
</p>
<p><code>dnorm(u, log=TRUE)      ## u ~ N(0, 1)</code>
</p>
<p>or 'indirect' as in
</p>
<p><code>dnorm(2*(u+1), log=TRUE)  ## u ~ N(-1, .25)</code>
</p>
<p>Indirect assignment works for a limited set of easily invertible functions - see <code>methods(class="simref")</code>.
</p>
<p><b>Simulation order</b> Note that probability assignments are sequential: All information required to draw a new variable must already be simulated.
Vectorized assignment implicitly occurs elementwise from left to right.
For example the assignment
</p>
<p><code>dnorm(diff(u), log=TRUE)</code>
</p>
<p>is not valid without a prior assignment of <code>u[1]</code>, e.g.
</p>
<p><code>dnorm(u[1], log=TRUE)</code>
</p>
<p><b>Supported distributions</b> Assignment must use supported density functions. I.e.
</p>
<p><code>dpois(N, exp(u), log=TRUE)</code>
</p>
<p>cannot be replaced by
</p>
<p><code>N * u - exp(u)</code>
</p>
<p>The latter will have no effect in simulation mode (the simulation will be <code>NA</code>).
</p>
<p><b>Return value</b> Note that when in simulation mode, the density functions all return zero. The actual simulation is written to the input argument by reference. This is very unlike standard R semantics.
</p>


<h3>Value</h3>

<p>An object with write access to store the simulation.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>simref()</code>: Construct <code>simref</code>
</p>
</li>
<li> <p><code>dim(simref) &lt;- value</code>: Equivalent of dim&lt;-
</p>
</li>
<li> <p><code>length(simref)</code>: Equivalent of length
</p>
</li>
<li> <p><code>dim(simref)</code>: Equivalent of dim
</p>
</li>
<li> <p><code>is.array(simref)</code>: Equivalent of is.array
</p>
</li>
<li> <p><code>is.matrix(simref)</code>: Equivalent of is.matrix
</p>
</li>
<li> <p><code>as.array(simref)</code>: Equivalent of as.array
</p>
</li>
<li> <p><code>is.na(simref)</code>: Equivalent of is.na
</p>
</li>
<li> <p><code>[</code>: Equivalent of [
</p>
</li>
<li> <p><code>`[`(simref) &lt;- value</code>: Equivalent of [&lt;-
</p>
</li>
<li> <p><code>Ops(simref)</code>: Equivalent of Ops
</p>
</li>
<li> <p><code>Math(simref)</code>: Equivalent of Math
</p>
</li>
<li> <p><code>t(simref)</code>: Equivalent of t
</p>
</li>
<li> <p><code>diff(simref)</code>: Equivalent of diff
</p>
</li>
<li> <p><code>Summary(simref)</code>: Summary operations are not invertible and will throw an error.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">s &lt;- simref(4)
s2 &lt;- 2 * s[1:2] + 1
s2[] &lt;- 7
s ## 3 3 NA NA
## Random walk
func &lt;- function(p) {
  u &lt;- p$u
  ans &lt;- -dnorm(u[1], log=TRUE) ## u[1] ~ N(0,1)
  ans &lt;- ans - sum(dnorm(diff(u), log=TRUE)) ## u[i]-u[i-1] ~ N(0,1)
}
obj &lt;- MakeADFun(func, list(u=numeric(20)), random="u")
obj$simulate()
</code></pre>


</div>