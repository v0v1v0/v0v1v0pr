<div class="container">

<table style="width: 100%;"><tr>
<td>getClusters</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>getClusters</h2>

<h3>Description</h3>

<p>From the data matrix generated from the integration of all bucket zones (columns) for each 
spectrum (rows), we can take advantage of the concentration variability of each compound in 
a series of samples by performing a clustering based on significant correlations that link 
these buckets together into clusters. Bucket Clustering based on either a lower threshold  
applied on correlations or a cutting value applied on a hierarchical tree of the variables 
(buckets) generated by an Hierarchical Clustering Analysis (HCA).
</p>


<h3>Usage</h3>

<pre><code class="language-R">getClusters(data, method = "hca", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>the matrix including the integrations of the areas defined by the buckets (columns) 
on each spectrum (rows)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Clustering method of the buckets. Either 'corr' for 'correlation' or 'hca' for 
'hierarchical clustering analysis'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Depending on the chosen method:
</p>

<ul>
<li> <p><code>corr</code> : cval, dC, ncpu
</p>
</li>
<li> <p><code>hca</code> :  vcutusr
</p>
</li>
</ul>
</td>
</tr>
</table>
<h3>Details</h3>

<p>At the bucketing step (see above),  we have chosen the intelligent bucketing, it means 
that each bucket exact matches with one resonance peak. Thanks to this, the buckets now 
have a strong chemical meaning, since the resonance peaks are the fingerprints of 
chemical compounds. However, to assign a chemical compound, several resonance peaks 
are generally required in 1D 1 H-NMR metabolic profiling. To generate relevant 
clusters (i.e. clusters possibly matching to chemical compounds), two approaches 
have been implemented:
</p>

<ul>
<li>
<p> Bucket Clustering based on a lower threshold  applied on correlations
</p>

<ul><li>
<p> In this approach an appropriate correlation threshold is applied on the correlation 
matrix before its cluster decomposition. Moreover, an improvement can be done by searching for 
a trade-off on a tolerance interval of the correlation threshold : from a fixed threshold of the 
correlation (cval), the clustering is calculated for the three values (cval-dC, cval, cval+dC), 
where dC is the tolerance interval of the correlation threshold. From these three sets of 
clusters, we establish a merger according to the following rules: 1) if a large cluster is 
broken, we keep the two resulting clusters. 2) If a small cluster disappears, the initial 
cluster is conserved. Generally, an interval of the correlation threshold included between 
0.002 and 0.01 gives good trade-off.
</p>
</li></ul>
</li>
<li>
<p> Bucket Clustering based on a hierarchical tree of the variables (buckets) generated 
by an Hierarchical Clustering Analysis (HCA)
</p>

<ul><li>
<p> In this approach a Hierachical Classification Analysis (HCA, <code>hclust</code>) 
is applied on the data after calculating a matrix distance ("euclidian" by default). Then, a cut 
is applied on the tree (<code>cutree</code>) resulting from <code>hclust</code>, 
into several groups by specifying the cut height(s). For finding best cut value,  the cut height 
is chosen i) by testing several values equally spaced in a given range of the cut height, then, 
2) by keeping the one that gives the more cluster and by including most bucket variables. 
Otherwise, a cut value has to be specified by the user (vcutusr)
</p>
</li></ul>
</li>
</ul>
<h3>Value</h3>

<p><code>getClusters</code> returns a list containing the following components:
</p>

<ul>
<li> <p><code>vstats</code> Statistics that served to find the best value of the criterion (matrix)
</p>
</li>
<li> <p><code>clusters</code> List of  the ppm value corresponding to each cluster. the length of the list equal to number of clusters
</p>
</li>
<li> <p><code>clustertab</code> the associations matrix that gives for each cluster (column 2) the corresponding buckets (column 1)
</p>
</li>
<li> <p><code>params</code> List of parameters related to the chosen method for which the clustering was performed.
</p>
</li>
<li> <p><code>vcrit</code> Value of the (best/user) criterion, i.e correlation threshold for 'corr' method or the cut value for the 'hca' method.
</p>
</li>
<li> <p><code>indxopt</code> Index value within the vstats matrix corresponding to the criterion value (vcrit)
</p>
</li>
</ul>
<h3>References</h3>


<p>Jacob D., Deborde C. and Moing A. (2013) An efficient spectra processing method for metabolite identification from 1H-NMR metabolomics data.
Analytical and Bioanalytical Chemistry 405(15) 5049-5061 doi: 10.1007/s00216-013-6852-y

</p>


<h3>Examples</h3>

<pre><code class="language-R"> 
  data_dir &lt;- system.file("extra", package = "Rnmr1D")
  cmdfile &lt;- file.path(data_dir, "NP_macro_cmd.txt")
  samplefile &lt;- file.path(data_dir, "Samples.txt")
  out &lt;- Rnmr1D::doProcessing(data_dir, cmdfile=cmdfile, 
                                samplefile=samplefile, ncpu=2)
  outMat &lt;- getBucketsDataset(out, norm_meth='CSN')
  clustcorr &lt;- getClusters(outMat, method='corr', cval=0, dC=0.003, ncpu=2)
  clusthca &lt;- getClusters(outMat, method='hca', vcutusr=0)
 
</code></pre>


</div>