<div class="container">

<table style="width: 100%;"><tr>
<td>search.shift</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Locating shifts in phenotypic evolutionary rates</h2>

<h3>Description</h3>

<p>The function <code>search.shift</code> (<cite>Castiglione et al.
2018</cite>) tests whether individual clades or isolated tips dispersed through
the phylogeny evolve at different <code>RRphylo</code> rates as compared
to the rest of the tree. Instances of rate shifts may be automatically
found.
</p>


<h3>Usage</h3>

<pre><code class="language-R">search.shift(RR, status.type = c("clade", "sparse"),node = NULL, state
  = NULL, cov = NULL, nrep = 1000, f = NULL,filename=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>RR</code></td>
<td>
<p>an object fitted by the function <code>RRphylo</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>status.type</code></td>
<td>
<p>whether the <code>"clade"</code> or <code>"sparse"</code> condition
must be tested.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>node</code></td>
<td>
<p>under the <code>"clade"</code> condition, the node (clade) to be tested
for the rate shift. When multiple nodes are tested, they need to be written
as in the example below. If <code>node</code> is left unspecified, the function
performs under the 'auto-recognize' feature, meaning it will automatically
test individual clades for deviation of their rates from the background
rate of the rest of the tree (see details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>state</code></td>
<td>
<p>the state of the tips specified under the <code>"sparse"</code>
condition.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov</code></td>
<td>
<p>the covariate vector to be indicated if its effect on rate values must be
accounted for. Contrary to <code>RRphylo</code>, <code>cov</code> needs to be as long
as the number of tips of the tree.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrep</code></td>
<td>
<p>the number of simulations to be performed for the rate shift
test, by default <code>nrep</code> is set at 1000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>f</code></td>
<td>
<p>the size of the smallest clade to be tested. By default, nodes
subtending to one tenth of the tree tips are tested.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filename</code></td>
<td>
<p>is deprecated. <code>search.shift</code> does not return plots
anymore, check the function <code>plotShift</code> instead.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function <code>search.shift</code> takes the object produced by
<code>RRphylo</code>. Two different conditions of rate change can be
investigated. Under the <code>"clade"</code> condition the vector of node or
nodes subjected to the shift must be provided. Alternatively, under the
<code>"sparse"</code> case the (named) vector of states (indicating which tips
are or are not evolving under the rate shift according to the tested
hypothesis) must be indicated. In the <code>"clade"</code> case, the function may
perform an 'auto-recognize' feature. Under such specification, the function
automatically tests individual clades (from clades as large as one half of
the tree down to a specified clade size) for deviation of their rates from
the background rate of the rest of the tree, which is identical to the
<code>"clade"</code> case. An inclusive clade with significantly high rates is
likely to include descending clades with similarly significantly high
rates. Hence, with 'auto-recognize' the <code>search.shift</code> function is
written as to scan clades individually and to select only the node
subtending to the highest difference in mean absolute rates as compared to
the rest of the tree. Caution must be put into interpreting the
'auto-recognize' results. For instance, a clade with small rates and
another with large rates could be individuated even under BM. This does not
mean these clades are actual instances for rate shifts. Clades must be
tested on their own without the 'auto-recognize' feature, which serves as
guidance to the investigator, when no strong a priori hypothesis to be
tested is advanced. The 'auto-recognize' feature is not meant to provide a
test for a specific hypothesis. It serves as an optional guidance to
understand whether and which clades show significantly large or small rates
as compared to the rest of the tree. Individual clades are tested at once,
meaning that significant instances of rate variation elsewhere on the tree
are ignored. Conversely, running the <code>"clade"</code> condition without
including the 'auto-recognize' feature, multiple clades presumed to evolve
under the same shift are tested together, meaning that their rates are
collectively contrasted to the rest of the tree, albeit they can
additionally be compared to each other upon request. Under both the
<code>"clade"</code> and <code>"sparse"</code> conditions, multiple clades could be
specified at once, and optionally tested individually (for deviation of
rates) against the rates of the rest of the tree and against each other.
Regardless of which condition is specified, the function output produces
the real difference of means, and their significance value.
</p>


<h3>Value</h3>

<p>Under all circumstances, <code>search.shift</code> provides a vector of
<code>$rates</code>. If <code>'cov'</code> values are provided, rates are regressed
against the covariate and the residuals of such regression form the vector
<strong><code>$rates</code></strong>. Otherwise, <strong><code>$rates</code></strong> are the same
rates as with the <code>RR</code> argument.
</p>
<p>Under <code>"clade"</code> case without specifying nodes (i.e.
'auto-recognize') a list including:
</p>
<p><strong>$all.clades</strong> for each detected node, the data-frame includes
the average rate difference (computed as the mean rate over all branches
subtended by the node minus the average rate for the rest of the tree) and
the probability that it do represent a real shift. Probabilities are
contrasted to simulations shuffling the rates across the tree branches for
a number of replicates specified by the argument <code>nrep</code>. Note that the
p-values refer to the number of times the real average rates are larger (or
smaller) than the rates averaged over the rest of the tree, divided by the
number of simulations. Hence, large rates are significantly larger than the
rest of the tree (at alpha = 0.05), when the probability is &gt; 0.975; and
small rates are significantly small for p &lt; 0.025.
</p>
<p><strong>$single.clades</strong> the same as with 'all.clades' but restricted
to the largest/smallest rate values along a single clade (i.e. nested
clades with smaller rate shifts are excluded). Large rates are
significantly larger than the rest of the tree (at alpha = 0.05), when the
probability is &gt; 0.975; and small rates are significantly small for p &lt;
0.025.
</p>
<p>Under <code>"clade"</code> condition by specifying the <code>node</code>
argument:
</p>
<p><strong>$all.clades.together</strong> if more than one node is tested, this
specifies the average rate difference and the significance of the rate
shift, by considering all the specified nodes as evolving under a single
rate. As with the 'auto-recognize' feature, large rates are significantly
larger than the rest of the tree (at alpha = 0.05), when the probability is
&gt; 0.975; and small rates are significantly small for p &lt; 0.025.
</p>
<p><strong>$single.clades</strong> this gives the significance for individual
clades, tested separately. As previously, large rates are significantly
larger than the rest of the tree (at alpha = 0.05), when the probability is
&gt; 0.975; and small rates are significantly small for p &lt; 0.025.
</p>
<p>Under the <code>"sparse"</code> condition:
</p>
<p><strong>$state.results</strong> for each state, the data-frame includes the
average rate difference (computed as the mean rate over all leaves evolving
under a given state, minus the average rate for each other state or the
rest of the tree) and the probability that the shift is real. Large rates
are significantly larger (at alpha = 0.05), when the probability is &gt;
0.975; and small rates are significantly small for p &lt; 0.025. States are
compared pairwise.
</p>


<h3>Author(s)</h3>

<p>Pasquale Raia, Silvia Castiglione, Carmela Serio, Alessandro
Mondanaro, Marina Melchionna, Mirko Di Febbraro, Antonio Profico, Francesco
Carotenuto
</p>


<h3>References</h3>

<p>Castiglione, S., Tesone, G., Piccolo, M., Melchionna, M.,
Mondanaro, A., Serio, C., Di Febbraro, M., &amp; Raia, P.(2018). A new method
for testing evolutionary rate variation and shifts in phenotypic evolution.
<em>Methods in Ecology and Evolution</em>, 9:
974-983.doi:10.1111/2041-210X.12954
</p>


<h3>See Also</h3>

<p><a href="../doc/search.shift.html"><code>search.shift</code> vignette</a>
</p>
<p><a href="../doc/Plotting-tools.html"><code>plotShift</code> vignette</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
data("DataOrnithodirans")
DataOrnithodirans$treedino-&gt;treedino
DataOrnithodirans$massdino-&gt;massdino
DataOrnithodirans$statedino-&gt;statedino
cc&lt;- 2/parallel::detectCores()

RRphylo(tree=treedino,y=massdino,clus=cc)-&gt;dinoRates

# Case 1. Without accounting for the effect of a covariate

# Case 1.1 "clade" condition
# with auto-recognize
search.shift(RR=dinoRates,status.type="clade")
# testing two hypothetical clades
search.shift(RR=dinoRates,status.type="clade",node=c(696,746))

# Case 1.2 "sparse" condition
# testing the sparse condition.
search.shift(RR=dinoRates,status.type= "sparse",state=statedino)


# Case 2. Accounting for the effect of a covariate

# Case 2.1 "clade" condition
search.shift(RR=dinoRates,status.type= "clade",cov=massdino)

# Case 2.2 "sparse" condition
search.shift(RR=dinoRates,status.type="sparse",state=statedino,cov=massdino)
    
## End(Not run)
</code></pre>


</div>