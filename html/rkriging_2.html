<div class="container">

<table style="width: 100%;"><tr>
<td>Fit.Kriging</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit or Create Kriging Models</h2>

<h3>Description</h3>

<p>This function provides a common interface to fit various kriging models from the data.
OK (Ordinary.Kriging), UK (Universal.Kriging), LK (Limit.Kriging), 
RK (Rational.Kriging), and GRK (Generalized.Rational.Kriging) are supported in this package.
</p>


<h3>Usage</h3>

<pre><code class="language-R">Fit.Kriging(
  X,
  y,
  interpolation = TRUE,
  fit = TRUE,
  model = "OK",
  model.parameters = list(),
  kernel = NULL,
  kernel.parameters = list(),
  nlopt.parameters = list()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>a matrix for input (feature)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>a vector for output (target), only one-dimensional output is supported</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interpolation</code></td>
<td>
<p>whether to interpolate, for noisy data please set <code>interpolate=FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p>whether to fit the length scale parameters from data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>choice of kriging model: OK, UK, LK, RK, GRK</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model.parameters</code></td>
<td>
<p>a list of parameters required for the specific kriging model, e.g. basis functions for universal kriging</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kernel</code></td>
<td>
<p>a kernel class object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kernel.parameters</code></td>
<td>
<p>a list of parameters required for the kernel, if no kernel class object is provided</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nlopt.parameters</code></td>
<td>
<p>a list of parameters required for NLopt, including choice of optimization algorithm and maximum number of evaluation</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Kriging gives the best linear unbiased predictor given the data. 
It can also be given a Bayesian interpretation by assuming a Gaussian process (GP) prior for the underlying function.
Please see Santner et al. (2003), Rasmussen and Williams (2006), and Joseph (2024) for details.
</p>
<p>For data from deterministic computer experiments, use <code>interpolation=TRUE</code> and will give an interpolator. 
For noisy data, use <code>interpolation=FALSE</code>, which will give an approximator of the underlying function.
Currently, approximation is supported for OK (Ordinary.Kriging) and UK (Universal.Kriging). 
</p>
<p>The kernel choices are required and can be specified by 
(i) providing the kernel class object to <code>kernel</code>
or (ii) specifying the kernel type and other parameters in <code>kernel.parameters</code>. 
Please see examples section for detail usages. 
</p>
<p>When the lengthscale / correlation parameters are known, simply provide them in 
(i) the kernel class object to <code>kernel</code> or (ii) in <code>kernel.parameters</code>,
and set <code>fit=FALSE</code>. The kriging model will be fitted with the user provided parameters.
</p>
<p>When the lengthscale / correlation parameters are unknown, 
they can be estimated via Maximum Likelihood method by setting <code>fit=TRUE</code>. 
The initial / lower bound / upper bound of the lengthscale parameters can be provided in <code>kernel.parameters</code>, 
otherwise a good initial and range would be estimated from the data. 
The optimization is performed via <a href="https://nlopt.readthedocs.io/en/latest/">NLopt</a>, 
a open-source library for nonlinear optimization. 
All gradient-free optimization methods in <a href="https://nlopt.readthedocs.io/en/latest/">NLopt</a> 
are supported and can be specified in <code>nlopt.parameters</code>.
See <code>nloptr::nloptr.print.options()</code> for the list of available derivative-free algorithms (prefix with NLOPT_GN or NLOPT_LN).  
The maximum number of optimization steps can also be defined in <code>nlopt.parameters</code>.
Please see examples section for detail usages.
</p>


<h3>Value</h3>

<p>A Kriging Class Object.
</p>


<h3>Author(s)</h3>

<p>Chaofan Huang and V. Roshan Joseph
</p>


<h3>References</h3>

<p>Joseph, V. R. (2006). <em>Limit kriging</em>. Technometrics, 48(4), 458-466.
</p>
<p>Joseph, V. R. (2024). Rational Kriging. <em>Journal of the American Statistical Association</em>.
</p>
<p>Rasmussen, C. E. &amp; Williams, C. K. (2006). <em>Gaussian Processes for Machine Learning</em>. The MIT Press.
</p>
<p>Santner, T. J., Williams, B. J., Notz, W. I., &amp; Williams, B. J. (2003). <em>The design and analysis of computer experiments (Vol. 1)</em>. New York: Springer.
</p>


<h3>See Also</h3>

<p>Predict.Kriging, Get.Kriging.Parameters, Get.Kernel, 
Ordinary.Kriging, Universal.Kriging, Limit.Kriging, 
Rational.Kriging, Generalized.Rational.Kriging.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># one dimensional example 
f &lt;- function(x) {
  x &lt;- 0.5 + 2*x
  y &lt;- sin(10*pi*x)/(2*x) + (x-1)^4
  return (y)
}

set.seed(1234)
# train set
n &lt;- 30
p &lt;- 1
X &lt;- matrix(runif(n),ncol=p)
y &lt;- apply(X, 1, f)
newX &lt;- matrix(seq(0,1,length=1001), ncol=p)

#############################################################################
################ Minimal Example for Fitting a Kriging Model ################
#############################################################################
# Ordinary Kriging
kriging &lt;- Fit.Kriging(X, y, interpolation=TRUE, fit=TRUE, model="OK",
                       kernel.parameters=list(type="Gaussian"))
pred &lt;- Predict.Kriging(kriging, newX)
plot(newX, f(newX), "l")
points(X, y, pch=16, col="blue")
lines(newX, pred$mean, col="red", lty=2)
lines(newX, pred$mean-2*pred$sd, col="red", lty=3)
lines(newX, pred$mean+2*pred$sd, col="red", lty=3)
Get.Kriging.Parameters(kriging)

# Universal Kriging
basis.function &lt;- function(x) {c(1,x[1],x[1]^2)}
kriging &lt;- Fit.Kriging(X, y, interpolation=TRUE, fit=TRUE, model="UK",
                       model.parameters=list(basis.function=basis.function),
                       kernel.parameters=list(type="Gaussian"))
pred &lt;- Predict.Kriging(kriging, newX)
plot(newX, f(newX), "l")
points(X, y, pch=16, col="blue")
lines(newX, pred$mean, col="red", lty=2)
lines(newX, pred$mean-2*pred$sd, col="red", lty=3)
lines(newX, pred$mean+2*pred$sd, col="red", lty=3)
Get.Kriging.Parameters(kriging)

# Limit Kriging
kriging &lt;- Fit.Kriging(X, y, interpolation=TRUE, fit=TRUE, model="LK",
                       kernel.parameters=list(type="Gaussian"))
pred &lt;- Predict.Kriging(kriging, newX)
plot(newX, f(newX), "l")
points(X, y, pch=16, col="blue")
lines(newX, pred$mean, col="red", lty=2)
lines(newX, pred$mean-2*pred$sd, col="red", lty=3)
lines(newX, pred$mean+2*pred$sd, col="red", lty=3)
Get.Kriging.Parameters(kriging)

# Rational Kriging
kriging &lt;- Fit.Kriging(X, y, interpolation=TRUE, fit=TRUE, model="RK",
                       kernel.parameters=list(type="RQ",alpha=1))
pred &lt;- Predict.Kriging(kriging, newX)
plot(newX, f(newX), "l")
points(X, y, pch=16, col="blue")
lines(newX, pred$mean, col="red", lty=2)
lines(newX, pred$mean-2*pred$sd, col="red", lty=3)
lines(newX, pred$mean+2*pred$sd, col="red", lty=3)
Get.Kriging.Parameters(kriging)

# Generalized Rational Kriging
kriging &lt;- Fit.Kriging(X, y, interpolation=TRUE, fit=TRUE, model="GRK",
                       kernel.parameters=list(type="RQ",alpha=1))
pred &lt;- Predict.Kriging(kriging, newX)
plot(newX, f(newX), "l")
points(X, y, pch=16, col="blue")
lines(newX, pred$mean, col="red", lty=2)
lines(newX, pred$mean-2*pred$sd, col="red", lty=3)
lines(newX, pred$mean+2*pred$sd, col="red", lty=3)
Get.Kriging.Parameters(kriging)

#############################################################################
################ Fitting a Kriging Model with Kernel Object #################
#############################################################################
kernel &lt;- Gaussian.Kernel(rep(1,p))
kriging &lt;- Fit.Kriging(X, y, interpolation=TRUE, fit=TRUE, model="OK", kernel=kernel)
pred &lt;- Predict.Kriging(kriging, newX)
plot(newX, f(newX), "l")
points(X, y, pch=16, col="blue")
lines(newX, pred$mean, col="red", lty=2)
lines(newX, pred$mean-2*pred$sd, col="red", lty=3)
lines(newX, pred$mean+2*pred$sd, col="red", lty=3)
Get.Kriging.Parameters(kriging)

#############################################################################
############### Creating a Kriging Model with Kernel Object #################
#############################################################################
# set fit = FALSE to create Kriging model with user provided kernel
# no optimization for the length scale parameters 
kernel &lt;- Gaussian.Kernel(rep(1e-1,p))
kriging &lt;- Fit.Kriging(X, y, interpolation=TRUE, fit=FALSE, model="OK", kernel=kernel)
pred &lt;- Predict.Kriging(kriging, newX)
plot(newX, f(newX), "l")
points(X, y, pch=16, col="blue")
lines(newX, pred$mean, col="red", lty=2)
lines(newX, pred$mean-2*pred$sd, col="red", lty=3)
lines(newX, pred$mean+2*pred$sd, col="red", lty=3) 
Get.Kriging.Parameters(kriging)

#############################################################################
############ Fitting a Kriging Model with Range for Lengthscale #############
#############################################################################
kernel.parameters &lt;- list(
    type = 'Gaussian',
    lengthscale = rep(1,p), # initial value
    lengthscale.lower.bound = rep(1e-3,p), # lower bound
    lengthscale.upper.bound = rep(1e3,p) # upper bound
) # if not provided, a good estimate would be computed from data
kriging &lt;- Fit.Kriging(X, y, interpolation=TRUE, fit=TRUE, model="OK",
                       kernel.parameters=kernel.parameters)
pred &lt;- Predict.Kriging(kriging, newX)
plot(newX, f(newX), "l")
points(X, y, pch=16, col="blue")
lines(newX, pred$mean, col="red", lty=2)
lines(newX, pred$mean-2*pred$sd, col="red", lty=3)
lines(newX, pred$mean+2*pred$sd, col="red", lty=3)
Get.Kriging.Parameters(kriging)

#############################################################################
########### Fitting a Kriging Model with Different Optimization #############
#############################################################################
nlopt.parameters &lt;- list(
    algorithm = 'NLOPT_GN_DIRECT', # optimization method
    maxeval = 250 # maximum number of evaluation
)
kriging &lt;- Fit.Kriging(X, y, interpolation=TRUE, fit=TRUE, model="OK",
                       kernel.parameters=list(type="Gaussian"),
                       nlopt.parameters=nlopt.parameters)
pred &lt;- Predict.Kriging(kriging, newX)
plot(newX, f(newX), "l")
points(X, y, pch=16, col="blue")
lines(newX, pred$mean, col="red", lty=2)
lines(newX, pred$mean-2*pred$sd, col="red", lty=3)
lines(newX, pred$mean+2*pred$sd, col="red", lty=3)
Get.Kriging.Parameters(kriging)

# Global-Local Optimization
nlopt.parameters &lt;- list(
    algorithm = 'NLOPT_GN_MLSL_LDS', # optimization method
    local.algorithm = 'NLOPT_LN_SBPLX', # local algorithm
    maxeval = 250 # maximum number of evaluation
)
kriging &lt;- Fit.Kriging(X, y, interpolation=TRUE, fit=TRUE, model="OK",
                       kernel.parameters=list(type="Gaussian"),
                       nlopt.parameters=nlopt.parameters)
pred &lt;- Predict.Kriging(kriging, newX)
plot(newX, f(newX), "l")
points(X, y, pch=16, col="blue")
lines(newX, pred$mean, col="red", lty=2)
lines(newX, pred$mean-2*pred$sd, col="red", lty=3)
lines(newX, pred$mean+2*pred$sd, col="red", lty=3)
Get.Kriging.Parameters(kriging)

#############################################################################
################# Fitting a Kriging Model from Noisy Data ###################
#############################################################################
y &lt;- y + 0.1 * rnorm(length(y))
kriging &lt;- Fit.Kriging(X, y, interpolation=FALSE, fit=TRUE, model="OK",
                       kernel.parameters=list(type="Gaussian"))
pred &lt;- Predict.Kriging(kriging, newX)
plot(newX, f(newX), "l")
points(X, y, pch=16, col="blue")
lines(newX, pred$mean, col="red", lty=2)
lines(newX, pred$mean-2*pred$sd, col="red", lty=3)
lines(newX, pred$mean+2*pred$sd, col="red", lty=3)
Get.Kriging.Parameters(kriging)

</code></pre>


</div>