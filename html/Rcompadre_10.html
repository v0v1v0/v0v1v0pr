<div class="container">

<table style="width: 100%;"><tr>
<td>cdb_collapse</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Collapse a COM(P)ADRE database by averaging matrices over levels of one or
more grouping variables</h2>

<h3>Description</h3>

<p>Collapses a CompadreDB object by averaging matrices over levels of one or
more grouping variables (e.g. SpeciesAuthor, MatrixPopulation).
</p>
<p>For a given study and species, a COM(P)ADRE database may contain multiple
matrices, reflecting different combinations of population, year, and/or
treatment. Collapsing allows a user to obtain a single 'grand mean matrix'
for each group of interest (e.g. MatrixPopulation), and therefore limit
pseudoreplication.
</p>
<p>All members of a group <em>must</em> have the same matrix dimension (consider
adding MatrixDimension as a grouping variable). All members of a group
<em>should</em> have the same ProjectionInterval and matrix stage class
definitions (see <code>cdb_id_stages</code>). Note that Seasonal matrices
should not be collapsed using this method (they should be matrix-multiplied
rather than averaged).
</p>


<h3>Usage</h3>

<pre><code class="language-R">cdb_collapse(cdb, columns)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>cdb</code></td>
<td>
<p>A CompadreDB object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>columns</code></td>
<td>
<p>Vector of grouping variables to collapse over (corresponding
to columns within <code>cdb</code>)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Will give a warning if members of any group do not all share the same
ProjectionInterval or stage class definitions, or if <code>cdb</code> contains any
rows with a MatrixComposite value of "Seasonal".
</p>
<p>Prior to collapsing, columns of class 'factor' will be coerced to
'character', and any list-column apart from <code>mat</code> will be removed.
</p>
<p>Within a group, rows of a given column are collapsed as follows:
</p>

<ul>
<li> <p><code>mat</code>: matrices are averaged using mpm_mean, and stage
class definitions are taken from the first group member
</p>
</li>
<li> <p><code>MatrixComposite</code>: return original value if N = 1, else return
"Collapsed"
</p>
</li>
<li> <p><code>Lat</code>: re-calculated by averaging Lat column (if available)
</p>
</li>
<li> <p><code>Lon</code>: re-calculated by averaging Lon column (if available)
</p>
</li>
<li> <p><code>SurvivalIssue</code>: re-calculated from the collapsed <code>mat</code>
(<code>max(colSums(matU))</code>)
</p>
</li>
<li> <p><code>others</code>: if all elements equal return that unique value, else
paste together all unique values separated by "; "
</p>
</li>
</ul>
<h3>Value</h3>

<p>A CompadreDB object
</p>


<h3>Author(s)</h3>

<p>Patrick M. Barks &lt;patrick.barks@gmail.com&gt;
</p>
<p>Owen R. Jones &lt;jones@biology.sdu.dk&gt;
</p>


<h3>See Also</h3>

<p>cdb_id_stages
</p>
<p>Other data checking: 
<code>cdb_check_species()</code>,
<code>cdb_compare()</code>,
<code>cdb_flag()</code>,
<code>mpm_methods</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># filter out Seasonal matrices
CompSub &lt;- subset(Compadre, MatrixComposite != "Seasonal")

# add column identifying unique stage class definitions
CompSub$id_stage &lt;- cdb_id_stages(CompSub, "MatrixClassOrganized")

# collapse
CompCollapse &lt;- cdb_collapse(CompSub, columns = c("id_stage"))

</code></pre>


</div>