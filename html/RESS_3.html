<div class="container">

<table style="width: 100%;"><tr>
<td>essQuery</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>essQuery
</h2>

<h3>Description</h3>

<p>Query the Essentia database and return the results to R.</p>


<h3>Usage</h3>

<pre><code class="language-R">essQuery(essentia, aq="", flags="")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>essentia</code></td>
<td>

<p>The essentia command to run. The options are "ess stream
category startdate enddate", "ess exec", and "ess query".
</p>
<p>Each stream or query command can be used to stream any number of files
directly into your R analysis. Alternatively, each stream command
can save multiple files into separate R dataframes, one file per dataframe.
</p>
<p>The default value for the essentia argument is "ess
exec".
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aq</code></td>
<td>

<p>This can be any combination of the aq_tools and standard UNIX
commands for "ess stream" and "ess exec" statements or an sql-like statement 
for "ess query" statements. However, the output MUST be in a 
csv format if you want R to capture the output. If you only want to 
run the command without R capturing the output, add "#Rignore" to the
flags argument.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flags</code></td>
<td>

<p>Any of the essentia flags can be used here in addition to any
of these RESS-specific flags:
</p>
<p><code>#Rignore</code> : Ignore an 'ess exec' statement. Do not
capture the output of the statement into R.
</p>
<p><code>#Rinclude</code> : Include an 'ess stream' or 'ess query' statement. 
Capture the output of the statement into R.
</p>
<p><code>#-notitle</code> : Tell R not to use the first line of the output
as the header.
</p>
<p><code>#Rseparate</code> : Can be used when saving multiple files into an
R dataframe using an 'ess stream' command. Saves each
file into a different R dataframe, entitled command1 to
commandN, where N is the number of files.
</p>
<p><code>#filelist</code> : Causes an extra dataframe to be stored in R that saves 
the list of files streamed into R when streaming multiple files.
</p>
<p><code>#R#name#R#</code> : Allows any automatically saved dataframe to be
renamed to whatever is entered in place of 'name'. This only
applies in essQuery when streaming multiple files with <code>#Rseparate</code>.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>essQuery is used to directly query the database using a single
statement. You can call essQuery multiple times to run different
statements.
</p>
<p>However, you can also use capture.essentia to read all of the statements
in a file instead.  Thus if you plan to run multiple statements
that may be somewhat related to each other, it is recommended that
you use capture.essentia.
</p>


<h3>Value</h3>

<p>The value returned is the output from querying the database. This
can be saved into an R dataframe or directly analyzed in R.
</p>
<p>If you use essQuery to save multiple files into separate R dataframes
using a single stream command, the files are stored automatically
in R dataframes called command1 to commandN (where N is the number of files) 
and no value is returned. To change the name of the stored dataframes, use 
the #R#any_name#R# flag. The dataframes will then be stored as any_name1 to any_nameN.
</p>
<p>With #filelist, the extra dataframe is saved as commandN+1 by default, or 
any_nameN+1 if #R#any_name#R# is also used.
</p>


<h3>Author(s)</h3>

<p>Ben Waxer, Data Scientist with Auriq Systems.
</p>


<h3>References</h3>

<p>See our website at www.auriq.com or our documentation at
www.auriq.com/documentation
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
--------------------------------------------------------------------------------------------------

These examples require Essentia to be installed:

fullexec &lt;- essQuery("ess exec", "echo -e '11,12,13\n4,5,6\n7,8,9' ","#-notitle")
print(fullexec)
defaultexec &lt;- essQuery("echo -e '11,12,13\n4,5,6\n7,8,9' ","#-notitle")
print(defaultexec)
essQuery("echo -e '11,12,13\n4,5,6\n7,8,9' ","#Rignore")
print("This last statement is ignored by R and just executed on the command line.")

--------------------------------------------------------------------------------------------------

This example requires Essentia to have selected a datastore containing purchase log data:

command1 &lt;- essQuery("ess query","select count(refID) from purchase:2014-09-01:2014-09-15 \
where articleID&gt;=46 group by price","#Rinclude")
command2 &lt;- essQuery("ess query", "select count(distinct userID) from \
purchase:2014-09-01:2014-09-15 where articleID&gt;=46", "#Rinclude")
command3 &lt;- essQuery("ess query", "select count(refID) from \
purchase:2014-09-01:2014-09-15 where articleID&gt;=46 group by userID", "#Rinclude")
querystream &lt;- essQuery("ess query", "select * from purchase:*:* where articleID &lt;= 20", "\
#Rinclude #-notitle")

Then run these commands to view the saved dataframes:

print(command1)
print(command2)
print(command3)
print(querystream)

--------------------------------------------------------------------------------------------------

The following example requires Essentia to be installed with apache log data stored in it:

# Query the Essentia database logsapache3 and return the contents of vector3 into R.
command1 &lt;- essQuery("aq_udb -exp logsapache3:vector3", "--debug")

# Query the Essentia database logsapache1 and return the sorted contents of vector1 into R.
command2 &lt;- essQuery("ess exec", "aq_udb -exp logsapache1:vector1 -sort pagecount -dec", "\
--debug")

# Stream the last five lines of the file in category 125accesslogs between dates 2014-12-07 and
# 2014-12-07, convert them to csv, return them to R, and store them into an R dataframe singlefile.
singlefile &lt;- essQuery("ess stream 125accesslogs '2014-12-07' '2014-12-07'","tail -5 \
| logcnv -f,eok - -d ip:ip sep:' ' s:rlog sep:' ' s:rusr sep:' [' i,tim:time sep:'] \\"' \
s,clf:req_line1 sep:' ' s,clf:req_line2 sep:' ' s,clf:req_line3 sep:'\\" ' i:res_status sep:' ' \
i:res_size sep:' \\"' s,clf:referrer sep:'\\" \\"' \
s,clf:user_agent sep:'\\"' X | cat -","#Rinclude")

# Stream the last five lines of the files in category 125accesslogs between dates 2014-11-30 and 
# 2014-12-07, convert them to csv, and save them into R dataframes apachefiles1 and apachefiles2.
essQuery("ess stream 125accesslogs '2014-11-30' '2014-12-07'","tail -5 \
| logcnv -f,eok - -d ip:ip sep:' ' s:rlog sep:' ' s:rusr sep:' [' i,tim:time sep:'] \\"' \
s,clf:req_line1 sep:' ' s,clf:req_line2 sep:' ' s,clf:req_line3 sep:'\\" ' i:res_status sep:' ' \
i:res_size sep:' \\"' s,clf:referrer sep:'\\" \\"' \
s,clf:user_agent sep:'\\"' X -notitle | cat -","\
#Rinclude #R#apachefiles#R# #Rseparate")

print(command1)
print(command2)
print(singlefile)
print(apachefiles1)
print(apachefiles2)

The references contain more extensive examples that 
fully walkthrough how to load and query the Essentia Database.

## End(Not run)
</code></pre>


</div>