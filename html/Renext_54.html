<div class="container">

<table style="width: 100%;"><tr>
<td>OT2MAX</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Temporal aggregation of a Marked Process</h2>

<h3>Description</h3>

<p>Temporal aggregation of a Marked Process, leading to block maxima or
<code class="reqn">r</code>-largest observations.
</p>


<h3>Usage</h3>

<pre><code class="language-R">  OT2MAX(OTdata,
         OTmissing = NULL,
         start = NULL,
         end = NULL,
         MAX.r = 1L,
         blockDuration = "year",
         monthGapStat = TRUE,
         maxMissingFrac = 0.05,
         dataFrames = FALSE,
         infMAX = FALSE,
         plot = TRUE,
         plotType = c("max", "gaps"),
         jitterSeed = 123,
         trace = 0L,
         ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>OTdata</code></td>
<td>

<p>Data frame containing a <code>POSIXct</code>
column <code>date</code> and the marks variable.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>OTmissing</code></td>
<td>

<p>Optional data frame with columns <code>start</code> and <code>end</code>
(coerced to <code>POSIXct</code>) giving the beginning and the end of
gaps.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>

<p>An object coerced to <code>POSIXct</code> indicating the beginning of
reliable/usable information. Unless this is a beginning of block
(1-st of January for years), the 1-st block will begin <em>after</em>
<code>start</code> in order to use only qualified information.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>end</code></td>
<td>

<p>An object indicating the end of the reliable/usable
information. Unless this is a end of block (1-st of January for
years), the last block will end <em>before</em> <code>end</code> in order to
use only qualified information.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MAX.r</code></td>
<td>

<p><em>Target</em> number of observations in the blocks. Can be of length
one (same number of observations for all blocks) or of length equal
to the number of blocks, the values being then for the blocks in the
same order. In both cases, the target number may be impossible to
reach because of a smaller number of events in the block. If
<code>infMAX</code> is <code>TRUE</code>, the target number of observations will
be reached by filling if needed with <code>-Inf</code> values. The
rationale for this is that a non-existing event is assumed to have
an arbitrarily small mark.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blockDuration</code></td>
<td>

<p>Duration of the blocks. Can only be <code>"year"</code> for now.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>monthGapStat</code></td>
<td>

<p>Logical. Setting it to <code>TRUE</code> will compute statistics
concerning the gaps and return them or show them on a plot.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxMissingFrac</code></td>
<td>

<p>Maximal fraction of a block duration (between 0 and 1) that can be
missing without leading to a <code>NA</code> aggregated value.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dataFrames</code></td>
<td>

<p>If <code>TRUE</code>, the result will contain data frames similar
to those found in an object with class <code>"Rendata"</code>. If
<code>FALSE</code> the result will contain <em>list</em> and <em>vector</em>
objects, similar to those used as inputs in the <code>Renouv</code>
function under the names <code>MAX.data</code> and
<code>MAX.effDuration</code>. Note however, that <code>-Inf</code> values can be
found in these objects when <code>infMAX</code> is <code>TRUE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>infMAX</code></td>
<td>

<p>If <code>FALSE</code>, the target number of values the blocks will generally
not be reached, because the total number of events in a block can be
lower than the target number. Then, the target number value is revised
to the number of found values in each block. If <code>TRUE</code>, the
target number of values is reached by filling the values with
<code>-Inf</code> and the datetimes with (<code>POSIXct</code>) <code>NA</code>s.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>

<p>If <code>TRUE</code> a simple plot is shown.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotType</code></td>
<td>

<p>Character controlling the plot. With <code>"max"</code>, the block maxima
are shown. With <code>plotType = "gap"</code>, the daily and monthly gap
rates are shown. This is possible when suitable information
concerning gaps is provided in <code>OTmissing</code>. The plot then shows
the probability that a given day of the year falls in a gap, as well
as monthly gap rates. Most often one wants that the gap rate does
not show a seasonal behaviour. Note that gap rates for month-year
combinations are shown as grey segments after jitterizing them since
the values <code>0</code> and <code>1</code> may be observed for several
years. An alternative way to is using the <code>monthGapTS</code>
multivariate time series returned by the function, see
<b>Examples</b>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>jitterSeed</code></td>
<td>

<p>Random seed for jittering. Used only when <code>plot</code> is
<code>TRUE</code>, <code>plotType</code> is <code>"gap"</code> and when suitable
information is provided in <code>OTmissing</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trace</code></td>
<td>

<p>Integer level of verbosity.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Other arguments to be passed to <code>plot</code>.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The data frame given in <code>OTdata</code> contains the <em>events</em> (or
<em>arrivals</em>) given by the <code>date</code> column, as well as one mark
column. Depending on the argument <code>MAX.r</code>, the maxima or the
<code class="reqn">r</code>-largest observations of the marks is computed for each time
block. When known gaps exist in the data and when they are given in
<code>OTmissing</code>, a block for which the total duration of gaps is too
large will be omitted.
</p>


<h3>Value</h3>

<p>A list, the content of which depends on the value of
<code>dataFrames</code>. If this value is <code>TRUE</code>, the
following elements are returned.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>MAXdata</code></td>
<td>

<p>A data frame of largest values by block with one row for
each observation. The largest values are given as columns
with names equal to those in the <code>OTdata</code> data
frame.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MAXinfo</code></td>
<td>

<p>A data frame describing the blocks, with one row by
block. The two (<code>POSIXct</code>) columns <code>"start"</code>
and <code>"end"</code> provide the beginning and the end of the
block.  The numeric column <code>duration</code> gives the
<em>effective duration</em> (in year) within block.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probMissing</code></td>
<td>

<p>A vector with values corresponding to the days in a block
(year). Each value is a estimation of the probability
that the day falls in a gap.
</p>
<p>If <code>dataFrames</code> is <code>FALSE</code>, the list still
contains <code>probMissing</code> as before, as well as other
lists as used in <code>Renouv</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>effDuration, r</code></td>
<td>

<p>Vectors containing the effective duration (<em>in
years</em>) and number of value for the blocks.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>

<p>List of maxima or <code class="reqn">r</code>-largest values for the blocks.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>monthGapStat, monthGapTS</code></td>
<td>

<p>Summary information concerning gaps, if <code>monthGapStat</code> is
<code>TRUE</code> and if relevant information is provide via the the
<code>OTmissing</code> formal. The element <code>monthGapTS</code> is a
multivariate time series with yearly observations and one series
(column) for each of the 12 months. Each series contains the missing
fraction of the month for the considered year, ranging from
<code>0.0</code> (no gap) to <code>1.0</code> (full gap). This object can be
dealt with standard methods for time-series, but the <code>plot</code>
method will require to select a reduced number of columns first,
see <b>Examples</b>.
</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>Remind that even when <code>maxMissingFrac</code> is set to its maximum
value 1.0, there can still be blocks with no data. When the result is
intended to be used in the <code>Renouv</code> function, the formal
<code>dataFrames</code> should be <code>FALSE</code>; the elements <code>data</code> and
<code>effDuration</code> can then be passed as <code>MAX.data</code> and
<code>MAX.effDuration</code>. At the time <code>infMAX</code> should also then be
set to <code>FALSE</code> since <code>-Inf</code> values are not yet allowed in
the <code class="reqn">r</code>-largest values.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## use Dunkerque data
OTdata &lt;- Dunkerque$OTdata; OTmissing &lt;- Dunkerque$OTmissing
## allow up to 50\% gap in a block, or only 5\%
MAX1 &lt;- OT2MAX(OTdata = OTdata, OTmissing = OTmissing,
               maxMissingFrac = 0.5,
               main = "impact of the 'maxMissingFrac' formal")
MAX2 &lt;- OT2MAX(OTdata = OTdata, OTmissing = OTmissing, dataFrames = TRUE,
               prefix = "Max", maxMissingFrac = 0.05, plot = FALSE)
lines(MAX2$MAXdata$date, MAX2$MAXdata$Surge, type = "h", col = "red", lwd = 3)
legend("topleft", lw = c(1, 3), col = c("black", "orangered"),
       legend = c("50\% max", " 5\% max"))

## r-largest obs for r = 4
MAX3 &lt;- OT2MAX(OTdata, OTmissing = OTmissing, MAX.r = 4,
               maxMissingFrac = 0.9, 
               dataFrames = FALSE, trace = TRUE,
               main = "r-largest with r = 4")

## restrict the period
MAX4 &lt;- OT2MAX(OTdata, OTmissing = OTmissing, MAX.r = 4,
               start = "1962-01-01",
               end = "1990-01-01",
               maxMissingFrac = 0.9, 
               dataFrames = FALSE, trace = TRUE,
               main = "r-largest with r = 4 with given 'start' and 'end'")
## Not run: 
  ## use in a block maxima analysis, as if there were no gaps.
  fit &lt;- fGEV.MAX(MAX.data = MAX3$data,
                  MAX.effDuration = rep(1, length(MAX3$effDuration)))     

## End(Not run)
## plot the gap rate
MAX5 &lt;- OT2MAX(OTdata = OTdata, OTmissing = OTmissing,
               maxMissingFrac = 0.5,
               main = "probability of being in a  gap",
               plotType = "gap")

## time series plot (only &lt;= 10 months)
plot(MAX5$monthGapTS[ , c(1:4)], main = "gap rate by month")

## much better with lattice.
## Not run: 
    require(lattice)
    xyplot(MAX5$monthGapTS)

## End(Not run)
</code></pre>


</div>