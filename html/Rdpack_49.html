<div class="container">

<table style="width: 100%;"><tr>
<td>Rdapply</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Apply a function over an Rd object</h2>

<h3>Description</h3>

<p>Apply a function recursively over an Rd object, similarly
to rapply but keeping attributes.</p>


<h3>Usage</h3>

<pre><code class="language-R">Rdapply(x, ...)

Rdtagapply(object, FUN, rdtag, classes = "character", how = "replace",
           ...)

rattr(x, y)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>the Rd object on which to apply a function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>the Rd object on which to apply a function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>FUN</code></td>
<td>
<p>The function to apply, see details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rdtag</code></td>
<td>
<p>apply FUN only to elements whose <code>Rd_tag</code> attribute
is <code>rdtag</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>an Rd object with the same structure as <code>x</code>, see ‘Details’.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments to pass to <code>rapply</code>, see ‘Details’.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>classes</code></td>
<td>
<p>a character vector, passed on to <code>rapply</code>,
see ‘Details’.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>how</code></td>
<td>
<p>a character string, passed on to <code>rapply</code>,
see ‘Details’.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>Rdapply</code> works like <code>rapply</code> but preserves the attributes
of <code>x</code> and (recursively) any sublists of it.  <code>Rdapply</code>
first calls <code>rapply</code>, passing all arguments to it. Then it
restores recursively the attributes by calling <code>rattr</code>.
</p>
<p>Note that the object returned by <code>rapply</code> is assumed to have
identical structure to the original object. This means that argument
<code>how</code> of <code>rapply</code> must not be "unlist" and normally will be
"replace".  <code>Rdtagapply</code> gives sensible default values for
<code>classes</code> and <code>how</code>.  See the documentation of
<code>rapply</code> for details and the possible choices for
<code>classes</code>, <code>how</code> or other arguments passed to it via
<code>"\dots"</code>.
</p>
<p><code>Rdtagapply</code> is a convenience variant of <code>Rdapply</code> for the
common task of modifying or examining only elements with a given
<code>Rd_tag</code> attribute. Since the Rd equation macros <code style="white-space: pre;">⁠\eqn⁠</code> and
<code style="white-space: pre;">⁠\deqn⁠</code> are assigned Rd tag "VERB" but are processed differently
from other "VERB" pieces,  pseudo-tags
"mathVERB" and "nonmathVERB" are provided, such that "mathVERB" is for
actions on the first argument of the mathematical macros <code style="white-space: pre;">⁠\eqn⁠</code> and
<code style="white-space: pre;">⁠\deqn⁠</code>, while "nonmathVERB" is for actions on "VERB" macros in
all other contexts. There is also a pseudo-tag "nonmath" for anything
that is not math.
</p>
<p><code>rattr</code> is an auxilliary function which takes two Rd objects
(with identical structure) and recursively examines them. It makes the
attributes of any lists in the first argument identical to the
corresponding attributes in the second.
</p>


<h3>Value</h3>

<p>For <code>Rdapply</code> and <code>Rdtagapply</code>, an Rd object with some of
its leaves replaced as specified above.
</p>
<p>For <code>rattr</code>, the object <code>x</code> with attributes of any list
elements of it set to the corresponding attributes of <code>y</code>.
</p>


<h3>Note</h3>

<p>todo: may be it is better to rename the argument FUN of <code>Rdtagapply</code> to
<code>f</code>, which is its name in <code>rapply</code>.
</p>


<h3>Author(s)</h3>

<p>Georgi N. Boshnakov</p>


<h3>See Also</h3>

<p><code>rapply</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># create an Rd object for the sake of example
u1 &lt;- list_Rd(name = "Dummyname", alias = "dummyfun",
              title = "Dummy title", description = "Dummy description",
              usage = "dummyfun(x)",
              value = "numeric vector",
              author = "A. Author",
              examples = "\na &lt;- matrix(1:6,nrow=2)\na %*% t(a)\nt(a) %*% a",
              Rd_class=TRUE )

# correct R code for examples but wrong for saving in Rd files
Rdo_show(u1)

# escape percents everywhere except in comments
#  (actually, .anypercent escapes only unescaped percents)
rdo &lt;- Rdapply(u1, Rdpack:::.anypercent, classes = "character", how = "replace")

# syntactically wrong R code for examples but ok for saving in Rd files
Rdo_show(rdo)


# Rdo2Rdf does this by default for examples and other R code,
#   so code can be kept syntactically correct while processing.
#   (reprompt() takes care of this too as it uses Rdo2Rdf for saving)

fn &lt;- tempfile("u1", fileext="Rd")
Rdo2Rdf(u1, file = fn)

# the saved file contains escaped percents but they disappear in parsing:
file.show(fn)
Rdo_show(tools::parse_Rd(fn))

# if you think that sections should start on new lines,
# the following makes the file a little more human-friendly
#   (by inserting new lines).

u2 &lt;- Rdpack:::.Rd_tidy(u1)
Rdo2Rdf(u2, file = fn)
file.show(fn)

unlink(fn)
</code></pre>


</div>