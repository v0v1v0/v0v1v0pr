<div class="container">

<table style="width: 100%;"><tr>
<td>fit_ClaDS0</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Infer ClaDS0's parameter on a phylogeny</h2>

<h3>Description</h3>

<p>Infer branch-specific speciation rates and the model's hyper parameters for the pure-birth model
</p>


<h3>Usage</h3>

<pre><code class="language-R">fit_ClaDS0(tree, name, pamhLocalName = "pamhLocal",  
            iteration = 1e+07, thin = 20000, update = 1000, 
            adaptation = 10, seed = NULL, nCPU = 3)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>tree</code></td>
<td>

<p>An object of class 'phylo'.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name</code></td>
<td>

<p>The name of the file in which the results will be saved. Use name = NULL to disable this option.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pamhLocalName</code></td>
<td>

<p>The function is writing in a text file to make the execution quicker, this is the name of this file.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iteration</code></td>
<td>

<p>Number of iterations after which the gelman factor is computed and printed. The function stops if it is below 1.05
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thin</code></td>
<td>

<p>Number of iterations between two chain state's recordings.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>update</code></td>
<td>

<p>Number of iterations between two adjustments of the proposal parameters during the adaptation phase of the sampler.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adaptation</code></td>
<td>

<p>Number of times the proposal is adjusted during the adaptation phase of the sampler.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>

<p>An optional seed for the MCMC run.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nCPU</code></td>
<td>

<p>The number of CPUs to use. Should be either 1 or 3.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function uses a Metropolis within Gibbs MCMC sampler with a bactrian proposal (ref) with an initial adaptation phase. During this phase, the proposal is adjusted "adaptation" times every "update" iterations to reach a goal acceptance rate of 0.3.
</p>
<p>To monitor convergence, 3 independant MCMC chains are run simultaneously and the Gelman statistics is computed every "iteration" iterations. The inference is stopped when the maximum of the one dimentional Gelman statistics (computed for each of the parameters) is below 1.05.</p>


<h3>Value</h3>

<p>A mcmc.list object with the three MCMC chains.
</p>


<h3>Author(s)</h3>

<p>O. Maliet
</p>


<h3>References</h3>

<p>Maliet O., Hartig F. and Morlon H. 2019, A model with many small shifts for estimating species-specific diversificaton rates, <em>Nature Ecology and Evolution</em>, doi 10.1038/s41559-019-0908-0
</p>


<h3>See Also</h3>

<p><code>getMAPS_ClaDS0</code>, <code>plot_ClaDS0_chains</code>, <code>fit_ClaDS</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
set.seed(1)


if(test){

obj= sim_ClaDS( lambda_0=0.1,    
                mu_0=0.5,      
                sigma_lamb=0.7,         
                alpha_lamb=0.90,     
                condition="taxa",    
                taxa_stop = 20,    
                prune_extinct = TRUE)  

tree = obj$tree
speciation_rates = obj$lamb[obj$rates]
extinction_rates = obj$mu[obj$rates]

plot_ClaDS_phylo(tree,speciation_rates)

sampler = fit_ClaDS0(tree=tree,        
              name="ClaDS0_example.Rdata",      
              nCPU=1,               
              pamhLocalName = "local",
              iteration=500000,
              thin=2000,
              update=1000, adaptation=5) 
              
# extract the Maximum A Posteriori for each of the parameters
MAPS = getMAPS_ClaDS0(tree, sampler, thin = 10)

# plot the simulated (on the left) and inferred speciation rates (on the right)
# on the same color scale
plot_ClaDS_phylo(tree, speciation_rates, MAPS[-(1:3)])
     
}         
</code></pre>


</div>