<div class="container">

<table style="width: 100%;"><tr>
<td>delta.surv.estimate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>

Calculates treatment effect in a survival setting
</h2>

<h3>Description</h3>


<p>This function calculates the treatment effect in the survival setting i.e. the difference in survival at time t between the treatment group and the control group. The user can also request a variance estimate, estimated using perturbating-resampling, and a 95% confidence interval. If a confidence interval is requested two versions are provided: a normal approximation based interval and a quantile based interval, both use perturbation-resampling. 
</p>


<h3>Usage</h3>

<pre><code class="language-R">delta.surv.estimate(xone, xzero, deltaone, deltazero, t, var = FALSE, conf.int 
= FALSE, weight = NULL, weight.perturb = NULL, approx = T)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>xone</code></td>
<td>


<p>numeric vector, the observed event times in the treatment group, X = min(T,C) where T is the time of the primary outcome and C is the censoring time.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xzero</code></td>
<td>


<p>numeric vector, the observed event times in the control group, X = min(T,C) where T is the time of the primary outcome and C is the censoring time.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deltaone</code></td>
<td>


<p>numeric vector, the event indicators for the treatment group, D = I(T&lt;C) where T is the time of the primary outcome and C is the censoring time.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deltazero</code></td>
<td>


<p>numeric vector, the event indicators for the control group, D = I(T&lt;C) where T is the time of the primary outcome and C is the censoring time.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t</code></td>
<td>


<p>the time of interest.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var</code></td>
<td>


<p>TRUE or FALSE; indicates whether a variance estimate for delta is requested, default is FALSE.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.int</code></td>
<td>


<p>TRUE or FALSE; indicates whether a 95% confidence interval for delta is requested, default is FALSE.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight</code></td>
<td>


<p>a <code class="reqn">n_1+n_0</code> by <code class="reqn">x</code> matrix of weights where <code class="reqn">n_1 =</code> sample size in treatment group and <code class="reqn">n_0 =</code> sample size in the control group, default is null; generally not supplied by use but only used by other functions.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight.perturb</code></td>
<td>


<p>a <code class="reqn">n_1+n_0</code> by <code class="reqn">x</code> matrix of weights where <code class="reqn">n_1 =</code>sample size in treatment group and <code class="reqn">n_0 =</code> sample size in the control group, default is null; generally used for confidence interval construction and may be supplied by user.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>approx</code></td>
<td>

<p>TRUE or FALSE indicating whether an approximation should be used when calculating the probability of censoring; most relevant in settings where the survival time of interest for the primary outcome is greater than the last observed event but before the last censored case, default is TRUE.
</p>
</td>
</tr>
</table>
<h3>Details</h3>


<p>Let <code class="reqn">G</code> be the binary treatment indicator with <code class="reqn">G=1</code> for treatment and <code class="reqn">G=0</code> for control and we assume throughout that subjects are randomly assigned to a treatment group at baseline. Let <code class="reqn">T</code> denote the time of the primary outcome of interest, death for example. We use potential outcomes notation such that <code class="reqn">T^{(g)}</code> denotes the time of the primary outcome under treatment <code class="reqn">G = g</code>. We define the treatment effect, <code class="reqn">\Delta(t)</code>, as the difference in survival rates by time <code class="reqn">t</code> under treatment versus control,
</p>
<p style="text-align: center;"><code class="reqn"> \Delta(t)=E\{ I(T^{(1)}&gt;t)\} - E\{I(T^{(0)}&gt;t)\} = P(T^{(1)}&gt;t) - P(T^{(0)}&gt;t)</code>
</p>

<p>where <code class="reqn">t&gt;t_0</code>
</p>
<p>Due to censoring, our data consist of <code class="reqn">n_1</code> observations <code class="reqn">\{(X_{1i}, \delta_{1i}), i=1,...,n_1\}</code> from the treatment group <code class="reqn">G=1</code> and <code class="reqn">n_0</code> observations <code class="reqn">\{(X_{0i}, \delta_{0i}), i=1,...,n_0\}</code> from the control group <code class="reqn">G=0</code> where <code class="reqn">X_{gi} = \min(T_{gi}, C_{ gi})</code>,  <code class="reqn">\delta_{gi} = I(T_{gi} &lt; C_{gi})</code>, and <code class="reqn">C_{gi}</code> denotes the censoring time for <code class="reqn">g= 1,0</code>, for individual <code class="reqn">i</code>. Throughout, we estimate the treatment effect <code class="reqn">\Delta(t)</code> as
</p>
<p style="text-align: center;"><code class="reqn"> \hat{\Delta}(t)  = n_1^{-1} \sum_{i=1}^{n_1} \frac{I(X_{1i}&gt;t)}{\hat{W}^C_1(t)} - n_0^{-1} \sum_{i=1}^{n_0} \frac{I(X_{0i}&gt;t)}{\hat{W}^C_0(t)}</code>
</p>

<p>where  <code class="reqn">\hat{W}^C_g(\cdot)</code> is the Kaplan-Meier estimator of survival for censoring for <code class="reqn">g=1,0.</code> 
</p>
<p>Variance estimation and confidence interval construction are performed using perturbation-resampling. Specifically, let <code class="reqn">\left \{ V^{(b)} = (V_{11}^{(b)}, ...V_{1n_1}^{(b)}, V_{01}^{(b)}, ...V_{0n_0}^{(b)})^T, b=1,....,D \right \}</code> be <code class="reqn">n \times D</code> independent copies of a positive random variables <code class="reqn">V</code> from a known distribution with unit mean and unit variance. Let
</p>
<p style="text-align: center;"><code class="reqn">\hat{\Delta}^{(b)} (t) = \frac{  \sum_{i=1}^{n_1} V_{1i}^{(b)} I(X_{1i}&gt;t)}{ \sum_{i=1}^{n_1} V_{1i}^{(b)} \hat{W}_1^{C(b)}(t)}  -\frac{  \sum_{i=1}^{n_0} V_{0i}^{(b)} I(X_{0i}&gt;t)}{ \sum_{i=1}^{n_0} V_{0i}^{(b)} \hat{W}_0^{C(b)}(t)}.</code>
</p>
<p> In this package, we use weights generated from an Exponential(1) distribution and use <code class="reqn">D=500</code>. The variance of <code class="reqn">\hat{\Delta}(t)</code> is obtained as the empirical variance of <code class="reqn">\{\hat{\Delta}(t)^{(b)}, b = 1,...,D\}.</code> We construct two versions of the <code class="reqn">95\%</code>confidence interval for <code class="reqn">\hat{\Delta}(t)</code>: one based on a normal approximation confidence interval using the estimated variance and another taking the 2.5th and 97.5th empirical percentiles of <code class="reqn">\hat{\Delta}(t)^{(b)}</code>.
</p>


<h3>Value</h3>






<p>A list is returned:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>delta </code></td>
<td>
<p>the estimate, <code class="reqn">\hat{\Delta}(t)</code>, described above. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var </code></td>
<td>
<p>the variance estimate of <code class="reqn">\hat{\Delta}(t)</code>; if var = TRUE or conf.int = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.int.normal</code></td>
<td>
<p>a vector of size 2; the 95% confidence interval for <code class="reqn">\hat{\Delta}(t)</code> based on a normal approximation; if conf.int = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.int.quantile</code></td>
<td>
<p>a vector of size 2; the 95% confidence interval for <code class="reqn">\hat{\Delta}(t)</code> based on sample quantiles of the perturbed values, described above; if conf.int = TRUE.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>


<p>Layla Parast
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(d_example_surv)
names(d_example_surv)
delta.surv.estimate(xone = d_example_surv$x1, xzero = d_example_surv$x0,  
deltaone = d_example_surv$delta1, deltazero = d_example_surv$delta0, t = 3)
</code></pre>


</div>