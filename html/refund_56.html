<div class="container">

<table style="width: 100%;"><tr>
<td>mfpca.sc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Multilevel functional principal components analysis by smoothed covariance</h2>

<h3>Description</h3>

<p>Decomposes functional observations using functional principal components
analysis. A mixed model framework is used to estimate scores and obtain
variance estimates.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mfpca.sc(
  Y = NULL,
  id = NULL,
  visit = NULL,
  twoway = FALSE,
  argvals = NULL,
  nbasis = 10,
  pve = 0.99,
  npc = NULL,
  makePD = FALSE,
  center = TRUE,
  cov.est.method = 2,
  integration = "trapezoidal"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Y, </code></td>
<td>
<p>The user must supply a matrix of functions on a regular grid</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>Must be supplied, a vector containing the id information used to identify clusters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>visit</code></td>
<td>
<p>A vector containing information used to identify visits. Defaults to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>twoway</code></td>
<td>
<p>logical, indicating whether to carry out twoway ANOVA and calculate visit-specific means. Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>argvals</code></td>
<td>
<p>function argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbasis</code></td>
<td>
<p>number of B-spline basis functions used for estimation of the
mean function and bivariate smoothing of the covariance surface.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pve</code></td>
<td>
<p>proportion of variance explained: used to choose the number of
principal components.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npc</code></td>
<td>
<p>prespecified value for the number of principal components (if
given, this overrides <code>pve</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>makePD</code></td>
<td>
<p>logical: should positive definiteness be enforced for the
covariance surface estimate? Defaults to <code>FALSE</code> Only <code>FALSE</code> is currently supported.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>center</code></td>
<td>
<p>logical: should an estimated mean function be subtracted from
<code>Y</code>? Set to <code>FALSE</code> if you have already demeaned the data using
your favorite mean function estimate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov.est.method</code></td>
<td>
<p>covariance estimation method. If set to <code>1</code>, a
one-step method that applies a bivariate smooth to the <code class="reqn">y(s_1)y(s_2)</code>
values. This can be very slow. If set to <code>2</code> (the default), a two-step
method that obtains a naive covariance estimate which is then smoothed. <code>2</code> is currently supported.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>integration</code></td>
<td>
<p>quadrature method for numerical integration; only
<code>"trapezoidal"</code> is currently supported.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function computes a multilevel FPC decomposition for a set of observed curves,
which may be sparsely observed and/or measured with error. A mixed model
framework is used to estimate level 1 and level 2  scores.
</p>
<p>MFPCA was proposed in Di et al. (2009), with variations for 
MFPCA with sparse data in Di et al. (2014). 
<code>mfpca.sc</code> uses penalized splines to smooth the covariance functions, as
Described in Di et al. (2009) and Goldsmith et al. (2013).
</p>


<h3>Value</h3>

<p>An object of class <code>mfpca</code> containing:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>Yhat</code></td>
<td>
<p>FPC approximation (projection onto leading components)
of <code>Y</code>, estimated curves for all subjects and visits</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Yhat.subject</code></td>
<td>
<p>estimated subject specific curves for all subjects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>the observed data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scores</code></td>
<td>
<p><code class="reqn">n
\times npc</code> matrix of estimated FPC scores for level1 and level2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu</code></td>
<td>
<p>estimated mean
function (or a vector of zeroes if <code>center==FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>efunctions
</code></td>
<td>
<p><code class="reqn">d \times npc</code> matrix of estimated eigenfunctions of the functional
covariance, i.e., the FPC basis functions for levels 1 and 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>evalues</code></td>
<td>
<p>estimated
eigenvalues of the covariance operator, i.e., variances of FPC scores for levels 1 and 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npc </code></td>
<td>
<p>number of FPCs: either the supplied <code>npc</code>, or the minimum
number of basis functions needed to explain proportion <code>pve</code> of the
variance in the observed curves for levels 1 and 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma2</code></td>
<td>
<p>estimated measurement error
variance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eta</code></td>
<td>
<p>the estimated visit specific shifts from overall mean.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Julia Wrobel <a href="mailto:jw3134@cumc.columbia.edu">jw3134@cumc.columbia.edu</a>, Jeff Goldsmith <a href="mailto:jeff.goldsmith@columbia.edu">jeff.goldsmith@columbia.edu</a>, and Chongzhi Di
</p>


<h3>References</h3>

<p>Di, C., Crainiceanu, C., Caffo, B., and Punjabi, N. (2009).
Multilevel functional principal component analysis. <em>Annals of Applied
Statistics</em>, 3, 458–488.
</p>
<p>Di, C., Crainiceanu, C., Caffo, B., and Punjabi, N. (2014).
Multilevel sparse functional principal component analysis. <em>Stat</em>, 3, 126–143.
</p>
<p>Goldsmith, J., Greven, S., and Crainiceanu, C. (2013). Corrected confidence
bands for functional data using principal components. <em>Biometrics</em>,
69(1), 41–51.
</p>


<h3>Examples</h3>

<pre><code class="language-R"> ## Not run: 
 data(DTI)
 DTI = subset(DTI, Nscans &lt; 6)  ## example where all subjects have 6 or fewer visits
 id  = DTI$ID
 Y = DTI$cca
 mfpca.DTI =  mfpca.sc(Y=Y, id = id, twoway = TRUE)
 
## End(Not run)
</code></pre>


</div>