<div class="container">

<table style="width: 100%;"><tr>
<td>coverage</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimating Coverage Probability</h2>

<h3>Description</h3>

<p><code>coverage</code> estimates Rao-Blackwellized and simple unbiased coverage probabilities.</p>


<h3>Usage</h3>

<pre><code class="language-R">coverage(gbp.object, A.or.r, reg.coef, mean.PriorDist, nsim = 100)</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>gbp.object</code></td>
<td>

<p>a resultant object of <code>gbp</code> function. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A.or.r</code></td>
<td>

<p>(optional) a given true numeric value of <em>A</em> for Gaussian data or of <em>r</em> for Binomial and Poisson data. If not designated, the estimated value in the <code>gbp.object</code> object will be considered as a true value.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reg.coef</code></td>
<td>

<p>(optional) a given true (<em>m</em> by 1) vector for regression coefficients, <code class="reqn">\beta</code>, where <em>m</em> is the number of regression coefficients including an intercept. If not designated, the estimated value in the <code>gbp.object</code> object will be considered as a true value.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mean.PriorDist</code></td>
<td>

<p>(optional) a given true numeric value for the mean of (second-level) prior distribution. If not designated, the previously known value in the <code>gbp.object</code> object will be considered as a known prior mean.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsim</code></td>
<td>

<p>number of datasets to be generated. Default is 100.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>As for the argument <code>gbp.object</code>, if the result of <code>gbp</code> is designated to 
<code>b</code>, for example <br> "<code>b &lt;- gbp(z, n, model = "binomial")</code>", the argument <code>gbp.object</code> indicates this <code>b</code>.
</p>
<p>Data generating process is based on a second-level hierarchical model. The first-level hierarchy is 
a distribution of observed data and the second-level is a conjugate prior distribution 
on the first-level parameter.
</p>
<p>To be specific, for Normal data, <code>gbp</code> constructs a two-level Normal-Normal 2-level model. <code class="reqn">\sigma^{2}_{j}</code> below is assumed to be known or to be accurately estimated (<code class="reqn">s^{2}_{j}</code>) and subscript <em>j</em> indicates <em>j</em>-th group in a dataset.
</p>
<p style="text-align: center;"><code class="reqn">(y_{j} | \theta_{j}) \stackrel{ind}{\sim} N(\theta_{j}, \sigma^{2}_{j})</code>
</p>

<p style="text-align: center;"><code class="reqn">(\theta_{j} |\mu_{0j} , A) \stackrel{ind}{\sim} N(\mu_{0j}, A)</code>
</p>

<p style="text-align: center;"><code class="reqn">\mu_{0j} = x_{j}'\beta</code>
</p>

<p>for <code class="reqn">j = 1, \ldots, k</code>, where <em>k</em> is the number of groups (units) in a dataset.
</p>
<p>For Poisson data, <code>gbp</code> builds a two-level Poisson-Gamma multi-level model. A square bracket below indicates [mean, variance] of distribution and a constant multiplied to the notation representing Gamma distribution (Gam) is a scale. Also, for consistent notation, <code class="reqn">y_{j}=\frac{z_{j}}{n_{j}}</code> and <code class="reqn">n_{j}</code> can be interpreted as <em>j</em>-th group's exposure only in this Poisson-Gamma hierarchical model.
</p>
<p style="text-align: center;"><code class="reqn">(z_{j} | \theta_{j}) \stackrel{ind}{\sim} Pois(n_{j}\theta_{j})</code>
</p>

<p style="text-align: center;"><code class="reqn">(\theta_{j} | r, \mu_{0j}) \stackrel{ind}{\sim} \frac{1}{r}Gam(r\mu_{0j})\stackrel{ind}{\sim}Gam[\mu_{0j}, \mu_{0j} / r] </code>
</p>

<p style="text-align: center;"><code class="reqn">log(\mu_{0j}) = x_{j}'\beta</code>
</p>

<p>for <code class="reqn">j = 1, \ldots, k</code>, where <em>k</em> is the number of groups (units) in a dataset.
</p>
<p>For Binomial data, <code>gbp</code> sets a two-level Binomial-Beta multi-level model. For reference, a square bracket below indicates [mean, variance] of distribution and <code class="reqn">y_{j} = \frac{z_{j}}{n_{j}}</code>.
</p>
<p style="text-align: center;"><code class="reqn">(z_{j} | \theta_{j}) \stackrel{ind}{\sim} Bin(n_{j}, \theta_{j})</code>
</p>

<p style="text-align: center;"><code class="reqn">(\theta_{j} | r, \mu_{0j}) \stackrel{ind}{\sim} Beta(r\mu_{0j}, r(1-\mu_{0j})) \stackrel{ind}{\sim} Beta[\mu_{0j}, \mu_{0j}(1 - \mu_{0j}) / (r + 1)]</code>
</p>

<p style="text-align: center;"><code class="reqn">logit(\mu_{0j}) = x_{j}'\beta</code>
</p>

<p>for <code class="reqn">j = 1, \ldots, k</code>, where <em>k</em> is the number of groups (units) in a dataset.
</p>
<p>From now on, the subscript <em>(i)</em> means <em>i</em>-th simulation and the subscript <em>j</em> indicates <em>j</em>-th group. So, notations with a subscript <em>(i)</em> are (<em>k</em> by 1) vectors, for example <code class="reqn">\theta_{(i)}' = (\theta_{(i)1}, \theta_{(i)2}, \ldots, \theta_{(i)k})</code>.
</p>
<p>Pseudo-data generating process starts from the second-level hierarchy to the first-level. <code>coverage</code> first generates true parameters (<code class="reqn">\theta_{(i)}</code>) for <em>k</em> groups at the second-level and then moves onto the first-level to simulate pseudo-data sets, <code class="reqn">y_{(i)}</code> for Gaussian or <code class="reqn">z_{(i)}</code> for Binomial and Poisson data, given previously generated true parameters (<code class="reqn">\theta_{(i)}</code>). 
</p>
<p>So, in order to generate pseudo-datasets, <code>coverage</code> needs parameters of prior distribution,  
(<em>A</em> (or <em>r</em>) and <code class="reqn">\beta</code> (<code>reg.coef</code>)) 
or (<em>A</em> (or <em>r</em>) and <code class="reqn">\mu_{0}</code>). From here, we have four options to run <code>coverage</code>.
</p>
<p>First, if any values related to the prior distribution are not designated like 
<code>coverage(b, nsim = 10)</code>, then <code>coverage</code> will regard estimated values (or known prior mean, <code class="reqn">\mu_{0}</code>) in <code>b</code> (<code>gbp.object</code>) as given true values when it generates lots of pseudo-datasets. After sampling <code class="reqn">\theta_{(i)}</code> from the prior distribution determined by these estimated values (or known prior mean) in <code>b</code> (<code>gbp.object</code>), <code>coverage</code> creates an <em>i</em>-th pseudo-dataset based on <code class="reqn">\theta_{(i)}</code> just sampled.
</p>
<p>Second, <code>coverage</code> allows us to try different true values in generating datasets. Suppose <code>gbp.object</code> is based on the model with a known prior mean, <code class="reqn">\mu_{0}</code>. Then, we can try either different <code>A.or.r</code> or <code>mean.PriorDist</code>. For example, <code>coverage(b, A.or.r = 20, nsim = 10)</code>, <br><code>coverage(b, mean.PriorDist = 0.5, nsim = 10)</code>, or <br><code>coverage(b, A.or.r = 20, mean.PriorDist = 0.5, nsim = 10)</code>. Note that we cannot set <code>reg.coef</code> because the second-level mean (prior mean) is known in <code>gbp.object</code> to begin with.
</p>
<p>Suppose <code>gbp.object</code> is based on the model with an unknown prior mean. In this case, <code>gbp.object</code> has the estimation result of regression model, linear regression for Normal-Normal, log-linear regression for Poisson-Gamma, or logistic regression for Binomial-Beta, (only intercept term if there is no covariate) to estimate the unknown prior mean. Then, we can try some options: one or two of (<code>A.or.r</code>, <code>mean.PriorDist</code>, <code>reg.coef</code>). For example, <code>coverage(b, A.or.r = 20, nsim = 10)</code>,  <code>coverage(b, mean.PriorDist = 0.5, nsim = 10)</code>, or <br><code>coverage(b, reg.coef = 0.1, nsim = 10)</code> with no covariate where <code>reg.coef</code> is a designated intercept term. Estimates in <code>gbp.object</code> will be used for undesignated values. Also, we can try appropriate combinations of two arguments. For example, <br><code>coverage(b, A.or.r = 20, mean.PriorDist = 0.5, nsim = 10)</code> and <br><code>coverage(b, A.or.r = 20, reg.coef = 0.1, nsim = 10)</code>. If we have one covariate, a 2 by 1 vector should be designated for <code>reg.coef</code>, one for an intercept term and the other for a regression coefficient of the covariate. Note that the two arguments, <code>mean.PriorDist</code> and <code>reg.coef</code>, cannot be assigned together because we do not need <code>reg.coef</code> given <code>mean.PriorDist</code>. 
</p>
<p>The simple unbiased estimator of coverage probability in <em>j</em>-th group is a sample mean of indicators over all simulated datasets. The <em>j</em>-th indicator in <em>i</em>-th simulation is 1 if the estimated interval of the <em>j</em>-th group on <em>i</em>-th simulated dataset contains a true parameter 
<code class="reqn">\theta_{(i)j}</code> that generated the observed value of the <em>j</em>-th group in the 
<em>i</em>-th dataset.
</p>
<p>Rao-Blackwellized unbiased estimator for group <em>j</em> is a conditional expectation of the simple unbiased estimator given a sufficient statistic, <code class="reqn">y_{j}</code> for Gaussian or <code class="reqn">z_{j}</code> for Binomial and Poisson data.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>coverageRB</code></td>
<td>

<p>Rao-Blackwellized unbiased coverage estimate for each group averaged over all simulations.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coverageS</code></td>
<td>

<p>Simple unbiased coverage estimate for each group averaged over all simulations.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>average.coverageRB</code></td>
<td>

<p>Overall Rao-Blackwellized unbiased coverage estimate across all the groups and simulations.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overall.coverageRB</code></td>
<td>

<p>Overall Rao-Blackwellized unbiased coverage estimate across all the groups and simulations.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>average.coverageS</code></td>
<td>

<p>Overall simple unbiased coverage estimate across all the groups and simulations.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.coverageRB</code></td>
<td>

<p>Standard error of Rao-Blackwellized unbiased coverage estimate for each group.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.overall.coverageRB</code></td>
<td>

<p>Standard error of the overall Rao-Blackwellized unbiased coverage estimate.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.coverageS</code></td>
<td>

<p>Standard error of simple unbiased coverage estimate for each group.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raw.resultRB</code></td>
<td>

<p>All the Rao-Blackwellized unbiased coverage estimates for every group and for every simulation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raw.resultS</code></td>
<td>

<p>All the simple unbiased coverage estimates for every group and for every simulation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>confidence.lvl</code></td>
<td>

<p>Nominal confidence level 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>effective.n</code></td>
<td>

<p>The number of simulated data sets used to calculate the coverage estimates. The data sets may cause some errors in fitting models. For example, the data set may be against the conditions for the posteiror propriety in Binomial data.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>

<p>The model being used, "br", "pr", or "gr".
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>case</code></td>
<td>

<p>One of the cases used to re-draw the coverage plot by <code>coverage.plot</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betas</code></td>
<td>

<p>The regression coefficient used to generate simulated data sets.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A.r</code></td>
<td>

<p>The hyper-parameter value (A for Gaussian model, and r for both Binomial and Poisson models) used to generate simulated data sets.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priormeanused</code></td>
<td>

<p>The value of the prior mean(s) used to generate simulated data sets.
</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Hyungsuk Tak, Joseph Kelly, and Carl Morris</p>


<h3>References</h3>

<p>Tak, H., Kelly, J., and Morris, C. (2017) Rgbp: An R Package for Gaussian, Poisson, and Binomial Random Effects Models with Frequency Coverage Evaluations. <em>Journal of Statistical Software</em>. <b>78</b>, 5, 1–33.
</p>
<p>Christiansen, C. and Morris, C. (1997). Hierarchical Poisson Regression Modeling. <em>Journal of the American Statistical Association</em>. <b>92</b>, 438, 618–632.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
  # Loading datasets
  data(schools)
  y &lt;- schools$y
  se &lt;- schools$se

  # Arbitrary covariate for schools data
  x2 &lt;- rep(c(-1, 0, 1, 2), 2)

  # baseball data where z is Hits and n is AtBats
  z &lt;- c(18, 17, 16, 15, 14, 14, 13, 12, 11, 11, 10, 10, 10, 10, 10,  9,  8,  7)
  n &lt;- c(45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45)

  # One covariate: 1 if a player is an outfielder and 0 otherwise
  x1 &lt;- c(1,  1,  1,  1,  1,  0,  0,  0,  0,  1,  0,  0,  0,  1,  1,  0,  0,  0)
  
  #################################################################
  # Gaussian Regression Interactive Multi-level Modeling (GRIMM) #
  #################################################################

    ####################################################################################
    # If we do not have any covariate and do not know a mean of the prior distribution #
    ####################################################################################

    g &lt;- gbp(y, se, model = "gaussian")

    ### when we want to simulate pseudo datasets considering the estimated values 
    ### as true ones.
    gcv &lt;- coverage(g, nsim = 10)  

    ### gcv$coverageRB, gcv$coverageS, gcv$average.coverageRB, gcv$average.coverageS,
    ### gcv$minimum.coverageRB, gcv$raw.resultRB, gcv$raw.resultS

    ### gcv &lt;- coverage(g, mean.PriorDist = 3, nsim = 100)
    ### gcv &lt;- coverage(g, A.or.r = 150, nsim = 100)
    ### gcv &lt;- coverage(g, reg.coef = 10, nsim = 100)
    ### gcv &lt;- coverage(g, A.or.r = 150, mean.PriorDist = 3, nsim = 100)
    ### gcv &lt;- coverage(g, A.or.r = 150, reg.coef = 10, nsim = 100)

    ##################################################################################
    # If we have one covariate and do not know a mean of the prior distribution yet, #
    ##################################################################################

    g &lt;- gbp(y, se, x2, model = "gaussian")
 
    ### when we want to simulate pseudo datasets considering the estimated values 
    ### as true ones.
    gcv &lt;- coverage(g, nsim = 10)  
 
    ### gcv$coverageRB, gcv$coverageS, gcv$average.coverageRB, gcv$average.coverageS,
    ### gcv$minimum.coverageRB, gcv$raw.resultRB, gcv$raw.resultS

    ### gcv &lt;- coverage(g, mean.PriorDist = 3, nsim = 100)
    ### gcv &lt;- coverage(g, A.or.r = 200, nsim = 100)
    ### gcv &lt;- coverage(g, reg.coef = c(10, 2), nsim = 100)
    ### gcv &lt;- coverage(g, A.or.r = 200, mean.PriorDist = 3, nsim = 100)
    ### gcv &lt;- coverage(g, A.or.r = 200, reg.coef = c(10, 2), nsim = 100)

    ################################################
    # If we know a mean of the prior distribution, #
    ################################################

    g &lt;- gbp(y, se, mean.PriorDist = 8, model = "gaussian")

    ### when we want to simulate pseudo datasets considering the estimated values 
    ### as true ones.
    gcv &lt;- coverage(g, nsim = 10)  

    ### gcv$coverageRB, gcv$coverageS, gcv$average.coverageRB, gcv$average.coverageS,
    ### gcv$minimum.coverageRB, gcv$raw.resultRB, gcv$raw.resultS

    ### gcv &lt;- coverage(g, mean.PriorDist = 3, nsim = 100)
    ### gcv &lt;- coverage(g, A.or.r = 150, nsim = 100)
    ### gcv &lt;- coverage(g, A.or.r = 150, mean.PriorDist = 3, nsim = 100)

  ################################################################
  # Binomial Regression Interactive Multi-level Modeling (BRIMM) #
  ################################################################

    ####################################################################################
    # If we do not have any covariate and do not know a mean of the prior distribution #
    ####################################################################################

    b &lt;- gbp(z, n, model = "binomial")

    ### when we want to simulate pseudo datasets considering the estimated values 
    ### as true ones.
    bcv &lt;- coverage(b, nsim = 10)  

    ### bcv$coverageRB, bcv$coverageS, bcv$average.coverageRB, bcv$average.coverageS,
    ### bcv$minimum.coverageRB, bcv$raw.resultRB, bcv$raw.resultS

    ### bcv &lt;- coverage(b, mean.PriorDist = 0.2, nsim = 100)
    ### bcv &lt;- coverage(b, A.or.r = 50, nsim = 100)
    ### bcv &lt;- coverage(b, reg.coef = -1.5, nsim = 100)
    ### bcv &lt;- coverage(b, A.or.r = 50, mean.PriorDist = 0.2, nsim = 100)
    ### bcv &lt;- coverage(b, A.or.r = 50, reg.coef = -1.5, nsim = 100)

    ##################################################################################
    # If we have one covariate and do not know a mean of the prior distribution yet, #
    ##################################################################################

    b &lt;- gbp(z, n, x1, model = "binomial")

    ### when we want to simulate pseudo datasets considering the estimated values 
    ### as true ones.
    bcv &lt;- coverage(b, nsim = 10)  

    ### bcv$coverageRB, bcv$coverageS, bcv$average.coverageRB, bcv$average.coverageS,
    ### bcv$minimum.coverageRB, bcv$raw.resultRB, bcv$raw.resultS

    ### bcv &lt;- coverage(b, mean.PriorDist = 0.2, nsim = 100)
    ### bcv &lt;- coverage(b, A.or.r = 50, nsim = 100)
    ### bcv &lt;- coverage(b, reg.coef = c(-1.5, 0), nsim = 100)
    ### bcv &lt;- coverage(b, A.or.r = 40, mean.PriorDist = 0.2, nsim = 100)
    ### bcv &lt;- coverage(b, A.or.r = 40, reg.coef = c(-1.5, 0), nsim = 100)

    ################################################
    # If we know a mean of the prior distribution, #
    ################################################

    b &lt;- gbp(z, n, mean.PriorDist = 0.265, model = "binomial")

    ### when we want to simulate pseudo datasets considering the estimated values 
    ### as true ones.
    bcv &lt;- coverage(b, nsim = 10)  

    ### bcv$coverageRB, bcv$coverageS, bcv$average.coverageRB, bcv$average.coverageS,
    ### bcv$minimum.coverageRB, bcv$raw.resultRB, bcv$raw.resultS

    ### bcv &lt;- coverage(b, mean.PriorDist = 0.2, nsim = 100)
    ### bcv &lt;- coverage(b, A.or.r = 50, nsim = 100)
    ### bcv &lt;- coverage(b, A.or.r = 40, mean.PriorDist = 0.2, nsim = 100)

  ###############################################################
  # Poisson Regression Interactive Multi-level Modeling (PRIMM) #
  ###############################################################

    ################################################
    # If we know a mean of the prior distribution, #
    ################################################

    p &lt;- gbp(z, n, mean.PriorDist = 0.265, model = "poisson")

    ### when we want to simulate pseudo datasets considering the estimated values 
    ### as true ones.
    pcv &lt;- coverage(p, nsim = 10)  

    ### pcv$coverageRB, pcv$coverageS, pcv$average.coverageRB, pcv$average.coverageS,
    ### pcv$minimum.coverageRB, pcv$raw.resultRB, pcv$raw.resultS

    ### pcv &lt;- coverage(p, mean.PriorDist = 0.265, nsim = 100)
    ### pcv &lt;- coverage(p, A.or.r = 150, nsim = 100)
    ### pcv &lt;- coverage(p, A.or.r = 150, mean.PriorDist = 0.265, nsim = 100)

</code></pre>


</div>