<div class="container">

<table style="width: 100%;"><tr>
<td>outliergram</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Outliergram for univariate functional data sets</h2>

<h3>Description</h3>

<p>This function performs the outliergram of a univariate functional data set,
possibly with an adjustment of the true positive rate of outliers discovered
under assumption of gaussianity.
</p>


<h3>Usage</h3>

<pre><code class="language-R">outliergram(
  fData,
  MBD_data = NULL,
  MEI_data = NULL,
  p_check = 0.05,
  Fvalue = 1.5,
  adjust = FALSE,
  display = TRUE,
  xlab = NULL,
  ylab = NULL,
  main = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fData</code></td>
<td>
<p>the univariate functional dataset whose outliergram has to be
determined.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MBD_data</code></td>
<td>
<p>a vector containing the MBD for each element of the dataset.
If missing, MBDs are computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MEI_data</code></td>
<td>
<p>a vector containing the MEI for each element of the dataset.
If not not provided, MEIs are computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_check</code></td>
<td>
<p>percentage of observations with either low or high MEI to be
checked for outliers in the secondary step (shift towards the center of the
dataset).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Fvalue</code></td>
<td>
<p>the <code class="reqn">F</code> value to be used in the procedure that finds the
shape outliers by looking at the lower parabolic limit in the outliergram.
Default is <code>1.5</code>. You can also leave the default value and, by providing
the parameter <code>adjust</code>, specify that you want <code>Fvalue</code> to be
adjusted for the dataset provided in <code>fData</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adjust</code></td>
<td>
<p>either <code>FALSE</code> if you would like the default value for the
inflation factor, <code class="reqn">F = 1.5</code>, to be used, or a list specifying the
parameters required by the adjustment.
</p>

<ul>
<li>
<p>"<code>N_trials</code>": the number of repetitions of the adjustment
procedure based on the simulation of a gaussian population of functional
data, each one producing an adjusted value of <code class="reqn">F</code>, which will lead
to the averaged adjusted value <code class="reqn">\bar{F}</code>. Default is 20;
</p>
</li>
<li>
<p>"<code>trial_size</code>": the number of elements in the gaussian
population of functional data that will be simulated at each repetition of
the adjustment procedure. Default is <code>5 * fData$N</code>;
</p>
</li>
<li>
<p>"<code>TPR</code>": the True Positive Rate of outliers, i.e. the proportion
of observations in a dataset without shape outliers that have to be considered
outliers. Default is <code>2 * pnorm( 4 * qnorm( 0.25 ) )</code>;
</p>
</li>
<li>
<p>"<code>F_min</code>": the minimum value of <code class="reqn">F</code>, defining the left
boundary for the optimization problem aimed at finding, for a given dataset
of simulated gaussian data associated to <code>fData</code>, the optimal value of
<code class="reqn">F</code>. Default is 0.5;
</p>
</li>
<li>
<p>"<code>F_max</code>": the maximum value of <code class="reqn">F</code>, defining the right
boundary for the optimization problem aimed at finding, for a given dataset
of simulated gaussian data associated to <code>fData</code>, the optimal value of
<code class="reqn">F</code>. Default is 20;
</p>
</li>
<li>
<p>"<code>tol</code>": the tolerance to be used in the optimization problem
aimed at finding, for a given dataset of simulated gaussian data associated
to <code>fData</code>, the optimal value of <code class="reqn">F</code>. Default is <code>1e-3</code>;
</p>
</li>
<li>
<p>"<code>maxiter</code>": the maximum number of iterations to solve the
optimization problem aimed at finding, for a given dataset of simulated
gaussian data associated to <code>fData</code>, the optimal value of <code class="reqn">F</code>.
Default is <code>100</code>;
</p>
</li>
<li>
<p>"<code>VERBOSE</code>": a parameter controlling the verbosity of the
adjustment process;
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>display</code></td>
<td>
<p>either a logical value indicating whether you want the
outliergram to be displayed, or the number of the graphical device
where you want the outliergram to be displayed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>a list of two labels to use on the x axis when displaying the
functional dataset and the outliergram</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>a list of two labels to use on the y axis when displaying the
functional dataset and the outliergram;</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main</code></td>
<td>
<p>a list of two titles to be used on the plot of the functional
dataset and the outliergram;</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional graphical parameters to be used <em>only</em> in the plot
of the functional dataset</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Even when used graphically to plot the outliergram, the function returns a
list containing:
</p>

<ul>
<li>
<p><code>Fvalue</code>: the value of the parameter F used;
</p>
</li>
<li>
<p><code>d</code>: the vector of values of the parameter <code class="reqn">d</code> for each observation
(distance to the parabolic border of the outliergram);
</p>
</li>
<li>
<p><code>ID_outliers</code>: the vector of observations id corresponding to outliers.</p>
</li>
</ul>
<h3>Adjustment</h3>

<p>When the adjustment option is selected, the value of <code class="reqn">F</code> is optimized for
the univariate functional dataset provided with <code>fData</code>. In practice,
a number <code>adjust$N_trials</code> of times a synthetic population
(of size <code>adjust$trial_size</code> with the same covariance (robustly
estimated from data) and centerline as <code>fData</code> is simulated without
outliers and each time an optimized value <code class="reqn">F_i</code> is computed so that a
given proportion (<code>adjust$TPR</code>) of observations is flagged as outliers.
The final value of <code>F</code> for the outliergram is determined as an average
of <code class="reqn">F_1, F_2, \ldots, F_{N_{trials}}</code>. At each time step the optimization
problem is solved using <code>stats::uniroot</code> (Brent's method).
</p>


<h3>References</h3>

<p>Arribas-Gil, A., and Romo, J. (2014). Shape outlier detection and visualization
for functional data: the outliergram, <em>Biostatistics</em>, 15(4), 603-619.
</p>


<h3>See Also</h3>

<p><code>fData</code>, <code>MEI</code>, <code>MBD</code>,
<code>fbplot</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(1618)

N &lt;- 200
P &lt;- 200
N_extra &lt;- 4

grid &lt;- seq(0, 1, length.out = P)

Cov &lt;- exp_cov_function(grid, alpha = 0.2, beta = 0.8)

Data &lt;- generate_gauss_fdata(
  N = N,
  centerline = sin(4 * pi * grid),
  Cov = Cov
)

Data_extra &lt;- array(0, dim = c(N_extra, P))

Data_extra[1, ] &lt;- generate_gauss_fdata(
  N = 1,
  centerline = sin(4 * pi * grid + pi / 2),
  Cov = Cov
)

Data_extra[2, ] &lt;- generate_gauss_fdata(
  N = 1,
  centerline = sin(4 * pi * grid - pi / 2),
  Cov = Cov
)

Data_extra[3, ] &lt;- generate_gauss_fdata(
  N = 1,
  centerline = sin(4 * pi * grid + pi / 3),
  Cov = Cov
)

Data_extra[4, ] &lt;- generate_gauss_fdata(
  N = 1,
  centerline = sin(4 * pi * grid - pi / 3),
  Cov = Cov
)

Data &lt;- rbind(Data, Data_extra)

fD &lt;- fData(grid, Data)

# Outliergram with default Fvalue = 1.5
outliergram(fD, display = TRUE)

# Outliergram with Fvalue enforced to 2.5
outliergram(fD, Fvalue = 2.5, display = TRUE)


# Outliergram with estimated Fvalue to ensure TPR of 1%
outliergram(
  fData = fD,
  adjust = list(
    N_trials = 10,
    trial_size = 5 * nrow(Data),
    TPR = 0.01,
    VERBOSE = FALSE
  ),
  display = TRUE
)


</code></pre>


</div>