<div class="container">

<table style="width: 100%;"><tr>
<td>fnenvir</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Check Covariates and Parameters of a Function</h2>

<h3>Description</h3>

<p><code>fnenvir</code> finds the covariates and parameters in a function and
can modify it so that the covariates used in it are found in the data
object specified by <code>.envir</code>.
</p>
<p>If the data object has class, <code>repeated</code>, the key word
<code>times</code> in a function will use the response times from the data
object as a covariate.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fnenvir(.z, ...)
## Default S3 method:
fnenvir(.z, .envir=parent.frame(), .name=NULL, .expand=TRUE,
	.response=FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>.z</code></td>
<td>
<p>A function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.envir</code></td>
<td>
<p>The environment or data object of class,
<code>repeated</code>, <code>tccov</code>, or <code>tvcov</code>, in which the function
is to be interpreted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.name</code></td>
<td>
<p>Character string giving the name of the data object
specified by <code>.envir</code>. Ignored unless the latter is such an
object and only necessary when <code>fnenvir</code> is called within other
functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.expand</code></td>
<td>
<p>If TRUE, expand functions with only time-constant
covariates to return one value per observation instead of one value
per individual. Ignored unless <code>.envir</code> is an object of class,
<code>repeated</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.response</code></td>
<td>
<p>If TRUE, any response variable can be used in the
function. If FALSE, checks are made that the response is not also used
as a covariate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Arguments passed to other functions.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The (modified) function, of class <code>formulafn</code>, is returned with its
attributes giving the (new) model function, the covariate names, and
the parameter names.</p>


<h3>Author(s)</h3>

<p>J.K. Lindsey</p>


<h3>See Also</h3>

<p><code>FormulaMethods</code>,<code>covariates</code>,
<code>finterp</code>, <code>model</code>,
<code>parameters</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">fn &lt;- function(p) a+b*x
fnenvir(fn)
fn &lt;- function(p) a+p*x
fnenvir(fn)
x &lt;- 1:4
fnenvir(fn)
fn &lt;- function(p) p[1]+exp(p[2]*x)
fnenvir(fn)
#
y &lt;- matrix(rnorm(20),ncol=5)
y[3,3] &lt;- y[2,2] &lt;- NA
resp &lt;- restovec(y)
xx &lt;- tcctomat(x)
z1 &lt;- matrix(rnorm(20),ncol=5)
z2 &lt;- matrix(rnorm(20),ncol=5)
z3 &lt;- matrix(rnorm(20),ncol=5)
zz &lt;- tvctomat(z1)
zz &lt;- tvctomat(z2,old=zz)
reps &lt;- rmna(resp, ccov=xx, tvcov=zz)
rm(y, x, z1, z2)
#
# repeated objects
func1 &lt;- function(p) p[1]+p[2]*x+p[3]*z2
print(fn1 &lt;- fnenvir(func1, .envir=reps))
fn1(2:4)
#
# time-constant covariates
func2 &lt;- function(p) p[1]+p[2]*x
print(fn2 &lt;- fnenvir(func2, .envir=reps))
fn2(2:3)
print(fn2a &lt;- fnenvir(func2, .envir=xx))
fn2a(2:3)
#
# time-varying covariates
func3 &lt;- function(p) p[1]+p[2]*z1+p[3]*z2
print(fn3 &lt;- fnenvir(func3, .envir=reps))
fn3(2:4)
print(fn3a &lt;- fnenvir(func3, .envir=zz))
fn3a(2:4)
# including times
func3b &lt;- function(p) p[1]+p[2]*z1+p[3]*z2+p[4]*times
print(fn3b &lt;- fnenvir(func3b, .envir=reps))
fn3b(2:5)
#
# with typing error and a variable not in the data object
func4 &lt;- function(p) p[1]+p2[2]*z1+p[3]*z2+p[4]*z3
print(fn4 &lt;- fnenvir(func4, .envir=reps))
#
# first-order one-compartment model
# data objects for formulae
dose &lt;- c(2,5)
dd &lt;- tcctomat(dose)
times &lt;- matrix(rep(1:20,2), nrow=2, byrow=TRUE)
tt &lt;- tvctomat(times)
# vector covariates for functions
dose &lt;- c(rep(2,20),rep(5,20))
times &lt;- rep(1:20,2)
# functions
mu &lt;- function(p) {
	absorption &lt;- exp(p[1])
	elimination &lt;- exp(p[2])
	absorption*exp(-p[3])*dose/(absorption-elimination)*
		(exp(-elimination*times)-exp(-absorption*times))}
shape &lt;- function(p) exp(p[1]-p[2])*times*dose*exp(-exp(p[1])*times)
# response
conc &lt;- matrix(rgamma(40,shape(log(c(0.1,0.4))),
	scale=mu(log(c(1,0.3,0.2))))/shape(log(c(0.1,0.4))),ncol=20,byrow=TRUE)
conc[,2:20] &lt;- conc[,2:20]+0.5*(conc[,1:19]-matrix(mu(log(c(1,0.3,0.2))),
	ncol=20,byrow=TRUE)[,1:19])
conc &lt;- restovec(ifelse(conc&gt;0,conc,0.01))
reps &lt;- rmna(conc, ccov=dd, tvcov=tt)
#
print(fn5 &lt;- fnenvir(mu,.envir=reps))
fn5(c(0,-1.2,-1.6))
</code></pre>


</div>