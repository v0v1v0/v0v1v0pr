<div class="container">

<table style="width: 100%;"><tr>
<td>mfpca.face</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Multilevel functional principal components analysis with fast covariance estimation</h2>

<h3>Description</h3>

<p>Decompose dense or sparse multilevel functional observations using multilevel
functional principal component analysis with the fast covariance estimation
approach.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mfpca.face(
  Y,
  id,
  visit = NULL,
  twoway = TRUE,
  weight = "obs",
  argvals = NULL,
  pve = 0.99,
  npc = NULL,
  pve2 = NULL,
  npc2 = NULL,
  p = 3,
  m = 2,
  knots = 35,
  silent = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>A multilevel functional dataset on a regular grid stored in a matrix.
Each row of the data is the functional observations at one visit for one subject.
Missingness is allowed and need to be labeled as NA. The data must be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>A vector containing the id information to identify the subjects. The
data must be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>visit</code></td>
<td>
<p>A vector containing information used to identify the visits.
If not provided, assume the visit id are 1,2,... for each subject.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>twoway</code></td>
<td>
<p>Logical, indicating whether to carry out twoway ANOVA and
calculate visit-specific means. Defaults to <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight</code></td>
<td>
<p>The way of calculating covariance. <code>weight = "obs"</code> indicates
that the sample covariance is weighted by observations. <code>weight = "subj"</code>
indicates that the sample covariance is weighted equally by subjects. Defaults to <code>"obs"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>argvals</code></td>
<td>
<p>A vector containing observed locations on the functional domain.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pve</code></td>
<td>
<p>Proportion of variance explained. This value is used to choose the
number of principal components for both levels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npc</code></td>
<td>
<p>Pre-specified value for the number of principal components.
If given, this overrides <code>pve</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pve2</code></td>
<td>
<p>Proportion of variance explained in level 2. If given, this overrides
the value of <code>pve</code> for level 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npc2</code></td>
<td>
<p>Pre-specified value for the number of principal components in level 2.
If given, this overrides <code>npc</code> for level 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>The degree of B-splines functions to use. Defaults to 3.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>
<p>The order of difference penalty to use. Defaults to 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>Number of knots to use or the vectors of knots. Defaults to 35.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>silent</code></td>
<td>
<p>Logical, indicating whether to not display the name of each step.
Defaults to <code>TRUE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The fast MFPCA approach (Cui et al., 2023) uses FACE (Xiao et al., 2016) to estimate
covariance functions and mixed model equations (MME) to predict
scores for each level. As a result, it has lower computational complexity than
MFPCA (Di et al., 2009) implemented in the <code>mfpca.sc</code> function, and
can be applied to decompose data sets with over 10000 subjects and over 10000
dimensions.
</p>


<h3>Value</h3>

<p>A list containing:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>Yhat</code></td>
<td>
<p>FPC approximation (projection onto leading components)
of <code>Y</code>, estimated curves for all subjects and visits</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Yhat.subject</code></td>
<td>
<p>Estimated subject specific curves for all subjects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y.df</code></td>
<td>
<p>The observed data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu</code></td>
<td>
<p>estimated mean function (or a vector of zeroes if <code>center==FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eta</code></td>
<td>
<p>The estimated visit specific shifts from overall mean.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scores</code></td>
<td>
<p>A matrix of estimated FPC scores for level1 and level2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>efunctions</code></td>
<td>
<p>A matrix of estimated eigenfunctions of the functional
covariance, i.e., the FPC basis functions for levels 1 and 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>evalues</code></td>
<td>
<p>Estimated eigenvalues of the covariance operator, i.e., variances
of FPC scores for levels 1 and 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pve</code></td>
<td>
<p>The percent variance explained by the returned number of PCs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npc</code></td>
<td>
<p>Number of FPCs: either the supplied <code>npc</code>, or the minimum
number of basis functions needed to explain proportion <code>pve</code> of the
variance in the observed curves for levels 1 and 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma2</code></td>
<td>
<p>Estimated measurement error variance.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Ruonan Li <a href="mailto:rli20@ncsu.edu">rli20@ncsu.edu</a>, Erjia Cui <a href="mailto:ecui@umn.edu">ecui@umn.edu</a>
</p>


<h3>References</h3>

<p>Cui, E., Li, R., Crainiceanu, C., and Xiao, L. (2023). Fast multilevel
functional principal component analysis. <em>Journal of Computational and
Graphical Statistics</em>, 32(3), 366-377.
</p>
<p>Di, C., Crainiceanu, C., Caffo, B., and Punjabi, N. (2009).
Multilevel functional principal component analysis. <em>Annals of Applied
Statistics</em>, 3, 458-488.
</p>
<p>Xiao, L., Ruppert, D., Zipunnikov, V., and Crainiceanu, C. (2016).
Fast covariance estimation for high-dimensional functional data.
<em>Statistics and Computing</em>, 26, 409-421.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(DTI)
mfpca.DTI &lt;- mfpca.face(Y = DTI$cca, id = DTI$ID, twoway = TRUE)
</code></pre>


</div>