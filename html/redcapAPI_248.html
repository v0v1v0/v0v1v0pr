<div class="container">

<table style="width: 100%;"><tr>
<td>unlockREDCap</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Open REDCap connections using cryptolocker for storage of API_KEYs.</h2>

<h3>Description</h3>

<p>Opens a set of connections to REDcap from API_KEYs stored in an encrypted keyring.
If the keyring does not exist, it will ask for password to this keyring to use on
later requests. Next it
will ask for the API_KEYs specified in <code>connections</code>. If an API_KEY does not
work, it will request again. On later executions it will use an open keyring
to retrieve all API_KEYs or for a password if the keyring is currently
locked.
</p>


<h3>Usage</h3>

<pre><code class="language-R">unlockREDCap(
  connections,
  url,
  keyring,
  envir = NULL,
  passwordFUN = .default_pass(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>connections</code></td>
<td>
<p>character vector. A list of strings that define the
connections with associated API_KEYs to load into environment. Each
name should correspond to a REDCap project for traceability, but
it can be named anything one desires.
The name in the returned list is this name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>url</code></td>
<td>
<p>character. The url of one's institutional REDCap server api.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keyring</code></td>
<td>
<p>character. Potential keyring, not used by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>envir</code></td>
<td>
<p>environment. The target environment for the connections. Defaults to NULL
which returns the keys as a list. Use <code>globalenv()</code> to assign in the
global environment. Will accept a number such a '1' for global as well.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>passwordFUN</code></td>
<td>
<p>function. Function to get the password for the keyring. Usually defaults <code>getPass::getPass</code>.
On MacOS it will use rstudioapi::askForPassword if available.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed to <code>redcapConnection()</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If one forgets the password to this keyring, or wishes to start over:
<code>keyring::keyring_delete("&lt;NAME_OF_KEY_RING_HERE&gt;")</code>
</p>
<p>Consistent behavior requires <code>options(keyring_backend=keyring::backend_file)</code> to
be set. It is recommended to place this in <code style="white-space: pre;">⁠~/.Rprofile⁠</code>.
</p>
<p>For production servers where the password must be stored in a readable
plain text file, it will search for <code style="white-space: pre;">⁠../&lt;basename&gt;.yml⁠</code>. DO NOT USE
this unless one is a sysadmin, as this defeats the security and purpose of
a local encrypted file. The expected structure of this yaml file is
as follows:
</p>
<pre>
other-config-stuff1: blah blah
redcapAPI:
  keys:
    intake: THIS_IS_THE_INTAKE_DATABASE_APIKEY
    details: THIS_IS_THE_DETAILS_DATABASE_APIKEY
other-config-stuff2: blah blah
other-config-stuff3: blah blah
</pre>
<p>For production servers the use of ENV variables is also supported. The connection
string is converted to upper case for the search of ENV. If a YAML
and ENV variable both exist, the YAML will take precedence.
</p>
<p>IMPORTANT: Make sure that R is set to NEVER save workspace to .RData
as this <em>is</em> writing the API_KEY to a local file in clear text because
connection objects contain the unlocked key in memory. Tips
are provided in <code>vignette("redcapAPI-best-practices")</code>.
</p>


<h3>Value</h3>

<p>If <code>envir</code> is NULL returns a list of opened connections. Otherwise
connections are assigned into the specified <code>envir</code>.
</p>


<h3>See Also</h3>

<p><code>redcapConnection()</code>
</p>


<h4>Vignettes</h4>

<p><code>vignette("redcapAPI-best-practices")</code>, <br><code>vignette("redcapAPI-getting-started-connecting")</code>
</p>



<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
options(keyring_backend=keyring::backend_file) # Put in .Rprofile

unlockREDCap(c(test_conn    = 'TestRedcapAPI',
               sandbox_conn = 'SandboxAPI'),
             keyring      = '&lt;NAME_OF_KEY_RING_HERE&gt;',
             envir        = globalenv(),
             url          = 'https://&lt;INSTITUTIONS_REDCAP_DOMAIN&gt;/api/') 

## End(Not run)
</code></pre>


</div>